<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flujos de Cambios</title>

    <link rel="alternate" href="https://campusempresa.com/mongodb/change-streams" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mongodb/change-streams" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mongodb/change-streams" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
										<a href="https://enterprisecampus.net/mongodb/change-streams" class="px-2">EN</a></b>
				|
				<b class="px-2">ES</b>
				|
				<a href="https://campusempresa.cat/mongodb/change-streams" class="px-2">CA</a>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Proyecto</a>
				<a href="/about">Sobre nosotros</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donaciones</a>
				<a href="/licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='transactions-in-mongodb'>&#x25C4;Transacciones en MongoDB</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Flujos de Cambios</a>
	</div>
	<div class='col-4 text-end'>
					<a href='full-text-search'>Búsqueda de Texto Completo &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Los Flujos de Cambios en MongoDB proporcionan una forma poderosa de escuchar los cambios en tiempo real en tu base de datos. Esta característica es particularmente útil para aplicaciones que necesitan responder a los cambios en la base de datos a medida que ocurren, como análisis en tiempo real, notificaciones y sincronización de datos.</p>
</div><h1>Introducción a los Flujos de Cambios</h1>
<div class='content'><ul>
<li><strong>Definición</strong>: Los Flujos de Cambios permiten a las aplicaciones acceder a cambios de datos en tiempo real sin la complejidad y sobrecarga del sondeo.</li>
<li><strong>Casos de Uso</strong>:
<ul>
<li>Análisis en tiempo real</li>
<li>Notificaciones y alertas</li>
<li>Sincronización de datos entre diferentes sistemas</li>
<li>Auditoría y registro de cambios</li>
</ul>
</li>
</ul>
</div><h1>Habilitando los Flujos de Cambios</h1>
<div class='content'><p>Para usar los Flujos de Cambios, debes asegurarte de que tu implementación de MongoDB cumpla con los siguientes requisitos:</p>
<ul>
<li>Versión de MongoDB 3.6 o posterior.</li>
<li>Configuración de conjunto de réplicas o clúster fragmentado.</li>
</ul>
</div><h1>Uso Básico</h1>
<div class='content'></div><h2>Abriendo un Flujo de Cambios</h2>
<div class='content'><p>Para abrir un Flujo de Cambios, puedes usar el método <code>watch</code> en una colección, base de datos o en toda la implementación.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBNb25nb0NsaWVudCB9ID0gcmVxdWlyZSgnbW9uZ29kYicpOwoKYXN5bmMgZnVuY3Rpb24gbWFpbigpIHsKICBjb25zdCB1cmkgPSAieW91cl9tb25nb2RiX2Nvbm5lY3Rpb25fc3RyaW5nIjsKICBjb25zdCBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQodXJpLCB7IHVzZU5ld1VybFBhcnNlcjogdHJ1ZSwgdXNlVW5pZmllZFRvcG9sb2d5OiB0cnVlIH0pOwoKICB0cnkgewogICAgYXdhaXQgY2xpZW50LmNvbm5lY3QoKTsKICAgIGNvbnN0IGRhdGFiYXNlID0gY2xpZW50LmRiKCd5b3VyX2RhdGFiYXNlJyk7CiAgICBjb25zdCBjb2xsZWN0aW9uID0gZGF0YWJhc2UuY29sbGVjdGlvbigneW91cl9jb2xsZWN0aW9uJyk7CgogICAgY29uc3QgY2hhbmdlU3RyZWFtID0gY29sbGVjdGlvbi53YXRjaCgpOwoKICAgIGNoYW5nZVN0cmVhbS5vbignY2hhbmdlJywgKGNoYW5nZSkgPT4gewogICAgICBjb25zb2xlLmxvZygnQ2FtYmlvIGRldGVjdGFkbzonLCBjaGFuZ2UpOwogICAgfSk7CgogIH0gZmluYWxseSB7CiAgICAvLyBhd2FpdCBjbGllbnQuY2xvc2UoKTsgLy8gRGVzY29tZW50YSBlc3RhIGzDrW5lYSBwYXJhIGNlcnJhciBsYSBjb25leGnDs24gY3VhbmRvIHRlcm1pbmVzCiAgfQp9CgptYWluKCkuY2F0Y2goY29uc29sZS5lcnJvcik7"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { MongoClient } = require('mongodb');

async function main() {
  const uri = &quot;your_mongodb_connection_string&quot;;
  const client = new MongoClient(uri, { useNewUrlParser: true, useUnifiedTopology: true });

  try {
    await client.connect();
    const database = client.db('your_database');
    const collection = database.collection('your_collection');

    const changeStream = collection.watch();

    changeStream.on('change', (change) =&gt; {
      console.log('Cambio detectado:', change);
    });

  } finally {
    // await client.close(); // Descomenta esta l&iacute;nea para cerrar la conexi&oacute;n cuando termines
  }
}

main().catch(console.error);</pre></div><div class='content'></div><h2>Estructura del Evento de Cambio</h2>
<div class='content'><p>Un documento de evento de cambio contiene varios campos que proporcionan información sobre el cambio:</p>
<ul>
<li><strong>_id</strong>: Un identificador único para el evento de cambio.</li>
<li><strong>operationType</strong>: El tipo de operación que desencadenó el cambio (por ejemplo, insert, update, delete).</li>
<li><strong>fullDocument</strong>: El documento afectado por el cambio (solo para operaciones de inserción y actualización).</li>
<li><strong>ns</strong>: El espacio de nombres (base de datos y colección) del documento cambiado.</li>
<li><strong>documentKey</strong>: El identificador único del documento cambiado.</li>
</ul>
</div><h2>Ejemplo de Evento de Cambio</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ewogICJfaWQiOiB7ICJ0cyI6IHsgIiR0aW1lc3RhbXAiOiB7ICJ0IjogMTYyMDA3NTYwMCwgImkiOiAxIH0gfSwgIm5zIjogInlvdXJfZGF0YWJhc2UueW91cl9jb2xsZWN0aW9uIiwgImRvY3VtZW50S2V5IjogeyAiX2lkIjogMSB9IH0sCiAgIm9wZXJhdGlvblR5cGUiOiAiaW5zZXJ0IiwKICAiZnVsbERvY3VtZW50IjogeyAiX2lkIjogMSwgIm5hbWUiOiAiSm9obiBEb2UiLCAiYWdlIjogMzAgfSwKICAibnMiOiB7ICJkYiI6ICJ5b3VyX2RhdGFiYXNlIiwgImNvbGwiOiAieW91cl9jb2xsZWN0aW9uIiB9LAogICJkb2N1bWVudEtleSI6IHsgIl9pZCI6IDEgfQp9"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>{
  &quot;_id&quot;: { &quot;ts&quot;: { &quot;$timestamp&quot;: { &quot;t&quot;: 1620075600, &quot;i&quot;: 1 } }, &quot;ns&quot;: &quot;your_database.your_collection&quot;, &quot;documentKey&quot;: { &quot;_id&quot;: 1 } },
  &quot;operationType&quot;: &quot;insert&quot;,
  &quot;fullDocument&quot;: { &quot;_id&quot;: 1, &quot;name&quot;: &quot;John Doe&quot;, &quot;age&quot;: 30 },
  &quot;ns&quot;: { &quot;db&quot;: &quot;your_database&quot;, &quot;coll&quot;: &quot;your_collection&quot; },
  &quot;documentKey&quot;: { &quot;_id&quot;: 1 }
}</pre></div><div class='content'></div><h1>Uso Avanzado</h1>
<div class='content'></div><h2>Filtrando Eventos de Cambio</h2>
<div class='content'><p>Puedes filtrar eventos de cambio usando un pipeline de agregación para recibir solo los cambios que te interesan.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgcGlwZWxpbmUgPSBbCiAgeyAkbWF0Y2g6IHsgJ2Z1bGxEb2N1bWVudC5hZ2UnOiB7ICRndGU6IDE4IH0gfSB9Cl07Cgpjb25zdCBjaGFuZ2VTdHJlYW0gPSBjb2xsZWN0aW9uLndhdGNoKHBpcGVsaW5lKTsKCmNoYW5nZVN0cmVhbS5vbignY2hhbmdlJywgKGNoYW5nZSkgPT4gewogIGNvbnNvbGUubG9nKCdDYW1iaW8gZmlsdHJhZG8gZGV0ZWN0YWRvOicsIGNoYW5nZSk7Cn0pOw=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const pipeline = [
  { $match: { 'fullDocument.age': { $gte: 18 } } }
];

const changeStream = collection.watch(pipeline);

changeStream.on('change', (change) =&gt; {
  console.log('Cambio filtrado detectado:', change);
});</pre></div><div class='content'></div><h2>Reanudando los Flujos de Cambios</h2>
<div class='content'><p>Los Flujos de Cambios pueden reanudarse desde un punto específico en el tiempo usando un token de reanudación. Esto es útil para manejar interrupciones.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgcmVzdW1lVG9rZW4gPSBjaGFuZ2VTdHJlYW0ucmVzdW1lVG9rZW47Cgpjb25zdCByZXN1bWVkQ2hhbmdlU3RyZWFtID0gY29sbGVjdGlvbi53YXRjaChbXSwgeyByZXN1bWVBZnRlcjogcmVzdW1lVG9rZW4gfSk7CgpyZXN1bWVkQ2hhbmdlU3RyZWFtLm9uKCdjaGFuZ2UnLCAoY2hhbmdlKSA9PiB7CiAgY29uc29sZS5sb2coJ0NhbWJpbyByZWFudWRhZG8gZGV0ZWN0YWRvOicsIGNoYW5nZSk7Cn0pOw=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const resumeToken = changeStream.resumeToken;

const resumedChangeStream = collection.watch([], { resumeAfter: resumeToken });

resumedChangeStream.on('change', (change) =&gt; {
  console.log('Cambio reanudado detectado:', change);
});</pre></div><div class='content'></div><h2>Flujos de Cambios en una Base de Datos o Implementación</h2>
<div class='content'><p>También puedes observar cambios en toda una base de datos o implementación.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgZGJDaGFuZ2VTdHJlYW0gPSBkYXRhYmFzZS53YXRjaCgpOwpjb25zdCBkZXBsb3ltZW50Q2hhbmdlU3RyZWFtID0gY2xpZW50LndhdGNoKCk7CgpkYkNoYW5nZVN0cmVhbS5vbignY2hhbmdlJywgKGNoYW5nZSkgPT4gewogIGNvbnNvbGUubG9nKCdDYW1iaW8gZW4gbGEgYmFzZSBkZSBkYXRvcyBkZXRlY3RhZG86JywgY2hhbmdlKTsKfSk7CgpkZXBsb3ltZW50Q2hhbmdlU3RyZWFtLm9uKCdjaGFuZ2UnLCAoY2hhbmdlKSA9PiB7CiAgY29uc29sZS5sb2coJ0NhbWJpbyBlbiBsYSBpbXBsZW1lbnRhY2nDs24gZGV0ZWN0YWRvOicsIGNoYW5nZSk7Cn0pOw=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const dbChangeStream = database.watch();
const deploymentChangeStream = client.watch();

dbChangeStream.on('change', (change) =&gt; {
  console.log('Cambio en la base de datos detectado:', change);
});

deploymentChangeStream.on('change', (change) =&gt; {
  console.log('Cambio en la implementaci&oacute;n detectado:', change);
});</pre></div><div class='content'></div><h1>Conclusión</h1>
<div class='content'><p>Los Flujos de Cambios en MongoDB proporcionan un mecanismo robusto para monitorear cambios en tiempo real en tu base de datos. Al aprovechar los Flujos de Cambios, puedes construir aplicaciones receptivas que reaccionen instantáneamente a los cambios de datos. Ya sea que estés trabajando en análisis en tiempo real, notificaciones o sincronización de datos, los Flujos de Cambios ofrecen una solución flexible y eficiente.</p>
<ul>
<li><strong>Puntos Clave</strong>:
<ul>
<li>Los Flujos de Cambios permiten el monitoreo en tiempo real de los cambios en la base de datos.</li>
<li>Pueden usarse en colecciones, bases de datos o implementaciones completas.</li>
<li>Filtrar y reanudar los Flujos de Cambios proporciona control y confiabilidad adicionales.</li>
</ul>
</li>
</ul>
<p>Al dominar los Flujos de Cambios, puedes mejorar significativamente la capacidad de respuesta e interactividad de tus aplicaciones basadas en MongoDB.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='transactions-in-mongodb'>&#x25C4;Transacciones en MongoDB</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Flujos de Cambios</a>
	</div>
	<div class='col-4 text-end'>
					<a href='full-text-search'>Búsqueda de Texto Completo &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
