<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consultando la Base de Datos</title>

    <link rel="alternate" href="https://campusempresa.com/es/django/querying-the-database" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/django/querying-the-database" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/django/querying-the-database" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/es/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy<br> y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
										<b id="lit_lang_es" class="px-2">ES</b>
				|
				<a href="/ca/django/querying-the-database" id="lnk_lang_ca" data-lang="ca" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="objective">El Proyecto</a>
				<a href="about">Sobre nosotros</a>
				<a href="contribute">Contribuir</a>
				<a href="donate">Donaciones</a>
				<a href="licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='content'></div><h1>Introducción</h1>
<div class='content'><p>En esta sección, exploraremos cómo consultar la base de datos usando el ORM (Mapeo Objeto-Relacional) de Django. El ORM de Django proporciona una abstracción de alto nivel sobre SQL, permitiendo a los desarrolladores interactuar con la base de datos usando código Python. Esto facilita realizar operaciones CRUD (Crear, Leer, Actualizar, Eliminar) sin escribir consultas SQL en bruto.</p>
</div><h1>Consultas Básicas</h1>
<h2>Recuperar Todos los Objetos</h2>
<div class='content'><p>Para recuperar todos los objetos de un modelo, puedes usar el método <code>all()</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEJvb2sKCiMgUmVjdXBlcmFyIHRvZG9zIGxvcyBsaWJyb3MKYm9va3MgPSBCb29rLm9iamVjdHMuYWxsKCk="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Book

# Recuperar todos los libros
books = Book.objects.all()</pre></div><div class='content'></div><h2>Filtrar Objetos</h2>
<div class='content'><p>Para filtrar objetos basados en ciertos criterios, puedes usar el método <code>filter()</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEJvb2sKCiMgUmVjdXBlcmFyIGxpYnJvcyBwdWJsaWNhZG9zIGVuIDIwMjEKYm9va3NfMjAyMSA9IEJvb2sub2JqZWN0cy5maWx0ZXIocHVibGljYXRpb25feWVhcj0yMDIxKQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Book

# Recuperar libros publicados en 2021
books_2021 = Book.objects.filter(publication_year=2021)</pre></div><div class='content'></div><h2>Recuperar un Solo Objeto</h2>
<div class='content'><p>Para recuperar un solo objeto, puedes usar el método <code>get()</code>. Ten en cuenta que <code>get()</code> lanzará una excepción <code>DoesNotExist</code> si no se encuentra ningún objeto y una excepción <code>MultipleObjectsReturned</code> si se encuentran más de un objeto.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEJvb2sKCiMgUmVjdXBlcmFyIHVuIGxpYnJvIGNvbiB1biB0w610dWxvIGVzcGVjw61maWNvCnRyeToKICAgIGJvb2sgPSBCb29rLm9iamVjdHMuZ2V0KHRpdGxlPSJEamFuZ28gZm9yIEJlZ2lubmVycyIpCmV4Y2VwdCBCb29rLkRvZXNOb3RFeGlzdDoKICAgIHByaW50KCJMaWJybyBubyBlbmNvbnRyYWRvIikKZXhjZXB0IEJvb2suTXVsdGlwbGVPYmplY3RzUmV0dXJuZWQ6CiAgICBwcmludCgiU2UgZW5jb250cmFyb24gbcO6bHRpcGxlcyBsaWJyb3MiKQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Book

# Recuperar un libro con un t&iacute;tulo espec&iacute;fico
try:
    book = Book.objects.get(title=&quot;Django for Beginners&quot;)
except Book.DoesNotExist:
    print(&quot;Libro no encontrado&quot;)
except Book.MultipleObjectsReturned:
    print(&quot;Se encontraron m&uacute;ltiples libros&quot;)</pre></div><div class='content'></div><h2>Búsquedas de Campos</h2>
<div class='content'><p>Django proporciona varias búsquedas de campos para filtrar datos. Algunas búsquedas comunes incluyen:</p>
<ul>
<li><code>exact</code>: Coincidencia exacta</li>
<li><code>iexact</code>: Coincidencia exacta sin distinguir mayúsculas y minúsculas</li>
<li><code>contains</code>: Prueba de contención sensible a mayúsculas y minúsculas</li>
<li><code>icontains</code>: Prueba de contención sin distinguir mayúsculas y minúsculas</li>
<li><code>gt</code>: Mayor que</li>
<li><code>gte</code>: Mayor o igual que</li>
<li><code>lt</code>: Menor que</li>
<li><code>lte</code>: Menor o igual que</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEJvb2sKCiMgUmVjdXBlcmFyIGxpYnJvcyBjb24gdMOtdHVsb3MgcXVlIGNvbnRlbmdhbiAnRGphbmdvJwpib29rcyA9IEJvb2sub2JqZWN0cy5maWx0ZXIodGl0bGVfX2ljb250YWlucz0nRGphbmdvJykKCiMgUmVjdXBlcmFyIGxpYnJvcyBwdWJsaWNhZG9zIGRlc3B1w6lzIGRlIDIwMjAKYm9va3MgPSBCb29rLm9iamVjdHMuZmlsdGVyKHB1YmxpY2F0aW9uX3llYXJfX2d0PTIwMjAp"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Book

# Recuperar libros con t&iacute;tulos que contengan 'Django'
books = Book.objects.filter(title__icontains='Django')

# Recuperar libros publicados despu&eacute;s de 2020
books = Book.objects.filter(publication_year__gt=2020)</pre></div><div class='content'></div><h1>Consultas Avanzadas</h1>
<h2>Búsquedas Complejas con Objetos Q</h2>
<div class='content'><p>Para realizar consultas complejas que involucren condiciones OR o combinar múltiples condiciones, puedes usar objetos <code>Q</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBkamFuZ28uZGIubW9kZWxzIGltcG9ydCBRCmZyb20gbXlhcHAubW9kZWxzIGltcG9ydCBCb29rCgojIFJlY3VwZXJhciBsaWJyb3MgcHVibGljYWRvcyBlbiAyMDIwIG8gY29uIHTDrXR1bG9zIHF1ZSBjb250ZW5nYW4gJ1B5dGhvbicKYm9va3MgPSBCb29rLm9iamVjdHMuZmlsdGVyKFEocHVibGljYXRpb25feWVhcj0yMDIwKSB8IFEodGl0bGVfX2ljb250YWlucz0nUHl0aG9uJykp"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from django.db.models import Q
from myapp.models import Book

# Recuperar libros publicados en 2020 o con t&iacute;tulos que contengan 'Python'
books = Book.objects.filter(Q(publication_year=2020) | Q(title__icontains='Python'))</pre></div><div class='content'></div><h2>Agregaciones</h2>
<div class='content'><p>Django proporciona funciones de agregación como <code>Count</code>, <code>Sum</code>, <code>Avg</code>, <code>Min</code> y <code>Max</code> para realizar cálculos en conjuntos de consultas.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBkamFuZ28uZGIubW9kZWxzIGltcG9ydCBDb3VudCwgQXZnCmZyb20gbXlhcHAubW9kZWxzIGltcG9ydCBCb29rCgojIENvbnRhciBlbCBuw7ptZXJvIGRlIGxpYnJvcwpib29rX2NvdW50ID0gQm9vay5vYmplY3RzLmNvdW50KCkKCiMgQ2FsY3VsYXIgZWwgYcOxbyBkZSBwdWJsaWNhY2nDs24gcHJvbWVkaW8KYXZlcmFnZV95ZWFyID0gQm9vay5vYmplY3RzLmFnZ3JlZ2F0ZShBdmcoJ3B1YmxpY2F0aW9uX3llYXInKSk="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from django.db.models import Count, Avg
from myapp.models import Book

# Contar el n&uacute;mero de libros
book_count = Book.objects.count()

# Calcular el a&ntilde;o de publicaci&oacute;n promedio
average_year = Book.objects.aggregate(Avg('publication_year'))</pre></div><div class='content'></div><h2>Anotando Conjuntos de Consultas</h2>
<div class='content'><p>El método <code>annotate()</code> te permite agregar campos calculados a cada objeto en un conjunto de consultas.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBkamFuZ28uZGIubW9kZWxzIGltcG9ydCBDb3VudApmcm9tIG15YXBwLm1vZGVscyBpbXBvcnQgQXV0aG9yCgojIEFub3RhciBhdXRvcmVzIGNvbiBlbCBuw7ptZXJvIGRlIGxpYnJvcyBxdWUgaGFuIGVzY3JpdG8KYXV0aG9ycyA9IEF1dGhvci5vYmplY3RzLmFubm90YXRlKGJvb2tfY291bnQ9Q291bnQoJ2Jvb2snKSkKZm9yIGF1dGhvciBpbiBhdXRob3JzOgogICAgcHJpbnQoZiJ7YXV0aG9yLm5hbWV9IGhhIGVzY3JpdG8ge2F1dGhvci5ib29rX2NvdW50fSBsaWJyb3MiKQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from django.db.models import Count
from myapp.models import Author

# Anotar autores con el n&uacute;mero de libros que han escrito
authors = Author.objects.annotate(book_count=Count('book'))
for author in authors:
    print(f&quot;{author.name} ha escrito {author.book_count} libros&quot;)</pre></div><div class='content'></div><h1>Optimización de Consultas</h1>
<h2>Select Related</h2>
<div class='content'><p>Para reducir el número de consultas a la base de datos, puedes usar <code>select_related()</code> para relaciones de valor único (claves foráneas).</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEJvb2sKCiMgUmVjdXBlcmFyIGxpYnJvcyBqdW50byBjb24gc3VzIGF1dG9yZXMgZW4gdW5hIHNvbGEgY29uc3VsdGEKYm9va3MgPSBCb29rLm9iamVjdHMuc2VsZWN0X3JlbGF0ZWQoJ2F1dGhvcicpLmFsbCgp"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Book

# Recuperar libros junto con sus autores en una sola consulta
books = Book.objects.select_related('author').all()</pre></div><div class='content'></div><h2>Prefetch Related</h2>
<div class='content'><p>Para relaciones de valor múltiple (muchos a muchos y clave foránea inversa), usa <code>prefetch_related()</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEF1dGhvcgoKIyBSZWN1cGVyYXIgYXV0b3JlcyBqdW50byBjb24gc3VzIGxpYnJvcyBlbiB1bmEgc29sYSBjb25zdWx0YQphdXRob3JzID0gQXV0aG9yLm9iamVjdHMucHJlZmV0Y2hfcmVsYXRlZCgnYm9va19zZXQnKS5hbGwoKQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Author

# Recuperar autores junto con sus libros en una sola consulta
authors = Author.objects.prefetch_related('book_set').all()</pre></div><div class='content'></div><h1>Conclusión</h1>
<div class='content'><p>Consultar la base de datos en Django es simple y eficiente mediante el uso del ORM de Django. Al comprender las técnicas de consulta básicas y avanzadas, puedes realizar operaciones complejas de recuperación de datos con facilidad. Recuerda usar técnicas de optimización de consultas como <code>select_related()</code> y <code>prefetch_related()</code> para mejorar el rendimiento de tus consultas a la base de datos.</p>
</div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
