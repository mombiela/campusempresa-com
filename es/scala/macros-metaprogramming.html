<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Macros y Metaprogramación en Scala</title>

    <link rel="alternate" href="https://campusempresa.com/es/scala/macros-metaprogramming" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/scala/macros-metaprogramming" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/scala/macros-metaprogramming" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/es/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy<br> y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
										<b id="lit_lang_es" class="px-2">ES</b>
				|
				<a href="/ca/scala/macros-metaprogramming" id="lnk_lang_ca" data-lang="ca" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="objective">El Proyecto</a>
				<a href="about">Sobre nosotros</a>
				<a href="contribute">Contribuir</a>
				<a href="donate">Donaciones</a>
				<a href="licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='content'></div><h1>Introducción a Macros y Metaprogramación</h1>
<div class='content'><p>Los macros y la metaprogramación son características poderosas en Scala que te permiten escribir código que genera otro código en tiempo de compilación. Esto puede llevar a un código más eficiente y reutilizable. En esta sección, exploraremos los conceptos básicos de los macros y la metaprogramación, entenderemos sus casos de uso y veremos cómo se pueden implementar en Scala.</p>
</div><h1>¿Qué son los Macros?</h1>
<div class='content'><p>Los macros en Scala son métodos que se expanden en tiempo de compilación. Te permiten manipular árboles de sintaxis abstracta (ASTs) para generar código dinámicamente.</p>
</div><h2>Conceptos Clave</h2>
<div class='content'><ul>
<li><strong>Generación de Código en Tiempo de Compilación</strong>: Los macros generan código durante el proceso de compilación, no en tiempo de ejecución.</li>
<li><strong>Árboles de Sintaxis Abstracta (ASTs)</strong>: Los macros funcionan manipulando los ASTs del código.</li>
<li><strong>Seguridad de Tipos</strong>: Los macros proporcionan seguridad de tipos al asegurar que el código generado sea verificado en tiempo de compilación.</li>
</ul>
</div><h2>Ejemplo de un Macro Simple</h2>
<div class='content'><p>Comencemos con un ejemplo simple de macro que imprime el código que se le da.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHNjYWxhLmxhbmd1YWdlLmV4cGVyaW1lbnRhbC5tYWNyb3MKaW1wb3J0IHNjYWxhLnJlZmxlY3QubWFjcm9zLmJsYWNrYm94LkNvbnRleHQKCm9iamVjdCBNYWNyb3MgewogIGRlZiBwcmludENvZGUoY29kZTogQW55KTogVW5pdCA9IG1hY3JvIHByaW50Q29kZUltcGwKCiAgZGVmIHByaW50Q29kZUltcGwoYzogQ29udGV4dCkoY29kZTogYy5FeHByW0FueV0pOiBjLkV4cHJbVW5pdF0gPSB7CiAgICBpbXBvcnQgYy51bml2ZXJzZS5fCiAgICBwcmludGxuKHNob3dDb2RlKGNvZGUudHJlZSkpCiAgICByZWlmeShwcmludGxuKGNvZGUuc3BsaWNlKSkKICB9Cn0KCm9iamVjdCBNYWluIGV4dGVuZHMgQXBwIHsKICBNYWNyb3MucHJpbnRDb2RlKCLCoUhvbGEsIE1hY3JvcyEiKQp9"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import scala.language.experimental.macros
import scala.reflect.macros.blackbox.Context

object Macros {
  def printCode(code: Any): Unit = macro printCodeImpl

  def printCodeImpl(c: Context)(code: c.Expr[Any]): c.Expr[Unit] = {
    import c.universe._
    println(showCode(code.tree))
    reify(println(code.splice))
  }
}

object Main extends App {
  Macros.printCode(&quot;&iexcl;Hola, Macros!&quot;)
}</pre></div><div class='content'><p>En este ejemplo:</p>
<ul>
<li><code>printCode</code> es un método macro.</li>
<li><code>printCodeImpl</code> es la implementación del macro que manipula el AST.</li>
<li><code>showCode</code> se utiliza para imprimir el código pasado al macro.</li>
<li><code>reify</code> y <code>splice</code> se utilizan para generar e insertar código.</li>
</ul>
</div><h1>Macros Avanzados</h1>
<div class='content'><p>A medida que te sientas más cómodo con los macros, puedes comenzar a crear macros más complejos que realicen transformaciones de código sofisticadas.</p>
</div><h2>Conceptos Clave</h2>
<div class='content'><ul>
<li><strong>Bundles de Macros</strong>: Agrupación de macros relacionados.</li>
<li><strong>Macros de Tipo</strong>: Generación de tipos dinámicamente.</li>
<li><strong>Macros Contextuales</strong>: Uso del contexto del macro para acceder a información adicional.</li>
</ul>
</div><h2>Ejemplo de un Macro Avanzado</h2>
<div class='content'><p>Aquí hay un ejemplo de un macro que genera una clase case a partir de un mapa de nombres de campos y tipos.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHNjYWxhLmxhbmd1YWdlLmV4cGVyaW1lbnRhbC5tYWNyb3MKaW1wb3J0IHNjYWxhLnJlZmxlY3QubWFjcm9zLmJsYWNrYm94LkNvbnRleHQKCm9iamVjdCBDYXNlQ2xhc3NHZW5lcmF0b3IgewogIGRlZiBnZW5lcmF0ZUNhc2VDbGFzcyhuYW1lOiBTdHJpbmcsIGZpZWxkczogTWFwW1N0cmluZywgU3RyaW5nXSk6IEFueSA9IG1hY3JvIGdlbmVyYXRlQ2FzZUNsYXNzSW1wbAoKICBkZWYgZ2VuZXJhdGVDYXNlQ2xhc3NJbXBsKGM6IENvbnRleHQpKG5hbWU6IGMuRXhwcltTdHJpbmddLCBmaWVsZHM6IGMuRXhwcltNYXBbU3RyaW5nLCBTdHJpbmddXSk6IGMuRXhwcltBbnldID0gewogICAgaW1wb3J0IGMudW5pdmVyc2UuXwoKICAgIHZhbCBMaXRlcmFsKENvbnN0YW50KGNsYXNzTmFtZTogU3RyaW5nKSkgPSBuYW1lLnRyZWUKICAgIHZhbCBMaXRlcmFsKENvbnN0YW50KGZpZWxkTWFwOiBNYXBbU3RyaW5nLCBTdHJpbmddKSkgPSBmaWVsZHMudHJlZQoKICAgIHZhbCBjbGFzc0RlZiA9IHEiIiIKICAgICAgY2FzZSBjbGFzcyAke1R5cGVOYW1lKGNsYXNzTmFtZSl9KC4uJHtmaWVsZE1hcC5tYXAgeyBjYXNlIChmaWVsZE5hbWUsIGZpZWxkVHlwZSkgPT4KICAgICAgICBxInZhbCAke1Rlcm1OYW1lKGZpZWxkTmFtZSl9OiAke1R5cGVOYW1lKGZpZWxkVHlwZSl9IgogICAgICB9fSkKICAgICIiIgoKICAgIGMuRXhwcltBbnldKGNsYXNzRGVmKQogIH0KfQoKb2JqZWN0IE1haW4gZXh0ZW5kcyBBcHAgewogIENhc2VDbGFzc0dlbmVyYXRvci5nZW5lcmF0ZUNhc2VDbGFzcygiUGVyc29uIiwgTWFwKCJuYW1lIiAtPiAiU3RyaW5nIiwgImFnZSIgLT4gIkludCIpKQp9"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import scala.language.experimental.macros
import scala.reflect.macros.blackbox.Context

object CaseClassGenerator {
  def generateCaseClass(name: String, fields: Map[String, String]): Any = macro generateCaseClassImpl

  def generateCaseClassImpl(c: Context)(name: c.Expr[String], fields: c.Expr[Map[String, String]]): c.Expr[Any] = {
    import c.universe._

    val Literal(Constant(className: String)) = name.tree
    val Literal(Constant(fieldMap: Map[String, String])) = fields.tree

    val classDef = q&quot;&quot;&quot;
      case class ${TypeName(className)}(..${fieldMap.map { case (fieldName, fieldType) =&gt;
        q&quot;val ${TermName(fieldName)}: ${TypeName(fieldType)}&quot;
      }})
    &quot;&quot;&quot;

    c.Expr[Any](classDef)
  }
}

object Main extends App {
  CaseClassGenerator.generateCaseClass(&quot;Person&quot;, Map(&quot;name&quot; -&gt; &quot;String&quot;, &quot;age&quot; -&gt; &quot;Int&quot;))
}</pre></div><div class='content'><p>En este ejemplo:</p>
<ul>
<li><code>generateCaseClass</code> es un macro que genera una clase case.</li>
<li><code>generateCaseClassImpl</code> es la implementación del macro que construye la definición de la clase case.</li>
<li>El macro utiliza quasiquotes (<code>q&quot;...&quot;</code>) para generar el código de la clase case.</li>
</ul>
</div><h1>Metaprogramación en Scala</h1>
<div class='content'><p>La metaprogramación implica escribir programas que escriben o manipulan otros programas. En Scala, esto a menudo se hace usando macros, pero también puede involucrar otras técnicas como la reflexión.</p>
</div><h2>Conceptos Clave</h2>
<div class='content'><ul>
<li><strong>Reflexión</strong>: Inspección y modificación de la estructura del programa en tiempo de ejecución.</li>
<li><strong>Quasiquotes</strong>: Una herramienta poderosa para generar y manipular código.</li>
<li><strong>Anotaciones</strong>: Adición de metadatos a elementos de código que pueden ser procesados en tiempo de compilación o ejecución.</li>
</ul>
</div><h2>Ejemplo de Metaprogramación con Reflexión</h2>
<div class='content'><p>Aquí hay un ejemplo de uso de la reflexión para inspeccionar los campos de una clase case en tiempo de ejecución.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHNjYWxhLnJlZmxlY3QucnVudGltZS51bml2ZXJzZS5fCgpjYXNlIGNsYXNzIFBlcnNvbihuYW1lOiBTdHJpbmcsIGFnZTogSW50KQoKb2JqZWN0IFJlZmxlY3Rpb25FeGFtcGxlIGV4dGVuZHMgQXBwIHsKICB2YWwgcGVyc29uID0gUGVyc29uKCJBbGljZSIsIDMwKQogIHZhbCBtaXJyb3IgPSBydW50aW1lTWlycm9yKHBlcnNvbi5nZXRDbGFzcy5nZXRDbGFzc0xvYWRlcikKICB2YWwgaW5zdGFuY2VNaXJyb3IgPSBtaXJyb3IucmVmbGVjdChwZXJzb24pCiAgdmFsIGNsYXNzU3ltYm9sID0gaW5zdGFuY2VNaXJyb3Iuc3ltYm9sCgogIGNsYXNzU3ltYm9sLnR5cGVTaWduYXR1cmUubWVtYmVycy5jb2xsZWN0IHsKICAgIGNhc2UgbTogTWV0aG9kU3ltYm9sIGlmIG0uaXNDYXNlQWNjZXNzb3IgPT4KICAgICAgdmFsIGZpZWxkTWlycm9yID0gaW5zdGFuY2VNaXJyb3IucmVmbGVjdEZpZWxkKG0pCiAgICAgIHByaW50bG4ocyIke20ubmFtZX06ICR7ZmllbGRNaXJyb3IuZ2V0fSIpCiAgfQp9"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import scala.reflect.runtime.universe._

case class Person(name: String, age: Int)

object ReflectionExample extends App {
  val person = Person(&quot;Alice&quot;, 30)
  val mirror = runtimeMirror(person.getClass.getClassLoader)
  val instanceMirror = mirror.reflect(person)
  val classSymbol = instanceMirror.symbol

  classSymbol.typeSignature.members.collect {
    case m: MethodSymbol if m.isCaseAccessor =&gt;
      val fieldMirror = instanceMirror.reflectField(m)
      println(s&quot;${m.name}: ${fieldMirror.get}&quot;)
  }
}</pre></div><div class='content'><p>En este ejemplo:</p>
<ul>
<li><code>runtimeMirror</code> se utiliza para obtener un espejo del entorno de ejecución.</li>
<li><code>reflect</code> se utiliza para obtener un espejo de la instancia.</li>
<li><code>typeSignature.members</code> se utiliza para obtener los miembros de la clase.</li>
<li><code>reflectField</code> se utiliza para obtener el valor de un campo.</li>
</ul>
</div><h1>Conclusión</h1>
<div class='content'><p>Los macros y la metaprogramación son características avanzadas en Scala que pueden mejorar enormemente la flexibilidad y eficiencia de tu código. Al entender y utilizar estas características, puedes escribir código más poderoso y reutilizable. Comienza con macros simples para familiarizarte con su funcionamiento y gradualmente avanza a escenarios más complejos a medida que te sientas más cómodo con los conceptos. Recuerda siempre considerar las compensaciones, ya que los macros pueden hacer que tu código sea más difícil de leer y depurar.</p>
</div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
