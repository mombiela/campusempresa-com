<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy<br> y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
										<b id="lit_lang_es">Castellano</b>
				|
				<a href="https://campusempresa.cat/pytorch/custom-loss-functions" id="lnk_lang_ca" data-lang="ca">Català</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="objective">El Proyecto</a>
				<a href="about">Sobre nosotros</a>
				<a href="contribute">Contribuir</a>
				<a href="donate">Donaciones</a>
				<a href="licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='content'></div><h1>Introducción</h1>
<div class='content'><p>En esta sección, exploraremos cómo crear funciones de pérdida personalizadas en PyTorch. Las funciones de pérdida son un componente crucial del entrenamiento de redes neuronales, ya que miden qué tan bien está funcionando el modelo. Si bien PyTorch proporciona muchas funciones de pérdida integradas, hay escenarios en los que puede ser necesario definir las propias.</p>
</div><h1>Conceptos Clave</h1>
<div class='content'><ul>
<li><strong>Función de Pérdida</strong>: Un método para evaluar qué tan bien las predicciones del modelo coinciden con los valores objetivo.</li>
<li><strong>Propagación hacia Atrás</strong>: El proceso de calcular el gradiente de la función de pérdida con respecto a los parámetros del modelo.</li>
<li><strong>Autograd</strong>: La biblioteca de diferenciación automática de PyTorch que admite todas las operaciones en Tensors.</li>
</ul>
</div><h1>Funciones de Pérdida Integradas</h1>
<div class='content'><p>Antes de sumergirnos en las funciones de pérdida personalizadas, revisemos brevemente algunas funciones de pérdida integradas comunes en PyTorch:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCmltcG9ydCB0b3JjaC5ubiBhcyBubgoKIyBQw6lyZGlkYSBkZSBFcnJvciBDdWFkcsOhdGljbyBNZWRpbwptc2VfbG9zcyA9IG5uLk1TRUxvc3MoKQoKIyBQw6lyZGlkYSBkZSBFbnRyb3DDrWEgQ3J1emFkYQpjcm9zc19lbnRyb3B5X2xvc3MgPSBubi5Dcm9zc0VudHJvcHlMb3NzKCkKCiMgUMOpcmRpZGEgZGUgRW50cm9ww61hIENydXphZGEgQmluYXJpYQpiY2VfbG9zcyA9IG5uLkJDRUxvc3MoKQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch
import torch.nn as nn

# P&eacute;rdida de Error Cuadr&aacute;tico Medio
mse_loss = nn.MSELoss()

# P&eacute;rdida de Entrop&iacute;a Cruzada
cross_entropy_loss = nn.CrossEntropyLoss()

# P&eacute;rdida de Entrop&iacute;a Cruzada Binaria
bce_loss = nn.BCELoss()</pre></div><div class='content'></div><h1>Creación de Funciones de Pérdida Personalizadas</h1>
<div class='content'><p>Crear una función de pérdida personalizada en PyTorch implica definir una nueva clase que herede de <code>nn.Module</code> y sobrescribir el método <code>forward</code>.</p>
</div><h2>Ejemplo 1: Pérdida de Error Absoluto Medio (MAE)</h2>
<div class='content'><p>Comencemos con un ejemplo simple de creación de una función de pérdida de Error Absoluto Medio (MAE).</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCmltcG9ydCB0b3JjaC5ubiBhcyBubgoKY2xhc3MgTUFFTG9zcyhubi5Nb2R1bGUpOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHN1cGVyKE1BRUxvc3MsIHNlbGYpLl9faW5pdF9fKCkKCiAgICBkZWYgZm9yd2FyZChzZWxmLCBwcmVkaWN0aW9ucywgdGFyZ2V0cyk6CiAgICAgICAgcmV0dXJuIHRvcmNoLm1lYW4odG9yY2guYWJzKHByZWRpY3Rpb25zIC0gdGFyZ2V0cykpCgojIEVqZW1wbG8gZGUgdXNvCnByZWRpY3Rpb25zID0gdG9yY2gudGVuc29yKFswLjUsIDEuNSwgMi41XSkKdGFyZ2V0cyA9IHRvcmNoLnRlbnNvcihbMS4wLCAyLjAsIDMuMF0pCm1hZV9sb3NzID0gTUFFTG9zcygpCmxvc3MgPSBtYWVfbG9zcyhwcmVkaWN0aW9ucywgdGFyZ2V0cykKcHJpbnQoZidQw6lyZGlkYSBNQUU6IHtsb3NzLml0ZW0oKX0nKQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch
import torch.nn as nn

class MAELoss(nn.Module):
    def __init__(self):
        super(MAELoss, self).__init__()

    def forward(self, predictions, targets):
        return torch.mean(torch.abs(predictions - targets))

# Ejemplo de uso
predictions = torch.tensor([0.5, 1.5, 2.5])
targets = torch.tensor([1.0, 2.0, 3.0])
mae_loss = MAELoss()
loss = mae_loss(predictions, targets)
print(f'P&eacute;rdida MAE: {loss.item()}')</pre></div><div class='content'></div><h2>Ejemplo 2: Pérdida de Huber</h2>
<div class='content'><p>La Pérdida de Huber es menos sensible a los valores atípicos en los datos que la pérdida de Error Cuadrático Medio. Combina las mejores propiedades de MAE y MSE.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgSHViZXJMb3NzKG5uLk1vZHVsZSk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZGVsdGE9MS4wKToKICAgICAgICBzdXBlcihIdWJlckxvc3MsIHNlbGYpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLmRlbHRhID0gZGVsdGEKCiAgICBkZWYgZm9yd2FyZChzZWxmLCBwcmVkaWN0aW9ucywgdGFyZ2V0cyk6CiAgICAgICAgZXJyb3IgPSBwcmVkaWN0aW9ucyAtIHRhcmdldHMKICAgICAgICBpc19zbWFsbF9lcnJvciA9IHRvcmNoLmFicyhlcnJvcikgPD0gc2VsZi5kZWx0YQogICAgICAgIHNtYWxsX2Vycm9yX2xvc3MgPSAwLjUgKiB0b3JjaC5wb3coZXJyb3IsIDIpCiAgICAgICAgbGFyZ2VfZXJyb3JfbG9zcyA9IHNlbGYuZGVsdGEgKiAodG9yY2guYWJzKGVycm9yKSAtIDAuNSAqIHNlbGYuZGVsdGEpCiAgICAgICAgcmV0dXJuIHRvcmNoLm1lYW4odG9yY2gud2hlcmUoaXNfc21hbGxfZXJyb3IsIHNtYWxsX2Vycm9yX2xvc3MsIGxhcmdlX2Vycm9yX2xvc3MpKQoKIyBFamVtcGxvIGRlIHVzbwpwcmVkaWN0aW9ucyA9IHRvcmNoLnRlbnNvcihbMC41LCAxLjUsIDIuNV0pCnRhcmdldHMgPSB0b3JjaC50ZW5zb3IoWzEuMCwgMi4wLCAzLjBdKQpodWJlcl9sb3NzID0gSHViZXJMb3NzKGRlbHRhPTEuMCkKbG9zcyA9IGh1YmVyX2xvc3MocHJlZGljdGlvbnMsIHRhcmdldHMpCnByaW50KGYnUMOpcmRpZGEgZGUgSHViZXI6IHtsb3NzLml0ZW0oKX0nKQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class HuberLoss(nn.Module):
    def __init__(self, delta=1.0):
        super(HuberLoss, self).__init__()
        self.delta = delta

    def forward(self, predictions, targets):
        error = predictions - targets
        is_small_error = torch.abs(error) &lt;= self.delta
        small_error_loss = 0.5 * torch.pow(error, 2)
        large_error_loss = self.delta * (torch.abs(error) - 0.5 * self.delta)
        return torch.mean(torch.where(is_small_error, small_error_loss, large_error_loss))

# Ejemplo de uso
predictions = torch.tensor([0.5, 1.5, 2.5])
targets = torch.tensor([1.0, 2.0, 3.0])
huber_loss = HuberLoss(delta=1.0)
loss = huber_loss(predictions, targets)
print(f'P&eacute;rdida de Huber: {loss.item()}')</pre></div><div class='content'></div><h1>Funciones de Pérdida Personalizadas Avanzadas</h1>
<div class='content'><p>Para funciones de pérdida personalizadas más avanzadas, puede ser necesario aprovechar directamente la funcionalidad de autograd de PyTorch.</p>
</div><h2>Ejemplo 3: Penalización de Gradiente Personalizada</h2>
<div class='content'><p>Supongamos que desea crear una función de pérdida personalizada que incluya un término de penalización de gradiente, a menudo utilizado en Redes Generativas Antagónicas (GANs).</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgR3JhZGllbnRQZW5hbHR5TG9zcyhubi5Nb2R1bGUpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGxhbWJkYV9ncD0xMCk6CiAgICAgICAgc3VwZXIoR3JhZGllbnRQZW5hbHR5TG9zcywgc2VsZikuX19pbml0X18oKQogICAgICAgIHNlbGYubGFtYmRhX2dwID0gbGFtYmRhX2dwCgogICAgZGVmIGZvcndhcmQoc2VsZiwgZGlzY3JpbWluYXRvciwgcmVhbF9kYXRhLCBmYWtlX2RhdGEpOgogICAgICAgIGJhdGNoX3NpemUgPSByZWFsX2RhdGEuc2l6ZSgwKQogICAgICAgIGVwc2lsb24gPSB0b3JjaC5yYW5kKGJhdGNoX3NpemUsIDEsIDEsIDEsIGRldmljZT1yZWFsX2RhdGEuZGV2aWNlKQogICAgICAgIGludGVycG9sYXRlZCA9IGVwc2lsb24gKiByZWFsX2RhdGEgKyAoMSAtIGVwc2lsb24pICogZmFrZV9kYXRhCiAgICAgICAgaW50ZXJwb2xhdGVkLnJlcXVpcmVzX2dyYWRfKFRydWUpCgogICAgICAgIGRfaW50ZXJwb2xhdGVkID0gZGlzY3JpbWluYXRvcihpbnRlcnBvbGF0ZWQpCiAgICAgICAgZ3JhZGllbnRzID0gdG9yY2guYXV0b2dyYWQuZ3JhZCgKICAgICAgICAgICAgb3V0cHV0cz1kX2ludGVycG9sYXRlZCwKICAgICAgICAgICAgaW5wdXRzPWludGVycG9sYXRlZCwKICAgICAgICAgICAgZ3JhZF9vdXRwdXRzPXRvcmNoLm9uZXNfbGlrZShkX2ludGVycG9sYXRlZCksCiAgICAgICAgICAgIGNyZWF0ZV9ncmFwaD1UcnVlLAogICAgICAgICAgICByZXRhaW5fZ3JhcGg9VHJ1ZSwKICAgICAgICApWzBdCgogICAgICAgIGdyYWRpZW50cyA9IGdyYWRpZW50cy52aWV3KGJhdGNoX3NpemUsIC0xKQogICAgICAgIGdyYWRpZW50X3BlbmFsdHkgPSAoKGdyYWRpZW50cy5ub3JtKDIsIGRpbT0xKSAtIDEpICoqIDIpLm1lYW4oKQogICAgICAgIHJldHVybiBzZWxmLmxhbWJkYV9ncCAqIGdyYWRpZW50X3BlbmFsdHkKCiMgRWplbXBsbyBkZSB1c28KIyBTdXBvbmllbmRvIHF1ZSBgZGlzY3JpbWluYXRvcmAsIGByZWFsX2RhdGFgIHkgYGZha2VfZGF0YWAgZXN0w6FuIGRlZmluaWRvcwpncmFkaWVudF9wZW5hbHR5X2xvc3MgPSBHcmFkaWVudFBlbmFsdHlMb3NzKGxhbWJkYV9ncD0xMCkKbG9zcyA9IGdyYWRpZW50X3BlbmFsdHlfbG9zcyhkaXNjcmltaW5hdG9yLCByZWFsX2RhdGEsIGZha2VfZGF0YSkKcHJpbnQoZidQw6lyZGlkYSBkZSBQZW5hbGl6YWNpw7NuIGRlIEdyYWRpZW50ZToge2xvc3MuaXRlbSgpfScp"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class GradientPenaltyLoss(nn.Module):
    def __init__(self, lambda_gp=10):
        super(GradientPenaltyLoss, self).__init__()
        self.lambda_gp = lambda_gp

    def forward(self, discriminator, real_data, fake_data):
        batch_size = real_data.size(0)
        epsilon = torch.rand(batch_size, 1, 1, 1, device=real_data.device)
        interpolated = epsilon * real_data + (1 - epsilon) * fake_data
        interpolated.requires_grad_(True)

        d_interpolated = discriminator(interpolated)
        gradients = torch.autograd.grad(
            outputs=d_interpolated,
            inputs=interpolated,
            grad_outputs=torch.ones_like(d_interpolated),
            create_graph=True,
            retain_graph=True,
        )[0]

        gradients = gradients.view(batch_size, -1)
        gradient_penalty = ((gradients.norm(2, dim=1) - 1) ** 2).mean()
        return self.lambda_gp * gradient_penalty

# Ejemplo de uso
# Suponiendo que `discriminator`, `real_data` y `fake_data` est&aacute;n definidos
gradient_penalty_loss = GradientPenaltyLoss(lambda_gp=10)
loss = gradient_penalty_loss(discriminator, real_data, fake_data)
print(f'P&eacute;rdida de Penalizaci&oacute;n de Gradiente: {loss.item()}')</pre></div><div class='content'></div><h1>Conclusión</h1>
<div class='content'><p>Las funciones de pérdida personalizadas en PyTorch proporcionan flexibilidad para adaptar el proceso de entrenamiento a necesidades específicas. Al comprender cómo crear e implementar estas funciones, puede mejorar el rendimiento de sus modelos y adaptarse a requisitos de problemas únicos. Ya sea una simple pérdida MAE o una penalización de gradiente más compleja, el diseño modular de PyTorch facilita la definición y el uso de funciones de pérdida personalizadas en su pipeline de entrenamiento.</p>
</div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
       <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
       <a href="cookies">Més informació</a>
   </div>	
	</div>    
</body>
</html>
