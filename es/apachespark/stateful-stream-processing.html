<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procesamiento de Flujos con Estado</title>

    <link rel="alternate" href="https://campusempresa.com/es/apachespark/stateful-stream-processing" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/apachespark/stateful-stream-processing" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/apachespark/stateful-stream-processing" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/es/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
										<b id="lit_lang_es" class="px-2">ES</b>
				|
				<a href="/ca/apachespark/stateful-stream-processing" id="lnk_lang_ca" data-lang="ca" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/es/objective">El Proyecto</a>
				<a href="/es/about">Sobre nosotros</a>
				<a href="/es/contribute">Contribuir</a>
				<a href="/es/donate">Donaciones</a>
				<a href="/es/licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'><div class='col-6'><a href='window-operations'>&#x25C4; Operaciones de Ventana</a></div><div class='col-6 text-end'><a href='structured-streaming'>Streaming Estructurado &#x25BA;</a></div></div><div class='content'><p>El procesamiento de flujos con estado es una característica poderosa en Apache Spark que te permite mantener y actualizar información de estado a través de múltiples registros en un flujo. Esto es crucial para aplicaciones que necesitan rastrear información a lo largo del tiempo, como la sesionización, análisis en tiempo real y monitoreo.</p>
</div><h1>Introducción al Procesamiento de Flujos con Estado</h1>
<div class='content'><p>El procesamiento de flujos con estado implica mantener información de estado a través de múltiples registros en un flujo. Este estado puede ser actualizado y consultado a medida que llegan nuevos datos.</p>
<ul>
<li><strong>Estado</strong>: Información que se mantiene a través de múltiples registros.</li>
<li><strong>Operaciones con Estado</strong>: Operaciones que actualizan y consultan el estado.</li>
</ul>
</div><h1>Conceptos Clave</h1>
<div class='content'><ul>
<li><strong>Estado</strong>: La información almacenada que puede ser actualizada y consultada.</li>
<li><strong>Transformación con Estado</strong>: Transformaciones que involucran estado, como <code>mapWithState</code> y <code>updateStateByKey</code>.</li>
<li><strong>Checkpointing</strong>: Mecanismo para guardar el estado periódicamente para asegurar la tolerancia a fallos.</li>
</ul>
</div><h1>Transformaciones con Estado</h1>
<div class='content'></div><h2>`mapWithState`</h2>
<div class='content'><p>La operación <code>mapWithState</code> te permite mantener y actualizar información de estado para cada clave en un DStream.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3RyZWFtaW5nLl8KaW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3RyZWFtaW5nLlN0cmVhbWluZ0NvbnRleHQuXwppbXBvcnQgb3JnLmFwYWNoZS5zcGFyay5zdHJlYW1pbmcuZHN0cmVhbS5fCgp2YWwgY29uZiA9IG5ldyBTcGFya0NvbmYoKS5zZXRNYXN0ZXIoImxvY2FsWzJdIikuc2V0QXBwTmFtZSgiU3RhdGVmdWxOZXR3b3JrV29yZENvdW50IikKdmFsIHNzYyA9IG5ldyBTdHJlYW1pbmdDb250ZXh0KGNvbmYsIFNlY29uZHMoMSkpCgovLyBSREQgZGUgZXN0YWRvIGluaWNpYWwKdmFsIGluaXRpYWxSREQgPSBzc2Muc3BhcmtDb250ZXh0LnBhcmFsbGVsaXplKExpc3QoKCJoZWxsbyIsIDEpLCAoIndvcmxkIiwgMSkpKQoKLy8gRnVuY2nDs24gcGFyYSBhY3R1YWxpemFyIGVsIGVzdGFkbwpkZWYgbWFwcGluZ0Z1bmN0aW9uKGJhdGNoVGltZTogVGltZSwga2V5OiBTdHJpbmcsIHZhbHVlOiBPcHRpb25bSW50XSwgc3RhdGU6IFN0YXRlW0ludF0pOiBPcHRpb25bKFN0cmluZywgSW50KV0gPSB7CiAgdmFsIHN1bSA9IHZhbHVlLmdldE9yRWxzZSgwKSArIHN0YXRlLmdldE9wdGlvbi5nZXRPckVsc2UoMCkKICB2YWwgb3V0cHV0ID0gKGtleSwgc3VtKQogIHN0YXRlLnVwZGF0ZShzdW0pCiAgU29tZShvdXRwdXQpCn0KCnZhbCBsaW5lcyA9IHNzYy5zb2NrZXRUZXh0U3RyZWFtKCJsb2NhbGhvc3QiLCA5OTk5KQp2YWwgd29yZHMgPSBsaW5lcy5mbGF0TWFwKF8uc3BsaXQoIiAiKSkKdmFsIHdvcmREc3RyZWFtID0gd29yZHMubWFwKHdvcmQgPT4gKHdvcmQsIDEpKQoKdmFsIHN0YXRlRHN0cmVhbSA9IHdvcmREc3RyZWFtLm1hcFdpdGhTdGF0ZShTdGF0ZVNwZWMuZnVuY3Rpb24obWFwcGluZ0Z1bmN0aW9uKS5pbml0aWFsU3RhdGUoaW5pdGlhbFJERCkpCnN0YXRlRHN0cmVhbS5wcmludCgpCgpzc2Muc3RhcnQoKQpzc2MuYXdhaXRUZXJtaW5hdGlvbigp"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.apache.spark.streaming._
import org.apache.spark.streaming.StreamingContext._
import org.apache.spark.streaming.dstream._

val conf = new SparkConf().setMaster(&quot;local[2]&quot;).setAppName(&quot;StatefulNetworkWordCount&quot;)
val ssc = new StreamingContext(conf, Seconds(1))

// RDD de estado inicial
val initialRDD = ssc.sparkContext.parallelize(List((&quot;hello&quot;, 1), (&quot;world&quot;, 1)))

// Funci&oacute;n para actualizar el estado
def mappingFunction(batchTime: Time, key: String, value: Option[Int], state: State[Int]): Option[(String, Int)] = {
  val sum = value.getOrElse(0) + state.getOption.getOrElse(0)
  val output = (key, sum)
  state.update(sum)
  Some(output)
}

val lines = ssc.socketTextStream(&quot;localhost&quot;, 9999)
val words = lines.flatMap(_.split(&quot; &quot;))
val wordDstream = words.map(word =&gt; (word, 1))

val stateDstream = wordDstream.mapWithState(StateSpec.function(mappingFunction).initialState(initialRDD))
stateDstream.print()

ssc.start()
ssc.awaitTermination()</pre></div><div class='content'></div><h2>`updateStateByKey`</h2>
<div class='content'><p>La operación <code>updateStateByKey</code> te permite mantener el estado a través de lotes de datos.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3RyZWFtaW5nLl8KaW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3RyZWFtaW5nLlN0cmVhbWluZ0NvbnRleHQuXwoKdmFsIGNvbmYgPSBuZXcgU3BhcmtDb25mKCkuc2V0TWFzdGVyKCJsb2NhbFsyXSIpLnNldEFwcE5hbWUoIlN0YXRlZnVsTmV0d29ya1dvcmRDb3VudCIpCnZhbCBzc2MgPSBuZXcgU3RyZWFtaW5nQ29udGV4dChjb25mLCBTZWNvbmRzKDEpKQoKLy8gRnVuY2nDs24gcGFyYSBhY3R1YWxpemFyIGVsIGVzdGFkbwpkZWYgdXBkYXRlRnVuY3Rpb24obmV3VmFsdWVzOiBTZXFbSW50XSwgcnVubmluZ0NvdW50OiBPcHRpb25bSW50XSk6IE9wdGlvbltJbnRdID0gewogIHZhbCBuZXdDb3VudCA9IHJ1bm5pbmdDb3VudC5nZXRPckVsc2UoMCkgKyBuZXdWYWx1ZXMuc3VtCiAgU29tZShuZXdDb3VudCkKfQoKc3NjLmNoZWNrcG9pbnQoImNoZWNrcG9pbnQiKQoKdmFsIGxpbmVzID0gc3NjLnNvY2tldFRleHRTdHJlYW0oImxvY2FsaG9zdCIsIDk5OTkpCnZhbCB3b3JkcyA9IGxpbmVzLmZsYXRNYXAoXy5zcGxpdCgiICIpKQp2YWwgd29yZERzdHJlYW0gPSB3b3Jkcy5tYXAod29yZCA9PiAod29yZCwgMSkpCgp2YWwgc3RhdGVEc3RyZWFtID0gd29yZERzdHJlYW0udXBkYXRlU3RhdGVCeUtleSh1cGRhdGVGdW5jdGlvbikKc3RhdGVEc3RyZWFtLnByaW50KCkKCnNzYy5zdGFydCgpCnNzYy5hd2FpdFRlcm1pbmF0aW9uKCk="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.apache.spark.streaming._
import org.apache.spark.streaming.StreamingContext._

val conf = new SparkConf().setMaster(&quot;local[2]&quot;).setAppName(&quot;StatefulNetworkWordCount&quot;)
val ssc = new StreamingContext(conf, Seconds(1))

// Funci&oacute;n para actualizar el estado
def updateFunction(newValues: Seq[Int], runningCount: Option[Int]): Option[Int] = {
  val newCount = runningCount.getOrElse(0) + newValues.sum
  Some(newCount)
}

ssc.checkpoint(&quot;checkpoint&quot;)

val lines = ssc.socketTextStream(&quot;localhost&quot;, 9999)
val words = lines.flatMap(_.split(&quot; &quot;))
val wordDstream = words.map(word =&gt; (word, 1))

val stateDstream = wordDstream.updateStateByKey(updateFunction)
stateDstream.print()

ssc.start()
ssc.awaitTermination()</pre></div><div class='content'></div><h1>Checkpointing</h1>
<div class='content'><p>El checkpointing es esencial para la tolerancia a fallos en el procesamiento de flujos con estado. Guarda el estado del flujo periódicamente en un almacenamiento confiable.</p>
<ul>
<li><strong>Directorio de Checkpoint</strong>: Un directorio en HDFS o un sistema de archivos distribuido similar donde se guarda el estado.</li>
<li><strong>Intervalo de Checkpoint</strong>: La frecuencia con la que se guarda el estado.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c3NjLmNoZWNrcG9pbnQoImhkZnM6Ly9jaGVja3BvaW50LWRpcmVjdG9yeSIp"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ssc.checkpoint(&quot;hdfs://checkpoint-directory&quot;)</pre></div><div class='content'></div><h1>Resumen</h1>
<div class='content'><p>El procesamiento de flujos con estado en Apache Spark te permite mantener y actualizar información de estado a través de múltiples registros en un flujo. Las operaciones clave incluyen <code>mapWithState</code> y <code>updateStateByKey</code>, que te permiten realizar transformaciones complejas que dependen de datos históricos. El checkpointing asegura la tolerancia a fallos guardando periódicamente el estado en un almacenamiento confiable.</p>
<p>Al comprender y utilizar estos conceptos, puedes construir aplicaciones de streaming con estado robustas que pueden manejar requisitos de procesamiento de datos en tiempo real de manera efectiva.</p>
</div><div class='row navigation'><div class='col-6'><a href='window-operations'>&#x25C4; Operaciones de Ventana</a></div><div class='col-6 text-end'><a href='structured-streaming'>Streaming Estructurado &#x25BA;</a></div></div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/es/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
