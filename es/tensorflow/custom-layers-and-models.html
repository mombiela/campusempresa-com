<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy<br> y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
										<b id="lit_lang_es">Castellano</b>
				|
				<a href="https://campusempresa.cat/tensorflow/custom-layers-and-models" id="lnk_lang_ca" data-lang="ca">Català</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="objective">El Proyecto</a>
				<a href="about">Sobre nosotros</a>
				<a href="contribute">Contribuir</a>
				<a href="donate">Donaciones</a>
				<a href="licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='content'></div><h1>Introducción</h1>
<div class='content'><p>En esta sección, exploraremos cómo crear capas y modelos personalizados usando TensorFlow. Esto es esencial para construir arquitecturas de redes neuronales más complejas y adaptadas que van más allá de las capas y modelos predefinidos disponibles en TensorFlow.</p>
</div><h1>Capas Personalizadas</h1>
<div class='content'></div><h2>¿Por qué Crear Capas Personalizadas?</h2>
<div class='content'><ul>
<li><strong>Flexibilidad</strong>: Las capas personalizadas te permiten implementar operaciones específicas que no están disponibles en las capas predefinidas de TensorFlow.</li>
<li><strong>Reusabilidad</strong>: Una vez creadas, las capas personalizadas pueden reutilizarse en diferentes modelos.</li>
<li><strong>Optimización</strong>: Adapta el comportamiento de la capa para optimizar el rendimiento para tu caso de uso específico.</li>
</ul>
</div><h2>Creando una Capa Personalizada</h2>
<div class='content'><p>Para crear una capa personalizada, necesitas subclasificar <code>tf.keras.layers.Layer</code> e implementar los siguientes métodos:</p>
<ul>
<li><code>__init__</code>: Inicializa los atributos de la capa.</li>
<li><code>build</code>: Define los pesos de la capa.</li>
<li><code>call</code>: Implementa la pasada hacia adelante de la capa.</li>
</ul>
<h4>Ejemplo: Capa Densa Personalizada</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRlbnNvcmZsb3cgYXMgdGYKCmNsYXNzIEN1c3RvbURlbnNlTGF5ZXIodGYua2VyYXMubGF5ZXJzLkxheWVyKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB1bml0cz0zMik6CiAgICAgICAgc3VwZXIoQ3VzdG9tRGVuc2VMYXllciwgc2VsZikuX19pbml0X18oKQogICAgICAgIHNlbGYudW5pdHMgPSB1bml0cwoKICAgIGRlZiBidWlsZChzZWxmLCBpbnB1dF9zaGFwZSk6CiAgICAgICAgc2VsZi53ID0gc2VsZi5hZGRfd2VpZ2h0KHNoYXBlPShpbnB1dF9zaGFwZVstMV0sIHNlbGYudW5pdHMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXplcj0ncmFuZG9tX25vcm1hbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYWluYWJsZT1UcnVlKQogICAgICAgIHNlbGYuYiA9IHNlbGYuYWRkX3dlaWdodChzaGFwZT0oc2VsZi51bml0cywpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXplcj0nemVyb3MnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFpbmFibGU9VHJ1ZSkKCiAgICBkZWYgY2FsbChzZWxmLCBpbnB1dHMpOgogICAgICAgIHJldHVybiB0Zi5tYXRtdWwoaW5wdXRzLCBzZWxmLncpICsgc2VsZi5iCgojIFVzbwpjdXN0b21fZGVuc2UgPSBDdXN0b21EZW5zZUxheWVyKDEwKQpvdXRwdXQgPSBjdXN0b21fZGVuc2UodGYucmFuZG9tLnVuaWZvcm0oWzUsIDVdKSkKcHJpbnQob3V0cHV0KQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import tensorflow as tf

class CustomDenseLayer(tf.keras.layers.Layer):
    def __init__(self, units=32):
        super(CustomDenseLayer, self).__init__()
        self.units = units

    def build(self, input_shape):
        self.w = self.add_weight(shape=(input_shape[-1], self.units),
                                 initializer='random_normal',
                                 trainable=True)
        self.b = self.add_weight(shape=(self.units,),
                                 initializer='zeros',
                                 trainable=True)

    def call(self, inputs):
        return tf.matmul(inputs, self.w) + self.b

# Uso
custom_dense = CustomDenseLayer(10)
output = custom_dense(tf.random.uniform([5, 5]))
print(output)</pre></div><div class='content'><p>En este ejemplo:</p>
<ul>
<li><code>__init__</code> inicializa el número de unidades.</li>
<li><code>build</code> crea los pesos <code>w</code> y <code>b</code>.</li>
<li><code>call</code> define la pasada hacia adelante usando multiplicación de matrices.</li>
</ul>
</div><h1>Modelos Personalizados</h1>
<div class='content'></div><h2>¿Por qué Crear Modelos Personalizados?</h2>
<div class='content'><ul>
<li><strong>Arquitecturas Complejas</strong>: Los modelos personalizados te permiten construir arquitecturas más complejas que no son posibles con la API Sequential.</li>
<li><strong>Control</strong>: Proporciona más control sobre la pasada hacia adelante y el comportamiento general del modelo.</li>
</ul>
</div><h2>Creando un Modelo Personalizado</h2>
<div class='content'><p>Para crear un modelo personalizado, necesitas subclasificar <code>tf.keras.Model</code> e implementar los siguientes métodos:</p>
<ul>
<li><code>__init__</code>: Inicializa las capas del modelo.</li>
<li><code>call</code>: Implementa la pasada hacia adelante del modelo.</li>
</ul>
<h4>Ejemplo: Modelo Personalizado con Capa Personalizada</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgQ3VzdG9tTW9kZWwodGYua2VyYXMuTW9kZWwpOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHN1cGVyKEN1c3RvbU1vZGVsLCBzZWxmKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi5kZW5zZTEgPSBDdXN0b21EZW5zZUxheWVyKDMyKQogICAgICAgIHNlbGYuZGVuc2UyID0gQ3VzdG9tRGVuc2VMYXllcigxMCkKCiAgICBkZWYgY2FsbChzZWxmLCBpbnB1dHMpOgogICAgICAgIHggPSBzZWxmLmRlbnNlMShpbnB1dHMpCiAgICAgICAgcmV0dXJuIHNlbGYuZGVuc2UyKHgpCgojIFVzbwptb2RlbCA9IEN1c3RvbU1vZGVsKCkKb3V0cHV0ID0gbW9kZWwodGYucmFuZG9tLnVuaWZvcm0oWzUsIDVdKSkKcHJpbnQob3V0cHV0KQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class CustomModel(tf.keras.Model):
    def __init__(self):
        super(CustomModel, self).__init__()
        self.dense1 = CustomDenseLayer(32)
        self.dense2 = CustomDenseLayer(10)

    def call(self, inputs):
        x = self.dense1(inputs)
        return self.dense2(x)

# Uso
model = CustomModel()
output = model(tf.random.uniform([5, 5]))
print(output)</pre></div><div class='content'><p>En este ejemplo:</p>
<ul>
<li><code>__init__</code> inicializa dos capas densas personalizadas.</li>
<li><code>call</code> define la pasada hacia adelante usando estas capas.</li>
</ul>
</div><h1>Capas y Modelos Personalizados Avanzados</h1>
<div class='content'></div><h2>Añadiendo Regularización</h2>
<div class='content'><p>Puedes añadir regularización a las capas personalizadas incluyendo pérdidas de regularización en el método <code>build</code>.</p>
<h4>Ejemplo: Capa Personalizada con Regularización L2</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgQ3VzdG9tRGVuc2VMYXllcldpdGhSZWd1bGFyaXphdGlvbih0Zi5rZXJhcy5sYXllcnMuTGF5ZXIpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHVuaXRzPTMyLCByZWd1bGFyaXplcj1Ob25lKToKICAgICAgICBzdXBlcihDdXN0b21EZW5zZUxheWVyV2l0aFJlZ3VsYXJpemF0aW9uLCBzZWxmKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi51bml0cyA9IHVuaXRzCiAgICAgICAgc2VsZi5yZWd1bGFyaXplciA9IHJlZ3VsYXJpemVyCgogICAgZGVmIGJ1aWxkKHNlbGYsIGlucHV0X3NoYXBlKToKICAgICAgICBzZWxmLncgPSBzZWxmLmFkZF93ZWlnaHQoc2hhcGU9KGlucHV0X3NoYXBlWy0xXSwgc2VsZi51bml0cyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemVyPSdyYW5kb21fbm9ybWFsJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVndWxhcml6ZXI9c2VsZi5yZWd1bGFyaXplciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhaW5hYmxlPVRydWUpCiAgICAgICAgc2VsZi5iID0gc2VsZi5hZGRfd2VpZ2h0KHNoYXBlPShzZWxmLnVuaXRzLCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemVyPSd6ZXJvcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYWluYWJsZT1UcnVlKQoKICAgIGRlZiBjYWxsKHNlbGYsIGlucHV0cyk6CiAgICAgICAgcmV0dXJuIHRmLm1hdG11bChpbnB1dHMsIHNlbGYudykgKyBzZWxmLmIKCiMgVXNvCnJlZ3VsYXJpemVyID0gdGYua2VyYXMucmVndWxhcml6ZXJzLmwyKDAuMDEpCmN1c3RvbV9kZW5zZV9yZWcgPSBDdXN0b21EZW5zZUxheWVyV2l0aFJlZ3VsYXJpemF0aW9uKDEwLCByZWd1bGFyaXplcikKb3V0cHV0ID0gY3VzdG9tX2RlbnNlX3JlZyh0Zi5yYW5kb20udW5pZm9ybShbNSwgNV0pKQpwcmludChvdXRwdXQp"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class CustomDenseLayerWithRegularization(tf.keras.layers.Layer):
    def __init__(self, units=32, regularizer=None):
        super(CustomDenseLayerWithRegularization, self).__init__()
        self.units = units
        self.regularizer = regularizer

    def build(self, input_shape):
        self.w = self.add_weight(shape=(input_shape[-1], self.units),
                                 initializer='random_normal',
                                 regularizer=self.regularizer,
                                 trainable=True)
        self.b = self.add_weight(shape=(self.units,),
                                 initializer='zeros',
                                 trainable=True)

    def call(self, inputs):
        return tf.matmul(inputs, self.w) + self.b

# Uso
regularizer = tf.keras.regularizers.l2(0.01)
custom_dense_reg = CustomDenseLayerWithRegularization(10, regularizer)
output = custom_dense_reg(tf.random.uniform([5, 5]))
print(output)</pre></div><div class='content'></div><h2>Bucle de Entrenamiento Personalizado</h2>
<div class='content'><p>Para más control sobre el proceso de entrenamiento, puedes implementar un bucle de entrenamiento personalizado.</p>
<h4>Ejemplo: Bucle de Entrenamiento Personalizado</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bW9kZWwgPSBDdXN0b21Nb2RlbCgpCmxvc3NfZm4gPSB0Zi5rZXJhcy5sb3NzZXMuU3BhcnNlQ2F0ZWdvcmljYWxDcm9zc2VudHJvcHkoZnJvbV9sb2dpdHM9VHJ1ZSkKb3B0aW1pemVyID0gdGYua2VyYXMub3B0aW1pemVycy5BZGFtKCkKCkB0Zi5mdW5jdGlvbgpkZWYgdHJhaW5fc3RlcChpbnB1dHMsIGxhYmVscyk6CiAgICB3aXRoIHRmLkdyYWRpZW50VGFwZSgpIGFzIHRhcGU6CiAgICAgICAgcHJlZGljdGlvbnMgPSBtb2RlbChpbnB1dHMpCiAgICAgICAgbG9zcyA9IGxvc3NfZm4obGFiZWxzLCBwcmVkaWN0aW9ucykKICAgIGdyYWRpZW50cyA9IHRhcGUuZ3JhZGllbnQobG9zcywgbW9kZWwudHJhaW5hYmxlX3ZhcmlhYmxlcykKICAgIG9wdGltaXplci5hcHBseV9ncmFkaWVudHMoemlwKGdyYWRpZW50cywgbW9kZWwudHJhaW5hYmxlX3ZhcmlhYmxlcykpCiAgICByZXR1cm4gbG9zcwoKIyBEYXRvcyBmaWN0aWNpb3MKaW5wdXRzID0gdGYucmFuZG9tLnVuaWZvcm0oWzUsIDVdKQpsYWJlbHMgPSB0Zi5yYW5kb20udW5pZm9ybShbNV0sIG1heHZhbD0xMCwgZHR5cGU9dGYuaW50MzIpCgojIEJ1Y2xlIGRlIGVudHJlbmFtaWVudG8KZm9yIGVwb2NoIGluIHJhbmdlKDEwKToKICAgIGxvc3MgPSB0cmFpbl9zdGVwKGlucHV0cywgbGFiZWxzKQogICAgcHJpbnQoZidFcG9jaCB7ZXBvY2h9LCBMb3NzOiB7bG9zcy5udW1weSgpfScp"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>model = CustomModel()
loss_fn = tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True)
optimizer = tf.keras.optimizers.Adam()

@tf.function
def train_step(inputs, labels):
    with tf.GradientTape() as tape:
        predictions = model(inputs)
        loss = loss_fn(labels, predictions)
    gradients = tape.gradient(loss, model.trainable_variables)
    optimizer.apply_gradients(zip(gradients, model.trainable_variables))
    return loss

# Datos ficticios
inputs = tf.random.uniform([5, 5])
labels = tf.random.uniform([5], maxval=10, dtype=tf.int32)

# Bucle de entrenamiento
for epoch in range(10):
    loss = train_step(inputs, labels)
    print(f'Epoch {epoch}, Loss: {loss.numpy()}')</pre></div><div class='content'></div><h1>Conclusión</h1>
<div class='content'><p>Crear capas y modelos personalizados en TensorFlow permite una mayor flexibilidad, control y optimización en la construcción de redes neuronales. Al subclasificar <code>tf.keras.layers.Layer</code> y <code>tf.keras.Model</code>, puedes definir comportamientos y arquitecturas específicas adaptadas a tus necesidades. Además, técnicas avanzadas como añadir regularización e implementar bucles de entrenamiento personalizados mejoran aún más las capacidades de tus modelos.</p>
</div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
       <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
       <a href="cookies">Més informació</a>
   </div>	
	</div>    
</body>
</html>
