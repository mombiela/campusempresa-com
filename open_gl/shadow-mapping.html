<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapeo de Sombras en OpenGL</title>

    <link rel="alternate" href="https://campusempresa.com/open_gl/shadow-mapping" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/open_gl/shadow-mapping" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/open_gl/shadow-mapping" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
										<a href="https://enterprisecampus.net/open_gl/shadow-mapping" class="px-2">EN</a></b>
				|
				<b class="px-2">ES</b>
				|
				<a href="https://campusempresa.cat/open_gl/shadow-mapping" class="px-2">CA</a>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Proyecto</a>
				<a href="/about">Sobre nosotros</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donaciones</a>
				<a href="/licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='advanced-shading-techniques'>&#x25C4;Técnicas Avanzadas de Sombreado</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Mapeo de Sombras en OpenGL</a>
	</div>
	<div class='col-4 text-end'>
					<a href='post-processing-effects'>Efectos de Post-Procesamiento &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introducción al Mapeo de Sombras</h1>
<div class='content'><p>El mapeo de sombras es una técnica utilizada en gráficos por computadora para añadir sombras a una escena 3D. Implica renderizar la escena desde el punto de vista de la luz para crear un mapa de profundidad, que luego se usa para determinar si un píxel está en sombra.</p>
</div><h2>Conceptos Clave</h2>
<div class='content'><ul>
<li><strong>Mapa de Profundidad</strong>: Una textura que almacena la distancia desde la fuente de luz hasta la superficie más cercana.</li>
<li><strong>Transformación del Espacio de Luz</strong>: Transformar las coordenadas del mundo a la vista de la luz para crear el mapa de profundidad.</li>
<li><strong>Prueba de Sombra</strong>: Comparar la profundidad de un fragmento con el mapa de profundidad para determinar si está en sombra.</li>
</ul>
</div><h1>Creación de un Mapa de Profundidad</h1>
<div class='content'><p>Para crear un mapa de profundidad, necesitas renderizar la escena desde la perspectiva de la luz.</p>
</div><h2>Pasos para Crear un Mapa de Profundidad</h2>
<div class='content'><ol>
<li><strong>Configurar un objeto framebuffer (FBO)</strong> con un adjunto de textura de profundidad.</li>
<li><strong>Renderizar la escena</strong> desde el punto de vista de la luz para poblar la textura de profundidad.</li>
</ol>
</div><h2>Ejemplo de Código: Configuración del Mapa de Profundidad</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gQ3JlYXIgdW4gb2JqZXRvIGZyYW1lYnVmZmVyIHBhcmEgZWwgbWFwYSBkZSBwcm9mdW5kaWRhZApHTHVpbnQgZGVwdGhNYXBGQk87CmdsR2VuRnJhbWVidWZmZXJzKDEsICZkZXB0aE1hcEZCTyk7CgovLyBDcmVhciB1bmEgdGV4dHVyYSBwYXJhIGFsbWFjZW5hciBlbCBtYXBhIGRlIHByb2Z1bmRpZGFkCkdMdWludCBkZXB0aE1hcDsKZ2xHZW5UZXh0dXJlcygxLCAmZGVwdGhNYXApOwpnbEJpbmRUZXh0dXJlKEdMX1RFWFRVUkVfMkQsIGRlcHRoTWFwKTsKZ2xUZXhJbWFnZTJEKEdMX1RFWFRVUkVfMkQsIDAsIEdMX0RFUFRIX0NPTVBPTkVOVCwgU0hBRE9XX1dJRFRILCBTSEFET1dfSEVJR0hULCAwLCBHTF9ERVBUSF9DT01QT05FTlQsIEdMX0ZMT0FULCBOVUxMKTsKZ2xUZXhQYXJhbWV0ZXJpKEdMX1RFWFRVUkVfMkQsIEdMX1RFWFRVUkVfTUlOX0ZJTFRFUiwgR0xfTkVBUkVTVCk7CmdsVGV4UGFyYW1ldGVyaShHTF9URVhUVVJFXzJELCBHTF9URVhUVVJFX01BR19GSUxURVIsIEdMX05FQVJFU1QpOwpnbFRleFBhcmFtZXRlcmkoR0xfVEVYVFVSRV8yRCwgR0xfVEVYVFVSRV9XUkFQX1MsIEdMX0NMQU1QX1RPX0JPUkRFUik7CmdsVGV4UGFyYW1ldGVyaShHTF9URVhUVVJFXzJELCBHTF9URVhUVVJFX1dSQVBfVCwgR0xfQ0xBTVBfVE9fQk9SREVSKTsKZmxvYXQgYm9yZGVyQ29sb3JbXSA9IHsgMS4wLCAxLjAsIDEuMCwgMS4wIH07CmdsVGV4UGFyYW1ldGVyZnYoR0xfVEVYVFVSRV8yRCwgR0xfVEVYVFVSRV9CT1JERVJfQ09MT1IsIGJvcmRlckNvbG9yKTsKCi8vIEFkanVudGFyIGxhIHRleHR1cmEgZGUgcHJvZnVuZGlkYWQgYWwgZnJhbWVidWZmZXIKZ2xCaW5kRnJhbWVidWZmZXIoR0xfRlJBTUVCVUZGRVIsIGRlcHRoTWFwRkJPKTsKZ2xGcmFtZWJ1ZmZlclRleHR1cmUyRChHTF9GUkFNRUJVRkZFUiwgR0xfREVQVEhfQVRUQUNITUVOVCwgR0xfVEVYVFVSRV8yRCwgZGVwdGhNYXAsIDApOwpnbERyYXdCdWZmZXIoR0xfTk9ORSk7IC8vIE5vIHNlIGRpYnVqYSBuaW5nw7puIGJ1ZmZlciBkZSBjb2xvcgpnbFJlYWRCdWZmZXIoR0xfTk9ORSk7CmdsQmluZEZyYW1lYnVmZmVyKEdMX0ZSQU1FQlVGRkVSLCAwKTs="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Crear un objeto framebuffer para el mapa de profundidad
GLuint depthMapFBO;
glGenFramebuffers(1, &amp;depthMapFBO);

// Crear una textura para almacenar el mapa de profundidad
GLuint depthMap;
glGenTextures(1, &amp;depthMap);
glBindTexture(GL_TEXTURE_2D, depthMap);
glTexImage2D(GL_TEXTURE_2D, 0, GL_DEPTH_COMPONENT, SHADOW_WIDTH, SHADOW_HEIGHT, 0, GL_DEPTH_COMPONENT, GL_FLOAT, NULL);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_BORDER);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_BORDER);
float borderColor[] = { 1.0, 1.0, 1.0, 1.0 };
glTexParameterfv(GL_TEXTURE_2D, GL_TEXTURE_BORDER_COLOR, borderColor);

// Adjuntar la textura de profundidad al framebuffer
glBindFramebuffer(GL_FRAMEBUFFER, depthMapFBO);
glFramebufferTexture2D(GL_FRAMEBUFFER, GL_DEPTH_ATTACHMENT, GL_TEXTURE_2D, depthMap, 0);
glDrawBuffer(GL_NONE); // No se dibuja ning&uacute;n buffer de color
glReadBuffer(GL_NONE);
glBindFramebuffer(GL_FRAMEBUFFER, 0);</pre></div><div class='content'></div><h1>Renderizar la Escena desde la Perspectiva de la Luz</h1>
<div class='content'><p>Para renderizar la escena desde la perspectiva de la luz, necesitas configurar una matriz de vista y proyección para la luz.</p>
</div><h2>Ejemplo de Código: Transformación del Espacio de Luz</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Z2xtOjptYXQ0IGxpZ2h0UHJvamVjdGlvbiwgbGlnaHRWaWV3OwpnbG06Om1hdDQgbGlnaHRTcGFjZU1hdHJpeDsKZmxvYXQgbmVhcl9wbGFuZSA9IDEuMGYsIGZhcl9wbGFuZSA9IDcuNWY7CmxpZ2h0UHJvamVjdGlvbiA9IGdsbTo6b3J0aG8oLTEwLjBmLCAxMC4wZiwgLTEwLjBmLCAxMC4wZiwgbmVhcl9wbGFuZSwgZmFyX3BsYW5lKTsKbGlnaHRWaWV3ID0gZ2xtOjpsb29rQXQobGlnaHRQb3MsIGdsbTo6dmVjMygwLjBmKSwgZ2xtOjp2ZWMzKDAuMGYsIDEuMGYsIDAuMGYpKTsKbGlnaHRTcGFjZU1hdHJpeCA9IGxpZ2h0UHJvamVjdGlvbiAqIGxpZ2h0VmlldzsKCi8vIFBhc2FyIGxpZ2h0U3BhY2VNYXRyaXggYWwgc2hhZGVyCnNoYWRlci5zZXRNYXQ0KCJsaWdodFNwYWNlTWF0cml4IiwgbGlnaHRTcGFjZU1hdHJpeCk7"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>glm::mat4 lightProjection, lightView;
glm::mat4 lightSpaceMatrix;
float near_plane = 1.0f, far_plane = 7.5f;
lightProjection = glm::ortho(-10.0f, 10.0f, -10.0f, 10.0f, near_plane, far_plane);
lightView = glm::lookAt(lightPos, glm::vec3(0.0f), glm::vec3(0.0f, 1.0f, 0.0f));
lightSpaceMatrix = lightProjection * lightView;

// Pasar lightSpaceMatrix al shader
shader.setMat4(&quot;lightSpaceMatrix&quot;, lightSpaceMatrix);</pre></div><div class='content'></div><h1>Realizar la Prueba de Sombra</h1>
<div class='content'><p>Después de crear el mapa de profundidad, necesitas realizar una prueba de sombra en el shader de fragmentos para determinar si un fragmento está en sombra.</p>
</div><h2>Ejemplo de Código: Prueba de Sombra en el Shader de Fragmentos</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("I3ZlcnNpb24gMzMwIGNvcmUKaW4gdmVjNCBGcmFnUG9zTGlnaHRTcGFjZTsKdW5pZm9ybSBzYW1wbGVyMkQgc2hhZG93TWFwOwoKZmxvYXQgU2hhZG93Q2FsY3VsYXRpb24odmVjNCBmcmFnUG9zTGlnaHRTcGFjZSkKewogICAgLy8gUmVhbGl6YXIgbGEgZGl2aXNpw7NuIGRlIHBlcnNwZWN0aXZhCiAgICB2ZWMzIHByb2pDb29yZHMgPSBmcmFnUG9zTGlnaHRTcGFjZS54eXogLyBmcmFnUG9zTGlnaHRTcGFjZS53OwogICAgLy8gVHJhbnNmb3JtYXIgYWwgcmFuZ28gWzAsMV0KICAgIHByb2pDb29yZHMgPSBwcm9qQ29vcmRzICogMC41ICsgMC41OwogICAgLy8gT2J0ZW5lciBlbCB2YWxvciBkZSBwcm9mdW5kaWRhZCBtw6FzIGNlcmNhbm8gZGVzZGUgbGEgcGVyc3BlY3RpdmEgZGUgbGEgbHV6ICh1c2FuZG8gZWwgcmFuZ28gWzAsMV0pCiAgICBmbG9hdCBjbG9zZXN0RGVwdGggPSB0ZXh0dXJlKHNoYWRvd01hcCwgcHJvakNvb3Jkcy54eSkucjsKICAgIC8vIE9idGVuZXIgbGEgcHJvZnVuZGlkYWQgZGVsIGZyYWdtZW50byBhY3R1YWwgZGVzZGUgbGEgcGVyc3BlY3RpdmEgZGUgbGEgbHV6CiAgICBmbG9hdCBjdXJyZW50RGVwdGggPSBwcm9qQ29vcmRzLno7CiAgICAvLyBDb21wcm9iYXIgc2kgZWwgZnJhZ21lbnRvIGFjdHVhbCBlc3TDoSBlbiBzb21icmEKICAgIGZsb2F0IHNoYWRvdyA9IGN1cnJlbnREZXB0aCA+IGNsb3Nlc3REZXB0aCAgPyAxLjAgOiAwLjA7CiAgICByZXR1cm4gc2hhZG93Owp9Cgp2b2lkIG1haW4oKQp7CiAgICBmbG9hdCBzaGFkb3cgPSBTaGFkb3dDYWxjdWxhdGlvbihGcmFnUG9zTGlnaHRTcGFjZSk7CiAgICB2ZWMzIGNvbG9yID0gdmVjMygxLjApICogKDEuMCAtIHNoYWRvdyk7IC8vIEFwbGljYXIgc29tYnJhCiAgICBGcmFnQ29sb3IgPSB2ZWM0KGNvbG9yLCAxLjApOwp9"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#version 330 core
in vec4 FragPosLightSpace;
uniform sampler2D shadowMap;

float ShadowCalculation(vec4 fragPosLightSpace)
{
    // Realizar la divisi&oacute;n de perspectiva
    vec3 projCoords = fragPosLightSpace.xyz / fragPosLightSpace.w;
    // Transformar al rango [0,1]
    projCoords = projCoords * 0.5 + 0.5;
    // Obtener el valor de profundidad m&aacute;s cercano desde la perspectiva de la luz (usando el rango [0,1])
    float closestDepth = texture(shadowMap, projCoords.xy).r;
    // Obtener la profundidad del fragmento actual desde la perspectiva de la luz
    float currentDepth = projCoords.z;
    // Comprobar si el fragmento actual est&aacute; en sombra
    float shadow = currentDepth &gt; closestDepth  ? 1.0 : 0.0;
    return shadow;
}

void main()
{
    float shadow = ShadowCalculation(FragPosLightSpace);
    vec3 color = vec3(1.0) * (1.0 - shadow); // Aplicar sombra
    FragColor = vec4(color, 1.0);
}</pre></div><div class='content'></div><h1>Mejorar la Calidad de las Sombras</h1>
<div class='content'><p>Existen varias técnicas para mejorar la calidad de las sombras:</p>
<ul>
<li><strong>PCF (Filtrado de Cercanía de Porcentaje)</strong>: Suaviza los bordes de la sombra promediando múltiples comparaciones de profundidad.</li>
<li><strong>Resolución del Mapa de Sombras</strong>: Aumentar la resolución del mapa de profundidad puede reducir el aliasing.</li>
<li><strong>Bias</strong>: Añadir un pequeño sesgo a la comparación de profundidad para reducir el acné de sombra.</li>
</ul>
</div><h2>Ejemplo de Código: PCF en el Shader de Fragmentos</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZmxvYXQgU2hhZG93Q2FsY3VsYXRpb24odmVjNCBmcmFnUG9zTGlnaHRTcGFjZSkKewogICAgdmVjMyBwcm9qQ29vcmRzID0gZnJhZ1Bvc0xpZ2h0U3BhY2UueHl6IC8gZnJhZ1Bvc0xpZ2h0U3BhY2UudzsKICAgIHByb2pDb29yZHMgPSBwcm9qQ29vcmRzICogMC41ICsgMC41OwogICAgZmxvYXQgY3VycmVudERlcHRoID0gcHJvakNvb3Jkcy56OwogICAgZmxvYXQgc2hhZG93ID0gMC4wOwogICAgdmVjMiB0ZXhlbFNpemUgPSAxLjAgLyB0ZXh0dXJlU2l6ZShzaGFkb3dNYXAsIDApOwogICAgZm9yKGludCB4ID0gLTE7IHggPD0gMTsgKyt4KQogICAgewogICAgICAgIGZvcihpbnQgeSA9IC0xOyB5IDw9IDE7ICsreSkKICAgICAgICB7CiAgICAgICAgICAgIGZsb2F0IHBjZkRlcHRoID0gdGV4dHVyZShzaGFkb3dNYXAsIHByb2pDb29yZHMueHkgKyB2ZWMyKHgsIHkpICogdGV4ZWxTaXplKS5yOwogICAgICAgICAgICBzaGFkb3cgKz0gY3VycmVudERlcHRoID4gcGNmRGVwdGggID8gMS4wIDogMC4wOwogICAgICAgIH0KICAgIH0KICAgIHNoYWRvdyAvPSA5LjA7CiAgICByZXR1cm4gc2hhZG93Owp9"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>float ShadowCalculation(vec4 fragPosLightSpace)
{
    vec3 projCoords = fragPosLightSpace.xyz / fragPosLightSpace.w;
    projCoords = projCoords * 0.5 + 0.5;
    float currentDepth = projCoords.z;
    float shadow = 0.0;
    vec2 texelSize = 1.0 / textureSize(shadowMap, 0);
    for(int x = -1; x &lt;= 1; ++x)
    {
        for(int y = -1; y &lt;= 1; ++y)
        {
            float pcfDepth = texture(shadowMap, projCoords.xy + vec2(x, y) * texelSize).r;
            shadow += currentDepth &gt; pcfDepth  ? 1.0 : 0.0;
        }
    }
    shadow /= 9.0;
    return shadow;
}</pre></div><div class='content'></div><h1>Conclusión</h1>
<div class='content'><p>El mapeo de sombras es una técnica poderosa para añadir sombras realistas a una escena 3D. Al entender el proceso de creación de un mapa de profundidad, la transformación de coordenadas al espacio de luz y la realización de pruebas de sombra, puedes implementar el mapeo de sombras básico. Mejoras adicionales como PCF y ajustar la resolución del mapa de sombras pueden mejorar la calidad de las sombras en tus escenas.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='advanced-shading-techniques'>&#x25C4;Técnicas Avanzadas de Sombreado</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Mapeo de Sombras en OpenGL</a>
	</div>
	<div class='col-4 text-end'>
					<a href='post-processing-effects'>Efectos de Post-Procesamiento &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
