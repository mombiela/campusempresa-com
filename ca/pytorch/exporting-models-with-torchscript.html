<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exportant Models amb TorchScript</title>

    <link rel="alternate" href="https://campusempresa.com/es/pytorch/exporting-models-with-torchscript" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/pytorch/exporting-models-with-torchscript" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/pytorch/exporting-models-with-torchscript" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/ca/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui<br> i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="/es/pytorch/exporting-models-with-torchscript" id="lnk_lang_es" data-lang="es" class="px-2">ES</a></b>
				|
				<b id="lit_lang_ca" class="px-2">CA</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/ca/objective">El Projecte</a>
				<a href="/ca/about">Sobre nosaltres</a>
				<a href="/ca/contribute">Contribuir</a>
				<a href="/ca/donate">Donacions</a>
				<a href="/ca/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='content'></div><h1>Introducció a TorchScript</h1>
<div class='content'><p>TorchScript és una manera de crear models serialitzables i optimitzables a partir de codi PyTorch. Et permet desar els teus models i executar-los independentment de Python, cosa que és útil per desplegar models en entorns de producció.</p>
</div><h2>Conceptes Clau</h2>
<div class='content'><ul>
<li><strong>TorchScript</strong>: Una manera de convertir models PyTorch a un format que es pot executar en un entorn no Python.</li>
<li><strong>Tracing</strong>: Un mètode per convertir un model enregistrant les operacions a mesura que s'executen amb exemples d'entrada.</li>
<li><strong>Scripting</strong>: Un mètode per convertir un model compilant directament el codi Python en TorchScript.</li>
</ul>
</div><h1>Mètodes per Exportar Models</h1>
<div class='content'></div><h2>Tracing</h2>
<div class='content'><p>Tracing captura les operacions en el model executant un exemple d'entrada a través d'ell. Aquest mètode és senzill però té limitacions, especialment amb operacions de flux de control com bucles i condicionals.</p>
<h4>Exemple</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCmltcG9ydCB0b3JjaC5ubiBhcyBubgoKIyBEZWZpbmlyIHVuIG1vZGVsIHNlbnppbGwKY2xhc3MgU2ltcGxlTW9kZWwobm4uTW9kdWxlKToKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICBzdXBlcihTaW1wbGVNb2RlbCwgc2VsZikuX19pbml0X18oKQogICAgICAgIHNlbGYuZmMgPSBubi5MaW5lYXIoMTAsIDUpCiAgICAKICAgIGRlZiBmb3J3YXJkKHNlbGYsIHgpOgogICAgICAgIHJldHVybiBzZWxmLmZjKHgpCgojIEluc3RhbmNpYXIgZWwgbW9kZWwgaSBjcmVhciB1biBleGVtcGxlIGQnZW50cmFkYQptb2RlbCA9IFNpbXBsZU1vZGVsKCkKZXhhbXBsZV9pbnB1dCA9IHRvcmNoLnJhbmRuKDEsIDEwKQoKIyBUcmHDp2FyIGVsIG1vZGVsCnRyYWNlZF9tb2RlbCA9IHRvcmNoLmppdC50cmFjZShtb2RlbCwgZXhhbXBsZV9pbnB1dCkKCiMgRGVzYXIgZWwgbW9kZWwgdHJhw6dhdAp0cmFjZWRfbW9kZWwuc2F2ZSgidHJhY2VkX21vZGVsLnB0Iik="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch
import torch.nn as nn

# Definir un model senzill
class SimpleModel(nn.Module):
    def __init__(self):
        super(SimpleModel, self).__init__()
        self.fc = nn.Linear(10, 5)
    
    def forward(self, x):
        return self.fc(x)

# Instanciar el model i crear un exemple d'entrada
model = SimpleModel()
example_input = torch.randn(1, 10)

# Tra&ccedil;ar el model
traced_model = torch.jit.trace(model, example_input)

# Desar el model tra&ccedil;at
traced_model.save(&quot;traced_model.pt&quot;)</pre></div><div class='content'><ul>
<li><strong>Explicació</strong>:
<ul>
<li>Definim un model lineal senzill.</li>
<li>Creem un tensor d'exemple d'entrada.</li>
<li>Utilitzem <code>torch.jit.trace</code> per traçar el model amb l'exemple d'entrada.</li>
<li>Desem el model traçat en un fitxer.</li>
</ul>
</li>
</ul>
</div><h2>Scripting</h2>
<div class='content'><p>Scripting converteix el model compilant directament el codi Python. Aquest mètode és més flexible i pot gestionar models amb flux de control dinàmic.</p>
<h4>Exemple</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCmltcG9ydCB0b3JjaC5ubiBhcyBubgoKIyBEZWZpbmlyIHVuIG1vZGVsIGFtYiBmbHV4IGRlIGNvbnRyb2wKY2xhc3MgQ29udHJvbEZsb3dNb2RlbChubi5Nb2R1bGUpOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHN1cGVyKENvbnRyb2xGbG93TW9kZWwsIHNlbGYpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLmZjMSA9IG5uLkxpbmVhcigxMCwgNSkKICAgICAgICBzZWxmLmZjMiA9IG5uLkxpbmVhcig1LCAyKQogICAgCiAgICBkZWYgZm9yd2FyZChzZWxmLCB4KToKICAgICAgICBpZiB4LnN1bSgpID4gMDoKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZmMxKHgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZmMyKHgpCgojIEluc3RhbmNpYXIgZWwgbW9kZWwKbW9kZWwgPSBDb250cm9sRmxvd01vZGVsKCkKCiMgRXNjcml1cmUgZWwgbW9kZWwKc2NyaXB0ZWRfbW9kZWwgPSB0b3JjaC5qaXQuc2NyaXB0KG1vZGVsKQoKIyBEZXNhciBlbCBtb2RlbCBlc2NyaXQKc2NyaXB0ZWRfbW9kZWwuc2F2ZSgic2NyaXB0ZWRfbW9kZWwucHQiKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch
import torch.nn as nn

# Definir un model amb flux de control
class ControlFlowModel(nn.Module):
    def __init__(self):
        super(ControlFlowModel, self).__init__()
        self.fc1 = nn.Linear(10, 5)
        self.fc2 = nn.Linear(5, 2)
    
    def forward(self, x):
        if x.sum() &gt; 0:
            return self.fc1(x)
        else:
            return self.fc2(x)

# Instanciar el model
model = ControlFlowModel()

# Escriure el model
scripted_model = torch.jit.script(model)

# Desar el model escrit
scripted_model.save(&quot;scripted_model.pt&quot;)</pre></div><div class='content'><ul>
<li><strong>Explicació</strong>:
<ul>
<li>Definim un model amb una instrucció condicional en el mètode forward.</li>
<li>Utilitzem <code>torch.jit.script</code> per escriure el model.</li>
<li>Desem el model escrit en un fitxer.</li>
</ul>
</li>
</ul>
</div><h1>Comparant Tracing i Scripting</h1>
<div class='content'><p>| Característica         | Tracing                            | Scripting                          |
|------------------------|------------------------------------|------------------------------------|
| <strong>Facilitat d'Ús</strong>     | Més fàcil, requereix exemple d'entrada | Una mica més complex               |
| <strong>Flux de Control</strong>    | Limitat, no pot gestionar flux dinàmic | Gestiona flux de control dinàmic   |
| <strong>Rendiment</strong>          | Generalment més ràpid per models estàtics | Pot ser més lent degut a la flexibilitat |
| <strong>Usos</strong>               | Models senzills i estàtics         | Models complexos amb flux de control |</p>
</div><h1>Carregant i Utilitzant Models Exportats</h1>
<div class='content'><p>Un cop un model és exportat, es pot carregar i utilitzar en qualsevol entorn que suporti TorchScript.</p>
<h4>Exemple</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCgojIENhcnJlZ2FyIGVsIG1vZGVsIHRyYcOnYXQKbG9hZGVkX3RyYWNlZF9tb2RlbCA9IHRvcmNoLmppdC5sb2FkKCJ0cmFjZWRfbW9kZWwucHQiKQoKIyBDYXJyZWdhciBlbCBtb2RlbCBlc2NyaXQKbG9hZGVkX3NjcmlwdGVkX21vZGVsID0gdG9yY2guaml0LmxvYWQoInNjcmlwdGVkX21vZGVsLnB0IikKCiMgQ3JlYXIgZXhlbXBsZSBkJ2VudHJhZGEKZXhhbXBsZV9pbnB1dCA9IHRvcmNoLnJhbmRuKDEsIDEwKQoKIyBVdGlsaXR6YXIgZWxzIG1vZGVscyBjYXJyZWdhdHMKb3V0cHV0X3RyYWNlZCA9IGxvYWRlZF90cmFjZWRfbW9kZWwoZXhhbXBsZV9pbnB1dCkKb3V0cHV0X3NjcmlwdGVkID0gbG9hZGVkX3NjcmlwdGVkX21vZGVsKGV4YW1wbGVfaW5wdXQpCgpwcmludChvdXRwdXRfdHJhY2VkKQpwcmludChvdXRwdXRfc2NyaXB0ZWQp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch

# Carregar el model tra&ccedil;at
loaded_traced_model = torch.jit.load(&quot;traced_model.pt&quot;)

# Carregar el model escrit
loaded_scripted_model = torch.jit.load(&quot;scripted_model.pt&quot;)

# Crear exemple d'entrada
example_input = torch.randn(1, 10)

# Utilitzar els models carregats
output_traced = loaded_traced_model(example_input)
output_scripted = loaded_scripted_model(example_input)

print(output_traced)
print(output_scripted)</pre></div><div class='content'><ul>
<li><strong>Explicació</strong>:
<ul>
<li>Carreguem els models traçats i escrits prèviament desats utilitzant <code>torch.jit.load</code>.</li>
<li>Creem un tensor d'exemple d'entrada.</li>
<li>Executem l'exemple d'entrada a través dels models carregats i imprimim les sortides.</li>
</ul>
</li>
</ul>
</div><h1>Conclusió</h1>
<div class='content'><p>Exportar models amb TorchScript és una característica poderosa de PyTorch que permet el desplegament de models en entorns de producció. Tracing és adequat per models senzills i estàtics, mentre que scripting és més flexible i pot gestionar models complexos amb flux de control dinàmic. Entendre quan utilitzar cada mètode i com carregar i utilitzar models exportats és essencial per un desplegament efectiu de models.</p>
</div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/ca/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
