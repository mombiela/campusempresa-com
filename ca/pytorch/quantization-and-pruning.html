<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantització i Poda en PyTorch</title>

    <link rel="alternate" href="https://campusempresa.com/es/pytorch/quantization-and-pruning" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/pytorch/quantization-and-pruning" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/pytorch/quantization-and-pruning" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/ca/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui<br> i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="/es/pytorch/quantization-and-pruning" id="lnk_lang_es" data-lang="es" class="px-2">ES</a></b>
				|
				<b id="lit_lang_ca" class="px-2">CA</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="objective">El Projecte</a>
				<a href="about">Sobre nosaltres</a>
				<a href="contribute">Contribuir</a>
				<a href="donate">Donacions</a>
				<a href="licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='content'></div><h1>Introducció</h1>
<div class='content'><p>La quantització i la poda són dues tècniques utilitzades per optimitzar models d'aprenentatge profund, fent-los més eficients i ràpids sense comprometre significativament la precisió. Aquesta secció et guiarà a través dels conceptes bàsics d'aquestes tècniques, la seva implementació en PyTorch i l'ús avançat.</p>
</div><h1>Quantització</h1>
<div class='content'></div><h2>Què és la Quantització?</h2>
<div class='content'><p>La quantització és el procés de reduir el nombre de bits que representen un nombre. En el context de l'aprenentatge profund, implica convertir els pesos i les activacions d'una xarxa neuronal de precisió de punt flotant (32 bits) a una precisió inferior (per exemple, enters de 8 bits).</p>
</div><h2>Beneficis de la Quantització</h2>
<div class='content'><ul>
<li><strong>Reducció de la Mida del Model</strong>: Els pesos de menor precisió ocupen menys memòria.</li>
<li><strong>Augment de la Velocitat d'Inferència</strong>: Les operacions amb dades de menor precisió són més ràpides.</li>
<li><strong>Menor Consum d'Energia</strong>: Es requereix menys potència computacional.</li>
</ul>
</div><h2>Tipus de Quantització</h2>
<div class='content'><ul>
<li><strong>Quantització Dinàmica</strong>: Els pesos es quantitzen després de l'entrenament, però les activacions es quantitzen dinàmicament durant la inferència.</li>
<li><strong>Quantització Estàtica</strong>: Tant els pesos com les activacions es quantitzen després de l'entrenament.</li>
<li><strong>Entrenament Conscient de la Quantització (QAT)</strong>: El model s'entrena tenint en compte la quantització, cosa que condueix a una millor precisió.</li>
</ul>
</div><h2>Implementació de la Quantització Dinàmica en PyTorch</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCmltcG9ydCB0b3JjaHZpc2lvbi5tb2RlbHMgYXMgbW9kZWxzCgojIENhcnJlZ2FyIHVuIG1vZGVsIHByZWVudHJlbmF0Cm1vZGVsID0gbW9kZWxzLnJlc25ldDE4KHByZXRyYWluZWQ9VHJ1ZSkKCiMgQXBsaWNhciBxdWFudGl0emFjacOzIGRpbsOgbWljYQpxdWFudGl6ZWRfbW9kZWwgPSB0b3JjaC5xdWFudGl6YXRpb24ucXVhbnRpemVfZHluYW1pYygKICAgIG1vZGVsLCB7dG9yY2gubm4uTGluZWFyfSwgZHR5cGU9dG9yY2gucWludDgKKQoKIyBJbXByaW1pciBlbCBtb2RlbCBwZXIgdmV1cmUgZWxzIGNhbnZpcwpwcmludChxdWFudGl6ZWRfbW9kZWwp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch
import torchvision.models as models

# Carregar un model preentrenat
model = models.resnet18(pretrained=True)

# Aplicar quantitzaci&oacute; din&agrave;mica
quantized_model = torch.quantization.quantize_dynamic(
    model, {torch.nn.Linear}, dtype=torch.qint8
)

# Imprimir el model per veure els canvis
print(quantized_model)</pre></div><div class='content'></div><h2>Implementació de la Quantització Estàtica en PyTorch</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCmltcG9ydCB0b3JjaHZpc2lvbi5tb2RlbHMgYXMgbW9kZWxzCgojIENhcnJlZ2FyIHVuIG1vZGVsIHByZWVudHJlbmF0Cm1vZGVsID0gbW9kZWxzLnJlc25ldDE4KHByZXRyYWluZWQ9VHJ1ZSkKbW9kZWwuZXZhbCgpCgojIEZ1c2lvbmFyIGxlcyBjYXBlcyAobmVjZXNzYXJpIHBlciBhIGxhIHF1YW50aXR6YWNpw7MgZXN0w6B0aWNhKQptb2RlbC5mdXNlX21vZGVsKCkKCiMgUHJlcGFyYXIgZWwgbW9kZWwgcGVyIGEgbGEgcXVhbnRpdHphY2nDsyBlc3TDoHRpY2EKbW9kZWwucWNvbmZpZyA9IHRvcmNoLnF1YW50aXphdGlvbi5nZXRfZGVmYXVsdF9xY29uZmlnKCdmYmdlbW0nKQp0b3JjaC5xdWFudGl6YXRpb24ucHJlcGFyZShtb2RlbCwgaW5wbGFjZT1UcnVlKQoKIyBDYWxpYnJhciBlbCBtb2RlbCBhbWIgdW4gY29uanVudCBkZSBkYWRlcyByZXByZXNlbnRhdGl1CiMgKEFxdcOtLCB1dGlsaXR6ZW0gdW5hIGVudHJhZGEgZmljdMOtY2lhIHBlciBzaW1wbGljaXRhdCkKaW5wdXRfdGVuc29yID0gdG9yY2gucmFuZG4oMSwgMywgMjI0LCAyMjQpCm1vZGVsKGlucHV0X3RlbnNvcikKCiMgQ29udmVydGlyIGVsIG1vZGVsIGEgdW5hIHZlcnNpw7MgcXVhbnRpdHphZGEKdG9yY2gucXVhbnRpemF0aW9uLmNvbnZlcnQobW9kZWwsIGlucGxhY2U9VHJ1ZSkKCiMgSW1wcmltaXIgZWwgbW9kZWwgcGVyIHZldXJlIGVscyBjYW52aXMKcHJpbnQobW9kZWwp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch
import torchvision.models as models

# Carregar un model preentrenat
model = models.resnet18(pretrained=True)
model.eval()

# Fusionar les capes (necessari per a la quantitzaci&oacute; est&agrave;tica)
model.fuse_model()

# Preparar el model per a la quantitzaci&oacute; est&agrave;tica
model.qconfig = torch.quantization.get_default_qconfig('fbgemm')
torch.quantization.prepare(model, inplace=True)

# Calibrar el model amb un conjunt de dades representatiu
# (Aqu&iacute;, utilitzem una entrada fict&iacute;cia per simplicitat)
input_tensor = torch.randn(1, 3, 224, 224)
model(input_tensor)

# Convertir el model a una versi&oacute; quantitzada
torch.quantization.convert(model, inplace=True)

# Imprimir el model per veure els canvis
print(model)</pre></div><div class='content'></div><h2>Entrenament Conscient de la Quantització (QAT)</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCmltcG9ydCB0b3JjaHZpc2lvbi5tb2RlbHMgYXMgbW9kZWxzCgojIENhcnJlZ2FyIHVuIG1vZGVsIHByZWVudHJlbmF0Cm1vZGVsID0gbW9kZWxzLnJlc25ldDE4KHByZXRyYWluZWQ9VHJ1ZSkKbW9kZWwudHJhaW4oKQoKIyBGdXNpb25hciBsZXMgY2FwZXMKbW9kZWwuZnVzZV9tb2RlbCgpCgojIFByZXBhcmFyIGVsIG1vZGVsIHBlciBhIFFBVAptb2RlbC5xY29uZmlnID0gdG9yY2gucXVhbnRpemF0aW9uLmdldF9kZWZhdWx0X3FhdF9xY29uZmlnKCdmYmdlbW0nKQp0b3JjaC5xdWFudGl6YXRpb24ucHJlcGFyZV9xYXQobW9kZWwsIGlucGxhY2U9VHJ1ZSkKCiMgQWp1c3RhciBlbCBtb2RlbCBhbWIgZGFkZXMgZCdlbnRyZW5hbWVudAojIChBcXXDrSwgdXRpbGl0emVtIHVuIGJ1Y2xlIGQnZW50cmVuYW1lbnQgZmljdGljaSBwZXIgc2ltcGxpY2l0YXQpCm9wdGltaXplciA9IHRvcmNoLm9wdGltLlNHRChtb2RlbC5wYXJhbWV0ZXJzKCksIGxyPTAuMDEpCmZvciBlcG9jaCBpbiByYW5nZSg1KToKICAgIG9wdGltaXplci56ZXJvX2dyYWQoKQogICAgb3V0cHV0ID0gbW9kZWwoaW5wdXRfdGVuc29yKQogICAgbG9zcyA9IHRvcmNoLm5uLmZ1bmN0aW9uYWwuY3Jvc3NfZW50cm9weShvdXRwdXQsIHRvcmNoLnRlbnNvcihbMF0pKQogICAgbG9zcy5iYWNrd2FyZCgpCiAgICBvcHRpbWl6ZXIuc3RlcCgpCgojIENvbnZlcnRpciBlbCBtb2RlbCBhIHVuYSB2ZXJzacOzIHF1YW50aXR6YWRhCnRvcmNoLnF1YW50aXphdGlvbi5jb252ZXJ0KG1vZGVsLCBpbnBsYWNlPVRydWUpCgojIEltcHJpbWlyIGVsIG1vZGVsIHBlciB2ZXVyZSBlbHMgY2FudmlzCnByaW50KG1vZGVsKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch
import torchvision.models as models

# Carregar un model preentrenat
model = models.resnet18(pretrained=True)
model.train()

# Fusionar les capes
model.fuse_model()

# Preparar el model per a QAT
model.qconfig = torch.quantization.get_default_qat_qconfig('fbgemm')
torch.quantization.prepare_qat(model, inplace=True)

# Ajustar el model amb dades d'entrenament
# (Aqu&iacute;, utilitzem un bucle d'entrenament fictici per simplicitat)
optimizer = torch.optim.SGD(model.parameters(), lr=0.01)
for epoch in range(5):
    optimizer.zero_grad()
    output = model(input_tensor)
    loss = torch.nn.functional.cross_entropy(output, torch.tensor([0]))
    loss.backward()
    optimizer.step()

# Convertir el model a una versi&oacute; quantitzada
torch.quantization.convert(model, inplace=True)

# Imprimir el model per veure els canvis
print(model)</pre></div><div class='content'></div><h1>Poda</h1>
<div class='content'></div><h2>Què és la Poda?</h2>
<div class='content'><p>La poda implica eliminar pesos menys importants d'una xarxa neuronal per reduir la seva mida i complexitat. Això pot conduir a temps d'inferència més ràpids i a una menor utilització de memòria.</p>
</div><h2>Beneficis de la Poda</h2>
<div class='content'><ul>
<li><strong>Reducció de la Mida del Model</strong>: Menys pesos signifiquen un model més petit.</li>
<li><strong>Augment de la Velocitat d'Inferència</strong>: Es requereix menys computació.</li>
<li><strong>Potencial per a una Millor Generalització</strong>: Eliminar pesos redundants pot millorar la generalització del model.</li>
</ul>
</div><h2>Tipus de Poda</h2>
<div class='content'><ul>
<li><strong>Poda No Estructurada</strong>: Els pesos individuals es poden en funció de la seva magnitud.</li>
<li><strong>Poda Estructurada</strong>: Neurones, canals o capes completes es poden.</li>
</ul>
</div><h2>Implementació de la Poda No Estructurada en PyTorch</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCmltcG9ydCB0b3JjaC5ubi51dGlscy5wcnVuZSBhcyBwcnVuZQppbXBvcnQgdG9yY2h2aXNpb24ubW9kZWxzIGFzIG1vZGVscwoKIyBDYXJyZWdhciB1biBtb2RlbCBwcmVlbnRyZW5hdAptb2RlbCA9IG1vZGVscy5yZXNuZXQxOChwcmV0cmFpbmVkPVRydWUpCgojIEFwbGljYXIgcG9kYSBubyBlc3RydWN0dXJhZGEgYSBsYSBwcmltZXJhIGNhcGEKcHJ1bmUubDFfdW5zdHJ1Y3R1cmVkKG1vZGVsLmxheWVyMVswXS5jb252MSwgbmFtZT0nd2VpZ2h0JywgYW1vdW50PTAuMikKCiMgSW1wcmltaXIgZWwgbW9kZWwgcGVyIHZldXJlIGVscyBjYW52aXMKcHJpbnQobW9kZWwubGF5ZXIxWzBdLmNvbnYxLndlaWdodCk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch
import torch.nn.utils.prune as prune
import torchvision.models as models

# Carregar un model preentrenat
model = models.resnet18(pretrained=True)

# Aplicar poda no estructurada a la primera capa
prune.l1_unstructured(model.layer1[0].conv1, name='weight', amount=0.2)

# Imprimir el model per veure els canvis
print(model.layer1[0].conv1.weight)</pre></div><div class='content'></div><h2>Implementació de la Poda Estructurada en PyTorch</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCmltcG9ydCB0b3JjaC5ubi51dGlscy5wcnVuZSBhcyBwcnVuZQppbXBvcnQgdG9yY2h2aXNpb24ubW9kZWxzIGFzIG1vZGVscwoKIyBDYXJyZWdhciB1biBtb2RlbCBwcmVlbnRyZW5hdAptb2RlbCA9IG1vZGVscy5yZXNuZXQxOChwcmV0cmFpbmVkPVRydWUpCgojIEFwbGljYXIgcG9kYSBlc3RydWN0dXJhZGEgYSBsYSBwcmltZXJhIGNhcGEKcHJ1bmUubG5fc3RydWN0dXJlZChtb2RlbC5sYXllcjFbMF0uY29udjEsIG5hbWU9J3dlaWdodCcsIGFtb3VudD0wLjIsIG49MiwgZGltPTApCgojIEltcHJpbWlyIGVsIG1vZGVsIHBlciB2ZXVyZSBlbHMgY2FudmlzCnByaW50KG1vZGVsLmxheWVyMVswXS5jb252MS53ZWlnaHQp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch
import torch.nn.utils.prune as prune
import torchvision.models as models

# Carregar un model preentrenat
model = models.resnet18(pretrained=True)

# Aplicar poda estructurada a la primera capa
prune.ln_structured(model.layer1[0].conv1, name='weight', amount=0.2, n=2, dim=0)

# Imprimir el model per veure els canvis
print(model.layer1[0].conv1.weight)</pre></div><div class='content'></div><h1>Conclusió</h1>
<div class='content'><p>La quantització i la poda són tècniques poderoses per optimitzar models d'aprenentatge profund. La quantització redueix la precisió dels pesos i les activacions, cosa que condueix a models més petits i ràpids. La poda elimina pesos menys importants, reduint la mida i la complexitat del model. Ambdues tècniques es poden implementar en PyTorch amb relativa facilitat, permetent-te desplegar models eficients en entorns amb recursos limitats.</p>
<p>Comprenent i aplicant aquestes tècniques, pots millorar significativament el rendiment dels teus models d'aprenentatge profund, fent-los més adequats per a aplicacions del món real.</p>
</div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
