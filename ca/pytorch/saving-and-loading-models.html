<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desar i Carregar Models</title>

    <link rel="alternate" href="https://campusempresa.com/es/pytorch/saving-and-loading-models" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/pytorch/saving-and-loading-models" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/pytorch/saving-and-loading-models" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/ca/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="/es/pytorch/saving-and-loading-models" id="lnk_lang_es" data-lang="es" class="px-2">ES</a></b>
				|
				<b id="lit_lang_ca" class="px-2">CA</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/ca/objective">El Projecte</a>
				<a href="/ca/about">Sobre nosaltres</a>
				<a href="/ca/contribute">Contribuir</a>
				<a href="/ca/donate">Donacions</a>
				<a href="/ca/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='evaluating-model-performance'>&#x25C4;Avaluació del Rendiment del Model</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Desar i Carregar Models</a>
	</div>
	<div class='col-4 text-end'>
					<a href='convolutional-neural-networks-cnns'>Xarxes Neuronals Convolucionals (CNNs) &#x25BA;</a>
			</div>
</div>
<div class='content'><p>En aquesta secció, cobrim com desar i carregar models a PyTorch. Aquesta és una habilitat crucial per a qualsevol practicant d'aprenentatge automàtic, ja que permet persistir els teus models i reutilitzar-los més tard sense haver de reentrenar-los.</p>
</div><h1>Conceptes Clau</h1>
<div class='content'><ul>
<li><strong>Diccionari d'Estat</strong>: Un objecte diccionari de Python que mapatge cada capa al seu tensor de paràmetres.</li>
<li><strong>Desar un Model</strong>: Emmagatzemar el diccionari d'estat del model en un fitxer.</li>
<li><strong>Carregar un Model</strong>: Restaurar el diccionari d'estat del model des d'un fitxer.</li>
<li><strong>Checkpointing</strong>: Desar informació addicional com el número d'època, l'estat de l'optimitzador, etc.</li>
</ul>
</div><h1>Desar un Model</h1>
<div class='content'><p>Per desar un model a PyTorch, normalment deses el diccionari d'estat del model. Això es fa utilitzant la funció <code>torch.save</code>.</p>
</div><h2>Exemple: Desar un Model</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCmltcG9ydCB0b3JjaC5ubiBhcyBubgoKIyBEZWZpbmlyIHVuIG1vZGVsIHNpbXBsZQpjbGFzcyBTaW1wbGVNb2RlbChubi5Nb2R1bGUpOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHN1cGVyKFNpbXBsZU1vZGVsLCBzZWxmKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi5mYyA9IG5uLkxpbmVhcigxMCwgMSkKCiAgICBkZWYgZm9yd2FyZChzZWxmLCB4KToKICAgICAgICByZXR1cm4gc2VsZi5mYyh4KQoKIyBJbnN0YW5jaWFyIGVsIG1vZGVsCm1vZGVsID0gU2ltcGxlTW9kZWwoKQoKIyBEZXNhciBlbCBkaWNjaW9uYXJpIGQnZXN0YXQgZGVsIG1vZGVsCnRvcmNoLnNhdmUobW9kZWwuc3RhdGVfZGljdCgpLCAnbW9kZWwucHRoJyk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch
import torch.nn as nn

# Definir un model simple
class SimpleModel(nn.Module):
    def __init__(self):
        super(SimpleModel, self).__init__()
        self.fc = nn.Linear(10, 1)

    def forward(self, x):
        return self.fc(x)

# Instanciar el model
model = SimpleModel()

# Desar el diccionari d'estat del model
torch.save(model.state_dict(), 'model.pth')</pre></div><div class='content'><p>En aquest exemple:</p>
<ul>
<li>Definim una xarxa neuronal simple amb una capa lineal.</li>
<li>Instanciem el model.</li>
<li>Desem el diccionari d'estat del model en un fitxer anomenat <code>model.pth</code>.</li>
</ul>
</div><h1>Carregar un Model</h1>
<div class='content'><p>Per carregar un model, necessites crear una instància del model i després carregar-hi el diccionari d'estat utilitzant el mètode <code>load_state_dict</code>.</p>
</div><h2>Exemple: Carregar un Model</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCgojIERlZmluaXIgbGEgbWF0ZWl4YSBhcnF1aXRlY3R1cmEgZGVsIG1vZGVsCmNsYXNzIFNpbXBsZU1vZGVsKG5uLk1vZHVsZSk6CiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc3VwZXIoU2ltcGxlTW9kZWwsIHNlbGYpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLmZjID0gbm4uTGluZWFyKDEwLCAxKQoKICAgIGRlZiBmb3J3YXJkKHNlbGYsIHgpOgogICAgICAgIHJldHVybiBzZWxmLmZjKHgpCgojIEluc3RhbmNpYXIgZWwgbW9kZWwKbW9kZWwgPSBTaW1wbGVNb2RlbCgpCgojIENhcnJlZ2FyIGVsIGRpY2Npb25hcmkgZCdlc3RhdAptb2RlbC5sb2FkX3N0YXRlX2RpY3QodG9yY2gubG9hZCgnbW9kZWwucHRoJykpCgojIFBvc2FyIGVsIG1vZGVsIGVuIG1vZGUgZCdhdmFsdWFjacOzCm1vZGVsLmV2YWwoKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch

# Definir la mateixa arquitectura del model
class SimpleModel(nn.Module):
    def __init__(self):
        super(SimpleModel, self).__init__()
        self.fc = nn.Linear(10, 1)

    def forward(self, x):
        return self.fc(x)

# Instanciar el model
model = SimpleModel()

# Carregar el diccionari d'estat
model.load_state_dict(torch.load('model.pth'))

# Posar el model en mode d'avaluaci&oacute;
model.eval()</pre></div><div class='content'><p>En aquest exemple:</p>
<ul>
<li>Definim la mateixa arquitectura del model que abans.</li>
<li>Instanciem el model.</li>
<li>Carreguem el diccionari d'estat des del fitxer <code>model.pth</code>.</li>
<li>Posem el model en mode d'avaluació utilitzant <code>model.eval()</code>. Això és important ja que posa el model en mode d'inferència, afectant capes com dropout i normalització per lots.</li>
</ul>
</div><h1>Checkpointing</h1>
<div class='content'><p>El checkpointing implica desar no només el diccionari d'estat del model, sinó també altra informació com l'estat de l'optimitzador, el número d'època, etc. Això és útil per reprendre l'entrenament des d'un punt específic.</p>
</div><h2>Exemple: Desar un Checkpoint</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoLm9wdGltIGFzIG9wdGltCgojIERlZmluaXIgZWwgbW9kZWwgaSBsJ29wdGltaXR6YWRvcgptb2RlbCA9IFNpbXBsZU1vZGVsKCkKb3B0aW1pemVyID0gb3B0aW0uU0dEKG1vZGVsLnBhcmFtZXRlcnMoKSwgbHI9MC4wMSkKCiMgRGVzYXIgdW4gY2hlY2twb2ludApjaGVja3BvaW50ID0gewogICAgJ2Vwb2NoJzogMTAsCiAgICAnbW9kZWxfc3RhdGVfZGljdCc6IG1vZGVsLnN0YXRlX2RpY3QoKSwKICAgICdvcHRpbWl6ZXJfc3RhdGVfZGljdCc6IG9wdGltaXplci5zdGF0ZV9kaWN0KCksCiAgICAnbG9zcyc6IDAuNCwKfQp0b3JjaC5zYXZlKGNoZWNrcG9pbnQsICdjaGVja3BvaW50LnB0aCcp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch.optim as optim

# Definir el model i l'optimitzador
model = SimpleModel()
optimizer = optim.SGD(model.parameters(), lr=0.01)

# Desar un checkpoint
checkpoint = {
    'epoch': 10,
    'model_state_dict': model.state_dict(),
    'optimizer_state_dict': optimizer.state_dict(),
    'loss': 0.4,
}
torch.save(checkpoint, 'checkpoint.pth')</pre></div><div class='content'></div><h2>Exemple: Carregar un Checkpoint</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBJbnN0YW5jaWFyIGVsIG1vZGVsIGkgbCdvcHRpbWl0emFkb3IKbW9kZWwgPSBTaW1wbGVNb2RlbCgpCm9wdGltaXplciA9IG9wdGltLlNHRChtb2RlbC5wYXJhbWV0ZXJzKCksIGxyPTAuMDEpCgojIENhcnJlZ2FyIGVsIGNoZWNrcG9pbnQKY2hlY2twb2ludCA9IHRvcmNoLmxvYWQoJ2NoZWNrcG9pbnQucHRoJykKbW9kZWwubG9hZF9zdGF0ZV9kaWN0KGNoZWNrcG9pbnRbJ21vZGVsX3N0YXRlX2RpY3QnXSkKb3B0aW1pemVyLmxvYWRfc3RhdGVfZGljdChjaGVja3BvaW50WydvcHRpbWl6ZXJfc3RhdGVfZGljdCddKQplcG9jaCA9IGNoZWNrcG9pbnRbJ2Vwb2NoJ10KbG9zcyA9IGNoZWNrcG9pbnRbJ2xvc3MnXQoKIyBQb3NhciBlbCBtb2RlbCBlbiBtb2RlIGQnYXZhbHVhY2nDswptb2RlbC5ldmFsKCk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Instanciar el model i l'optimitzador
model = SimpleModel()
optimizer = optim.SGD(model.parameters(), lr=0.01)

# Carregar el checkpoint
checkpoint = torch.load('checkpoint.pth')
model.load_state_dict(checkpoint['model_state_dict'])
optimizer.load_state_dict(checkpoint['optimizer_state_dict'])
epoch = checkpoint['epoch']
loss = checkpoint['loss']

# Posar el model en mode d'avaluaci&oacute;
model.eval()</pre></div><div class='content'><p>En aquests exemples:</p>
<ul>
<li>Desem un checkpoint que inclou el número d'època, el diccionari d'estat del model, el diccionari d'estat de l'optimitzador i la pèrdua.</li>
<li>Carreguem el checkpoint i restablim els estats del model i de l'optimitzador, així com el número d'època i la pèrdua.</li>
</ul>
</div><h1>Resum</h1>
<div class='content'><ul>
<li><strong>Diccionari d'Estat</strong>: El component clau per desar i carregar models.</li>
<li><strong>Desar un Model</strong>: Utilitza <code>torch.save(model.state_dict(), 'file.pth')</code>.</li>
<li><strong>Carregar un Model</strong>: Utilitza <code>model.load_state_dict(torch.load('file.pth'))</code> i posa el model en mode d'avaluació amb <code>model.eval()</code>.</li>
<li><strong>Checkpointing</strong>: Desa informació addicional com el número d'època i l'estat de l'optimitzador per reprendre l'entrenament més tard.</li>
</ul>
<p>En dominar aquestes tècniques, pots gestionar eficientment els teus models i processos d'entrenament, assegurant-te que pots desar la teva feina i reprendre-la just on la vas deixar.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='evaluating-model-performance'>&#x25C4;Avaluació del Rendiment del Model</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Desar i Carregar Models</a>
	</div>
	<div class='col-4 text-end'>
					<a href='convolutional-neural-networks-cnns'>Xarxes Neuronals Convolucionals (CNNs) &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/ca/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
