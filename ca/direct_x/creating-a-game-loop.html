<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creant un Bucle de Joc</title>

    <link rel="alternate" href="https://campusempresa.com/es/direct_x/creating-a-game-loop" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/direct_x/creating-a-game-loop" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/direct_x/creating-a-game-loop" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/ca/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="/es/direct_x/creating-a-game-loop" id="lnk_lang_es" data-lang="es" class="px-2">ES</a></b>
				|
				<b id="lit_lang_ca" class="px-2">CA</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/ca/objective">El Projecte</a>
				<a href="/ca/about">Sobre nosaltres</a>
				<a href="/ca/contribute">Contribuir</a>
				<a href="/ca/donate">Donacions</a>
				<a href="/ca/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='introduction-to-game-development-with-directx'>&#x25C4;Introducció al Desenvolupament de Jocs amb DirectX</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Creant un Bucle de Joc</a>
	</div>
	<div class='col-4 text-end'>
					<a href='handling-input'>Gestió d'Entrada &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introducció</h1>
<div class='content'><p>Un bucle de joc és el nucli de qualsevol motor de joc. Actualitza contínuament l'estat del joc i renderitza el món del joc. En aquesta secció, cobrirem com crear un bucle de joc utilitzant DirectX, començant pels conceptes bàsics i avançant cap a conceptes més avançats.</p>
</div><h1>Conceptes Clau</h1>
<div class='content'><ul>
<li><strong>Bucle de Joc</strong>: Un cicle que gestiona les actualitzacions del joc i el renderitzat.</li>
<li><strong>Taxa de Fotogrames</strong>: La freqüència amb què s'executa el bucle de joc, normalment mesurada en fotogrames per segon (FPS).</li>
<li><strong>Temps Delta</strong>: La diferència de temps entre el fotograma actual i el fotograma anterior, utilitzada per assegurar moviments i animacions suaus.</li>
</ul>
</div><h1>Estructura Bàsica del Bucle de Joc</h1>
<div class='content'><p>Un bucle de joc bàsic consta de tres parts principals:</p>
<ol>
<li><strong>Inicialització</strong>: Configuració de l'entorn del joc.</li>
<li><strong>Actualització</strong>: Actualització de l'estat del joc.</li>
<li><strong>Renderitzat</strong>: Dibuix del món del joc.</li>
</ol>
</div><h2>Inicialització</h2>
<div class='content'><p>Abans d'entrar al bucle de joc, cal inicialitzar DirectX i configurar els recursos necessaris.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gSW5pY2lhbGl0emFyIERpcmVjdFgKYm9vbCBJbml0aWFsaXplRGlyZWN0WChIV05EIGh3bmQpIHsKICAgIC8vIENyZWFyIGVsIGRpc3Bvc2l0aXUgaSBlbCBjb250ZXh0IGRlbCBkaXNwb3NpdGl1CiAgICBIUkVTVUxUIGhyID0gRDNEMTFDcmVhdGVEZXZpY2UoCiAgICAgICAgbnVsbHB0ciwgICAgICAgICAgICAgICAgICAgIC8vIEFkYXB0YWRvciBwZXIgZGVmZWN0ZQogICAgICAgIEQzRF9EUklWRVJfVFlQRV9IQVJEV0FSRSwgICAvLyBDb250cm9sYWRvciBkZSBtYXF1aW5hcmkKICAgICAgICBudWxscHRyLCAgICAgICAgICAgICAgICAgICAgLy8gQ2FwIGRpc3Bvc2l0aXUgZGUgcHJvZ3JhbWFyaQogICAgICAgIDAsICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGbGFncwogICAgICAgIG51bGxwdHIsIDAsICAgICAgICAgICAgICAgICAvLyBOaXZlbGxzIGRlIGNhcmFjdGVyw61zdGlxdWVzCiAgICAgICAgRDNEMTFfU0RLX1ZFUlNJT04sICAgICAgICAgIC8vIFZlcnNpw7MgZGVsIFNESwogICAgICAgICZkZXZpY2UsICAgICAgICAgICAgICAgICAgICAvLyBEaXNwb3NpdGl1CiAgICAgICAgbnVsbHB0ciwgICAgICAgICAgICAgICAgICAgIC8vIE5pdmVsbCBkZSBjYXJhY3RlcsOtc3RpcXVlcwogICAgICAgICZkZXZpY2VDb250ZXh0ICAgICAgICAgICAgICAvLyBDb250ZXh0IGRlbCBkaXNwb3NpdGl1CiAgICApOwoKICAgIGlmIChGQUlMRUQoaHIpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIENvZGkgZGUgY29uZmlndXJhY2nDsyBhZGRpY2lvbmFsLi4uCgogICAgcmV0dXJuIHRydWU7Cn0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Inicialitzar DirectX
bool InitializeDirectX(HWND hwnd) {
    // Crear el dispositiu i el context del dispositiu
    HRESULT hr = D3D11CreateDevice(
        nullptr,                    // Adaptador per defecte
        D3D_DRIVER_TYPE_HARDWARE,   // Controlador de maquinari
        nullptr,                    // Cap dispositiu de programari
        0,                          // Flags
        nullptr, 0,                 // Nivells de caracter&iacute;stiques
        D3D11_SDK_VERSION,          // Versi&oacute; del SDK
        &amp;device,                    // Dispositiu
        nullptr,                    // Nivell de caracter&iacute;stiques
        &amp;deviceContext              // Context del dispositiu
    );

    if (FAILED(hr)) {
        return false;
    }

    // Codi de configuraci&oacute; addicional...

    return true;
}</pre></div><div class='content'></div><h2>Actualització</h2>
<div class='content'><p>La funció d'actualització gestiona tota la lògica del joc, com moure personatges, comprovar col·lisions i actualitzar l'estat del joc.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dm9pZCBVcGRhdGUoZmxvYXQgZGVsdGFUaW1lKSB7CiAgICAvLyBFeGVtcGxlOiBNb3VyZSB1biBwZXJzb25hdGdlCiAgICBjaGFyYWN0ZXJQb3NpdGlvbi54ICs9IGNoYXJhY3RlclNwZWVkICogZGVsdGFUaW1lOwp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>void Update(float deltaTime) {
    // Exemple: Moure un personatge
    characterPosition.x += characterSpeed * deltaTime;
}</pre></div><div class='content'></div><h2>Renderitzat</h2>
<div class='content'><p>La funció de renderitzat dibuixa el món del joc a la pantalla.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dm9pZCBSZW5kZXIoKSB7CiAgICAvLyBOZXRlamFyIGVsIGJ1ZmZlciBkZSBmb25zCiAgICBmbG9hdCBjbGVhckNvbG9yW10gPSB7IDAuMGYsIDAuMmYsIDAuNGYsIDEuMGYgfTsKICAgIGRldmljZUNvbnRleHQtPkNsZWFyUmVuZGVyVGFyZ2V0VmlldyhyZW5kZXJUYXJnZXRWaWV3LCBjbGVhckNvbG9yKTsKCiAgICAvLyBEaWJ1aXhhciBvYmplY3RlcyBkZWwgam9jCiAgICAvLyBFeGVtcGxlOiBEaWJ1aXhhciB1biBwZXJzb25hdGdlCiAgICBEcmF3Q2hhcmFjdGVyKGNoYXJhY3RlclBvc2l0aW9uKTsKCiAgICAvLyBQcmVzZW50YXIgZWwgYnVmZmVyIGRlIGZvbnMgYSBsYSBwYW50YWxsYQogICAgc3dhcENoYWluLT5QcmVzZW50KDEsIDApOwp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>void Render() {
    // Netejar el buffer de fons
    float clearColor[] = { 0.0f, 0.2f, 0.4f, 1.0f };
    deviceContext-&gt;ClearRenderTargetView(renderTargetView, clearColor);

    // Dibuixar objectes del joc
    // Exemple: Dibuixar un personatge
    DrawCharacter(characterPosition);

    // Presentar el buffer de fons a la pantalla
    swapChain-&gt;Present(1, 0);
}</pre></div><div class='content'></div><h1>Implementació del Bucle de Joc</h1>
<div class='content'><p>Ara que tenim els components bàsics, posem-los junts en un bucle de joc.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dm9pZCBHYW1lTG9vcCgpIHsKICAgIE1TRyBtc2cgPSB7IDAgfTsKICAgIHdoaWxlIChtc2cubWVzc2FnZSAhPSBXTV9RVUlUKSB7CiAgICAgICAgaWYgKFBlZWtNZXNzYWdlKCZtc2csIG51bGxwdHIsIDAsIDAsIFBNX1JFTU9WRSkpIHsKICAgICAgICAgICAgVHJhbnNsYXRlTWVzc2FnZSgmbXNnKTsKICAgICAgICAgICAgRGlzcGF0Y2hNZXNzYWdlKCZtc2cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIENhbGN1bGFyIGVsIHRlbXBzIGRlbHRhCiAgICAgICAgICAgIHN0YXRpYyBEV09SRCBwcmV2VGltZSA9IHRpbWVHZXRUaW1lKCk7CiAgICAgICAgICAgIERXT1JEIGN1cnJUaW1lID0gdGltZUdldFRpbWUoKTsKICAgICAgICAgICAgZmxvYXQgZGVsdGFUaW1lID0gKGN1cnJUaW1lIC0gcHJldlRpbWUpIC8gMTAwMC4wZjsKICAgICAgICAgICAgcHJldlRpbWUgPSBjdXJyVGltZTsKCiAgICAgICAgICAgIC8vIEFjdHVhbGl0emFyIGkgcmVuZGVyaXR6YXIKICAgICAgICAgICAgVXBkYXRlKGRlbHRhVGltZSk7CiAgICAgICAgICAgIFJlbmRlcigpOwogICAgICAgIH0KICAgIH0KfQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>void GameLoop() {
    MSG msg = { 0 };
    while (msg.message != WM_QUIT) {
        if (PeekMessage(&amp;msg, nullptr, 0, 0, PM_REMOVE)) {
            TranslateMessage(&amp;msg);
            DispatchMessage(&amp;msg);
        } else {
            // Calcular el temps delta
            static DWORD prevTime = timeGetTime();
            DWORD currTime = timeGetTime();
            float deltaTime = (currTime - prevTime) / 1000.0f;
            prevTime = currTime;

            // Actualitzar i renderitzar
            Update(deltaTime);
            Render();
        }
    }
}</pre></div><div class='content'></div><h1>Temes Avançats</h1>
<h2>Control de la Taxa de Fotogrames</h2>
<div class='content'><p>Per assegurar una taxa de fotogrames consistent, es pot implementar el control de la taxa de fotogrames.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgaW50IFRBUkdFVF9GUFMgPSA2MDsKY29uc3QgZmxvYXQgVEFSR0VUX0ZSQU1FX1RJTUUgPSAxLjBmIC8gVEFSR0VUX0ZQUzsKCnZvaWQgR2FtZUxvb3AoKSB7CiAgICBNU0cgbXNnID0geyAwIH07CiAgICB3aGlsZSAobXNnLm1lc3NhZ2UgIT0gV01fUVVJVCkgewogICAgICAgIGlmIChQZWVrTWVzc2FnZSgmbXNnLCBudWxscHRyLCAwLCAwLCBQTV9SRU1PVkUpKSB7CiAgICAgICAgICAgIFRyYW5zbGF0ZU1lc3NhZ2UoJm1zZyk7CiAgICAgICAgICAgIERpc3BhdGNoTWVzc2FnZSgmbXNnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBDYWxjdWxhciBlbCB0ZW1wcyBkZWx0YQogICAgICAgICAgICBzdGF0aWMgRFdPUkQgcHJldlRpbWUgPSB0aW1lR2V0VGltZSgpOwogICAgICAgICAgICBEV09SRCBjdXJyVGltZSA9IHRpbWVHZXRUaW1lKCk7CiAgICAgICAgICAgIGZsb2F0IGRlbHRhVGltZSA9IChjdXJyVGltZSAtIHByZXZUaW1lKSAvIDEwMDAuMGY7CgogICAgICAgICAgICBpZiAoZGVsdGFUaW1lID49IFRBUkdFVF9GUkFNRV9USU1FKSB7CiAgICAgICAgICAgICAgICBwcmV2VGltZSA9IGN1cnJUaW1lOwoKICAgICAgICAgICAgICAgIC8vIEFjdHVhbGl0emFyIGkgcmVuZGVyaXR6YXIKICAgICAgICAgICAgICAgIFVwZGF0ZShkZWx0YVRpbWUpOwogICAgICAgICAgICAgICAgUmVuZGVyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const int TARGET_FPS = 60;
const float TARGET_FRAME_TIME = 1.0f / TARGET_FPS;

void GameLoop() {
    MSG msg = { 0 };
    while (msg.message != WM_QUIT) {
        if (PeekMessage(&amp;msg, nullptr, 0, 0, PM_REMOVE)) {
            TranslateMessage(&amp;msg);
            DispatchMessage(&amp;msg);
        } else {
            // Calcular el temps delta
            static DWORD prevTime = timeGetTime();
            DWORD currTime = timeGetTime();
            float deltaTime = (currTime - prevTime) / 1000.0f;

            if (deltaTime &gt;= TARGET_FRAME_TIME) {
                prevTime = currTime;

                // Actualitzar i renderitzar
                Update(deltaTime);
                Render();
            }
        }
    }
}</pre></div><div class='content'></div><h2>Gestió de Taxes de Fotogrames Variables</h2>
<div class='content'><p>Per gestionar taxes de fotogrames variables, es pot utilitzar un pas de temps fix per a les actualitzacions i interpolar el renderitzat.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgZmxvYXQgRklYRURfVElNRV9TVEVQID0gMC4wMTZmOyAvLyA2MCBGUFMKCnZvaWQgR2FtZUxvb3AoKSB7CiAgICBNU0cgbXNnID0geyAwIH07CiAgICBmbG9hdCBhY2N1bXVsYXRvciA9IDAuMGY7CgogICAgd2hpbGUgKG1zZy5tZXNzYWdlICE9IFdNX1FVSVQpIHsKICAgICAgICBpZiAoUGVla01lc3NhZ2UoJm1zZywgbnVsbHB0ciwgMCwgMCwgUE1fUkVNT1ZFKSkgewogICAgICAgICAgICBUcmFuc2xhdGVNZXNzYWdlKCZtc2cpOwogICAgICAgICAgICBEaXNwYXRjaE1lc3NhZ2UoJm1zZyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gQ2FsY3VsYXIgZWwgdGVtcHMgZGVsdGEKICAgICAgICAgICAgc3RhdGljIERXT1JEIHByZXZUaW1lID0gdGltZUdldFRpbWUoKTsKICAgICAgICAgICAgRFdPUkQgY3VyclRpbWUgPSB0aW1lR2V0VGltZSgpOwogICAgICAgICAgICBmbG9hdCBkZWx0YVRpbWUgPSAoY3VyclRpbWUgLSBwcmV2VGltZSkgLyAxMDAwLjBmOwogICAgICAgICAgICBwcmV2VGltZSA9IGN1cnJUaW1lOwoKICAgICAgICAgICAgYWNjdW11bGF0b3IgKz0gZGVsdGFUaW1lOwoKICAgICAgICAgICAgd2hpbGUgKGFjY3VtdWxhdG9yID49IEZJWEVEX1RJTUVfU1RFUCkgewogICAgICAgICAgICAgICAgVXBkYXRlKEZJWEVEX1RJTUVfU1RFUCk7CiAgICAgICAgICAgICAgICBhY2N1bXVsYXRvciAtPSBGSVhFRF9USU1FX1NURVA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFJlbmRlcigpOwogICAgICAgIH0KICAgIH0KfQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const float FIXED_TIME_STEP = 0.016f; // 60 FPS

void GameLoop() {
    MSG msg = { 0 };
    float accumulator = 0.0f;

    while (msg.message != WM_QUIT) {
        if (PeekMessage(&amp;msg, nullptr, 0, 0, PM_REMOVE)) {
            TranslateMessage(&amp;msg);
            DispatchMessage(&amp;msg);
        } else {
            // Calcular el temps delta
            static DWORD prevTime = timeGetTime();
            DWORD currTime = timeGetTime();
            float deltaTime = (currTime - prevTime) / 1000.0f;
            prevTime = currTime;

            accumulator += deltaTime;

            while (accumulator &gt;= FIXED_TIME_STEP) {
                Update(FIXED_TIME_STEP);
                accumulator -= FIXED_TIME_STEP;
            }

            Render();
        }
    }
}</pre></div><div class='content'></div><h1>Conclusió</h1>
<div class='content'><p>Crear un bucle de joc és fonamental per al desenvolupament de jocs. Entenent i implementant un bucle de joc, pots controlar el flux del teu joc, assegurant actualitzacions i renderitzats fluids. A mesura que avancis, podràs incorporar tècniques més sofisticades com el control de la taxa de fotogrames i la gestió de taxes de fotogrames variables per millorar el rendiment i l'experiència de l'usuari del teu joc.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='introduction-to-game-development-with-directx'>&#x25C4;Introducció al Desenvolupament de Jocs amb DirectX</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Creant un Bucle de Joc</a>
	</div>
	<div class='col-4 text-end'>
					<a href='handling-input'>Gestió d'Entrada &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/ca/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
