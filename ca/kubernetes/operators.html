<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operadors a Kubernetes</title>

    <link rel="alternate" href="https://campusempresa.com/es/kubernetes/operators" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/kubernetes/operators" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/kubernetes/operators" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/ca/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="/es/kubernetes/operators" id="lnk_lang_es" data-lang="es" class="px-2">ES</a></b>
				|
				<b id="lit_lang_ca" class="px-2">CA</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/ca/objective">El Projecte</a>
				<a href="/ca/about">Sobre nosaltres</a>
				<a href="/ca/contribute">Contribuir</a>
				<a href="/ca/donate">Donacions</a>
				<a href="/ca/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'><div class='col-6'><a href='custom-resource-definitions'>&#x25C4; Definicions de Recursos Personalitzats (CRDs)</a></div><div class='col-6 text-end'><a href='helm-and-package-management'>Helm i Gestió de Paquets &#x25BA;</a></div></div><div class='content'></div><h1>Introducció als Operadors</h1>
<div class='content'><p>Els operadors són un concepte poderós a Kubernetes que amplien les capacitats de l'API de Kubernetes per gestionar aplicacions complexes i els seus components. Són essencialment controladors personalitzats que utilitzen recursos personalitzats per gestionar aplicacions i els seus components.</p>
<ul>
<li><strong>Definició</strong>: Els operadors són extensions de programari per a Kubernetes que fan ús de recursos personalitzats per gestionar aplicacions i els seus components.</li>
<li><strong>Propòsit</strong>: Automatitzar la gestió d'aplicacions complexes i amb estat.</li>
<li><strong>Components</strong>:
<ul>
<li><strong>Definicions de Recursos Personalitzats (CRDs)</strong>: Defineixen l'esquema per al recurs personalitzat.</li>
<li><strong>Controlador</strong>: Observa els recursos personalitzats i pren accions per reconciliar l'estat actual amb l'estat desitjat.</li>
</ul>
</li>
</ul>
</div><h1>Conceptes Clau</h1>
<div class='content'><ul>
<li><strong>Definicions de Recursos Personalitzats (CRDs)</strong>: Amplien l'API de Kubernetes per incloure objectes personalitzats.</li>
<li><strong>Controlador</strong>: Un bucle que observa l'estat del teu clúster i fa canvis per moure l'estat actual cap a l'estat desitjat.</li>
<li><strong>Bucle de Reconciliació</strong>: El procés pel qual el controlador assegura que l'estat real coincideixi amb l'estat desitjat.</li>
</ul>
</div><h1>Creació d'un Operador Simple</h1>
<h2>Pas 1: Definir un Recurs Personalitzat</h2>
<div class='content'><p>Un Recurs Personalitzat (CR) és una extensió de l'API de Kubernetes que et permet emmagatzemar i recuperar dades estructurades.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBteWFwcC1jcmQueWFtbAphcGlWZXJzaW9uOiBhcGlleHRlbnNpb25zLms4cy5pby92MQpraW5kOiBDdXN0b21SZXNvdXJjZURlZmluaXRpb24KbWV0YWRhdGE6CiAgbmFtZTogbXlhcHBzLmV4YW1wbGUuY29tCnNwZWM6CiAgZ3JvdXA6IGV4YW1wbGUuY29tCiAgdmVyc2lvbnM6CiAgICAtIG5hbWU6IHYxCiAgICAgIHNlcnZlZDogdHJ1ZQogICAgICBzdG9yYWdlOiB0cnVlCiAgc2NvcGU6IE5hbWVzcGFjZWQKICBuYW1lczoKICAgIHBsdXJhbDogbXlhcHBzCiAgICBzaW5ndWxhcjogbXlhcHAKICAgIGtpbmQ6IE15QXBwCiAgICBzaG9ydE5hbWVzOgogICAgLSBtYQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># myapp-crd.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: myapps.example.com
spec:
  group: example.com
  versions:
    - name: v1
      served: true
      storage: true
  scope: Namespaced
  names:
    plural: myapps
    singular: myapp
    kind: MyApp
    shortNames:
    - ma</pre></div><div class='content'></div><h2>Pas 2: Crear el Recurs Personalitzat</h2>
<div class='content'><p>Un cop definida la CRD, pots crear instàncies del recurs personalitzat.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBteWFwcC1pbnN0YW5jZS55YW1sCmFwaVZlcnNpb246IGV4YW1wbGUuY29tL3YxCmtpbmQ6IE15QXBwCm1ldGFkYXRhOgogIG5hbWU6IG15YXBwLXNhbXBsZQpzcGVjOgogIHNpemU6IDM="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># myapp-instance.yaml
apiVersion: example.com/v1
kind: MyApp
metadata:
  name: myapp-sample
spec:
  size: 3</pre></div><div class='content'></div><h2>Pas 3: Implementar el Controlador</h2>
<div class='content'><p>El controlador observa els recursos personalitzats i assegura que l'estat desitjat es mantingui.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBteWFwcC1jb250cm9sbGVyLnB5CmZyb20ga3ViZXJuZXRlcyBpbXBvcnQgY2xpZW50LCBjb25maWcsIHdhdGNoCgpkZWYgbWFpbigpOgogICAgY29uZmlnLmxvYWRfa3ViZV9jb25maWcoKQogICAgdjEgPSBjbGllbnQuQ3VzdG9tT2JqZWN0c0FwaSgpCiAgICB3ID0gd2F0Y2guV2F0Y2goKQoKICAgIGZvciBldmVudCBpbiB3LnN0cmVhbSh2MS5saXN0X25hbWVzcGFjZWRfY3VzdG9tX29iamVjdCwgZ3JvdXA9ImV4YW1wbGUuY29tIiwgdmVyc2lvbj0idjEiLCBuYW1lc3BhY2U9ImRlZmF1bHQiLCBwbHVyYWw9Im15YXBwcyIpOgogICAgICAgIHByaW50KCJFdmVudDogJXMgJXMiICUgKGV2ZW50Wyd0eXBlJ10sIGV2ZW50WydvYmplY3QnXVsnbWV0YWRhdGEnXVsnbmFtZSddKSkKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICBtYWluKCk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># myapp-controller.py
from kubernetes import client, config, watch

def main():
    config.load_kube_config()
    v1 = client.CustomObjectsApi()
    w = watch.Watch()

    for event in w.stream(v1.list_namespaced_custom_object, group=&quot;example.com&quot;, version=&quot;v1&quot;, namespace=&quot;default&quot;, plural=&quot;myapps&quot;):
        print(&quot;Event: %s %s&quot; % (event['type'], event['object']['metadata']['name']))

if __name__ == '__main__':
    main()</pre></div><div class='content'></div><h1>Patrons Avançats d'Operadors</h1>
<div class='content'><ul>
<li><strong>Aplicacions amb Estat</strong>: Els operadors poden gestionar aplicacions amb estat com bases de dades, assegurant la consistència i disponibilitat de les dades.</li>
<li><strong>Còpia de Seguretat i Restauració</strong>: Els operadors poden automatitzar els processos de còpia de seguretat i restauració per a aplicacions.</li>
<li><strong>Escalat</strong>: Els operadors poden gestionar l'escalat d'aplicacions basat en mètriques personalitzades.</li>
</ul>
</div><h1>Frameworks d'Operadors</h1>
<div class='content'><p>Diversos frameworks poden ajudar-te a construir operadors de manera més eficient:</p>
<ul>
<li><strong>Operator SDK</strong>: Un framework que proporciona eines per construir, provar i empaquetar operadors.</li>
<li><strong>Kubebuilder</strong>: Un framework per construir APIs de Kubernetes utilitzant CRDs.</li>
</ul>
</div><h1>Exemple: Utilitzant Operator SDK</h1>
<h2>Pas 1: Instal·lar Operator SDK</h2>
<div class='content'><p>Segueix les instruccions d'instal·lació de la <a href="https://sdk.operatorframework.io/docs/installation/">documentació de l'Operator SDK</a>.</p>
</div><h2>Pas 2: Crear un Nou Projecte d'Operador</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("b3BlcmF0b3Itc2RrIGluaXQgLS1kb21haW4gZXhhbXBsZS5jb20gLS1yZXBvIGdpdGh1Yi5jb20vZXhhbXBsZS9teWFwcC1vcGVyYXRvcg=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>operator-sdk init --domain example.com --repo github.com/example/myapp-operator</pre></div><div class='content'></div><h2>Pas 3: Definir l'API</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("b3BlcmF0b3Itc2RrIGNyZWF0ZSBhcGkgLS1ncm91cCBleGFtcGxlIC0tdmVyc2lvbiB2MSAtLWtpbmQgTXlBcHAgLS1yZXNvdXJjZSAtLWNvbnRyb2xsZXI="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>operator-sdk create api --group example --version v1 --kind MyApp --resource --controller</pre></div><div class='content'></div><h2>Pas 4: Implementar la Lògica de Reconciliació</h2>
<div class='content'><p>Edita el fitxer de controlador generat per implementar la teva lògica de reconciliació.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gY29udHJvbGxlcnMvbXlhcHBfY29udHJvbGxlci5nbwpmdW5jIChyICpNeUFwcFJlY29uY2lsZXIpIFJlY29uY2lsZShjdHggY29udGV4dC5Db250ZXh0LCByZXEgY3RybC5SZXF1ZXN0KSAoY3RybC5SZXN1bHQsIGVycm9yKSB7CiAgICAvLyBGZXRjaCB0aGUgTXlBcHAgaW5zdGFuY2UKICAgIG15YXBwIDo9ICZleGFtcGxldjEuTXlBcHB7fQogICAgZXJyIDo9IHIuR2V0KGN0eCwgcmVxLk5hbWVzcGFjZWROYW1lLCBteWFwcCkKICAgIGlmIGVyciAhPSBuaWwgewogICAgICAgIHJldHVybiBjdHJsLlJlc3VsdHt9LCBjbGllbnQuSWdub3JlTm90Rm91bmQoZXJyKQogICAgfQoKICAgIC8vIEltcGxlbWVudCB5b3VyIHJlY29uY2lsaWF0aW9uIGxvZ2ljIGhlcmUKCiAgICByZXR1cm4gY3RybC5SZXN1bHR7fSwgbmlsCn0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// controllers/myapp_controller.go
func (r *MyAppReconciler) Reconcile(ctx context.Context, req ctrl.Request) (ctrl.Result, error) {
    // Fetch the MyApp instance
    myapp := &amp;examplev1.MyApp{}
    err := r.Get(ctx, req.NamespacedName, myapp)
    if err != nil {
        return ctrl.Result{}, client.IgnoreNotFound(err)
    }

    // Implement your reconciliation logic here

    return ctrl.Result{}, nil
}</pre></div><div class='content'></div><h1>Conclusió</h1>
<div class='content'><p>Els operadors són una manera poderosa d'ampliar les capacitats de Kubernetes per gestionar aplicacions complexes. Definint recursos personalitzats i implementant controladors, pots automatitzar la gestió d'aplicacions amb estat, còpies de seguretat, escalat i més. Utilitzar frameworks com Operator SDK i Kubebuilder pot simplificar el procés de desenvolupament, permetent-te centrar en la lògica de negoci del teu operador.</p>
</div><div class='row navigation'><div class='col-6'><a href='custom-resource-definitions'>&#x25C4; Definicions de Recursos Personalitzats (CRDs)</a></div><div class='col-6 text-end'><a href='helm-and-package-management'>Helm i Gestió de Paquets &#x25BA;</a></div></div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/ca/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
