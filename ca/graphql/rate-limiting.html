<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui<br> i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="https://campusempresa.com/graphql/rate-limiting" id="lnk_lang_es" data-lang="es">Castellano</a></b>
				|
				<b id="lit_lang_ca">Catala</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="objective">El Projecte</a>
				<a href="about">Sobre nosaltres</a>
				<a href="contribute">Contribuir</a>
				<a href="donate">Donacions</a>
				<a href="licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='content'><p>La limitació de rati és un concepte crucial en el disseny i implementació d'APIs, assegurant que els recursos s'utilitzen de manera eficient i prevenint abusos. En aquesta secció, explorarem com implementar la limitació de rati en una API GraphQL, des de conceptes bàsics fins a tècniques avançades.</p>
</div><h1>Què és la Limitació de Rati?</h1>
<div class='content'><p>La limitació de rati és una tècnica utilitzada per controlar la quantitat de sol·licituds entrants a un servidor dins d'un període de temps especificat. Ajuda a:</p>
<ul>
<li>Prevenir abusos i l'ús excessiu de recursos.</li>
<li>Assegurar un ús just entre tots els clients.</li>
<li>Protegir el servidor de ser aclaparat per massa sol·licituds.</li>
</ul>
</div><h1>Per què és Important la Limitació de Rati en GraphQL</h1>
<div class='content'><p>Les APIs GraphQL poden ser particularment vulnerables a abusos perquè:</p>
<ul>
<li>Els clients poden sol·licitar una gran quantitat de dades en una sola consulta.</li>
<li>Es poden construir consultes complexes que són computacionalment costoses.</li>
</ul>
<p>Implementar la limitació de rati ajuda a mitigar aquests riscos i assegura l'estabilitat i el rendiment de la teva API GraphQL.</p>
</div><h1>Conceptes Bàsics de la Limitació de Rati</h1>
<div class='content'><p>Abans d'entrar en la implementació, entenguem alguns conceptes bàsics:</p>
<ul>
<li><strong>Compte de Sol·licituds</strong>: El nombre de sol·licituds que un client pot fer dins d'una finestra de temps.</li>
<li><strong>Finestra de Temps</strong>: La durada en què es mesura el compte de sol·licituds (per exemple, per minut, per hora).</li>
<li><strong>Identificació del Client</strong>: Identificar els clients típicament utilitzant claus d'API, adreces IP o tokens d'usuari.</li>
</ul>
</div><h1>Implementant la Limitació de Rati en GraphQL</h1>
<div class='content'></div><h2>Utilitzant Middleware</h2>
<div class='content'><p>Un enfocament comú per implementar la limitació de rati en GraphQL és utilitzant middleware. El middleware pot interceptar sol·licituds i aplicar la lògica de limitació de rati abans de passar la sol·licitud al resolutor de GraphQL.</p>
<h4>Exemple amb Express i Apollo Server</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTsKY29uc3QgeyBBcG9sbG9TZXJ2ZXIsIGdxbCB9ID0gcmVxdWlyZSgnYXBvbGxvLXNlcnZlci1leHByZXNzJyk7CmNvbnN0IHJhdGVMaW1pdCA9IHJlcXVpcmUoJ2V4cHJlc3MtcmF0ZS1saW1pdCcpOwoKLy8gRGVmaW5laXggZWwgdGV1IGVzcXVlbWEgR3JhcGhRTApjb25zdCB0eXBlRGVmcyA9IGdxbGAKICB0eXBlIFF1ZXJ5IHsKICAgIGhlbGxvOiBTdHJpbmcKICB9CmA7CgovLyBEZWZpbmVpeCBlbHMgdGV1cyByZXNvbHV0b3JzCmNvbnN0IHJlc29sdmVycyA9IHsKICBRdWVyeTogewogICAgaGVsbG86ICgpID0+ICdIZWxsbyB3b3JsZCEnLAogIH0sCn07CgovLyBDcmVhIHVuYSBpbnN0w6BuY2lhIGQnQXBvbGxvU2VydmVyCmNvbnN0IHNlcnZlciA9IG5ldyBBcG9sbG9TZXJ2ZXIoeyB0eXBlRGVmcywgcmVzb2x2ZXJzIH0pOwoKLy8gQ3JlYSB1bmEgaW5zdMOgbmNpYSBkJ0V4cHJlc3MKY29uc3QgYXBwID0gZXhwcmVzcygpOwoKLy8gRGVmaW5laXggZWwgbWlkZGxld2FyZSBkZSBsaW1pdGFjacOzIGRlIHJhdGkKY29uc3QgbGltaXRlciA9IHJhdGVMaW1pdCh7CiAgd2luZG93TXM6IDEgKiA2MCAqIDEwMDAsIC8vIDEgbWludXQKICBtYXg6IDEwLCAvLyBsaW1pdGEgY2FkYSBJUCBhIDEwIHNvbMK3bGljaXR1ZHMgcGVyIHdpbmRvd01zCiAgbWVzc2FnZTogJ01hc3NhIHNvbMK3bGljaXR1ZHMsIHNpIHVzIHBsYXUgaW50ZW50YS1obyBtw6lzIHRhcmQuJywKfSk7CgovLyBBcGxpY2EgZWwgbWlkZGxld2FyZSBkZSBsaW1pdGFjacOzIGRlIHJhdGkgYSB0b3RlcyBsZXMgc29swrdsaWNpdHVkcwphcHAudXNlKGxpbWl0ZXIpOwoKLy8gQXBsaWNhIGVsIG1pZGRsZXdhcmUgZGUgR3JhcGhRTCBkJ0Fwb2xsbwpzZXJ2ZXIuYXBwbHlNaWRkbGV3YXJlKHsgYXBwIH0pOwoKLy8gSW5pY2lhIGVsIHNlcnZpZG9yCmFwcC5saXN0ZW4oeyBwb3J0OiA0MDAwIH0sICgpID0+CiAgY29uc29sZS5sb2coYFNlcnZpZG9yIGxsZXN0IGEgaHR0cDovL2xvY2FsaG9zdDo0MDAwJHtzZXJ2ZXIuZ3JhcGhxbFBhdGh9YCkKKTs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const express = require('express');
const { ApolloServer, gql } = require('apollo-server-express');
const rateLimit = require('express-rate-limit');

// Defineix el teu esquema GraphQL
const typeDefs = gql`
  type Query {
    hello: String
  }
`;

// Defineix els teus resolutors
const resolvers = {
  Query: {
    hello: () =&gt; 'Hello world!',
  },
};

// Crea una inst&agrave;ncia d'ApolloServer
const server = new ApolloServer({ typeDefs, resolvers });

// Crea una inst&agrave;ncia d'Express
const app = express();

// Defineix el middleware de limitaci&oacute; de rati
const limiter = rateLimit({
  windowMs: 1 * 60 * 1000, // 1 minut
  max: 10, // limita cada IP a 10 sol&middot;licituds per windowMs
  message: 'Massa sol&middot;licituds, si us plau intenta-ho m&eacute;s tard.',
});

// Aplica el middleware de limitaci&oacute; de rati a totes les sol&middot;licituds
app.use(limiter);

// Aplica el middleware de GraphQL d'Apollo
server.applyMiddleware({ app });

// Inicia el servidor
app.listen({ port: 4000 }, () =&gt;
  console.log(`Servidor llest a http://localhost:4000${server.graphqlPath}`)
);</pre></div><div class='content'><p>En aquest exemple:</p>
<ul>
<li>Utilitzem <code>express-rate-limit</code> per definir un limitador de rati.</li>
<li>El limitador de rati està configurat per permetre 10 sol·licituds per minut per adreça IP.</li>
<li>Si es supera el límit, es retorna un missatge al client.</li>
</ul>
</div><h2>Tècniques Avançades de Limitació de Rati</h2>
<div class='content'><p>Per a una limitació de rati més avançada, podries considerar:</p>
<ul>
<li><strong>Límits Dinàmics</strong>: Ajustar els límits basats en els rols d'usuari o plans de subscripció.</li>
<li><strong>Limitació de Rati Distribuïda</strong>: Implementar la limitació de rati a través de múltiples servidors o instàncies.</li>
<li><strong>Límits Específics de GraphQL</strong>: Limitar basant-se en la complexitat o profunditat de la consulta.</li>
</ul>
<h4>Exemple amb Límits Dinàmics</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgcmF0ZUxpbWl0ID0gcmVxdWlyZSgnZXhwcmVzcy1yYXRlLWxpbWl0Jyk7CgovLyBGdW5jacOzIHBlciBkZXRlcm1pbmFyIGVsIGzDrW1pdCBkZSByYXRpIGJhc2F0IGVuIGVsIHJvbCBkZSBsJ3VzdWFyaQpjb25zdCBnZXRSYXRlTGltaXQgPSAocm9sZSkgPT4gewogIHN3aXRjaCAocm9sZSkgewogICAgY2FzZSAncHJlbWl1bSc6CiAgICAgIHJldHVybiB7IHdpbmRvd01zOiAxICogNjAgKiAxMDAwLCBtYXg6IDEwMCB9OwogICAgY2FzZSAnc3RhbmRhcmQnOgogICAgICByZXR1cm4geyB3aW5kb3dNczogMSAqIDYwICogMTAwMCwgbWF4OiA1MCB9OwogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIHsgd2luZG93TXM6IDEgKiA2MCAqIDEwMDAsIG1heDogMTAgfTsKICB9Cn07CgovLyBNaWRkbGV3YXJlIHBlciBhcGxpY2FyIGzDrW1pdHMgZGUgcmF0aSBkaW7DoG1pY3MKY29uc3QgZHluYW1pY1JhdGVMaW1pdCA9IChyZXEsIHJlcywgbmV4dCkgPT4gewogIGNvbnN0IHVzZXJSb2xlID0gcmVxLnVzZXIucm9sZTsgLy8gU3Vwb3NlbSBxdWUgZWwgcm9sIGRlIGwndXN1YXJpIGVzdMOgIGRpc3BvbmlibGUgYSByZXEudXNlcgogIGNvbnN0IGxpbWl0ID0gZ2V0UmF0ZUxpbWl0KHVzZXJSb2xlKTsKICByYXRlTGltaXQobGltaXQpKHJlcSwgcmVzLCBuZXh0KTsKfTsKCi8vIEFwbGljYSBlbCBtaWRkbGV3YXJlIGRlIGxpbWl0YWNpw7MgZGUgcmF0aSBkaW7DoG1pYwphcHAudXNlKGR5bmFtaWNSYXRlTGltaXQpOw=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const rateLimit = require('express-rate-limit');

// Funci&oacute; per determinar el l&iacute;mit de rati basat en el rol de l'usuari
const getRateLimit = (role) =&gt; {
  switch (role) {
    case 'premium':
      return { windowMs: 1 * 60 * 1000, max: 100 };
    case 'standard':
      return { windowMs: 1 * 60 * 1000, max: 50 };
    default:
      return { windowMs: 1 * 60 * 1000, max: 10 };
  }
};

// Middleware per aplicar l&iacute;mits de rati din&agrave;mics
const dynamicRateLimit = (req, res, next) =&gt; {
  const userRole = req.user.role; // Suposem que el rol de l'usuari est&agrave; disponible a req.user
  const limit = getRateLimit(userRole);
  rateLimit(limit)(req, res, next);
};

// Aplica el middleware de limitaci&oacute; de rati din&agrave;mic
app.use(dynamicRateLimit);</pre></div><div class='content'><p>En aquest exemple:</p>
<ul>
<li>Definim una funció <code>getRateLimit</code> per retornar diferents límits de rati basats en el rol de l'usuari.</li>
<li>El middleware <code>dynamicRateLimit</code> aplica el límit de rati apropiat per a cada sol·licitud.</li>
</ul>
</div><h1>Conclusió</h1>
<div class='content'><p>La limitació de rati és un aspecte essencial per construir APIs GraphQL robustes i segures. Implementant la limitació de rati, pots:</p>
<ul>
<li>Protegir el teu servidor d'abusos i ús excessiu.</li>
<li>Assegurar un ús just entre els clients.</li>
<li>Mantenir el rendiment i l'estabilitat de la teva API.</li>
</ul>
<p>Ja sigui que utilitzis middleware bàsic o tècniques més avançades, entendre i aplicar la limitació de rati t'ajudarà a construir millors aplicacions GraphQL.</p>
</div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
       <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
       <a href="cookies">Més informació</a>
   </div>	
	</div>    
</body>
</html>
