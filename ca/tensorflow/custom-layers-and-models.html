<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui<br> i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="https://campusempresa.com/tensorflow/custom-layers-and-models" id="lnk_lang_es" data-lang="es">Castellano</a></b>
				|
				<b id="lit_lang_ca">Catala</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="objective">El Projecte</a>
				<a href="about">Sobre nosaltres</a>
				<a href="contribute">Contribuir</a>
				<a href="donate">Donacions</a>
				<a href="licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='content'></div><h1>Introducció</h1>
<div class='content'><p>En aquesta secció, explorarem com crear capes i models personalitzats utilitzant TensorFlow. Això és essencial per construir arquitectures de xarxes neuronals més complexes i adaptades que van més enllà de les capes i models predefinits disponibles a TensorFlow.</p>
</div><h1>Capes Personalitzades</h1>
<div class='content'></div><h2>Per què Crear Capes Personalitzades?</h2>
<div class='content'><ul>
<li><strong>Flexibilitat</strong>: Les capes personalitzades et permeten implementar operacions específiques que no estan disponibles en les capes predefinides de TensorFlow.</li>
<li><strong>Reutilització</strong>: Un cop creades, les capes personalitzades es poden reutilitzar en diferents models.</li>
<li><strong>Optimització</strong>: Adapta el comportament de la capa per optimitzar el rendiment per al teu cas d'ús específic.</li>
</ul>
</div><h2>Creació d'una Capa Personalitzada</h2>
<div class='content'><p>Per crear una capa personalitzada, necessites subclassificar <code>tf.keras.layers.Layer</code> i implementar els següents mètodes:</p>
<ul>
<li><code>__init__</code>: Inicialitza els atributs de la capa.</li>
<li><code>build</code>: Defineix els pesos de la capa.</li>
<li><code>call</code>: Implementa el pas endavant de la capa.</li>
</ul>
<h4>Exemple: Capa Densa Personalitzada</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRlbnNvcmZsb3cgYXMgdGYKCmNsYXNzIEN1c3RvbURlbnNlTGF5ZXIodGYua2VyYXMubGF5ZXJzLkxheWVyKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB1bml0cz0zMik6CiAgICAgICAgc3VwZXIoQ3VzdG9tRGVuc2VMYXllciwgc2VsZikuX19pbml0X18oKQogICAgICAgIHNlbGYudW5pdHMgPSB1bml0cwoKICAgIGRlZiBidWlsZChzZWxmLCBpbnB1dF9zaGFwZSk6CiAgICAgICAgc2VsZi53ID0gc2VsZi5hZGRfd2VpZ2h0KHNoYXBlPShpbnB1dF9zaGFwZVstMV0sIHNlbGYudW5pdHMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXplcj0ncmFuZG9tX25vcm1hbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYWluYWJsZT1UcnVlKQogICAgICAgIHNlbGYuYiA9IHNlbGYuYWRkX3dlaWdodChzaGFwZT0oc2VsZi51bml0cywpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXplcj0nemVyb3MnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFpbmFibGU9VHJ1ZSkKCiAgICBkZWYgY2FsbChzZWxmLCBpbnB1dHMpOgogICAgICAgIHJldHVybiB0Zi5tYXRtdWwoaW5wdXRzLCBzZWxmLncpICsgc2VsZi5iCgojIMOacwpjdXN0b21fZGVuc2UgPSBDdXN0b21EZW5zZUxheWVyKDEwKQpvdXRwdXQgPSBjdXN0b21fZGVuc2UodGYucmFuZG9tLnVuaWZvcm0oWzUsIDVdKSkKcHJpbnQob3V0cHV0KQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import tensorflow as tf

class CustomDenseLayer(tf.keras.layers.Layer):
    def __init__(self, units=32):
        super(CustomDenseLayer, self).__init__()
        self.units = units

    def build(self, input_shape):
        self.w = self.add_weight(shape=(input_shape[-1], self.units),
                                 initializer='random_normal',
                                 trainable=True)
        self.b = self.add_weight(shape=(self.units,),
                                 initializer='zeros',
                                 trainable=True)

    def call(self, inputs):
        return tf.matmul(inputs, self.w) + self.b

# &Uacute;s
custom_dense = CustomDenseLayer(10)
output = custom_dense(tf.random.uniform([5, 5]))
print(output)</pre></div><div class='content'><p>En aquest exemple:</p>
<ul>
<li><code>__init__</code> inicialitza el nombre d'unitats.</li>
<li><code>build</code> crea els pesos <code>w</code> i <code>b</code>.</li>
<li><code>call</code> defineix el pas endavant utilitzant la multiplicació de matrius.</li>
</ul>
</div><h1>Models Personalitzats</h1>
<div class='content'></div><h2>Per què Crear Models Personalitzats?</h2>
<div class='content'><ul>
<li><strong>Arquitectures Complexes</strong>: Els models personalitzats et permeten construir arquitectures més complexes que no són possibles amb l'API Sequential.</li>
<li><strong>Control</strong>: Proporciona més control sobre el pas endavant i el comportament general del model.</li>
</ul>
</div><h2>Creació d'un Model Personalitzat</h2>
<div class='content'><p>Per crear un model personalitzat, necessites subclassificar <code>tf.keras.Model</code> i implementar els següents mètodes:</p>
<ul>
<li><code>__init__</code>: Inicialitza les capes del model.</li>
<li><code>call</code>: Implementa el pas endavant del model.</li>
</ul>
<h4>Exemple: Model Personalitzat amb Capa Personalitzada</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgQ3VzdG9tTW9kZWwodGYua2VyYXMuTW9kZWwpOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHN1cGVyKEN1c3RvbU1vZGVsLCBzZWxmKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi5kZW5zZTEgPSBDdXN0b21EZW5zZUxheWVyKDMyKQogICAgICAgIHNlbGYuZGVuc2UyID0gQ3VzdG9tRGVuc2VMYXllcigxMCkKCiAgICBkZWYgY2FsbChzZWxmLCBpbnB1dHMpOgogICAgICAgIHggPSBzZWxmLmRlbnNlMShpbnB1dHMpCiAgICAgICAgcmV0dXJuIHNlbGYuZGVuc2UyKHgpCgojIMOacwptb2RlbCA9IEN1c3RvbU1vZGVsKCkKb3V0cHV0ID0gbW9kZWwodGYucmFuZG9tLnVuaWZvcm0oWzUsIDVdKSkKcHJpbnQob3V0cHV0KQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class CustomModel(tf.keras.Model):
    def __init__(self):
        super(CustomModel, self).__init__()
        self.dense1 = CustomDenseLayer(32)
        self.dense2 = CustomDenseLayer(10)

    def call(self, inputs):
        x = self.dense1(inputs)
        return self.dense2(x)

# &Uacute;s
model = CustomModel()
output = model(tf.random.uniform([5, 5]))
print(output)</pre></div><div class='content'><p>En aquest exemple:</p>
<ul>
<li><code>__init__</code> inicialitza dues capes denses personalitzades.</li>
<li><code>call</code> defineix el pas endavant utilitzant aquestes capes.</li>
</ul>
</div><h1>Capes i Models Personalitzats Avançats</h1>
<div class='content'></div><h2>Afegint Regularització</h2>
<div class='content'><p>Pots afegir regularització a les capes personalitzades incloent pèrdues de regularització en el mètode <code>build</code>.</p>
<h4>Exemple: Capa Personalitzada amb Regularització L2</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgQ3VzdG9tRGVuc2VMYXllcldpdGhSZWd1bGFyaXphdGlvbih0Zi5rZXJhcy5sYXllcnMuTGF5ZXIpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHVuaXRzPTMyLCByZWd1bGFyaXplcj1Ob25lKToKICAgICAgICBzdXBlcihDdXN0b21EZW5zZUxheWVyV2l0aFJlZ3VsYXJpemF0aW9uLCBzZWxmKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi51bml0cyA9IHVuaXRzCiAgICAgICAgc2VsZi5yZWd1bGFyaXplciA9IHJlZ3VsYXJpemVyCgogICAgZGVmIGJ1aWxkKHNlbGYsIGlucHV0X3NoYXBlKToKICAgICAgICBzZWxmLncgPSBzZWxmLmFkZF93ZWlnaHQoc2hhcGU9KGlucHV0X3NoYXBlWy0xXSwgc2VsZi51bml0cyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemVyPSdyYW5kb21fbm9ybWFsJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVndWxhcml6ZXI9c2VsZi5yZWd1bGFyaXplciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhaW5hYmxlPVRydWUpCiAgICAgICAgc2VsZi5iID0gc2VsZi5hZGRfd2VpZ2h0KHNoYXBlPShzZWxmLnVuaXRzLCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemVyPSd6ZXJvcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYWluYWJsZT1UcnVlKQoKICAgIGRlZiBjYWxsKHNlbGYsIGlucHV0cyk6CiAgICAgICAgcmV0dXJuIHRmLm1hdG11bChpbnB1dHMsIHNlbGYudykgKyBzZWxmLmIKCiMgw5pzCnJlZ3VsYXJpemVyID0gdGYua2VyYXMucmVndWxhcml6ZXJzLmwyKDAuMDEpCmN1c3RvbV9kZW5zZV9yZWcgPSBDdXN0b21EZW5zZUxheWVyV2l0aFJlZ3VsYXJpemF0aW9uKDEwLCByZWd1bGFyaXplcikKb3V0cHV0ID0gY3VzdG9tX2RlbnNlX3JlZyh0Zi5yYW5kb20udW5pZm9ybShbNSwgNV0pKQpwcmludChvdXRwdXQp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class CustomDenseLayerWithRegularization(tf.keras.layers.Layer):
    def __init__(self, units=32, regularizer=None):
        super(CustomDenseLayerWithRegularization, self).__init__()
        self.units = units
        self.regularizer = regularizer

    def build(self, input_shape):
        self.w = self.add_weight(shape=(input_shape[-1], self.units),
                                 initializer='random_normal',
                                 regularizer=self.regularizer,
                                 trainable=True)
        self.b = self.add_weight(shape=(self.units,),
                                 initializer='zeros',
                                 trainable=True)

    def call(self, inputs):
        return tf.matmul(inputs, self.w) + self.b

# &Uacute;s
regularizer = tf.keras.regularizers.l2(0.01)
custom_dense_reg = CustomDenseLayerWithRegularization(10, regularizer)
output = custom_dense_reg(tf.random.uniform([5, 5]))
print(output)</pre></div><div class='content'></div><h2>Bucle d'Entrenament Personalitzat</h2>
<div class='content'><p>Per tenir més control sobre el procés d'entrenament, pots implementar un bucle d'entrenament personalitzat.</p>
<h4>Exemple: Bucle d'Entrenament Personalitzat</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bW9kZWwgPSBDdXN0b21Nb2RlbCgpCmxvc3NfZm4gPSB0Zi5rZXJhcy5sb3NzZXMuU3BhcnNlQ2F0ZWdvcmljYWxDcm9zc2VudHJvcHkoZnJvbV9sb2dpdHM9VHJ1ZSkKb3B0aW1pemVyID0gdGYua2VyYXMub3B0aW1pemVycy5BZGFtKCkKCkB0Zi5mdW5jdGlvbgpkZWYgdHJhaW5fc3RlcChpbnB1dHMsIGxhYmVscyk6CiAgICB3aXRoIHRmLkdyYWRpZW50VGFwZSgpIGFzIHRhcGU6CiAgICAgICAgcHJlZGljdGlvbnMgPSBtb2RlbChpbnB1dHMpCiAgICAgICAgbG9zcyA9IGxvc3NfZm4obGFiZWxzLCBwcmVkaWN0aW9ucykKICAgIGdyYWRpZW50cyA9IHRhcGUuZ3JhZGllbnQobG9zcywgbW9kZWwudHJhaW5hYmxlX3ZhcmlhYmxlcykKICAgIG9wdGltaXplci5hcHBseV9ncmFkaWVudHMoemlwKGdyYWRpZW50cywgbW9kZWwudHJhaW5hYmxlX3ZhcmlhYmxlcykpCiAgICByZXR1cm4gbG9zcwoKIyBEYWRlcyBmaWN0w61jaWVzCmlucHV0cyA9IHRmLnJhbmRvbS51bmlmb3JtKFs1LCA1XSkKbGFiZWxzID0gdGYucmFuZG9tLnVuaWZvcm0oWzVdLCBtYXh2YWw9MTAsIGR0eXBlPXRmLmludDMyKQoKIyBCdWNsZSBkJ2VudHJlbmFtZW50CmZvciBlcG9jaCBpbiByYW5nZSgxMCk6CiAgICBsb3NzID0gdHJhaW5fc3RlcChpbnB1dHMsIGxhYmVscykKICAgIHByaW50KGYnRXBvY2gge2Vwb2NofSwgTG9zczoge2xvc3MubnVtcHkoKX0nKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>model = CustomModel()
loss_fn = tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True)
optimizer = tf.keras.optimizers.Adam()

@tf.function
def train_step(inputs, labels):
    with tf.GradientTape() as tape:
        predictions = model(inputs)
        loss = loss_fn(labels, predictions)
    gradients = tape.gradient(loss, model.trainable_variables)
    optimizer.apply_gradients(zip(gradients, model.trainable_variables))
    return loss

# Dades fict&iacute;cies
inputs = tf.random.uniform([5, 5])
labels = tf.random.uniform([5], maxval=10, dtype=tf.int32)

# Bucle d'entrenament
for epoch in range(10):
    loss = train_step(inputs, labels)
    print(f'Epoch {epoch}, Loss: {loss.numpy()}')</pre></div><div class='content'></div><h1>Conclusió</h1>
<div class='content'><p>Crear capes i models personalitzats a TensorFlow permet una major flexibilitat, control i optimització en la construcció de xarxes neuronals. Subclassificant <code>tf.keras.layers.Layer</code> i <code>tf.keras.Model</code>, pots definir comportaments i arquitectures específiques adaptades a les teves necessitats. A més, tècniques avançades com afegir regularització i implementar bucles d'entrenament personalitzats milloren encara més les capacitats dels teus models.</p>
</div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
       <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
       <a href="cookies">Més informació</a>
   </div>	
	</div>    
</body>
</html>
