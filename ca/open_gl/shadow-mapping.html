<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapeig d'Ombres a OpenGL</title>

    <link rel="alternate" href="https://campusempresa.com/es/open_gl/shadow-mapping" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/open_gl/shadow-mapping" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/open_gl/shadow-mapping" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/ca/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="/es/open_gl/shadow-mapping" id="lnk_lang_es" data-lang="es" class="px-2">ES</a></b>
				|
				<b id="lit_lang_ca" class="px-2">CA</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/ca/objective">El Projecte</a>
				<a href="/ca/about">Sobre nosaltres</a>
				<a href="/ca/contribute">Contribuir</a>
				<a href="/ca/donate">Donacions</a>
				<a href="/ca/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='advanced-shading-techniques'>&#x25C4;Tècniques d'Ombrejat Avançades</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Mapeig d'Ombres a OpenGL</a>
	</div>
	<div class='col-4 text-end'>
					<a href='post-processing-effects'>Efeces de Postprocessament &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introducció al Mapeig d'Ombres</h1>
<div class='content'><p>El mapeig d'ombres és una tècnica utilitzada en gràfics per ordinador per afegir ombres a una escena 3D. Implica renderitzar l'escena des del punt de vista de la llum per crear un mapa de profunditat, que després s'utilitza per determinar si un píxel està en ombra.</p>
</div><h2>Conceptes Clau</h2>
<div class='content'><ul>
<li><strong>Mapa de Profunditat</strong>: Una textura que emmagatzema la distància des de la font de llum fins a la superfície més propera.</li>
<li><strong>Transformació de l'Espai de Llum</strong>: Transformar les coordenades del món a la vista de la llum per crear el mapa de profunditat.</li>
<li><strong>Prova d'Ombra</strong>: Comparar la profunditat d'un fragment amb el mapa de profunditat per determinar si està en ombra.</li>
</ul>
</div><h1>Creació d'un Mapa de Profunditat</h1>
<div class='content'><p>Per crear un mapa de profunditat, cal renderitzar l'escena des de la perspectiva de la llum.</p>
</div><h2>Passos per Crear un Mapa de Profunditat</h2>
<div class='content'><ol>
<li><strong>Configurar un objecte framebuffer (FBO)</strong> amb una textura de profunditat adjunta.</li>
<li><strong>Renderitzar l'escena</strong> des del punt de vista de la llum per omplir la textura de profunditat.</li>
</ol>
</div><h2>Exemple de Codi: Configuració del Mapa de Profunditat</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gQ3JlYXIgdW4gb2JqZWN0ZSBmcmFtZWJ1ZmZlciBwZXIgYWwgbWFwYSBkZSBwcm9mdW5kaXRhdApHTHVpbnQgZGVwdGhNYXBGQk87CmdsR2VuRnJhbWVidWZmZXJzKDEsICZkZXB0aE1hcEZCTyk7CgovLyBDcmVhciB1bmEgdGV4dHVyYSBwZXIgZW1tYWdhdHplbWFyIGVsIG1hcGEgZGUgcHJvZnVuZGl0YXQKR0x1aW50IGRlcHRoTWFwOwpnbEdlblRleHR1cmVzKDEsICZkZXB0aE1hcCk7CmdsQmluZFRleHR1cmUoR0xfVEVYVFVSRV8yRCwgZGVwdGhNYXApOwpnbFRleEltYWdlMkQoR0xfVEVYVFVSRV8yRCwgMCwgR0xfREVQVEhfQ09NUE9ORU5ULCBTSEFET1dfV0lEVEgsIFNIQURPV19IRUlHSFQsIDAsIEdMX0RFUFRIX0NPTVBPTkVOVCwgR0xfRkxPQVQsIE5VTEwpOwpnbFRleFBhcmFtZXRlcmkoR0xfVEVYVFVSRV8yRCwgR0xfVEVYVFVSRV9NSU5fRklMVEVSLCBHTF9ORUFSRVNUKTsKZ2xUZXhQYXJhbWV0ZXJpKEdMX1RFWFRVUkVfMkQsIEdMX1RFWFRVUkVfTUFHX0ZJTFRFUiwgR0xfTkVBUkVTVCk7CmdsVGV4UGFyYW1ldGVyaShHTF9URVhUVVJFXzJELCBHTF9URVhUVVJFX1dSQVBfUywgR0xfQ0xBTVBfVE9fQk9SREVSKTsKZ2xUZXhQYXJhbWV0ZXJpKEdMX1RFWFRVUkVfMkQsIEdMX1RFWFRVUkVfV1JBUF9ULCBHTF9DTEFNUF9UT19CT1JERVIpOwpmbG9hdCBib3JkZXJDb2xvcltdID0geyAxLjAsIDEuMCwgMS4wLCAxLjAgfTsKZ2xUZXhQYXJhbWV0ZXJmdihHTF9URVhUVVJFXzJELCBHTF9URVhUVVJFX0JPUkRFUl9DT0xPUiwgYm9yZGVyQ29sb3IpOwoKLy8gQWRqdW50YXIgbGEgdGV4dHVyYSBkZSBwcm9mdW5kaXRhdCBhbCBmcmFtZWJ1ZmZlcgpnbEJpbmRGcmFtZWJ1ZmZlcihHTF9GUkFNRUJVRkZFUiwgZGVwdGhNYXBGQk8pOwpnbEZyYW1lYnVmZmVyVGV4dHVyZTJEKEdMX0ZSQU1FQlVGRkVSLCBHTF9ERVBUSF9BVFRBQ0hNRU5ULCBHTF9URVhUVVJFXzJELCBkZXB0aE1hcCwgMCk7CmdsRHJhd0J1ZmZlcihHTF9OT05FKTsgLy8gTm8gZXMgZGlidWl4YSBjYXAgYnVmZmVyIGRlIGNvbG9yCmdsUmVhZEJ1ZmZlcihHTF9OT05FKTsKZ2xCaW5kRnJhbWVidWZmZXIoR0xfRlJBTUVCVUZGRVIsIDApOw=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Crear un objecte framebuffer per al mapa de profunditat
GLuint depthMapFBO;
glGenFramebuffers(1, &amp;depthMapFBO);

// Crear una textura per emmagatzemar el mapa de profunditat
GLuint depthMap;
glGenTextures(1, &amp;depthMap);
glBindTexture(GL_TEXTURE_2D, depthMap);
glTexImage2D(GL_TEXTURE_2D, 0, GL_DEPTH_COMPONENT, SHADOW_WIDTH, SHADOW_HEIGHT, 0, GL_DEPTH_COMPONENT, GL_FLOAT, NULL);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_BORDER);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_BORDER);
float borderColor[] = { 1.0, 1.0, 1.0, 1.0 };
glTexParameterfv(GL_TEXTURE_2D, GL_TEXTURE_BORDER_COLOR, borderColor);

// Adjuntar la textura de profunditat al framebuffer
glBindFramebuffer(GL_FRAMEBUFFER, depthMapFBO);
glFramebufferTexture2D(GL_FRAMEBUFFER, GL_DEPTH_ATTACHMENT, GL_TEXTURE_2D, depthMap, 0);
glDrawBuffer(GL_NONE); // No es dibuixa cap buffer de color
glReadBuffer(GL_NONE);
glBindFramebuffer(GL_FRAMEBUFFER, 0);</pre></div><div class='content'></div><h1>Renderització de l'Escena des de la Perspectiva de la Llum</h1>
<div class='content'><p>Per renderitzar l'escena des de la perspectiva de la llum, cal configurar una matriu de vista i projecció per a la llum.</p>
</div><h2>Exemple de Codi: Transformació de l'Espai de Llum</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Z2xtOjptYXQ0IGxpZ2h0UHJvamVjdGlvbiwgbGlnaHRWaWV3OwpnbG06Om1hdDQgbGlnaHRTcGFjZU1hdHJpeDsKZmxvYXQgbmVhcl9wbGFuZSA9IDEuMGYsIGZhcl9wbGFuZSA9IDcuNWY7CmxpZ2h0UHJvamVjdGlvbiA9IGdsbTo6b3J0aG8oLTEwLjBmLCAxMC4wZiwgLTEwLjBmLCAxMC4wZiwgbmVhcl9wbGFuZSwgZmFyX3BsYW5lKTsKbGlnaHRWaWV3ID0gZ2xtOjpsb29rQXQobGlnaHRQb3MsIGdsbTo6dmVjMygwLjBmKSwgZ2xtOjp2ZWMzKDAuMGYsIDEuMGYsIDAuMGYpKTsKbGlnaHRTcGFjZU1hdHJpeCA9IGxpZ2h0UHJvamVjdGlvbiAqIGxpZ2h0VmlldzsKCi8vIFBhc3NhciBsaWdodFNwYWNlTWF0cml4IGFsIHNoYWRlcgpzaGFkZXIuc2V0TWF0NCgibGlnaHRTcGFjZU1hdHJpeCIsIGxpZ2h0U3BhY2VNYXRyaXgpOw=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>glm::mat4 lightProjection, lightView;
glm::mat4 lightSpaceMatrix;
float near_plane = 1.0f, far_plane = 7.5f;
lightProjection = glm::ortho(-10.0f, 10.0f, -10.0f, 10.0f, near_plane, far_plane);
lightView = glm::lookAt(lightPos, glm::vec3(0.0f), glm::vec3(0.0f, 1.0f, 0.0f));
lightSpaceMatrix = lightProjection * lightView;

// Passar lightSpaceMatrix al shader
shader.setMat4(&quot;lightSpaceMatrix&quot;, lightSpaceMatrix);</pre></div><div class='content'></div><h1>Realització de la Prova d'Ombra</h1>
<div class='content'><p>Després de crear el mapa de profunditat, cal realitzar una prova d'ombra al fragment shader per determinar si un fragment està en ombra.</p>
</div><h2>Exemple de Codi: Prova d'Ombra al Fragment Shader</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("I3ZlcnNpb24gMzMwIGNvcmUKaW4gdmVjNCBGcmFnUG9zTGlnaHRTcGFjZTsKdW5pZm9ybSBzYW1wbGVyMkQgc2hhZG93TWFwOwoKZmxvYXQgU2hhZG93Q2FsY3VsYXRpb24odmVjNCBmcmFnUG9zTGlnaHRTcGFjZSkKewogICAgLy8gUmVhbGl0emFyIGxhIGRpdmlzacOzIGRlIHBlcnNwZWN0aXZhCiAgICB2ZWMzIHByb2pDb29yZHMgPSBmcmFnUG9zTGlnaHRTcGFjZS54eXogLyBmcmFnUG9zTGlnaHRTcGFjZS53OwogICAgLy8gVHJhbnNmb3JtYXIgYSByYW5nIFswLDFdCiAgICBwcm9qQ29vcmRzID0gcHJvakNvb3JkcyAqIDAuNSArIDAuNTsKICAgIC8vIE9idGVuaXIgZWwgdmFsb3IgZGUgcHJvZnVuZGl0YXQgbcOpcyBwcm9wZXIgZGVzIGRlIGxhIHBlcnNwZWN0aXZhIGRlIGxhIGxsdW0gKHV0aWxpdHphbnQgZWwgcmFuZyBbMCwxXSkKICAgIGZsb2F0IGNsb3Nlc3REZXB0aCA9IHRleHR1cmUoc2hhZG93TWFwLCBwcm9qQ29vcmRzLnh5KS5yOwogICAgLy8gT2J0ZW5pciBsYSBwcm9mdW5kaXRhdCBkZWwgZnJhZ21lbnQgYWN0dWFsIGRlcyBkZSBsYSBwZXJzcGVjdGl2YSBkZSBsYSBsbHVtCiAgICBmbG9hdCBjdXJyZW50RGVwdGggPSBwcm9qQ29vcmRzLno7CiAgICAvLyBDb21wcm92YXIgc2kgZWwgZnJhZ21lbnQgYWN0dWFsIGVzdMOgIGVuIG9tYnJhCiAgICBmbG9hdCBzaGFkb3cgPSBjdXJyZW50RGVwdGggPiBjbG9zZXN0RGVwdGggID8gMS4wIDogMC4wOwogICAgcmV0dXJuIHNoYWRvdzsKfQoKdm9pZCBtYWluKCkKewogICAgZmxvYXQgc2hhZG93ID0gU2hhZG93Q2FsY3VsYXRpb24oRnJhZ1Bvc0xpZ2h0U3BhY2UpOwogICAgdmVjMyBjb2xvciA9IHZlYzMoMS4wKSAqICgxLjAgLSBzaGFkb3cpOyAvLyBBcGxpY2FyIG9tYnJhCiAgICBGcmFnQ29sb3IgPSB2ZWM0KGNvbG9yLCAxLjApOwp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#version 330 core
in vec4 FragPosLightSpace;
uniform sampler2D shadowMap;

float ShadowCalculation(vec4 fragPosLightSpace)
{
    // Realitzar la divisi&oacute; de perspectiva
    vec3 projCoords = fragPosLightSpace.xyz / fragPosLightSpace.w;
    // Transformar a rang [0,1]
    projCoords = projCoords * 0.5 + 0.5;
    // Obtenir el valor de profunditat m&eacute;s proper des de la perspectiva de la llum (utilitzant el rang [0,1])
    float closestDepth = texture(shadowMap, projCoords.xy).r;
    // Obtenir la profunditat del fragment actual des de la perspectiva de la llum
    float currentDepth = projCoords.z;
    // Comprovar si el fragment actual est&agrave; en ombra
    float shadow = currentDepth &gt; closestDepth  ? 1.0 : 0.0;
    return shadow;
}

void main()
{
    float shadow = ShadowCalculation(FragPosLightSpace);
    vec3 color = vec3(1.0) * (1.0 - shadow); // Aplicar ombra
    FragColor = vec4(color, 1.0);
}</pre></div><div class='content'></div><h1>Millora de la Qualitat de les Ombres</h1>
<div class='content'><p>Hi ha diverses tècniques per millorar la qualitat de les ombres:</p>
<ul>
<li><strong>PCF (Percentage Closer Filtering)</strong>: Suavitza les vores de les ombres mitjançant la mitjana de múltiples comparacions de profunditat.</li>
<li><strong>Resolució del Mapa d'Ombres</strong>: Augmentar la resolució del mapa de profunditat pot reduir l'aliasing.</li>
<li><strong>Bias</strong>: Afegir un petit bias a la comparació de profunditat per reduir l'acne d'ombres.</li>
</ul>
</div><h2>Exemple de Codi: PCF al Fragment Shader</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZmxvYXQgU2hhZG93Q2FsY3VsYXRpb24odmVjNCBmcmFnUG9zTGlnaHRTcGFjZSkKewogICAgdmVjMyBwcm9qQ29vcmRzID0gZnJhZ1Bvc0xpZ2h0U3BhY2UueHl6IC8gZnJhZ1Bvc0xpZ2h0U3BhY2UudzsKICAgIHByb2pDb29yZHMgPSBwcm9qQ29vcmRzICogMC41ICsgMC41OwogICAgZmxvYXQgY3VycmVudERlcHRoID0gcHJvakNvb3Jkcy56OwogICAgZmxvYXQgc2hhZG93ID0gMC4wOwogICAgdmVjMiB0ZXhlbFNpemUgPSAxLjAgLyB0ZXh0dXJlU2l6ZShzaGFkb3dNYXAsIDApOwogICAgZm9yKGludCB4ID0gLTE7IHggPD0gMTsgKyt4KQogICAgewogICAgICAgIGZvcihpbnQgeSA9IC0xOyB5IDw9IDE7ICsreSkKICAgICAgICB7CiAgICAgICAgICAgIGZsb2F0IHBjZkRlcHRoID0gdGV4dHVyZShzaGFkb3dNYXAsIHByb2pDb29yZHMueHkgKyB2ZWMyKHgsIHkpICogdGV4ZWxTaXplKS5yOwogICAgICAgICAgICBzaGFkb3cgKz0gY3VycmVudERlcHRoID4gcGNmRGVwdGggID8gMS4wIDogMC4wOwogICAgICAgIH0KICAgIH0KICAgIHNoYWRvdyAvPSA5LjA7CiAgICByZXR1cm4gc2hhZG93Owp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>float ShadowCalculation(vec4 fragPosLightSpace)
{
    vec3 projCoords = fragPosLightSpace.xyz / fragPosLightSpace.w;
    projCoords = projCoords * 0.5 + 0.5;
    float currentDepth = projCoords.z;
    float shadow = 0.0;
    vec2 texelSize = 1.0 / textureSize(shadowMap, 0);
    for(int x = -1; x &lt;= 1; ++x)
    {
        for(int y = -1; y &lt;= 1; ++y)
        {
            float pcfDepth = texture(shadowMap, projCoords.xy + vec2(x, y) * texelSize).r;
            shadow += currentDepth &gt; pcfDepth  ? 1.0 : 0.0;
        }
    }
    shadow /= 9.0;
    return shadow;
}</pre></div><div class='content'></div><h1>Conclusió</h1>
<div class='content'><p>El mapeig d'ombres és una tècnica poderosa per afegir ombres realistes a una escena 3D. Entenent el procés de creació d'un mapa de profunditat, transformant coordenades a l'espai de llum i realitzant proves d'ombra, pots implementar el mapeig d'ombres bàsic. Millores addicionals com PCF i ajustar la resolució del mapa d'ombres poden millorar la qualitat de les ombres a les teves escenes.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='advanced-shading-techniques'>&#x25C4;Tècniques d'Ombrejat Avançades</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Mapeig d'Ombres a OpenGL</a>
	</div>
	<div class='col-4 text-end'>
					<a href='post-processing-effects'>Efeces de Postprocessament &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/ca/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
