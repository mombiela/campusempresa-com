<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consultar la Base de Dades</title>

    <link rel="alternate" href="https://campusempresa.com/es/django/querying-the-database" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/django/querying-the-database" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/django/querying-the-database" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/ca/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="/es/django/querying-the-database" id="lnk_lang_es" data-lang="es" class="px-2">ES</a></b>
				|
				<b id="lit_lang_ca" class="px-2">CA</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/ca/objective">El Projecte</a>
				<a href="/ca/about">Sobre nosaltres</a>
				<a href="/ca/contribute">Contribuir</a>
				<a href="/ca/donate">Donacions</a>
				<a href="/ca/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='model-migrations'>&#x25C4;Migracions de Models</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Consultar la Base de Dades</a>
	</div>
	<div class='col-4 text-end'>
					<a href='model-relationships'>Relacions entre Models &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introducció</h1>
<div class='content'><p>En aquesta secció, explorarem com consultar la base de dades utilitzant l'ORM (Object-Relational Mapping) de Django. L'ORM de Django proporciona una abstracció d'alt nivell sobre SQL, permetent als desenvolupadors interactuar amb la base de dades utilitzant codi Python. Això fa que sigui més fàcil realitzar operacions CRUD (Crear, Llegir, Actualitzar, Esborrar) sense escriure consultes SQL en brut.</p>
</div><h1>Consultes Bàsiques</h1>
<h2>Recuperar Tots els Objectes</h2>
<div class='content'><p>Per recuperar tots els objectes d'un model, pots utilitzar el mètode <code>all()</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEJvb2sKCiMgUmVjdXBlcmFyIHRvdHMgZWxzIGxsaWJyZXMKYm9va3MgPSBCb29rLm9iamVjdHMuYWxsKCk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Book

# Recuperar tots els llibres
books = Book.objects.all()</pre></div><div class='content'></div><h2>Filtrar Objectes</h2>
<div class='content'><p>Per filtrar objectes basats en certs criteris, pots utilitzar el mètode <code>filter()</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEJvb2sKCiMgUmVjdXBlcmFyIGxsaWJyZXMgcHVibGljYXRzIGVsIDIwMjEKYm9va3NfMjAyMSA9IEJvb2sub2JqZWN0cy5maWx0ZXIocHVibGljYXRpb25feWVhcj0yMDIxKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Book

# Recuperar llibres publicats el 2021
books_2021 = Book.objects.filter(publication_year=2021)</pre></div><div class='content'></div><h2>Recuperar un Sol Objecte</h2>
<div class='content'><p>Per recuperar un sol objecte, pots utilitzar el mètode <code>get()</code>. Tingues en compte que <code>get()</code> llançarà una excepció <code>DoesNotExist</code> si no es troba cap objecte i una excepció <code>MultipleObjectsReturned</code> si es troben més d'un objecte.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEJvb2sKCiMgUmVjdXBlcmFyIHVuIGxsaWJyZSBhbWIgdW4gdMOtdG9sIGVzcGVjw61maWMKdHJ5OgogICAgYm9vayA9IEJvb2sub2JqZWN0cy5nZXQodGl0bGU9IkRqYW5nbyBmb3IgQmVnaW5uZXJzIikKZXhjZXB0IEJvb2suRG9lc05vdEV4aXN0OgogICAgcHJpbnQoIkxsaWJyZSBubyB0cm9iYXQiKQpleGNlcHQgQm9vay5NdWx0aXBsZU9iamVjdHNSZXR1cm5lZDoKICAgIHByaW50KCJTJ2hhbiB0cm9iYXQgbcO6bHRpcGxlcyBsbGlicmVzIik="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Book

# Recuperar un llibre amb un t&iacute;tol espec&iacute;fic
try:
    book = Book.objects.get(title=&quot;Django for Beginners&quot;)
except Book.DoesNotExist:
    print(&quot;Llibre no trobat&quot;)
except Book.MultipleObjectsReturned:
    print(&quot;S'han trobat m&uacute;ltiples llibres&quot;)</pre></div><div class='content'></div><h2>Consultes de Camps</h2>
<div class='content'><p>Django proporciona diverses consultes de camps per filtrar dades. Algunes consultes comunes inclouen:</p>
<ul>
<li><code>exact</code>: Coincidència exacta</li>
<li><code>iexact</code>: Coincidència exacta insensible a majúscules i minúscules</li>
<li><code>contains</code>: Prova de contenció sensible a majúscules i minúscules</li>
<li><code>icontains</code>: Prova de contenció insensible a majúscules i minúscules</li>
<li><code>gt</code>: Major que</li>
<li><code>gte</code>: Major o igual que</li>
<li><code>lt</code>: Menor que</li>
<li><code>lte</code>: Menor o igual que</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEJvb2sKCiMgUmVjdXBlcmFyIGxsaWJyZXMgYW1iIHTDrXRvbHMgcXVlIGNvbnRpbmd1aW4gJ0RqYW5nbycKYm9va3MgPSBCb29rLm9iamVjdHMuZmlsdGVyKHRpdGxlX19pY29udGFpbnM9J0RqYW5nbycpCgojIFJlY3VwZXJhciBsbGlicmVzIHB1YmxpY2F0cyBkZXNwcsOpcyBkZWwgMjAyMApib29rcyA9IEJvb2sub2JqZWN0cy5maWx0ZXIocHVibGljYXRpb25feWVhcl9fZ3Q9MjAyMCk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Book

# Recuperar llibres amb t&iacute;tols que continguin 'Django'
books = Book.objects.filter(title__icontains='Django')

# Recuperar llibres publicats despr&eacute;s del 2020
books = Book.objects.filter(publication_year__gt=2020)</pre></div><div class='content'></div><h1>Consultes Avançades</h1>
<h2>Consultes Complexes amb Q Objects</h2>
<div class='content'><p>Per realitzar consultes complexes que impliquin condicions OR o combinar múltiples condicions, pots utilitzar <code>Q</code> objects.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBkamFuZ28uZGIubW9kZWxzIGltcG9ydCBRCmZyb20gbXlhcHAubW9kZWxzIGltcG9ydCBCb29rCgojIFJlY3VwZXJhciBsbGlicmVzIHB1YmxpY2F0cyBlbCAyMDIwIG8gYW1iIHTDrXRvbHMgcXVlIGNvbnRpbmd1aW4gJ1B5dGhvbicKYm9va3MgPSBCb29rLm9iamVjdHMuZmlsdGVyKFEocHVibGljYXRpb25feWVhcj0yMDIwKSB8IFEodGl0bGVfX2ljb250YWlucz0nUHl0aG9uJykp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from django.db.models import Q
from myapp.models import Book

# Recuperar llibres publicats el 2020 o amb t&iacute;tols que continguin 'Python'
books = Book.objects.filter(Q(publication_year=2020) | Q(title__icontains='Python'))</pre></div><div class='content'></div><h2>Agregacions</h2>
<div class='content'><p>Django proporciona funcions d'agregació com <code>Count</code>, <code>Sum</code>, <code>Avg</code>, <code>Min</code>, i <code>Max</code> per realitzar càlculs sobre querysets.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBkamFuZ28uZGIubW9kZWxzIGltcG9ydCBDb3VudCwgQXZnCmZyb20gbXlhcHAubW9kZWxzIGltcG9ydCBCb29rCgojIENvbXB0YXIgZWwgbm9tYnJlIGRlIGxsaWJyZXMKYm9va19jb3VudCA9IEJvb2sub2JqZWN0cy5jb3VudCgpCgojIENhbGN1bGFyIGwnYW55IGRlIHB1YmxpY2FjacOzIG1pdGrDoAphdmVyYWdlX3llYXIgPSBCb29rLm9iamVjdHMuYWdncmVnYXRlKEF2ZygncHVibGljYXRpb25feWVhcicpKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from django.db.models import Count, Avg
from myapp.models import Book

# Comptar el nombre de llibres
book_count = Book.objects.count()

# Calcular l'any de publicaci&oacute; mitj&agrave;
average_year = Book.objects.aggregate(Avg('publication_year'))</pre></div><div class='content'></div><h2>Anotant Querysets</h2>
<div class='content'><p>El mètode <code>annotate()</code> et permet afegir camps calculats a cada objecte en un queryset.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBkamFuZ28uZGIubW9kZWxzIGltcG9ydCBDb3VudApmcm9tIG15YXBwLm1vZGVscyBpbXBvcnQgQXV0aG9yCgojIEFub3RhciBhdXRvcnMgYW1iIGVsIG5vbWJyZSBkZSBsbGlicmVzIHF1ZSBoYW4gZXNjcml0CmF1dGhvcnMgPSBBdXRob3Iub2JqZWN0cy5hbm5vdGF0ZShib29rX2NvdW50PUNvdW50KCdib29rJykpCmZvciBhdXRob3IgaW4gYXV0aG9yczoKICAgIHByaW50KGYie2F1dGhvci5uYW1lfSBoYSBlc2NyaXQge2F1dGhvci5ib29rX2NvdW50fSBsbGlicmVzIik="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from django.db.models import Count
from myapp.models import Author

# Anotar autors amb el nombre de llibres que han escrit
authors = Author.objects.annotate(book_count=Count('book'))
for author in authors:
    print(f&quot;{author.name} ha escrit {author.book_count} llibres&quot;)</pre></div><div class='content'></div><h1>Optimització de Consultes</h1>
<h2>Select Related</h2>
<div class='content'><p>Per reduir el nombre de consultes a la base de dades, pots utilitzar <code>select_related()</code> per a relacions de valor únic (claus foranes).</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEJvb2sKCiMgUmVjdXBlcmFyIGxsaWJyZXMganVudGFtZW50IGFtYiBlbHMgc2V1cyBhdXRvcnMgZW4gdW5hIHNvbGEgY29uc3VsdGEKYm9va3MgPSBCb29rLm9iamVjdHMuc2VsZWN0X3JlbGF0ZWQoJ2F1dGhvcicpLmFsbCgp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Book

# Recuperar llibres juntament amb els seus autors en una sola consulta
books = Book.objects.select_related('author').all()</pre></div><div class='content'></div><h2>Prefetch Related</h2>
<div class='content'><p>Per a relacions de valor múltiple (many-to-many i clau forana inversa), utilitza <code>prefetch_related()</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEF1dGhvcgoKIyBSZWN1cGVyYXIgYXV0b3JzIGp1bnRhbWVudCBhbWIgZWxzIHNldXMgbGxpYnJlcyBlbiB1bmEgc29sYSBjb25zdWx0YQphdXRob3JzID0gQXV0aG9yLm9iamVjdHMucHJlZmV0Y2hfcmVsYXRlZCgnYm9va19zZXQnKS5hbGwoKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Author

# Recuperar autors juntament amb els seus llibres en una sola consulta
authors = Author.objects.prefetch_related('book_set').all()</pre></div><div class='content'></div><h1>Conclusió</h1>
<div class='content'><p>Consultar la base de dades en Django és senzill i eficient gràcies a l'ús de l'ORM de Django. Entenent les tècniques bàsiques i avançades de consulta, pots realitzar operacions complexes de recuperació de dades amb facilitat. Recorda utilitzar tècniques d'optimització de consultes com <code>select_related()</code> i <code>prefetch_related()</code> per millorar el rendiment de les teves consultes a la base de dades.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='model-migrations'>&#x25C4;Migracions de Models</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Consultar la Base de Dades</a>
	</div>
	<div class='col-4 text-end'>
					<a href='model-relationships'>Relacions entre Models &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/ca/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
