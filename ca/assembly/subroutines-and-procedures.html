<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui<br> i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="https://campusempresa.com/assembly/subroutines-and-procedures" id="lnk_lang_es" data-lang="es">Castellano</a></b>
				|
				<b id="lit_lang_ca">Catala</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="objective">El Projecte</a>
				<a href="about">Sobre nosaltres</a>
				<a href="contribute">Contribuir</a>
				<a href="donate">Donacions</a>
				<a href="licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='content'></div><h1>Introducció a les Subrutines i Procediments</h1>
<div class='content'><p>Les subrutines i procediments són conceptes fonamentals en la programació en llenguatge ensamblador. Permeten descompondre tasques complexes en peces més petites i manejables, fent que el teu codi sigui més modular, llegible i mantenible.</p>
</div><h1>Conceptes Clau</h1>
<div class='content'><ul>
<li><strong>Subrutina</strong>: Una seqüència d'instruccions dissenyada per realitzar una tasca específica, que es pot cridar des de diferents parts d'un programa.</li>
<li><strong>Procediment</strong>: Un altre terme per a subrutina, sovint utilitzat de manera intercanviable.</li>
<li><strong>Crida</strong>: La instrucció utilitzada per invocar una subrutina.</li>
<li><strong>Retorn</strong>: La instrucció utilitzada per retornar el control al codi que ha fet la crida després que la subrutina hagi acabat d'executar-se.</li>
<li><strong>Pila</strong>: Una estructura de memòria especial utilitzada per emmagatzemar adreces de retorn i variables locals durant les crides a subrutines.</li>
</ul>
</div><h1>Estructura Bàsica d'una Subrutina</h1>
<div class='content'><p>Una subrutina típicament consisteix en:</p>
<ol>
<li><strong>Pròleg</strong>: Codi que configura la subrutina, com ara guardar registres i configurar el marc de la pila.</li>
<li><strong>Cos</strong>: El codi principal de la subrutina que realitza la tasca específica.</li>
<li><strong>Epilog</strong>: Codi que neteja, restaura registres i retorna el control al codi que ha fet la crida.</li>
</ol>
</div><h2>Exemple: Subrutina Simple en x86 Assembly</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c2VjdGlvbiAuZGF0YQogICAgbXNnIGRiICdIb2xhLCBNw7NuIScsIDAKCnNlY3Rpb24gLnRleHQKICAgIGdsb2JhbCBfc3RhcnQKCl9zdGFydDoKICAgIGNhbGwgcHJpbnRfbWVzc2FnZQogICAgOyBTb3J0aXIgZGVsIHByb2dyYW1hCiAgICBtb3YgZWF4LCA2MCAgICAgICAgIDsgc3lzY2FsbDogZXhpdAogICAgeG9yIGVkaSwgZWRpICAgICAgICA7IGVzdGF0OiAwCiAgICBzeXNjYWxsCgpwcmludF9tZXNzYWdlOgogICAgOyBQcsOybGVnCiAgICBwdXNoIHJicCAgICAgICAgICAgIDsgR3VhcmRhciBlbCBwdW50ZXIgYmFzZQogICAgbW92IHJicCwgcnNwICAgICAgICA7IENvbmZpZ3VyYXIgZWwgcHVudGVyIGJhc2UgYWwgcHVudGVyIGRlIGxhIHBpbGEKCiAgICA7IENvcwogICAgbW92IHJheCwgMSAgICAgICAgICA7IHN5c2NhbGw6IHdyaXRlCiAgICBtb3YgcmRpLCAxICAgICAgICAgIDsgZGVzY3JpcHRvciBkZSBmaXR4ZXI6IHN0ZG91dAogICAgbW92IHJzaSwgbXNnICAgICAgICA7IG1pc3NhdGdlIGEgZXNjcml1cmUKICAgIG1vdiByZHgsIDEzICAgICAgICAgOyBsb25naXR1ZCBkZWwgbWlzc2F0Z2UKICAgIHN5c2NhbGwKCiAgICA7IEVwaWxvZwogICAgbW92IHJzcCwgcmJwICAgICAgICA7IFJlc3RhdXJhciBlbCBwdW50ZXIgZGUgbGEgcGlsYQogICAgcG9wIHJicCAgICAgICAgICAgICA7IFJlc3RhdXJhciBlbCBwdW50ZXIgYmFzZQogICAgcmV0ICAgICAgICAgICAgICAgICA7IFJldG9ybmFyIGFsIGNyaWRhbnQ="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>section .data
    msg db 'Hola, M&oacute;n!', 0

section .text
    global _start

_start:
    call print_message
    ; Sortir del programa
    mov eax, 60         ; syscall: exit
    xor edi, edi        ; estat: 0
    syscall

print_message:
    ; Pr&ograve;leg
    push rbp            ; Guardar el punter base
    mov rbp, rsp        ; Configurar el punter base al punter de la pila

    ; Cos
    mov rax, 1          ; syscall: write
    mov rdi, 1          ; descriptor de fitxer: stdout
    mov rsi, msg        ; missatge a escriure
    mov rdx, 13         ; longitud del missatge
    syscall

    ; Epilog
    mov rsp, rbp        ; Restaurar el punter de la pila
    pop rbp             ; Restaurar el punter base
    ret                 ; Retornar al cridant</pre></div><div class='content'></div><h2>Explicació</h2>
<div class='content'><ul>
<li><strong>Pròleg</strong>: <code>push rbp</code> i <code>mov rbp, rsp</code> guarden el punter base i configuren el marc de la pila.</li>
<li><strong>Cos</strong>: El codi entre el pròleg i l'epilog realitza la tasca d'imprimir un missatge.</li>
<li><strong>Epilog</strong>: <code>mov rsp, rbp</code> i <code>pop rbp</code> restauren el punter de la pila i el punter base, i <code>ret</code> retorna el control al cridant.</li>
</ul>
</div><h1>Conceptes Avançats de Subrutines</h1>
<h2>Passar Arguments</h2>
<div class='content'><p>Els arguments es poden passar a les subrutines utilitzant registres o la pila. En x86-64, els primers sis arguments enters o punters es passen típicament en els registres <code>rdi</code>, <code>rsi</code>, <code>rdx</code>, <code>rcx</code>, <code>r8</code>, i <code>r9</code>.</p>
</div><h2>Exemple: Subrutina amb Arguments</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c2VjdGlvbiAudGV4dAogICAgZ2xvYmFsIF9zdGFydAoKX3N0YXJ0OgogICAgbW92IHJkaSwgNSAgICAgICAgICA7IFByaW1lciBhcmd1bWVudAogICAgbW92IHJzaSwgMyAgICAgICAgICA7IFNlZ29uIGFyZ3VtZW50CiAgICBjYWxsIGFkZF9udW1iZXJzCiAgICA7IFNvcnRpciBkZWwgcHJvZ3JhbWEKICAgIG1vdiBlYXgsIDYwICAgICAgICAgOyBzeXNjYWxsOiBleGl0CiAgICB4b3IgZWRpLCBlZGkgICAgICAgIDsgZXN0YXQ6IDAKICAgIHN5c2NhbGwKCmFkZF9udW1iZXJzOgogICAgOyBQcsOybGVnCiAgICBwdXNoIHJicAogICAgbW92IHJicCwgcnNwCgogICAgOyBDb3MKICAgIG1vdiByYXgsIHJkaSAgICAgICAgOyBDYXJyZWdhciBlbCBwcmltZXIgYXJndW1lbnQgYSByYXgKICAgIGFkZCByYXgsIHJzaSAgICAgICAgOyBBZmVnaXIgZWwgc2Vnb24gYXJndW1lbnQgYSByYXgKCiAgICA7IEVwaWxvZwogICAgbW92IHJzcCwgcmJwCiAgICBwb3AgcmJwCiAgICByZXQ="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>section .text
    global _start

_start:
    mov rdi, 5          ; Primer argument
    mov rsi, 3          ; Segon argument
    call add_numbers
    ; Sortir del programa
    mov eax, 60         ; syscall: exit
    xor edi, edi        ; estat: 0
    syscall

add_numbers:
    ; Pr&ograve;leg
    push rbp
    mov rbp, rsp

    ; Cos
    mov rax, rdi        ; Carregar el primer argument a rax
    add rax, rsi        ; Afegir el segon argument a rax

    ; Epilog
    mov rsp, rbp
    pop rbp
    ret</pre></div><div class='content'></div><h2>Explicació</h2>
<div class='content'><ul>
<li>Els arguments <code>5</code> i <code>3</code> es passen a la subrutina <code>add_numbers</code> utilitzant els registres <code>rdi</code> i <code>rsi</code>.</li>
<li>La subrutina suma aquests dos nombres i emmagatzema el resultat en <code>rax</code>.</li>
</ul>
</div><h2>Variables Locals</h2>
<div class='content'><p>Les variables locals es poden emmagatzemar a la pila. Això es fa ajustant el punter de la pila en el pròleg i l'epilog.</p>
</div><h2>Exemple: Subrutina amb Variables Locals</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c2VjdGlvbiAudGV4dAogICAgZ2xvYmFsIF9zdGFydAoKX3N0YXJ0OgogICAgY2FsbCBjYWxjdWxhdGUKICAgIDsgU29ydGlyIGRlbCBwcm9ncmFtYQogICAgbW92IGVheCwgNjAgICAgICAgICA7IHN5c2NhbGw6IGV4aXQKICAgIHhvciBlZGksIGVkaSAgICAgICAgOyBlc3RhdDogMAogICAgc3lzY2FsbAoKY2FsY3VsYXRlOgogICAgOyBQcsOybGVnCiAgICBwdXNoIHJicAogICAgbW92IHJicCwgcnNwCiAgICBzdWIgcnNwLCAxNiAgICAgICAgIDsgQXNzaWduYXIgZXNwYWkgcGVyIGEgdmFyaWFibGVzIGxvY2FscwoKICAgIDsgQ29zCiAgICBtb3YgZHdvcmQgW3JicC00XSwgMTAgICA7IFZhcmlhYmxlIGxvY2FsIHggPSAxMAogICAgbW92IGR3b3JkIFtyYnAtOF0sIDIwICAgOyBWYXJpYWJsZSBsb2NhbCB5ID0gMjAKICAgIG1vdiBlYXgsIFtyYnAtNF0gICAgICAgIDsgQ2FycmVnYXIgeCBhIGVheAogICAgYWRkIGVheCwgW3JicC04XSAgICAgICAgOyBBZmVnaXIgeSBhIGVheAoKICAgIDsgRXBpbG9nCiAgICBtb3YgcnNwLCByYnAKICAgIHBvcCByYnAKICAgIHJldA=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>section .text
    global _start

_start:
    call calculate
    ; Sortir del programa
    mov eax, 60         ; syscall: exit
    xor edi, edi        ; estat: 0
    syscall

calculate:
    ; Pr&ograve;leg
    push rbp
    mov rbp, rsp
    sub rsp, 16         ; Assignar espai per a variables locals

    ; Cos
    mov dword [rbp-4], 10   ; Variable local x = 10
    mov dword [rbp-8], 20   ; Variable local y = 20
    mov eax, [rbp-4]        ; Carregar x a eax
    add eax, [rbp-8]        ; Afegir y a eax

    ; Epilog
    mov rsp, rbp
    pop rbp
    ret</pre></div><div class='content'></div><h2>Explicació</h2>
<div class='content'><ul>
<li>El punter de la pila s'ajusta amb <code>sub rsp, 16</code> per assignar espai per a variables locals.</li>
<li>Les variables locals <code>x</code> i <code>y</code> s'emmagatzemen a <code>[rbp-4]</code> i <code>[rbp-8]</code>, respectivament.</li>
</ul>
</div><h1>Conclusió</h1>
<div class='content'><p>Les subrutines i procediments són essencials per escriure codi ensamblador modular i mantenible. Entenent com estructurar subrutines, passar arguments i utilitzar variables locals, pots crear programes més complexos i eficients. Practica escrivint i cridant subrutines per convertir-te en un expert en aquestes tècniques.</p>
</div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
       <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
       <a href="cookies">Més informació</a>
   </div>	
	</div>    
</body>
</html>
