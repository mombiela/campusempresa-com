<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funcions definides per l'usuari a PostgreSQL</title>

    <link rel="alternate" href="https://campusempresa.com/es/postgresql/user-defined-functions" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/postgresql/user-defined-functions" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/postgresql/user-defined-functions" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/ca/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui<br> i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="/es/postgresql/user-defined-functions" id="lnk_lang_es" data-lang="es" class="px-2">ES</a></b>
				|
				<b id="lit_lang_ca" class="px-2">CA</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/ca/objective">El Projecte</a>
				<a href="/ca/about">Sobre nosaltres</a>
				<a href="/ca/contribute">Contribuir</a>
				<a href="/ca/donate">Donacions</a>
				<a href="/ca/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='content'></div><h1>Introducció</h1>
<div class='content'><p>Les funcions definides per l'usuari (UDFs) a PostgreSQL permeten encapsular la lògica de codi reutilitzable dins de la base de dades. Això pot ajudar a millorar l'organització del codi, la mantenibilitat i el rendiment. En aquesta secció, cobrirem els conceptes bàsics de la creació i l'ús de les UDFs, progressant des d'exemples simples fins a casos d'ús més avançats.</p>
</div><h1>Conceptes clau</h1>
<div class='content'><ul>
<li><strong>Definició de funció</strong>: La sintaxi i l'estructura per definir una funció.</li>
<li><strong>Paràmetres de funció</strong>: Com passar valors d'entrada a les funcions.</li>
<li><strong>Tipus de retorn</strong>: Diferents tipus de valors que les funcions poden retornar.</li>
<li><strong>Opcions de llenguatge</strong>: Diversos llenguatges suportats per escriure funcions.</li>
<li><strong>Gestió d'errors</strong>: Tècniques per gestionar errors dins de les funcions.</li>
</ul>
</div><h1>Creació d'una funció simple</h1>
<div class='content'><p>Per crear una funció a PostgreSQL, s'utilitza la sentència <code>CREATE FUNCTION</code>. Aquí teniu un exemple bàsic:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIEZVTkNUSU9OIGFkZF9udW1iZXJzKGEgSU5URUdFUiwgYiBJTlRFR0VSKSAKUkVUVVJOUyBJTlRFR0VSIEFTICQkCkJFR0lOCiAgICBSRVRVUk4gYSArIGI7CkVORDsKJCQgTEFOR1VBR0UgcGxwZ3NxbDs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE FUNCTION add_numbers(a INTEGER, b INTEGER) 
RETURNS INTEGER AS $$
BEGIN
    RETURN a + b;
END;
$$ LANGUAGE plpgsql;</pre></div><div class='content'></div><h2>Explicació:</h2>
<div class='content'><ul>
<li><code>CREATE FUNCTION add_numbers(a INTEGER, b INTEGER)</code>: Defineix una funció anomenada <code>add_numbers</code> amb dos paràmetres enters, <code>a</code> i <code>b</code>.</li>
<li><code>RETURNS INTEGER</code>: Especifica que la funció retorna un enter.</li>
<li><code>AS $$ ... $$ LANGUAGE plpgsql</code>: El cos de la funció està tancat en <code>$$</code> i escrit en el llenguatge <code>plpgsql</code>.</li>
</ul>
</div><h2>Ús:</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIGFkZF9udW1iZXJzKDUsIDMpOyAgLS0gUmV0b3JuYSA4"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT add_numbers(5, 3);  -- Retorna 8</pre></div><div class='content'></div><h1>Paràmetres de funció</h1>
<div class='content'><p>Les funcions poden tenir diferents tipus de paràmetres, incloent valors per defecte i paràmetres variàdics.</p>
</div><h2>Paràmetres per defecte:</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIEZVTkNUSU9OIGdyZWV0KG5hbWUgVEVYVCBERUZBVUxUICdXb3JsZCcpIApSRVRVUk5TIFRFWFQgQVMgJCQKQkVHSU4KICAgIFJFVFVSTiAnSGVsbG8sICcgfHwgbmFtZSB8fCAnISc7CkVORDsKJCQgTEFOR1VBR0UgcGxwZ3NxbDs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE FUNCTION greet(name TEXT DEFAULT 'World') 
RETURNS TEXT AS $$
BEGIN
    RETURN 'Hello, ' || name || '!';
END;
$$ LANGUAGE plpgsql;</pre></div><div class='content'></div><h2>Ús:</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIGdyZWV0KCk7ICAgICAgICAgLS0gUmV0b3JuYSAnSGVsbG8sIFdvcmxkIScKU0VMRUNUIGdyZWV0KCdBbGljZScpOyAgLS0gUmV0b3JuYSAnSGVsbG8sIEFsaWNlISc="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT greet();         -- Retorna 'Hello, World!'
SELECT greet('Alice');  -- Retorna 'Hello, Alice!'</pre></div><div class='content'></div><h2>Paràmetres variàdics:</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIEZVTkNUSU9OIHN1bV9udW1iZXJzKFZBUklBRElDIG51bXMgSU5URUdFUltdKSAKUkVUVVJOUyBJTlRFR0VSIEFTICQkCkRFQ0xBUkUKICAgIHRvdGFsIElOVEVHRVIgOj0gMDsKQkVHSU4KICAgIEZPUkVBQ0ggbnVtIElOIEFSUkFZIG51bXMKICAgIExPT1AKICAgICAgICB0b3RhbCA6PSB0b3RhbCArIG51bTsKICAgIEVORCBMT09QOwogICAgUkVUVVJOIHRvdGFsOwpFTkQ7CiQkIExBTkdVQUdFIHBscGdzcWw7"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE FUNCTION sum_numbers(VARIADIC nums INTEGER[]) 
RETURNS INTEGER AS $$
DECLARE
    total INTEGER := 0;
BEGIN
    FOREACH num IN ARRAY nums
    LOOP
        total := total + num;
    END LOOP;
    RETURN total;
END;
$$ LANGUAGE plpgsql;</pre></div><div class='content'></div><h2>Ús:</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIHN1bV9udW1iZXJzKDEsIDIsIDMsIDQpOyAgLS0gUmV0b3JuYSAxMA=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT sum_numbers(1, 2, 3, 4);  -- Retorna 10</pre></div><div class='content'></div><h1>Tipus de retorn</h1>
<div class='content'><p>Les funcions poden retornar diversos tipus de valors, incloent valors escalars, tipus compostos i conjunts.</p>
</div><h2>Tipus de retorn escalar:</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIEZVTkNUSU9OIG11bHRpcGx5KGEgSU5URUdFUiwgYiBJTlRFR0VSKSAKUkVUVVJOUyBJTlRFR0VSIEFTICQkCkJFR0lOCiAgICBSRVRVUk4gYSAqIGI7CkVORDsKJCQgTEFOR1VBR0UgcGxwZ3NxbDs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE FUNCTION multiply(a INTEGER, b INTEGER) 
RETURNS INTEGER AS $$
BEGIN
    RETURN a * b;
END;
$$ LANGUAGE plpgsql;</pre></div><div class='content'></div><h2>Tipus de retorn compost:</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIFRZUEUgcGVyc29uIEFTIChmaXJzdF9uYW1lIFRFWFQsIGxhc3RfbmFtZSBURVhUKTsKCkNSRUFURSBGVU5DVElPTiBnZXRfcGVyc29uKCkgClJFVFVSTlMgcGVyc29uIEFTICQkCkJFR0lOCiAgICBSRVRVUk4gKCdKb2huJywgJ0RvZScpOwpFTkQ7CiQkIExBTkdVQUdFIHBscGdzcWw7"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE TYPE person AS (first_name TEXT, last_name TEXT);

CREATE FUNCTION get_person() 
RETURNS person AS $$
BEGIN
    RETURN ('John', 'Doe');
END;
$$ LANGUAGE plpgsql;</pre></div><div class='content'></div><h2>Tipus de retorn de conjunt:</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIEZVTkNUSU9OIGdlbmVyYXRlX3NlcmllcyhzdGFydCBJTlRFR0VSLCBzdG9wIElOVEVHRVIpIApSRVRVUk5TIFNFVE9GIElOVEVHRVIgQVMgJCQKQkVHSU4KICAgIEZPUiBpIElOIHN0YXJ0Li5zdG9wIExPT1AKICAgICAgICBSRVRVUk4gTkVYVCBpOwogICAgRU5EIExPT1A7CiAgICBSRVRVUk47CkVORDsKJCQgTEFOR1VBR0UgcGxwZ3NxbDs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE FUNCTION generate_series(start INTEGER, stop INTEGER) 
RETURNS SETOF INTEGER AS $$
BEGIN
    FOR i IN start..stop LOOP
        RETURN NEXT i;
    END LOOP;
    RETURN;
END;
$$ LANGUAGE plpgsql;</pre></div><div class='content'></div><h2>Ús:</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUICogRlJPTSBnZW5lcmF0ZV9zZXJpZXMoMSwgNSk7ICAtLSBSZXRvcm5hIDEsIDIsIDMsIDQsIDU="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT * FROM generate_series(1, 5);  -- Retorna 1, 2, 3, 4, 5</pre></div><div class='content'></div><h1>Opcions de llenguatge</h1>
<div class='content'><p>PostgreSQL suporta múltiples llenguatges per escriure funcions, incloent SQL, PL/pgSQL, PL/Python, PL/Perl, i més.</p>
</div><h2>Llenguatge SQL:</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIEZVTkNUSU9OIGFkZF9zcWwoYSBJTlRFR0VSLCBiIElOVEVHRVIpIApSRVRVUk5TIElOVEVHRVIgQVMgJCQKICAgIFNFTEVDVCBhICsgYjsKJCQgTEFOR1VBR0Ugc3FsOw=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE FUNCTION add_sql(a INTEGER, b INTEGER) 
RETURNS INTEGER AS $$
    SELECT a + b;
$$ LANGUAGE sql;</pre></div><div class='content'></div><h2>Llenguatge PL/Python:</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIEZVTkNUSU9OIGFkZF9weXRob24oYSBJTlRFR0VSLCBiIElOVEVHRVIpIApSRVRVUk5TIElOVEVHRVIgQVMgJCQKICAgIHJldHVybiBhICsgYgokJCBMQU5HVUFHRSBwbHB5dGhvbnU7"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE FUNCTION add_python(a INTEGER, b INTEGER) 
RETURNS INTEGER AS $$
    return a + b
$$ LANGUAGE plpythonu;</pre></div><div class='content'></div><h1>Gestió d'errors</h1>
<div class='content'><p>La gestió d'errors en funcions és crucial per a aplicacions robustes. Es poden utilitzar blocs <code>EXCEPTION</code> per capturar i gestionar errors.</p>
</div><h2>Exemple:</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIEZVTkNUSU9OIGRpdmlkZShhIElOVEVHRVIsIGIgSU5URUdFUikgClJFVFVSTlMgSU5URUdFUiBBUyAkJApCRUdJTgogICAgUkVUVVJOIGEgLyBiOwpFWENFUFRJT04KICAgIFdIRU4gZGl2aXNpb25fYnlfemVybyBUSEVOCiAgICAgICAgUkVUVVJOIE5VTEw7CkVORDsKJCQgTEFOR1VBR0UgcGxwZ3NxbDs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE FUNCTION divide(a INTEGER, b INTEGER) 
RETURNS INTEGER AS $$
BEGIN
    RETURN a / b;
EXCEPTION
    WHEN division_by_zero THEN
        RETURN NULL;
END;
$$ LANGUAGE plpgsql;</pre></div><div class='content'></div><h2>Ús:</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIGRpdmlkZSgxMCwgMik7ICAtLSBSZXRvcm5hIDUKU0VMRUNUIGRpdmlkZSgxMCwgMCk7ICAtLSBSZXRvcm5hIE5VTEw="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT divide(10, 2);  -- Retorna 5
SELECT divide(10, 0);  -- Retorna NULL</pre></div><div class='content'></div><h1>Conclusió</h1>
<div class='content'><p>Les funcions definides per l'usuari a PostgreSQL proporcionen una manera poderosa d'encapsular i reutilitzar la lògica dins de la vostra base de dades. Entenent els conceptes bàsics de la creació de funcions, la gestió de paràmetres, els tipus de retorn, les opcions de llenguatge i la gestió d'errors, podeu escriure codi de base de dades eficient i fàcil de mantenir. Practiqueu la creació i l'ús de funcions per esdevenir proficient en l'aprofitament d'aquesta característica a PostgreSQL.</p>
</div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/ca/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
