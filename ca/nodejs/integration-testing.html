<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proves d'Integració en Node.js</title>

    <link rel="alternate" href="https://campusempresa.com/es/nodejs/integration-testing" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/nodejs/integration-testing" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/nodejs/integration-testing" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/ca/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="/es/nodejs/integration-testing" id="lnk_lang_es" data-lang="es" class="px-2">ES</a></b>
				|
				<b id="lit_lang_ca" class="px-2">CA</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/ca/objective">El Projecte</a>
				<a href="/ca/about">Sobre nosaltres</a>
				<a href="/ca/contribute">Contribuir</a>
				<a href="/ca/donate">Donacions</a>
				<a href="/ca/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'><div class='col-6'><a href='unit-testing-mocha-chai'>&#x25C4; Proves Unitàries amb Mocha i Chai</a></div><div class='col-6 text-end'><a href='debugging-nodejs'>Depurant Aplicacions Node.js &#x25BA;</a></div></div><div class='content'><p>Les proves d'integració són una part crucial del cicle de vida del desenvolupament de programari. Asseguren que diferents mòduls o serveis de la teva aplicació funcionin junts com s'espera. Aquest tema et guiarà des dels conceptes bàsics fins als avançats de les proves d'integració en Node.js.</p>
</div><h1>Què són les Proves d'Integració?</h1>
<div class='content'><ul>
<li><strong>Definició</strong>: Les proves d'integració són un nivell de proves de programari on les unitats individuals es combinen i es proven com un grup.</li>
<li><strong>Propòsit</strong>: Identificar problemes en la interacció entre unitats integrades.</li>
<li><strong>Abast</strong>: Va més enllà de les proves unitàries centrant-se en la comunicació entre mòduls.</li>
</ul>
</div><h1>Per què són Importants les Proves d'Integració</h1>
<div class='content'><ul>
<li><strong>Detecta Problemes d'Interfície</strong>: Ajuda a identificar problemes en la interacció entre diferents mòduls.</li>
<li><strong>Assegura la Integritat de les Dades</strong>: Verifica que les dades es passen correctament entre mòduls.</li>
<li><strong>Millora la Qualitat del Codi</strong>: Millora la qualitat general del codi detectant errors en les primeres etapes del procés de desenvolupament.</li>
</ul>
</div><h1>Eines per a les Proves d'Integració en Node.js</h1>
<div class='content'><ul>
<li><strong>Mocha</strong>: Un marc de proves de JavaScript ric en funcionalitats que s'executa en Node.js.</li>
<li><strong>Chai</strong>: Una biblioteca d'asserts BDD / TDD per a Node.js.</li>
<li><strong>Supertest</strong>: Una biblioteca per provar servidors HTTP de Node.js.</li>
</ul>
</div><h1>Configuració del Teu Entorn</h1>
<div class='content'><p>Per començar amb les proves d'integració en Node.js, necessites configurar el teu entorn amb les eines necessàries.</p>
</div><h2>Instal·lació de Mocha, Chai, i Supertest</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bnBtIGluc3RhbGwgLS1zYXZlLWRldiBtb2NoYSBjaGFpIHN1cGVydGVzdA=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>npm install --save-dev mocha chai supertest</pre></div><div class='content'></div><h2>Estructura Bàsica del Projecte</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bXktbm9kZS1hcHAvCuKUnOKUgOKUgCBhcHAuanMK4pSc4pSA4pSAIHBhY2thZ2UuanNvbgrilJzilIDilIAgdGVzdC8K4pSCICAg4pSU4pSA4pSAIGludGVncmF0aW9uLwrilIIgICAgICAg4pSU4pSA4pSAIGFwcC50ZXN0Lmpz"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>my-node-app/
├── app.js
├── package.json
├── test/
│   └── integration/
│       └── app.test.js</pre></div><div class='content'></div><h1>Escriure la Teva Primera Prova d'Integració</h1>
<div class='content'><p>Escrivim una prova d'integració simple per a una aplicació Node.js.</p>
</div><h2>Aplicació d'Exemple (app.js)</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTsKY29uc3QgYXBwID0gZXhwcmVzcygpOwoKYXBwLmdldCgnL2FwaS9oZWxsbycsIChyZXEsIHJlcykgPT4gewogIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgbWVzc2FnZTogJ0hlbGxvLCB3b3JsZCEnIH0pOwp9KTsKCm1vZHVsZS5leHBvcnRzID0gYXBwOw=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const express = require('express');
const app = express();

app.get('/api/hello', (req, res) =&gt; {
  res.status(200).json({ message: 'Hello, world!' });
});

module.exports = app;</pre></div><div class='content'></div><h2>Prova d'Integració (test/integration/app.test.js)</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgcmVxdWVzdCA9IHJlcXVpcmUoJ3N1cGVydGVzdCcpOwpjb25zdCBhcHAgPSByZXF1aXJlKCcuLi8uLi9hcHAnKTsKY29uc3QgY2hhaSA9IHJlcXVpcmUoJ2NoYWknKTsKY29uc3QgZXhwZWN0ID0gY2hhaS5leHBlY3Q7CgpkZXNjcmliZSgnR0VUIC9hcGkvaGVsbG8nLCAoKSA9PiB7CiAgaXQoJ3Nob3VsZCByZXR1cm4gYSBtZXNzYWdlICJIZWxsbywgd29ybGQhIicsIChkb25lKSA9PiB7CiAgICByZXF1ZXN0KGFwcCkKICAgICAgLmdldCgnL2FwaS9oZWxsbycpCiAgICAgIC5lbmQoKGVyciwgcmVzKSA9PiB7CiAgICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvLmVxdWFsKDIwMCk7CiAgICAgICAgZXhwZWN0KHJlcy5ib2R5Lm1lc3NhZ2UpLnRvLmVxdWFsKCdIZWxsbywgd29ybGQhJyk7CiAgICAgICAgZG9uZSgpOwogICAgICB9KTsKICB9KTsKfSk7"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const request = require('supertest');
const app = require('../../app');
const chai = require('chai');
const expect = chai.expect;

describe('GET /api/hello', () =&gt; {
  it('should return a message &quot;Hello, world!&quot;', (done) =&gt; {
    request(app)
      .get('/api/hello')
      .end((err, res) =&gt; {
        expect(res.status).to.equal(200);
        expect(res.body.message).to.equal('Hello, world!');
        done();
      });
  });
});</pre></div><div class='content'></div><h2>Explicació</h2>
<div class='content'><ul>
<li><strong>Configuració</strong>: Importa els mòduls necessaris (<code>supertest</code>, <code>chai</code>, i l'aplicació).</li>
<li><strong>Cas de Prova</strong>: Descriu el cas de prova utilitzant blocs <code>describe</code> i <code>it</code>.</li>
<li><strong>Petició</strong>: Utilitza <code>supertest</code> per fer una petició GET a <code>/api/hello</code>.</li>
<li><strong>Asserts</strong>: Utilitza <code>chai</code> per fer asserts sobre l'estat i el cos de la resposta.</li>
</ul>
</div><h1>Conceptes Avançats de Proves d'Integració</h1>
<div class='content'></div><h2>Proves amb Bases de Dades</h2>
<div class='content'><p>Quan la teva aplicació interactua amb una base de dades, necessites assegurar-te que les teves proves d'integració cobreixin aquestes interaccions.</p>
<h4>Exemple amb MongoDB</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpOwpjb25zdCBVc2VyID0gcmVxdWlyZSgnLi4vLi4vbW9kZWxzL3VzZXInKTsKCmJlZm9yZSgoZG9uZSkgPT4gewogIG1vbmdvb3NlLmNvbm5lY3QoJ21vbmdvZGI6Ly9sb2NhbGhvc3QvdGVzdGRiJywgeyB1c2VOZXdVcmxQYXJzZXI6IHRydWUsIHVzZVVuaWZpZWRUb3BvbG9neTogdHJ1ZSB9KTsKICBtb25nb29zZS5jb25uZWN0aW9uLm9uY2UoJ29wZW4nLCAoKSA9PiBkb25lKCkpLm9uKCdlcnJvcicsIChlcnJvcikgPT4gY29uc29sZS53YXJuKCdFcnJvcicsIGVycm9yKSk7Cn0pOwoKYWZ0ZXIoKGRvbmUpID0+IHsKICBtb25nb29zZS5jb25uZWN0aW9uLmNsb3NlKCgpID0+IGRvbmUoKSk7Cn0pOwoKZGVzY3JpYmUoJ1BPU1QgL2FwaS91c2VycycsICgpID0+IHsKICBpdCgnc2hvdWxkIGNyZWF0ZSBhIG5ldyB1c2VyJywgKGRvbmUpID0+IHsKICAgIGNvbnN0IHVzZXIgPSB7IG5hbWU6ICdKb2huIERvZScsIGVtYWlsOiAnam9obkBleGFtcGxlLmNvbScgfTsKICAgIHJlcXVlc3QoYXBwKQogICAgICAucG9zdCgnL2FwaS91c2VycycpCiAgICAgIC5zZW5kKHVzZXIpCiAgICAgIC5lbmQoKGVyciwgcmVzKSA9PiB7CiAgICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvLmVxdWFsKDIwMSk7CiAgICAgICAgZXhwZWN0KHJlcy5ib2R5Lm5hbWUpLnRvLmVxdWFsKCdKb2huIERvZScpOwogICAgICAgIGRvbmUoKTsKICAgICAgfSk7CiAgfSk7Cn0pOw=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const mongoose = require('mongoose');
const User = require('../../models/user');

before((done) =&gt; {
  mongoose.connect('mongodb://localhost/testdb', { useNewUrlParser: true, useUnifiedTopology: true });
  mongoose.connection.once('open', () =&gt; done()).on('error', (error) =&gt; console.warn('Error', error));
});

after((done) =&gt; {
  mongoose.connection.close(() =&gt; done());
});

describe('POST /api/users', () =&gt; {
  it('should create a new user', (done) =&gt; {
    const user = { name: 'John Doe', email: 'john@example.com' };
    request(app)
      .post('/api/users')
      .send(user)
      .end((err, res) =&gt; {
        expect(res.status).to.equal(201);
        expect(res.body.name).to.equal('John Doe');
        done();
      });
  });
});</pre></div><div class='content'></div><h2>Simulació de Serveis Externs</h2>
<div class='content'><p>De vegades, la teva aplicació pot dependre de serveis externs. Pots utilitzar biblioteques com <code>nock</code> per simular aquests serveis.</p>
<h4>Exemple amb Nock</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3Qgbm9jayA9IHJlcXVpcmUoJ25vY2snKTsKCmRlc2NyaWJlKCdHRVQgL2FwaS9leHRlcm5hbCcsICgpID0+IHsKICBiZWZvcmUoKCkgPT4gewogICAgbm9jaygnaHR0cHM6Ly9leHRlcm5hbC1zZXJ2aWNlLmNvbScpCiAgICAgIC5nZXQoJy9kYXRhJykKICAgICAgLnJlcGx5KDIwMCwgeyBkYXRhOiAnbW9ja2VkIGRhdGEnIH0pOwogIH0pOwoKICBpdCgnc2hvdWxkIHJldHVybiBtb2NrZWQgZGF0YSBmcm9tIGV4dGVybmFsIHNlcnZpY2UnLCAoZG9uZSkgPT4gewogICAgcmVxdWVzdChhcHApCiAgICAgIC5nZXQoJy9hcGkvZXh0ZXJuYWwnKQogICAgICAuZW5kKChlcnIsIHJlcykgPT4gewogICAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50by5lcXVhbCgyMDApOwogICAgICAgIGV4cGVjdChyZXMuYm9keS5kYXRhKS50by5lcXVhbCgnbW9ja2VkIGRhdGEnKTsKICAgICAgICBkb25lKCk7CiAgICAgIH0pOwogIH0pOwp9KTs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const nock = require('nock');

describe('GET /api/external', () =&gt; {
  before(() =&gt; {
    nock('https://external-service.com')
      .get('/data')
      .reply(200, { data: 'mocked data' });
  });

  it('should return mocked data from external service', (done) =&gt; {
    request(app)
      .get('/api/external')
      .end((err, res) =&gt; {
        expect(res.status).to.equal(200);
        expect(res.body.data).to.equal('mocked data');
        done();
      });
  });
});</pre></div><div class='content'></div><h1>Conclusió</h1>
<div class='content'><p>Les proves d'integració són essencials per assegurar que diferents parts de la teva aplicació funcionin juntes sense problemes. Utilitzant eines com Mocha, Chai, i Supertest, pots escriure proves d'integració efectives per a les teves aplicacions Node.js. A mesura que avancis, considera provar interaccions amb bases de dades i simular serveis externs per cobrir tots els aspectes de la teva aplicació.</p>
<p>Seguint aquestes pràctiques, pots millorar la fiabilitat i la qualitat de les teves aplicacions Node.js, fent-les més robustes i mantenibles.</p>
</div><div class='row navigation'><div class='col-6'><a href='unit-testing-mocha-chai'>&#x25C4; Proves Unitàries amb Mocha i Chai</a></div><div class='col-6 text-end'><a href='debugging-nodejs'>Depurant Aplicacions Node.js &#x25BA;</a></div></div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/ca/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
