<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processament de Fluxos amb Estat</title>

    <link rel="alternate" href="https://campusempresa.com/es/apachespark/stateful-stream-processing" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/apachespark/stateful-stream-processing" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/apachespark/stateful-stream-processing" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/ca/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui<br> i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="/es/apachespark/stateful-stream-processing" id="lnk_lang_es" data-lang="es" class="px-2">ES</a></b>
				|
				<b id="lit_lang_ca" class="px-2">CA</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/ca/objective">El Projecte</a>
				<a href="/ca/about">Sobre nosaltres</a>
				<a href="/ca/contribute">Contribuir</a>
				<a href="/ca/donate">Donacions</a>
				<a href="/ca/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='content'><p>El processament de fluxos amb estat és una característica poderosa d'Apache Spark que et permet mantenir i actualitzar informació d'estat a través de múltiples registres en un flux. Això és crucial per a aplicacions que necessiten fer un seguiment de la informació al llarg del temps, com ara la sessió, l'analítica en temps real i el monitoratge.</p>
</div><h1>Introducció al Processament de Fluxos amb Estat</h1>
<div class='content'><p>El processament de fluxos amb estat implica mantenir informació d'estat a través de múltiples registres en un flux. Aquest estat es pot actualitzar i consultar a mesura que arriben noves dades.</p>
<ul>
<li><strong>Estat</strong>: Informació que es manté a través de múltiples registres.</li>
<li><strong>Operacions amb Estat</strong>: Operacions que actualitzen i consulten l'estat.</li>
</ul>
</div><h1>Conceptes Clau</h1>
<div class='content'><ul>
<li><strong>Estat</strong>: La informació emmagatzemada que es pot actualitzar i consultar.</li>
<li><strong>Transformació amb Estat</strong>: Transformacions que impliquen estat, com ara <code>mapWithState</code> i <code>updateStateByKey</code>.</li>
<li><strong>Checkpointing</strong>: Mecanisme per guardar l'estat periòdicament per assegurar la tolerància a fallades.</li>
</ul>
</div><h1>Transformacions amb Estat</h1>
<div class='content'></div><h2>`mapWithState`</h2>
<div class='content'><p>L'operació <code>mapWithState</code> et permet mantenir i actualitzar informació d'estat per a cada clau en un DStream.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3RyZWFtaW5nLl8KaW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3RyZWFtaW5nLlN0cmVhbWluZ0NvbnRleHQuXwppbXBvcnQgb3JnLmFwYWNoZS5zcGFyay5zdHJlYW1pbmcuZHN0cmVhbS5fCgp2YWwgY29uZiA9IG5ldyBTcGFya0NvbmYoKS5zZXRNYXN0ZXIoImxvY2FsWzJdIikuc2V0QXBwTmFtZSgiU3RhdGVmdWxOZXR3b3JrV29yZENvdW50IikKdmFsIHNzYyA9IG5ldyBTdHJlYW1pbmdDb250ZXh0KGNvbmYsIFNlY29uZHMoMSkpCgovLyBSREQgZCdlc3RhdCBpbmljaWFsCnZhbCBpbml0aWFsUkREID0gc3NjLnNwYXJrQ29udGV4dC5wYXJhbGxlbGl6ZShMaXN0KCgiaGVsbG8iLCAxKSwgKCJ3b3JsZCIsIDEpKSkKCi8vIEZ1bmNpw7MgcGVyIGFjdHVhbGl0emFyIGwnZXN0YXQKZGVmIG1hcHBpbmdGdW5jdGlvbihiYXRjaFRpbWU6IFRpbWUsIGtleTogU3RyaW5nLCB2YWx1ZTogT3B0aW9uW0ludF0sIHN0YXRlOiBTdGF0ZVtJbnRdKTogT3B0aW9uWyhTdHJpbmcsIEludCldID0gewogIHZhbCBzdW0gPSB2YWx1ZS5nZXRPckVsc2UoMCkgKyBzdGF0ZS5nZXRPcHRpb24uZ2V0T3JFbHNlKDApCiAgdmFsIG91dHB1dCA9IChrZXksIHN1bSkKICBzdGF0ZS51cGRhdGUoc3VtKQogIFNvbWUob3V0cHV0KQp9Cgp2YWwgbGluZXMgPSBzc2Muc29ja2V0VGV4dFN0cmVhbSgibG9jYWxob3N0IiwgOTk5OSkKdmFsIHdvcmRzID0gbGluZXMuZmxhdE1hcChfLnNwbGl0KCIgIikpCnZhbCB3b3JkRHN0cmVhbSA9IHdvcmRzLm1hcCh3b3JkID0+ICh3b3JkLCAxKSkKCnZhbCBzdGF0ZURzdHJlYW0gPSB3b3JkRHN0cmVhbS5tYXBXaXRoU3RhdGUoU3RhdGVTcGVjLmZ1bmN0aW9uKG1hcHBpbmdGdW5jdGlvbikuaW5pdGlhbFN0YXRlKGluaXRpYWxSREQpKQpzdGF0ZURzdHJlYW0ucHJpbnQoKQoKc3NjLnN0YXJ0KCkKc3NjLmF3YWl0VGVybWluYXRpb24oKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.apache.spark.streaming._
import org.apache.spark.streaming.StreamingContext._
import org.apache.spark.streaming.dstream._

val conf = new SparkConf().setMaster(&quot;local[2]&quot;).setAppName(&quot;StatefulNetworkWordCount&quot;)
val ssc = new StreamingContext(conf, Seconds(1))

// RDD d'estat inicial
val initialRDD = ssc.sparkContext.parallelize(List((&quot;hello&quot;, 1), (&quot;world&quot;, 1)))

// Funci&oacute; per actualitzar l'estat
def mappingFunction(batchTime: Time, key: String, value: Option[Int], state: State[Int]): Option[(String, Int)] = {
  val sum = value.getOrElse(0) + state.getOption.getOrElse(0)
  val output = (key, sum)
  state.update(sum)
  Some(output)
}

val lines = ssc.socketTextStream(&quot;localhost&quot;, 9999)
val words = lines.flatMap(_.split(&quot; &quot;))
val wordDstream = words.map(word =&gt; (word, 1))

val stateDstream = wordDstream.mapWithState(StateSpec.function(mappingFunction).initialState(initialRDD))
stateDstream.print()

ssc.start()
ssc.awaitTermination()</pre></div><div class='content'></div><h2>`updateStateByKey`</h2>
<div class='content'><p>L'operació <code>updateStateByKey</code> et permet mantenir l'estat a través de lots de dades.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3RyZWFtaW5nLl8KaW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3RyZWFtaW5nLlN0cmVhbWluZ0NvbnRleHQuXwoKdmFsIGNvbmYgPSBuZXcgU3BhcmtDb25mKCkuc2V0TWFzdGVyKCJsb2NhbFsyXSIpLnNldEFwcE5hbWUoIlN0YXRlZnVsTmV0d29ya1dvcmRDb3VudCIpCnZhbCBzc2MgPSBuZXcgU3RyZWFtaW5nQ29udGV4dChjb25mLCBTZWNvbmRzKDEpKQoKLy8gRnVuY2nDsyBwZXIgYWN0dWFsaXR6YXIgbCdlc3RhdApkZWYgdXBkYXRlRnVuY3Rpb24obmV3VmFsdWVzOiBTZXFbSW50XSwgcnVubmluZ0NvdW50OiBPcHRpb25bSW50XSk6IE9wdGlvbltJbnRdID0gewogIHZhbCBuZXdDb3VudCA9IHJ1bm5pbmdDb3VudC5nZXRPckVsc2UoMCkgKyBuZXdWYWx1ZXMuc3VtCiAgU29tZShuZXdDb3VudCkKfQoKc3NjLmNoZWNrcG9pbnQoImNoZWNrcG9pbnQiKQoKdmFsIGxpbmVzID0gc3NjLnNvY2tldFRleHRTdHJlYW0oImxvY2FsaG9zdCIsIDk5OTkpCnZhbCB3b3JkcyA9IGxpbmVzLmZsYXRNYXAoXy5zcGxpdCgiICIpKQp2YWwgd29yZERzdHJlYW0gPSB3b3Jkcy5tYXAod29yZCA9PiAod29yZCwgMSkpCgp2YWwgc3RhdGVEc3RyZWFtID0gd29yZERzdHJlYW0udXBkYXRlU3RhdGVCeUtleSh1cGRhdGVGdW5jdGlvbikKc3RhdGVEc3RyZWFtLnByaW50KCkKCnNzYy5zdGFydCgpCnNzYy5hd2FpdFRlcm1pbmF0aW9uKCk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.apache.spark.streaming._
import org.apache.spark.streaming.StreamingContext._

val conf = new SparkConf().setMaster(&quot;local[2]&quot;).setAppName(&quot;StatefulNetworkWordCount&quot;)
val ssc = new StreamingContext(conf, Seconds(1))

// Funci&oacute; per actualitzar l'estat
def updateFunction(newValues: Seq[Int], runningCount: Option[Int]): Option[Int] = {
  val newCount = runningCount.getOrElse(0) + newValues.sum
  Some(newCount)
}

ssc.checkpoint(&quot;checkpoint&quot;)

val lines = ssc.socketTextStream(&quot;localhost&quot;, 9999)
val words = lines.flatMap(_.split(&quot; &quot;))
val wordDstream = words.map(word =&gt; (word, 1))

val stateDstream = wordDstream.updateStateByKey(updateFunction)
stateDstream.print()

ssc.start()
ssc.awaitTermination()</pre></div><div class='content'></div><h1>Checkpointing</h1>
<div class='content'><p>El checkpointing és essencial per a la tolerància a fallades en el processament de fluxos amb estat. Guarda l'estat del flux periòdicament en un emmagatzematge fiable.</p>
<ul>
<li><strong>Directori de Checkpoint</strong>: Un directori en HDFS o un sistema de fitxers distribuït similar on es guarda l'estat.</li>
<li><strong>Interval de Checkpoint</strong>: La freqüència amb què es guarda l'estat.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c3NjLmNoZWNrcG9pbnQoImhkZnM6Ly9jaGVja3BvaW50LWRpcmVjdG9yeSIp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ssc.checkpoint(&quot;hdfs://checkpoint-directory&quot;)</pre></div><div class='content'></div><h1>Resum</h1>
<div class='content'><p>El processament de fluxos amb estat en Apache Spark et permet mantenir i actualitzar informació d'estat a través de múltiples registres en un flux. Les operacions clau inclouen <code>mapWithState</code> i <code>updateStateByKey</code>, que et permeten realitzar transformacions complexes que depenen de dades històriques. El checkpointing assegura la tolerància a fallades guardant periòdicament l'estat en un emmagatzematge fiable.</p>
<p>Entenent i utilitzant aquests conceptes, pots construir aplicacions de fluxos amb estat robustes que poden gestionar els requisits de processament de dades en temps real de manera efectiva.</p>
</div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/ca/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
