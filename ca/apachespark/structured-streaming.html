<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streaming estructurat a Apache Spark</title>

    <link rel="alternate" href="https://campusempresa.com/es/apachespark/structured-streaming" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/apachespark/structured-streaming" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/apachespark/structured-streaming" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/ca/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="/es/apachespark/structured-streaming" id="lnk_lang_es" data-lang="es" class="px-2">ES</a></b>
				|
				<b id="lit_lang_ca" class="px-2">CA</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/ca/objective">El Projecte</a>
				<a href="/ca/about">Sobre nosaltres</a>
				<a href="/ca/contribute">Contribuir</a>
				<a href="/ca/donate">Donacions</a>
				<a href="/ca/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'><div class='col-6'><a href='stateful-stream-processing'>&#x25C4; Processament de Fluxos amb Estat</a></div><div class='col-6 text-end'><a href='introduction-to-spark-mllib'>Introducció a Spark MLlib &#x25BA;</a></div></div><div class='content'></div><h1>Introducció al streaming estructurat</h1>
<div class='content'><p>El streaming estructurat és un motor de processament de fluxos escalable i tolerant a fallades construït sobre el motor Spark SQL. Et permet expressar càlculs de streaming de la mateixa manera que expressaries càlculs per lots en dades estàtiques.</p>
</div><h2>Conceptes clau</h2>
<div class='content'><ul>
<li><strong>Dades il·limitades</strong>: Dades que arriben contínuament al llarg del temps.</li>
<li><strong>Consulta de streaming</strong>: Una consulta contínua que processa dades de streaming.</li>
<li><strong>Trigger</strong>: Defineix el moment del processament de dades de streaming.</li>
<li><strong>Operacions amb estat</strong>: Operacions que mantenen l'estat a través de lots de dades.</li>
</ul>
</div><h1>Configuració del streaming estructurat</h1>
<div class='content'><p>Abans d'entrar en el codi, assegura't de tenir l'entorn necessari configurat:</p>
<ul>
<li>Apache Spark instal·lat.</li>
<li>Un entorn de desenvolupament com Jupyter Notebook o un IDE (per exemple, IntelliJ IDEA).</li>
</ul>
</div><h2>Exemple de codi de configuració</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBweXNwYXJrLnNxbCBpbXBvcnQgU3BhcmtTZXNzaW9uCgojIENyZWFyIHVuYSBzZXNzacOzIFNwYXJrCnNwYXJrID0gU3BhcmtTZXNzaW9uLmJ1aWxkZXIgXAogICAgLmFwcE5hbWUoIlN0cnVjdHVyZWRTdHJlYW1pbmdFeGFtcGxlIikgXAogICAgLmdldE9yQ3JlYXRlKCk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from pyspark.sql import SparkSession

# Crear una sessi&oacute; Spark
spark = SparkSession.builder \
    .appName(&quot;StructuredStreamingExample&quot;) \
    .getOrCreate()</pre></div><div class='content'></div><h1>Operacions bàsiques</h1>
<h2>Llegir d'un flux</h2>
<div class='content'><p>El streaming estructurat suporta diverses fonts de dades com Kafka, fitxers i sockets.</p>
<h4>Exemple: Llegir d'un socket</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBMbGVnaXIgZGFkZXMgZGUgc3RyZWFtaW5nIGQndW4gc29ja2V0CmxpbmVzID0gc3BhcmsucmVhZFN0cmVhbSBcCiAgICAuZm9ybWF0KCJzb2NrZXQiKSBcCiAgICAub3B0aW9uKCJob3N0IiwgImxvY2FsaG9zdCIpIFwKICAgIC5vcHRpb24oInBvcnQiLCA5OTk5KSBcCiAgICAubG9hZCgpCgojIE1vc3RyYXIgbCdlc3F1ZW1hIGRlbCBEYXRhRnJhbWUKbGluZXMucHJpbnRTY2hlbWEoKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Llegir dades de streaming d'un socket
lines = spark.readStream \
    .format(&quot;socket&quot;) \
    .option(&quot;host&quot;, &quot;localhost&quot;) \
    .option(&quot;port&quot;, 9999) \
    .load()

# Mostrar l'esquema del DataFrame
lines.printSchema()</pre></div><div class='content'></div><h2>Escriure a un flux</h2>
<div class='content'><p>Pots escriure la sortida d'una consulta de streaming a diversos destins com la consola, fitxers o Kafka.</p>
<h4>Exemple: Escriure a la consola</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBFc2NyaXVyZSBsZXMgZGFkZXMgZGUgc3RyZWFtaW5nIGEgbGEgY29uc29sYQpxdWVyeSA9IGxpbmVzLndyaXRlU3RyZWFtIFwKICAgIC5vdXRwdXRNb2RlKCJhcHBlbmQiKSBcCiAgICAuZm9ybWF0KCJjb25zb2xlIikgXAogICAgLnN0YXJ0KCkKCiMgRXNwZXJhciBsYSB0ZXJtaW5hY2nDsyBkZSBsYSBjb25zdWx0YQpxdWVyeS5hd2FpdFRlcm1pbmF0aW9uKCk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Escriure les dades de streaming a la consola
query = lines.writeStream \
    .outputMode(&quot;append&quot;) \
    .format(&quot;console&quot;) \
    .start()

# Esperar la terminaci&oacute; de la consulta
query.awaitTermination()</pre></div><div class='content'></div><h1>Transformacions en dades de streaming</h1>
<div class='content'><p>El streaming estructurat et permet aplicar diverses transformacions en dades de streaming.</p>
</div><h2>Exemple: Comptar paraules</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBweXNwYXJrLnNxbC5mdW5jdGlvbnMgaW1wb3J0IGV4cGxvZGUsIHNwbGl0CgojIERpdmlkaXIgbGVzIGzDrW5pZXMgZW4gcGFyYXVsZXMKd29yZHMgPSBsaW5lcy5zZWxlY3QoCiAgICBleHBsb2RlKAogICAgICAgIHNwbGl0KGxpbmVzLnZhbHVlLCAiICIpCiAgICApLmFsaWFzKCJ3b3JkIikKKQoKIyBDb21wdGFyIGxlcyBvY3VycsOobmNpZXMgZGUgY2FkYSBwYXJhdWxhCndvcmRDb3VudHMgPSB3b3Jkcy5ncm91cEJ5KCJ3b3JkIikuY291bnQoKQoKIyBFc2NyaXVyZSBlbCByZWNvbXB0ZSBkZSBwYXJhdWxlcyBhIGxhIGNvbnNvbGEKcXVlcnkgPSB3b3JkQ291bnRzLndyaXRlU3RyZWFtIFwKICAgIC5vdXRwdXRNb2RlKCJjb21wbGV0ZSIpIFwKICAgIC5mb3JtYXQoImNvbnNvbGUiKSBcCiAgICAuc3RhcnQoKQoKcXVlcnkuYXdhaXRUZXJtaW5hdGlvbigp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from pyspark.sql.functions import explode, split

# Dividir les l&iacute;nies en paraules
words = lines.select(
    explode(
        split(lines.value, &quot; &quot;)
    ).alias(&quot;word&quot;)
)

# Comptar les ocurr&egrave;ncies de cada paraula
wordCounts = words.groupBy(&quot;word&quot;).count()

# Escriure el recompte de paraules a la consola
query = wordCounts.writeStream \
    .outputMode(&quot;complete&quot;) \
    .format(&quot;console&quot;) \
    .start()

query.awaitTermination()</pre></div><div class='content'></div><h1>Temes avançats</h1>
<h2>Operacions amb finestres</h2>
<div class='content'><p>Les operacions amb finestres et permeten realitzar agregacions sobre una finestra de temps lliscant.</p>
<h4>Exemple: Comptar paraules amb finestres</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBweXNwYXJrLnNxbC5mdW5jdGlvbnMgaW1wb3J0IHdpbmRvdwoKIyBEZWZpbmlyIHVuYSBmaW5lc3RyYSBkZSAxMCBtaW51dHMsIGxsaXNjYW50IGNhZGEgNSBtaW51dHMKd2luZG93ZWRDb3VudHMgPSB3b3Jkcy5ncm91cEJ5KAogICAgd2luZG93KHdvcmRzLnRpbWVzdGFtcCwgIjEwIG1pbnV0ZXMiLCAiNSBtaW51dGVzIiksCiAgICB3b3Jkcy53b3JkCikuY291bnQoKQoKIyBFc2NyaXVyZSBlbCByZWNvbXB0ZSBkZSBwYXJhdWxlcyBhbWIgZmluZXN0cmVzIGEgbGEgY29uc29sYQpxdWVyeSA9IHdpbmRvd2VkQ291bnRzLndyaXRlU3RyZWFtIFwKICAgIC5vdXRwdXRNb2RlKCJjb21wbGV0ZSIpIFwKICAgIC5mb3JtYXQoImNvbnNvbGUiKSBcCiAgICAuc3RhcnQoKQoKcXVlcnkuYXdhaXRUZXJtaW5hdGlvbigp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from pyspark.sql.functions import window

# Definir una finestra de 10 minuts, lliscant cada 5 minuts
windowedCounts = words.groupBy(
    window(words.timestamp, &quot;10 minutes&quot;, &quot;5 minutes&quot;),
    words.word
).count()

# Escriure el recompte de paraules amb finestres a la consola
query = windowedCounts.writeStream \
    .outputMode(&quot;complete&quot;) \
    .format(&quot;console&quot;) \
    .start()

query.awaitTermination()</pre></div><div class='content'></div><h2>Operacions amb estat</h2>
<div class='content'><p>Les operacions amb estat mantenen l'estat a través de lots de dades, cosa que és útil per a operacions com totals acumulatius.</p>
<h4>Exemple: Total acumulatiu</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBweXNwYXJrLnNxbC5mdW5jdGlvbnMgaW1wb3J0IGV4cHIKCiMgRGVmaW5pciB1biB0b3RhbCBhY3VtdWxhdGl1CnJ1bm5pbmdUb3RhbCA9IHdvcmRzLndpdGhXYXRlcm1hcmsoInRpbWVzdGFtcCIsICIxMCBtaW51dGVzIikgXAogICAgLmdyb3VwQnkoIndvcmQiKSBcCiAgICAuYWdnKGV4cHIoImNvdW50KCopIGFzIHRvdGFsIikpCgojIEVzY3JpdXJlIGVsIHRvdGFsIGFjdW11bGF0aXUgYSBsYSBjb25zb2xhCnF1ZXJ5ID0gcnVubmluZ1RvdGFsLndyaXRlU3RyZWFtIFwKICAgIC5vdXRwdXRNb2RlKCJ1cGRhdGUiKSBcCiAgICAuZm9ybWF0KCJjb25zb2xlIikgXAogICAgLnN0YXJ0KCkKCnF1ZXJ5LmF3YWl0VGVybWluYXRpb24oKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from pyspark.sql.functions import expr

# Definir un total acumulatiu
runningTotal = words.withWatermark(&quot;timestamp&quot;, &quot;10 minutes&quot;) \
    .groupBy(&quot;word&quot;) \
    .agg(expr(&quot;count(*) as total&quot;))

# Escriure el total acumulatiu a la consola
query = runningTotal.writeStream \
    .outputMode(&quot;update&quot;) \
    .format(&quot;console&quot;) \
    .start()

query.awaitTermination()</pre></div><div class='content'></div><h1>Tolerància a fallades i checkpointing</h1>
<div class='content'><p>El streaming estructurat proporciona tolerància a fallades integrada a través del checkpointing i els registres d'escriptura anticipada.</p>
</div><h2>Exemple: Checkpointing</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBEZWZpbmlyIHVuYSB1YmljYWNpw7MgZGUgY2hlY2twb2ludApxdWVyeSA9IHdvcmRDb3VudHMud3JpdGVTdHJlYW0gXAogICAgLm91dHB1dE1vZGUoImNvbXBsZXRlIikgXAogICAgLmZvcm1hdCgiY29uc29sZSIpIFwKICAgIC5vcHRpb24oImNoZWNrcG9pbnRMb2NhdGlvbiIsICIvcGF0aC90by9jaGVja3BvaW50L2RpciIpIFwKICAgIC5zdGFydCgpCgpxdWVyeS5hd2FpdFRlcm1pbmF0aW9uKCk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Definir una ubicaci&oacute; de checkpoint
query = wordCounts.writeStream \
    .outputMode(&quot;complete&quot;) \
    .format(&quot;console&quot;) \
    .option(&quot;checkpointLocation&quot;, &quot;/path/to/checkpoint/dir&quot;) \
    .start()

query.awaitTermination()</pre></div><div class='content'></div><h1>Conclusió</h1>
<div class='content'><p>El streaming estructurat a Apache Spark proporciona un marc potent i flexible per al processament de dades de streaming. Aprofitant les mateixes API utilitzades per al processament per lots, simplifica el desenvolupament d'aplicacions de streaming. Funcions clau com les operacions amb finestres, el processament amb estat i la tolerància a fallades el fan adequat per a una àmplia gamma de tasques de processament de dades en temps real.</p>
</div><div class='row navigation'><div class='col-6'><a href='stateful-stream-processing'>&#x25C4; Processament de Fluxos amb Estat</a></div><div class='col-6 text-end'><a href='introduction-to-spark-mllib'>Introducció a Spark MLlib &#x25BA;</a></div></div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/ca/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
