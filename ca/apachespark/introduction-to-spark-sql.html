<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Introducció a Spark SQL</title>

    <link rel="alternate" href="https://campusempresa.com/es/apachespark/introduction-to-spark-sql" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/apachespark/introduction-to-spark-sql" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/apachespark/introduction-to-spark-sql" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/ca/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="/es/apachespark/introduction-to-spark-sql" id="lnk_lang_es" data-lang="es" class="px-2">ES</a></b>
				|
				<b id="lit_lang_ca" class="px-2">CA</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/ca/objective">El Projecte</a>
				<a href="/ca/about">Sobre nosaltres</a>
				<a href="/ca/contribute">Contribuir</a>
				<a href="/ca/donate">Donacions</a>
				<a href="/ca/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'><div class='col-6'><a href='dataframes-and-datasets'>&#x25C4; DataFrames i Datasets</a></div><div class='col-6 text-end'><a href='dataframes-api'>API de DataFrames &#x25BA;</a></div></div><div class='content'></div><h1>Visió general</h1>
<div class='content'><p>Apache Spark SQL és un mòdul per al processament de dades estructurades. Permet consultar dades mitjançant SQL així com l'API de Dataset d'Apache Spark. Aquesta secció us introduirà als conceptes bàsics de Spark SQL, la seva arquitectura i com utilitzar-lo per al processament de dades.</p>
</div><h1>Conceptes clau</h1>
<div class='content'><ul>
<li><strong>SparkSession</strong>: El punt d'entrada per programar Spark amb l'API de Dataset i DataFrame.</li>
<li><strong>DataFrame</strong>: Una col·lecció distribuïda de dades organitzades en columnes amb nom.</li>
<li><strong>SQLContext</strong>: Un punt d'entrada per treballar amb dades estructurades a Spark.</li>
<li><strong>Catalyst Optimizer</strong>: Un optimitzador de consultes extensible utilitzat per Spark SQL.</li>
<li><strong>Data Source API</strong>: Permet a Spark llegir dades de diverses fonts com JSON, Parquet, JDBC, etc.</li>
</ul>
</div><h1>Configuració de Spark SQL</h1>
<div class='content'><p>Per utilitzar Spark SQL, cal configurar un SparkSession. Aquest és el punt de partida per a qualsevol aplicació de Spark SQL.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBweXNwYXJrLnNxbCBpbXBvcnQgU3BhcmtTZXNzaW9uCgojIEluaWNpYWxpdHphciBTcGFya1Nlc3Npb24Kc3BhcmsgPSBTcGFya1Nlc3Npb24uYnVpbGRlciBcCiAgICAuYXBwTmFtZSgiRXhlbXBsZSBkZSBTcGFyayBTUUwiKSBcCiAgICAuZ2V0T3JDcmVhdGUoKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from pyspark.sql import SparkSession

# Inicialitzar SparkSession
spark = SparkSession.builder \
    .appName(&quot;Exemple de Spark SQL&quot;) \
    .getOrCreate()</pre></div><div class='content'></div><h1>Creació de DataFrames</h1>
<div class='content'><p>Els DataFrames es poden crear a partir de diverses fonts de dades, incloent-hi fitxers JSON, Parquet i CSV.</p>
</div><h2>Exemple: Creació de DataFrame a partir de JSON</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBDYXJyZWdhciBkYWRlcyBKU09OIGVuIHVuIERhdGFGcmFtZQpkZiA9IHNwYXJrLnJlYWQuanNvbigicGF0aC90by9qc29uL2ZpbGUuanNvbiIpCgojIE1vc3RyYXIgZWwgY29udGluZ3V0IGRlbCBEYXRhRnJhbWUKZGYuc2hvdygp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Carregar dades JSON en un DataFrame
df = spark.read.json(&quot;path/to/json/file.json&quot;)

# Mostrar el contingut del DataFrame
df.show()</pre></div><div class='content'></div><h2>Exemple: Creació de DataFrame a partir de CSV</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBDYXJyZWdhciBkYWRlcyBDU1YgZW4gdW4gRGF0YUZyYW1lCmRmID0gc3BhcmsucmVhZC5jc3YoInBhdGgvdG8vY3N2L2ZpbGUuY3N2IiwgaGVhZGVyPVRydWUsIGluZmVyU2NoZW1hPVRydWUpCgojIE1vc3RyYXIgZWwgY29udGluZ3V0IGRlbCBEYXRhRnJhbWUKZGYuc2hvdygp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Carregar dades CSV en un DataFrame
df = spark.read.csv(&quot;path/to/csv/file.csv&quot;, header=True, inferSchema=True)

# Mostrar el contingut del DataFrame
df.show()</pre></div><div class='content'></div><h1>Execució de consultes SQL</h1>
<div class='content'><p>Podeu executar consultes SQL directament sobre DataFrames utilitzant el mètode <code>sql</code> de SparkSession.</p>
</div><h2>Exemple: Execució de consulta SQL</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBSZWdpc3RyYXIgRGF0YUZyYW1lIGNvbSBhIHZpc3RhIHRlbXBvcmFsIFNRTApkZi5jcmVhdGVPclJlcGxhY2VUZW1wVmlldygicGVvcGxlIikKCiMgRXhlY3V0YXIgY29uc3VsdGEgU1FMCnNxbERGID0gc3Bhcmsuc3FsKCJTRUxFQ1QgbmFtZSwgYWdlIEZST00gcGVvcGxlIFdIRVJFIGFnZSA+IDIxIikKCiMgTW9zdHJhciBlbCByZXN1bHRhdApzcWxERi5zaG93KCk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Registrar DataFrame com a vista temporal SQL
df.createOrReplaceTempView(&quot;people&quot;)

# Executar consulta SQL
sqlDF = spark.sql(&quot;SELECT name, age FROM people WHERE age &gt; 21&quot;)

# Mostrar el resultat
sqlDF.show()</pre></div><div class='content'></div><h1>Operacions amb DataFrames</h1>
<div class='content'><p>Els DataFrames proporcionen un llenguatge específic de domini per a la manipulació de dades estructurades. Aquí teniu algunes operacions comunes:</p>
</div><h2>Selecció de columnes</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBTZWxlY2Npb25hciBjb2x1bW5lcyBlc3BlY8OtZmlxdWVzCmRmLnNlbGVjdCgibmFtZSIsICJhZ2UiKS5zaG93KCk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Seleccionar columnes espec&iacute;fiques
df.select(&quot;name&quot;, &quot;age&quot;).show()</pre></div><div class='content'></div><h2>Filtratge de files</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBGaWx0cmFyIGZpbGVzIGJhc2F0IGVuIHVuYSBjb25kaWNpw7MKZGYuZmlsdGVyKGRmLmFnZSA+IDIxKS5zaG93KCk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Filtrar files basat en una condici&oacute;
df.filter(df.age &gt; 21).show()</pre></div><div class='content'></div><h2>Agrupació i agregació</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBBZ3J1cGFyIHBlciBpIGFncmVnYXIKZGYuZ3JvdXBCeSgiYWdlIikuY291bnQoKS5zaG93KCk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Agrupar per i agregar
df.groupBy(&quot;age&quot;).count().show()</pre></div><div class='content'></div><h1>Treballant amb diferents fonts de dades</h1>
<div class='content'><p>Spark SQL pot llegir i escriure dades des/de diverses fonts de dades.</p>
</div><h2>Exemple: Lectura de Parquet</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBDYXJyZWdhciBkYWRlcyBQYXJxdWV0IGVuIHVuIERhdGFGcmFtZQpwYXJxdWV0REYgPSBzcGFyay5yZWFkLnBhcnF1ZXQoInBhdGgvdG8vcGFycXVldC9maWxlLnBhcnF1ZXQiKQoKIyBNb3N0cmFyIGVsIGNvbnRpbmd1dCBkZWwgRGF0YUZyYW1lCnBhcnF1ZXRERi5zaG93KCk="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Carregar dades Parquet en un DataFrame
parquetDF = spark.read.parquet(&quot;path/to/parquet/file.parquet&quot;)

# Mostrar el contingut del DataFrame
parquetDF.show()</pre></div><div class='content'></div><h2>Exemple: Escriptura a Parquet</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBFc2NyaXVyZSBEYXRhRnJhbWUgYSBQYXJxdWV0CmRmLndyaXRlLnBhcnF1ZXQoInBhdGgvdG8vb3V0cHV0L2ZpbGUucGFycXVldCIp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Escriure DataFrame a Parquet
df.write.parquet(&quot;path/to/output/file.parquet&quot;)</pre></div><div class='content'></div><h1>Optimització del rendiment</h1>
<div class='content'><p>Spark SQL inclou un optimitzador basat en costos, generació de codi i emmagatzematge columnar per fer les consultes ràpides. Aquí teniu alguns consells per a l'optimització del rendiment:</p>
<ul>
<li><strong>Caché</strong>: Cacheu els DataFrames que es reutilitzen múltiples vegades.</li>
<li><strong>Particionament</strong>: Utilitzeu el particionament per distribuir les dades uniformement a través del clúster.</li>
<li><strong>Unions de difusió</strong>: Utilitzeu unions de difusió per a DataFrames petits per evitar la redistribució de grans conjunts de dades.</li>
</ul>
</div><h2>Exemple: Cachejar DataFrame</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBDYWNoZWphciBEYXRhRnJhbWUKZGYuY2FjaGUoKQoKIyBSZWFsaXR6YXIgb3BlcmFjaW9ucyBzb2JyZSBlbCBEYXRhRnJhbWUgY2FjaGVqYXQKZGYuY291bnQoKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Cachejar DataFrame
df.cache()

# Realitzar operacions sobre el DataFrame cachejat
df.count()</pre></div><div class='content'></div><h1>Conclusió</h1>
<div class='content'><p>Spark SQL és una eina poderosa per treballar amb dades estructurades a Apache Spark. Proporciona una manera simple i eficient de realitzar consultes SQL, manipulació de dades i integració amb diverses fonts de dades. Entenent els conceptes bàsics de Spark SQL, podeu aprofitar les seves capacitats per processar grans conjunts de dades de manera eficient.</p>
<p>En les següents seccions, aprofundirem en temes avançats com l'optimització de consultes Spark SQL, treballar amb tipus de dades complexos i integrar Spark SQL amb altres eines de big data.</p>
</div><div class='row navigation'><div class='col-6'><a href='dataframes-and-datasets'>&#x25C4; DataFrames i Datasets</a></div><div class='col-6 text-end'><a href='dataframes-api'>API de DataFrames &#x25BA;</a></div></div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/ca/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
