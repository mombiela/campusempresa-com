<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui<br> i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="https://campusempresa.com/mongodb/change-streams" id="lnk_lang_es" data-lang="es">Castellano</a></b>
				|
				<b id="lit_lang_ca">Catala</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="objective">El Projecte</a>
				<a href="about">Sobre nosaltres</a>
				<a href="contribute">Contribuir</a>
				<a href="donate">Donacions</a>
				<a href="licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='content'><p>Els Fluxos de Canvis a MongoDB proporcionen una manera poderosa d'escoltar els canvis en temps real a la teva base de dades. Aquesta característica és particularment útil per a aplicacions que necessiten respondre als canvis de la base de dades a mesura que succeeixen, com ara analítiques en temps real, notificacions i sincronització de dades.</p>
</div><h1>Introducció als Fluxos de Canvis</h1>
<div class='content'><ul>
<li><strong>Definició</strong>: Els Fluxos de Canvis permeten a les aplicacions accedir als canvis de dades en temps real sense la complexitat i el cost de la consulta periòdica.</li>
<li><strong>Casos d'ús</strong>:
<ul>
<li>Analítiques en temps real</li>
<li>Notificacions i alertes</li>
<li>Sincronització de dades entre diferents sistemes</li>
<li>Auditoria i registre de canvis</li>
</ul>
</li>
</ul>
</div><h1>Activació dels Fluxos de Canvis</h1>
<div class='content'><p>Per utilitzar els Fluxos de Canvis, has d'assegurar-te que el teu desplegament de MongoDB compleixi els següents requisits:</p>
<ul>
<li>Versió de MongoDB 3.6 o posterior.</li>
<li>Configuració de conjunt de rèpliques o clúster fragmentat.</li>
</ul>
</div><h1>Ús Bàsic</h1>
<div class='content'></div><h2>Obrir un Flux de Canvis</h2>
<div class='content'><p>Per obrir un Flux de Canvis, pots utilitzar el mètode <code>watch</code> en una col·lecció, base de dades o en tot el desplegament.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBNb25nb0NsaWVudCB9ID0gcmVxdWlyZSgnbW9uZ29kYicpOwoKYXN5bmMgZnVuY3Rpb24gbWFpbigpIHsKICBjb25zdCB1cmkgPSAieW91cl9tb25nb2RiX2Nvbm5lY3Rpb25fc3RyaW5nIjsKICBjb25zdCBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQodXJpLCB7IHVzZU5ld1VybFBhcnNlcjogdHJ1ZSwgdXNlVW5pZmllZFRvcG9sb2d5OiB0cnVlIH0pOwoKICB0cnkgewogICAgYXdhaXQgY2xpZW50LmNvbm5lY3QoKTsKICAgIGNvbnN0IGRhdGFiYXNlID0gY2xpZW50LmRiKCd5b3VyX2RhdGFiYXNlJyk7CiAgICBjb25zdCBjb2xsZWN0aW9uID0gZGF0YWJhc2UuY29sbGVjdGlvbigneW91cl9jb2xsZWN0aW9uJyk7CgogICAgY29uc3QgY2hhbmdlU3RyZWFtID0gY29sbGVjdGlvbi53YXRjaCgpOwoKICAgIGNoYW5nZVN0cmVhbS5vbignY2hhbmdlJywgKGNoYW5nZSkgPT4gewogICAgICBjb25zb2xlLmxvZygnQ2FudmkgZGV0ZWN0YXQ6JywgY2hhbmdlKTsKICAgIH0pOwoKICB9IGZpbmFsbHkgewogICAgLy8gYXdhaXQgY2xpZW50LmNsb3NlKCk7IC8vIERlc2NvbWVudGEgYXF1ZXN0YSBsw61uaWEgcGVyIHRhbmNhciBsYSBjb25uZXhpw7MgcXVhbiBoYWdpcyBhY2FiYXQKICB9Cn0KCm1haW4oKS5jYXRjaChjb25zb2xlLmVycm9yKTs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { MongoClient } = require('mongodb');

async function main() {
  const uri = &quot;your_mongodb_connection_string&quot;;
  const client = new MongoClient(uri, { useNewUrlParser: true, useUnifiedTopology: true });

  try {
    await client.connect();
    const database = client.db('your_database');
    const collection = database.collection('your_collection');

    const changeStream = collection.watch();

    changeStream.on('change', (change) =&gt; {
      console.log('Canvi detectat:', change);
    });

  } finally {
    // await client.close(); // Descomenta aquesta l&iacute;nia per tancar la connexi&oacute; quan hagis acabat
  }
}

main().catch(console.error);</pre></div><div class='content'></div><h2>Estructura de l'Esdeveniment de Canvi</h2>
<div class='content'><p>Un document d'esdeveniment de canvi conté diversos camps que proporcionen informació sobre el canvi:</p>
<ul>
<li><strong>_id</strong>: Un identificador únic per a l'esdeveniment de canvi.</li>
<li><strong>operationType</strong>: El tipus d'operació que va desencadenar el canvi (per exemple, insert, update, delete).</li>
<li><strong>fullDocument</strong>: El document afectat pel canvi (només per a operacions d'inserció i actualització).</li>
<li><strong>ns</strong>: L'espai de noms (base de dades i col·lecció) del document canviat.</li>
<li><strong>documentKey</strong>: L'identificador únic del document canviat.</li>
</ul>
</div><h2>Exemple d'Esdeveniment de Canvi</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ewogICJfaWQiOiB7ICJ0cyI6IHsgIiR0aW1lc3RhbXAiOiB7ICJ0IjogMTYyMDA3NTYwMCwgImkiOiAxIH0gfSwgIm5zIjogInlvdXJfZGF0YWJhc2UueW91cl9jb2xsZWN0aW9uIiwgImRvY3VtZW50S2V5IjogeyAiX2lkIjogMSB9IH0sCiAgIm9wZXJhdGlvblR5cGUiOiAiaW5zZXJ0IiwKICAiZnVsbERvY3VtZW50IjogeyAiX2lkIjogMSwgIm5hbWUiOiAiSm9obiBEb2UiLCAiYWdlIjogMzAgfSwKICAibnMiOiB7ICJkYiI6ICJ5b3VyX2RhdGFiYXNlIiwgImNvbGwiOiAieW91cl9jb2xsZWN0aW9uIiB9LAogICJkb2N1bWVudEtleSI6IHsgIl9pZCI6IDEgfQp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>{
  &quot;_id&quot;: { &quot;ts&quot;: { &quot;$timestamp&quot;: { &quot;t&quot;: 1620075600, &quot;i&quot;: 1 } }, &quot;ns&quot;: &quot;your_database.your_collection&quot;, &quot;documentKey&quot;: { &quot;_id&quot;: 1 } },
  &quot;operationType&quot;: &quot;insert&quot;,
  &quot;fullDocument&quot;: { &quot;_id&quot;: 1, &quot;name&quot;: &quot;John Doe&quot;, &quot;age&quot;: 30 },
  &quot;ns&quot;: { &quot;db&quot;: &quot;your_database&quot;, &quot;coll&quot;: &quot;your_collection&quot; },
  &quot;documentKey&quot;: { &quot;_id&quot;: 1 }
}</pre></div><div class='content'></div><h1>Ús Avançat</h1>
<div class='content'></div><h2>Filtratge d'Esdeveniments de Canvi</h2>
<div class='content'><p>Pots filtrar els esdeveniments de canvi utilitzant una pipeline d'agregació per rebre només els canvis que t'interessen.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgcGlwZWxpbmUgPSBbCiAgeyAkbWF0Y2g6IHsgJ2Z1bGxEb2N1bWVudC5hZ2UnOiB7ICRndGU6IDE4IH0gfSB9Cl07Cgpjb25zdCBjaGFuZ2VTdHJlYW0gPSBjb2xsZWN0aW9uLndhdGNoKHBpcGVsaW5lKTsKCmNoYW5nZVN0cmVhbS5vbignY2hhbmdlJywgKGNoYW5nZSkgPT4gewogIGNvbnNvbGUubG9nKCdDYW52aSBmaWx0cmF0IGRldGVjdGF0OicsIGNoYW5nZSk7Cn0pOw=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const pipeline = [
  { $match: { 'fullDocument.age': { $gte: 18 } } }
];

const changeStream = collection.watch(pipeline);

changeStream.on('change', (change) =&gt; {
  console.log('Canvi filtrat detectat:', change);
});</pre></div><div class='content'></div><h2>Reprendre els Fluxos de Canvis</h2>
<div class='content'><p>Els Fluxos de Canvis es poden reprendre des d'un punt específic en el temps utilitzant un token de represa. Això és útil per gestionar interrupcions.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgcmVzdW1lVG9rZW4gPSBjaGFuZ2VTdHJlYW0ucmVzdW1lVG9rZW47Cgpjb25zdCByZXN1bWVkQ2hhbmdlU3RyZWFtID0gY29sbGVjdGlvbi53YXRjaChbXSwgeyByZXN1bWVBZnRlcjogcmVzdW1lVG9rZW4gfSk7CgpyZXN1bWVkQ2hhbmdlU3RyZWFtLm9uKCdjaGFuZ2UnLCAoY2hhbmdlKSA9PiB7CiAgY29uc29sZS5sb2coJ0NhbnZpIHJlcHLDqHMgZGV0ZWN0YXQ6JywgY2hhbmdlKTsKfSk7"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const resumeToken = changeStream.resumeToken;

const resumedChangeStream = collection.watch([], { resumeAfter: resumeToken });

resumedChangeStream.on('change', (change) =&gt; {
  console.log('Canvi repr&egrave;s detectat:', change);
});</pre></div><div class='content'></div><h2>Fluxos de Canvis en una Base de Dades o Desplegament</h2>
<div class='content'><p>També pots observar canvis en tota una base de dades o desplegament.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgZGJDaGFuZ2VTdHJlYW0gPSBkYXRhYmFzZS53YXRjaCgpOwpjb25zdCBkZXBsb3ltZW50Q2hhbmdlU3RyZWFtID0gY2xpZW50LndhdGNoKCk7CgpkYkNoYW5nZVN0cmVhbS5vbignY2hhbmdlJywgKGNoYW5nZSkgPT4gewogIGNvbnNvbGUubG9nKCdDYW52aSBlbiBsYSBiYXNlIGRlIGRhZGVzIGRldGVjdGF0OicsIGNoYW5nZSk7Cn0pOwoKZGVwbG95bWVudENoYW5nZVN0cmVhbS5vbignY2hhbmdlJywgKGNoYW5nZSkgPT4gewogIGNvbnNvbGUubG9nKCdDYW52aSBlbiBlbCBkZXNwbGVnYW1lbnQgZGV0ZWN0YXQ6JywgY2hhbmdlKTsKfSk7"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const dbChangeStream = database.watch();
const deploymentChangeStream = client.watch();

dbChangeStream.on('change', (change) =&gt; {
  console.log('Canvi en la base de dades detectat:', change);
});

deploymentChangeStream.on('change', (change) =&gt; {
  console.log('Canvi en el desplegament detectat:', change);
});</pre></div><div class='content'></div><h1>Conclusió</h1>
<div class='content'><p>Els Fluxos de Canvis a MongoDB proporcionen un mecanisme robust per monitoritzar els canvis en temps real a la teva base de dades. Aprofitant els Fluxos de Canvis, pots construir aplicacions responsives que reaccionen als canvis de dades instantàniament. Tant si estàs treballant en analítiques en temps real, notificacions o sincronització de dades, els Fluxos de Canvis ofereixen una solució flexible i eficient.</p>
<ul>
<li><strong>Punts Clau</strong>:
<ul>
<li>Els Fluxos de Canvis permeten la monitorització en temps real dels canvis de la base de dades.</li>
<li>Es poden utilitzar en col·leccions, bases de dades o en tot el desplegament.</li>
<li>El filtratge i la represa dels Fluxos de Canvis proporcionen control i fiabilitat addicionals.</li>
</ul>
</li>
</ul>
<p>Dominant els Fluxos de Canvis, pots millorar significativament la capacitat de resposta i interactivitat de les teves aplicacions basades en MongoDB.</p>
</div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
       <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
       <a href="cookies">Més informació</a>
   </div>	
	</div>    
</body>
</html>
