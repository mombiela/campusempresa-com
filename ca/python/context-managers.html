<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestors de context a Python</title>

    <link rel="alternate" href="https://campusempresa.com/es/python/context-managers" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/python/context-managers" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/python/context-managers" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/ca/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui<br> i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="/es/python/context-managers" id="lnk_lang_es" data-lang="es" class="px-2">ES</a></b>
				|
				<b id="lit_lang_ca" class="px-2">CA</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/ca/objective">El Projecte</a>
				<a href="/ca/about">Sobre nosaltres</a>
				<a href="/ca/contribute">Contribuir</a>
				<a href="/ca/donate">Donacions</a>
				<a href="/ca/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='content'></div><h1>Introducció als gestors de context</h1>
<div class='content'><p>Els gestors de context són una característica poderosa a Python que et permeten assignar i alliberar recursos precisament quan ho desitges. L'ús més comú dels gestors de context és amb la instrucció <code>with</code>, que assegura que els recursos es gestionin correctament.</p>
</div><h2>Conceptes clau</h2>
<div class='content'><ul>
<li><strong>Gestió de recursos</strong>: Els gestors de context s'utilitzen per gestionar recursos com fluxos de fitxers, connexions de xarxa i bloquejos.</li>
<li><strong>La instrucció <code>with</code></strong>: Simplifica la gestió d'excepcions encapsulant tasques comunes de preparació i neteja.</li>
<li><strong>Neteja automàtica</strong>: Assegura que els recursos es alliberin després del seu ús, fins i tot si es produeix un error.</li>
</ul>
</div><h1>Ús de la instrucció `with`</h1>
<div class='content'><p>La instrucció <code>with</code> simplifica el procés de treballar amb gestors de context. Assegura que el recurs es netegi correctament després del seu ús.</p>
</div><h2>Exemple bàsic</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("d2l0aCBvcGVuKCdleGFtcGxlLnR4dCcsICdyJykgYXMgZmlsZToKICAgIGNvbnRlbnQgPSBmaWxlLnJlYWQoKQogICAgcHJpbnQoY29udGVudCkKIyBFbCBmaXR4ZXIgZXMgdGFuY2EgYXV0b23DoHRpY2FtZW50IGRlc3Byw6lzIHF1ZSBlbCBibG9jIHMnZXhlY3V0aQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>with open('example.txt', 'r') as file:
    content = file.read()
    print(content)
# El fitxer es tanca autom&agrave;ticament despr&eacute;s que el bloc s'executi</pre></div><div class='content'><ul>
<li><strong>Explicació</strong>:
<ul>
<li><code>open('example.txt', 'r')</code> obre el fitxer en mode lectura.</li>
<li><code>as file</code> assigna l'objecte fitxer a la variable <code>file</code>.</li>
<li>El fitxer es tanca automàticament quan es surt del bloc dins de la instrucció <code>with</code>.</li>
</ul>
</li>
</ul>
</div><h1>Creació de gestors de context personalitzats</h1>
<div class='content'><p>Pots crear els teus propis gestors de context utilitzant classes o el mòdul <code>contextlib</code>.</p>
</div><h2>Ús de classes</h2>
<div class='content'><p>Per crear un gestor de context utilitzant una classe, necessites definir els mètodes <code>__enter__</code> i <code>__exit__</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgTXlDb250ZXh0TWFuYWdlcjoKICAgIGRlZiBfX2VudGVyX18oc2VsZik6CiAgICAgICAgcHJpbnQoIkVudHJhbnQgYWwgY29udGV4dCIpCiAgICAgICAgcmV0dXJuIHNlbGYKCiAgICBkZWYgX19leGl0X18oc2VsZiwgZXhjX3R5cGUsIGV4Y192YWx1ZSwgdHJhY2ViYWNrKToKICAgICAgICBwcmludCgiU29ydGludCBkZWwgY29udGV4dCIpCgp3aXRoIE15Q29udGV4dE1hbmFnZXIoKSBhcyBtYW5hZ2VyOgogICAgcHJpbnQoIkRpbnMgZGVsIGNvbnRleHQiKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class MyContextManager:
    def __enter__(self):
        print(&quot;Entrant al context&quot;)
        return self

    def __exit__(self, exc_type, exc_value, traceback):
        print(&quot;Sortint del context&quot;)

with MyContextManager() as manager:
    print(&quot;Dins del context&quot;)</pre></div><div class='content'><ul>
<li><strong>Explicació</strong>:
<ul>
<li>El mètode <code>__enter__</code> s'executa quan s'entra al bloc <code>with</code>.</li>
<li>El mètode <code>__exit__</code> s'executa quan es surt del bloc <code>with</code>.</li>
<li><code>exc_type</code>, <code>exc_value</code> i <code>traceback</code> s'utilitzen per gestionar excepcions si es produeixen dins del bloc <code>with</code>.</li>
</ul>
</li>
</ul>
</div><h2>Ús del mòdul `contextlib`</h2>
<div class='content'><p>El mòdul <code>contextlib</code> proporciona una manera més senzilla de crear gestors de context utilitzant el decorador <code>@contextmanager</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBjb250ZXh0bGliIGltcG9ydCBjb250ZXh0bWFuYWdlcgoKQGNvbnRleHRtYW5hZ2VyCmRlZiBteV9jb250ZXh0X21hbmFnZXIoKToKICAgIHByaW50KCJFbnRyYW50IGFsIGNvbnRleHQiKQogICAgeWllbGQKICAgIHByaW50KCJTb3J0aW50IGRlbCBjb250ZXh0IikKCndpdGggbXlfY29udGV4dF9tYW5hZ2VyKCk6CiAgICBwcmludCgiRGlucyBkZWwgY29udGV4dCIp"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from contextlib import contextmanager

@contextmanager
def my_context_manager():
    print(&quot;Entrant al context&quot;)
    yield
    print(&quot;Sortint del context&quot;)

with my_context_manager():
    print(&quot;Dins del context&quot;)</pre></div><div class='content'><ul>
<li><strong>Explicació</strong>:
<ul>
<li>El decorador <code>@contextmanager</code> s'utilitza per definir un gestor de context basat en generadors.</li>
<li>La instrucció <code>yield</code> separa el codi de configuració i desmuntatge.</li>
</ul>
</li>
</ul>
</div><h1>Ús avançat</h1>
<div class='content'><p>Els gestors de context es poden utilitzar per a escenaris de gestió de recursos més complexos, com gestionar connexions de bases de dades o sockets de xarxa.</p>
</div><h2>Exemple: Connexió a una base de dades</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHNxbGl0ZTMKZnJvbSBjb250ZXh0bGliIGltcG9ydCBjb250ZXh0bWFuYWdlcgoKQGNvbnRleHRtYW5hZ2VyCmRlZiBvcGVuX2RhdGFiYXNlKGRiX25hbWUpOgogICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdChkYl9uYW1lKQogICAgdHJ5OgogICAgICAgIHlpZWxkIGNvbm4KICAgIGZpbmFsbHk6CiAgICAgICAgY29ubi5jbG9zZSgpCgp3aXRoIG9wZW5fZGF0YWJhc2UoJ2V4YW1wbGUuZGInKSBhcyBjb25uOgogICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgY3Vyc29yLmV4ZWN1dGUoJ1NFTEVDVCAqIEZST00gbXlfdGFibGUnKQogICAgcmVzdWx0cyA9IGN1cnNvci5mZXRjaGFsbCgpCiAgICBwcmludChyZXN1bHRzKQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import sqlite3
from contextlib import contextmanager

@contextmanager
def open_database(db_name):
    conn = sqlite3.connect(db_name)
    try:
        yield conn
    finally:
        conn.close()

with open_database('example.db') as conn:
    cursor = conn.cursor()
    cursor.execute('SELECT * FROM my_table')
    results = cursor.fetchall()
    print(results)</pre></div><div class='content'><ul>
<li><strong>Explicació</strong>:
<ul>
<li>El gestor de context <code>open_database</code> gestiona l'obertura i tancament de la connexió a la base de dades.</li>
<li>El bloc <code>finally</code> assegura que la connexió es tanqui fins i tot si es produeix un error.</li>
</ul>
</li>
</ul>
</div><h1>Conclusió</h1>
<div class='content'><p>Els gestors de context són una part crucial de la programació en Python, proporcionant una manera neta i eficient de gestionar recursos. Utilitzant la instrucció <code>with</code>, pots assegurar-te que els recursos es alliberin correctament, reduint el risc de fuites de recursos i fent el teu codi més robust. Tant si utilitzes gestors de context integrats com si crees els teus propis, entendre aquest concepte millorarà enormement la teva capacitat per escriure codi Python eficient i fiable.</p>
</div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/ca/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
