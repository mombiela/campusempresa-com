<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestió d'Errors i Reintents</title>

    <link rel="alternate" href="https://campusempresa.com/es/kafka/error-handling-and-retries" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/kafka/error-handling-and-retries" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/kafka/error-handling-and-retries" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/ca/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui<br> i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="/es/kafka/error-handling-and-retries" id="lnk_lang_es" data-lang="es" class="px-2">ES</a></b>
				|
				<b id="lit_lang_ca" class="px-2">CA</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="objective">El Projecte</a>
				<a href="about">Sobre nosaltres</a>
				<a href="contribute">Contribuir</a>
				<a href="donate">Donacions</a>
				<a href="licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='content'></div><h1>Introducció</h1>
<div class='content'><p>La gestió d'errors i els reintents són aspectes crucials per treballar amb Apache Kafka, assegurant que les teves aplicacions puguin gestionar fallades de manera elegant i mantenir la integritat de les dades. Aquesta secció cobrirà els conceptes bàsics de la gestió d'errors, estratègies comunes per als reintents i tècniques avançades per gestionar errors a Kafka.</p>
</div><h1>Conceptes Clau</h1>
<div class='content'><ul>
<li><strong>Gestió d'Errors</strong>: El procés de gestionar errors que es produeixen durant l'execució d'un programa.</li>
<li><strong>Reintents</strong>: L'acte d'intentar una operació de nou després que hagi fallat.</li>
<li><strong>Idempotència</strong>: Assegurar que una operació es pugui realitzar múltiples vegades sense canviar el resultat més enllà de l'aplicació inicial.</li>
<li><strong>Estratègia de Retard</strong>: Un mètode per retardar els reintents per evitar sobrecarregar el sistema.</li>
</ul>
</div><h1>Gestió d'Errors a Kafka</h1>
<div class='content'><p>Kafka proporciona diversos mecanismes per gestionar errors que es produeixen durant la producció i el consum de missatges.</p>
</div><h2>Gestió d'Errors del Productor</h2>
<div class='content'><p>Quan es produeixen missatges a Kafka, poden ocórrer errors a causa de problemes de xarxa, fallades de brokers o problemes de configuració. L'API del productor de Kafka proporciona callbacks i excepcions per gestionar aquests errors.</p>
<h4>Exemple: Gestió d'Errors del Productor</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5hcGFjaGUua2Fma2EuY2xpZW50cy5wcm9kdWNlci4qOwoKaW1wb3J0IGphdmEudXRpbC5Qcm9wZXJ0aWVzOwoKcHVibGljIGNsYXNzIEthZmthUHJvZHVjZXJFeGFtcGxlIHsKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHsKICAgICAgICBQcm9wZXJ0aWVzIHByb3BzID0gbmV3IFByb3BlcnRpZXMoKTsKICAgICAgICBwcm9wcy5wdXQoImJvb3RzdHJhcC5zZXJ2ZXJzIiwgImxvY2FsaG9zdDo5MDkyIik7CiAgICAgICAgcHJvcHMucHV0KCJrZXkuc2VyaWFsaXplciIsICJvcmcuYXBhY2hlLmthZmthLmNvbW1vbi5zZXJpYWxpemF0aW9uLlN0cmluZ1NlcmlhbGl6ZXIiKTsKICAgICAgICBwcm9wcy5wdXQoInZhbHVlLnNlcmlhbGl6ZXIiLCAib3JnLmFwYWNoZS5rYWZrYS5jb21tb24uc2VyaWFsaXphdGlvbi5TdHJpbmdTZXJpYWxpemVyIik7CgogICAgICAgIFByb2R1Y2VyPFN0cmluZywgU3RyaW5nPiBwcm9kdWNlciA9IG5ldyBLYWZrYVByb2R1Y2VyPD4ocHJvcHMpOwoKICAgICAgICBQcm9kdWNlclJlY29yZDxTdHJpbmcsIFN0cmluZz4gcmVjb3JkID0gbmV3IFByb2R1Y2VyUmVjb3JkPD4oIm15LXRvcGljIiwgImtleSIsICJ2YWx1ZSIpOwoKICAgICAgICBwcm9kdWNlci5zZW5kKHJlY29yZCwgbmV3IENhbGxiYWNrKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgb25Db21wbGV0aW9uKFJlY29yZE1ldGFkYXRhIG1ldGFkYXRhLCBFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICBpZiAoZXhjZXB0aW9uICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oIkVycm9yIHByb2R1aW50IGFsIHRlbWEgIiArIG1ldGFkYXRhLnRvcGljKCkpOwogICAgICAgICAgICAgICAgICAgIGV4Y2VwdGlvbi5wcmludFN0YWNrVHJhY2UoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJSZWdpc3RyZSBwcm9kdcOvdCBhbCB0ZW1hICIgKyBtZXRhZGF0YS50b3BpYygpICsgIiBwYXJ0aWNpw7MgIiArIG1ldGFkYXRhLnBhcnRpdGlvbigpICsgIiBAIG9mZnNldCAiICsgbWV0YWRhdGEub2Zmc2V0KCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHByb2R1Y2VyLmNsb3NlKCk7CiAgICB9Cn0="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.apache.kafka.clients.producer.*;

import java.util.Properties;

public class KafkaProducerExample {
    public static void main(String[] args) {
        Properties props = new Properties();
        props.put(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);
        props.put(&quot;key.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);
        props.put(&quot;value.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);

        Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props);

        ProducerRecord&lt;String, String&gt; record = new ProducerRecord&lt;&gt;(&quot;my-topic&quot;, &quot;key&quot;, &quot;value&quot;);

        producer.send(record, new Callback() {
            @Override
            public void onCompletion(RecordMetadata metadata, Exception exception) {
                if (exception != null) {
                    System.err.println(&quot;Error produint al tema &quot; + metadata.topic());
                    exception.printStackTrace();
                } else {
                    System.out.println(&quot;Registre produ&iuml;t al tema &quot; + metadata.topic() + &quot; partici&oacute; &quot; + metadata.partition() + &quot; @ offset &quot; + metadata.offset());
                }
            }
        });

        producer.close();
    }
}</pre></div><div class='content'></div><h2>Gestió d'Errors del Consumidor</h2>
<div class='content'><p>Els consumidors poden trobar errors mentre obtenen missatges de Kafka, com errors de deserialització o problemes de xarxa. L'API del consumidor de Kafka proporciona mecanismes per gestionar aquests errors de manera elegant.</p>
<h4>Exemple: Gestió d'Errors del Consumidor</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5hcGFjaGUua2Fma2EuY2xpZW50cy5jb25zdW1lci4qOwppbXBvcnQgb3JnLmFwYWNoZS5rYWZrYS5jb21tb24uZXJyb3JzLldha2V1cEV4Y2VwdGlvbjsKCmltcG9ydCBqYXZhLnRpbWUuRHVyYXRpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuUHJvcGVydGllczsKCnB1YmxpYyBjbGFzcyBLYWZrYUNvbnN1bWVyRXhhbXBsZSB7CiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdzKSB7CiAgICAgICAgUHJvcGVydGllcyBwcm9wcyA9IG5ldyBQcm9wZXJ0aWVzKCk7CiAgICAgICAgcHJvcHMucHV0KCJib290c3RyYXAuc2VydmVycyIsICJsb2NhbGhvc3Q6OTA5MiIpOwogICAgICAgIHByb3BzLnB1dCgiZ3JvdXAuaWQiLCAibXktZ3JvdXAiKTsKICAgICAgICBwcm9wcy5wdXQoImtleS5kZXNlcmlhbGl6ZXIiLCAib3JnLmFwYWNoZS5rYWZrYS5jb21tb24uc2VyaWFsaXphdGlvbi5TdHJpbmdEZXNlcmlhbGl6ZXIiKTsKICAgICAgICBwcm9wcy5wdXQoInZhbHVlLmRlc2VyaWFsaXplciIsICJvcmcuYXBhY2hlLmthZmthLmNvbW1vbi5zZXJpYWxpemF0aW9uLlN0cmluZ0Rlc2VyaWFsaXplciIpOwoKICAgICAgICBDb25zdW1lcjxTdHJpbmcsIFN0cmluZz4gY29uc3VtZXIgPSBuZXcgS2Fma2FDb25zdW1lcjw+KHByb3BzKTsKICAgICAgICBjb25zdW1lci5zdWJzY3JpYmUoQ29sbGVjdGlvbnMuc2luZ2xldG9uTGlzdCgibXktdG9waWMiKSk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICBDb25zdW1lclJlY29yZHM8U3RyaW5nLCBTdHJpbmc+IHJlY29yZHMgPSBjb25zdW1lci5wb2xsKER1cmF0aW9uLm9mTWlsbGlzKDEwMCkpOwogICAgICAgICAgICAgICAgZm9yIChDb25zdW1lclJlY29yZDxTdHJpbmcsIFN0cmluZz4gcmVjb3JkIDogcmVjb3JkcykgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRmKCJSZWdpc3RyZSBjb25zdW1pdCBhbWIgY2xhdSAlcyBpIHZhbG9yICVzJW4iLCByZWNvcmQua2V5KCksIHJlY29yZC52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50ZigiRXJyb3IgcHJvY2Vzc2FudCBlbCByZWdpc3RyZSBhbWIgY2xhdSAlcyBpIHZhbG9yICVzJW4iLCByZWNvcmQua2V5KCksIHJlY29yZC52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmludFN0YWNrVHJhY2UoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChXYWtldXBFeGNlcHRpb24gZSkgewogICAgICAgICAgICAvLyBJZ25vcmFyIGV4Y2VwY2nDsyBzaSBlcyB0YW5jYQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGNvbnN1bWVyLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.apache.kafka.clients.consumer.*;
import org.apache.kafka.common.errors.WakeupException;

import java.time.Duration;
import java.util.Collections;
import java.util.Properties;

public class KafkaConsumerExample {
    public static void main(String[] args) {
        Properties props = new Properties();
        props.put(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);
        props.put(&quot;group.id&quot;, &quot;my-group&quot;);
        props.put(&quot;key.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);
        props.put(&quot;value.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);

        Consumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props);
        consumer.subscribe(Collections.singletonList(&quot;my-topic&quot;));

        try {
            while (true) {
                ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(100));
                for (ConsumerRecord&lt;String, String&gt; record : records) {
                    try {
                        System.out.printf(&quot;Registre consumit amb clau %s i valor %s%n&quot;, record.key(), record.value());
                    } catch (Exception e) {
                        System.err.printf(&quot;Error processant el registre amb clau %s i valor %s%n&quot;, record.key(), record.value());
                        e.printStackTrace();
                    }
                }
            }
        } catch (WakeupException e) {
            // Ignorar excepci&oacute; si es tanca
        } finally {
            consumer.close();
        }
    }
}</pre></div><div class='content'></div><h1>Estratègies de Reintents</h1>
<div class='content'><p>Els reintents són essencials per assegurar que els errors transitoris no causin fallades permanents. Kafka proporciona diverses configuracions per gestionar els reintents.</p>
</div><h2>Reintents del Productor</h2>
<div class='content'><p>Els productors de Kafka es poden configurar per reintentar enviar missatges en cas d'errors transitoris.</p>
<h4>Exemple: Configuració de Reintents del Productor</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("UHJvcGVydGllcyBwcm9wcyA9IG5ldyBQcm9wZXJ0aWVzKCk7CnByb3BzLnB1dCgiYm9vdHN0cmFwLnNlcnZlcnMiLCAibG9jYWxob3N0OjkwOTIiKTsKcHJvcHMucHV0KCJrZXkuc2VyaWFsaXplciIsICJvcmcuYXBhY2hlLmthZmthLmNvbW1vbi5zZXJpYWxpemF0aW9uLlN0cmluZ1NlcmlhbGl6ZXIiKTsKcHJvcHMucHV0KCJ2YWx1ZS5zZXJpYWxpemVyIiwgIm9yZy5hcGFjaGUua2Fma2EuY29tbW9uLnNlcmlhbGl6YXRpb24uU3RyaW5nU2VyaWFsaXplciIpOwpwcm9wcy5wdXQoInJldHJpZXMiLCAzKTsgLy8gTm9tYnJlIGRlIHJlaW50ZW50cwpwcm9wcy5wdXQoInJldHJ5LmJhY2tvZmYubXMiLCAxMDApOyAvLyBUZW1wcyBkZSByZXRhcmQgZW50cmUgcmVpbnRlbnRzCgpQcm9kdWNlcjxTdHJpbmcsIFN0cmluZz4gcHJvZHVjZXIgPSBuZXcgS2Fma2FQcm9kdWNlcjw+KHByb3BzKTs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>Properties props = new Properties();
props.put(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);
props.put(&quot;key.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);
props.put(&quot;value.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);
props.put(&quot;retries&quot;, 3); // Nombre de reintents
props.put(&quot;retry.backoff.ms&quot;, 100); // Temps de retard entre reintents

Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props);</pre></div><div class='content'></div><h2>Reintents del Consumidor</h2>
<div class='content'><p>Els consumidors poden implementar lògica de reintents personalitzada per gestionar errors transitoris durant el processament de missatges.</p>
<h4>Exemple: Implementació de Reintents del Consumidor</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHVibGljIGNsYXNzIEthZmthQ29uc3VtZXJXaXRoUmV0cmllcyB7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTUFYX1JFVFJJRVMgPSAzOwoKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHsKICAgICAgICBQcm9wZXJ0aWVzIHByb3BzID0gbmV3IFByb3BlcnRpZXMoKTsKICAgICAgICBwcm9wcy5wdXQoImJvb3RzdHJhcC5zZXJ2ZXJzIiwgImxvY2FsaG9zdDo5MDkyIik7CiAgICAgICAgcHJvcHMucHV0KCJncm91cC5pZCIsICJteS1ncm91cCIpOwogICAgICAgIHByb3BzLnB1dCgia2V5LmRlc2VyaWFsaXplciIsICJvcmcuYXBhY2hlLmthZmthLmNvbW1vbi5zZXJpYWxpemF0aW9uLlN0cmluZ0Rlc2VyaWFsaXplciIpOwogICAgICAgIHByb3BzLnB1dCgidmFsdWUuZGVzZXJpYWxpemVyIiwgIm9yZy5hcGFjaGUua2Fma2EuY29tbW9uLnNlcmlhbGl6YXRpb24uU3RyaW5nRGVzZXJpYWxpemVyIik7CgogICAgICAgIENvbnN1bWVyPFN0cmluZywgU3RyaW5nPiBjb25zdW1lciA9IG5ldyBLYWZrYUNvbnN1bWVyPD4ocHJvcHMpOwogICAgICAgIGNvbnN1bWVyLnN1YnNjcmliZShDb2xsZWN0aW9ucy5zaW5nbGV0b25MaXN0KCJteS10b3BpYyIpKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgIENvbnN1bWVyUmVjb3JkczxTdHJpbmcsIFN0cmluZz4gcmVjb3JkcyA9IGNvbnN1bWVyLnBvbGwoRHVyYXRpb24ub2ZNaWxsaXMoMTAwKSk7CiAgICAgICAgICAgICAgICBmb3IgKENvbnN1bWVyUmVjb3JkPFN0cmluZywgU3RyaW5nPiByZWNvcmQgOiByZWNvcmRzKSB7CiAgICAgICAgICAgICAgICAgICAgYm9vbGVhbiBzdWNjZXNzID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaW50IGF0dGVtcHQgPSAwOwogICAgICAgICAgICAgICAgICAgIHdoaWxlICghc3VjY2VzcyAmJiBhdHRlbXB0IDwgTUFYX1JFVFJJRVMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRmKCJSZWdpc3RyZSBjb25zdW1pdCBhbWIgY2xhdSAlcyBpIHZhbG9yICVzJW4iLCByZWNvcmQua2V5KCksIHJlY29yZC52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0ZW1wdCsrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmVyci5wcmludGYoIkVycm9yIHByb2Nlc3NhbnQgZWwgcmVnaXN0cmUgYW1iIGNsYXUgJXMgaSB2YWxvciAlcywgaW50ZW50ICVkJW4iLCByZWNvcmQua2V5KCksIHJlY29yZC52YWx1ZSgpLCBhdHRlbXB0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRocmVhZC5zbGVlcCgxMDApOyAvLyBSZXRhcmQgYWJhbnMgZGUgcmVpbnRlbnRhcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLmludGVycnVwdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50ZigiTm8gcydoYSBwb2d1dCBwcm9jZXNzYXIgZWwgcmVnaXN0cmUgYW1iIGNsYXUgJXMgaSB2YWxvciAlcyBkZXNwcsOpcyBkZSAlZCBpbnRlbnRzJW4iLCByZWNvcmQua2V5KCksIHJlY29yZC52YWx1ZSgpLCBNQVhfUkVUUklFUyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoV2FrZXVwRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gSWdub3JhciBleGNlcGNpw7Mgc2kgZXMgdGFuY2EKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBjb25zdW1lci5jbG9zZSgpOwogICAgICAgIH0KICAgIH0KfQ=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>public class KafkaConsumerWithRetries {
    private static final int MAX_RETRIES = 3;

    public static void main(String[] args) {
        Properties props = new Properties();
        props.put(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);
        props.put(&quot;group.id&quot;, &quot;my-group&quot;);
        props.put(&quot;key.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);
        props.put(&quot;value.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);

        Consumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props);
        consumer.subscribe(Collections.singletonList(&quot;my-topic&quot;));

        try {
            while (true) {
                ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(100));
                for (ConsumerRecord&lt;String, String&gt; record : records) {
                    boolean success = false;
                    int attempt = 0;
                    while (!success &amp;&amp; attempt &lt; MAX_RETRIES) {
                        try {
                            System.out.printf(&quot;Registre consumit amb clau %s i valor %s%n&quot;, record.key(), record.value());
                            success = true;
                        } catch (Exception e) {
                            attempt++;
                            System.err.printf(&quot;Error processant el registre amb clau %s i valor %s, intent %d%n&quot;, record.key(), record.value(), attempt);
                            e.printStackTrace();
                            try {
                                Thread.sleep(100); // Retard abans de reintentar
                            } catch (InterruptedException ie) {
                                Thread.currentThread().interrupt();
                            }
                        }
                    }
                    if (!success) {
                        System.err.printf(&quot;No s'ha pogut processar el registre amb clau %s i valor %s despr&eacute;s de %d intents%n&quot;, record.key(), record.value(), MAX_RETRIES);
                    }
                }
            }
        } catch (WakeupException e) {
            // Ignorar excepci&oacute; si es tanca
        } finally {
            consumer.close();
        }
    }
}</pre></div><div class='content'></div><h1>Tècniques Avançades</h1>
<div class='content'><p>Les tècniques avançades de gestió d'errors i reintents poden millorar encara més la robustesa de les teves aplicacions Kafka.</p>
</div><h2>Productor Idempotent</h2>
<div class='content'><p>Un productor idempotent assegura que els missatges no es dupliquin, fins i tot si es produeixen reintents.</p>
<h4>Exemple: Configuració del Productor Idempotent</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("UHJvcGVydGllcyBwcm9wcyA9IG5ldyBQcm9wZXJ0aWVzKCk7CnByb3BzLnB1dCgiYm9vdHN0cmFwLnNlcnZlcnMiLCAibG9jYWxob3N0OjkwOTIiKTsKcHJvcHMucHV0KCJrZXkuc2VyaWFsaXplciIsICJvcmcuYXBhY2hlLmthZmthLmNvbW1vbi5zZXJpYWxpemF0aW9uLlN0cmluZ1NlcmlhbGl6ZXIiKTsKcHJvcHMucHV0KCJ2YWx1ZS5zZXJpYWxpemVyIiwgIm9yZy5hcGFjaGUua2Fma2EuY29tbW9uLnNlcmlhbGl6YXRpb24uU3RyaW5nU2VyaWFsaXplciIpOwpwcm9wcy5wdXQoImVuYWJsZS5pZGVtcG90ZW5jZSIsICJ0cnVlIik7IC8vIEhhYmlsaXRhciBpZGVtcG90w6huY2lhCgpQcm9kdWNlcjxTdHJpbmcsIFN0cmluZz4gcHJvZHVjZXIgPSBuZXcgS2Fma2FQcm9kdWNlcjw+KHByb3BzKTs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>Properties props = new Properties();
props.put(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);
props.put(&quot;key.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);
props.put(&quot;value.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);
props.put(&quot;enable.idempotence&quot;, &quot;true&quot;); // Habilitar idempot&egrave;ncia

Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props);</pre></div><div class='content'></div><h2>Cua de Missatges Fallits (DLQ)</h2>
<div class='content'><p>Una Cua de Missatges Fallits és un tema especial de Kafka on es col·loquen els missatges que no es poden processar després d'un cert nombre de reintents per a una anàlisi posterior.</p>
<h4>Exemple: Enviament a DLQ</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHVibGljIGNsYXNzIEthZmthQ29uc3VtZXJXaXRoRExRIHsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBNQVhfUkVUUklFUyA9IDM7CgogICAgcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgewogICAgICAgIFByb3BlcnRpZXMgcHJvcHMgPSBuZXcgUHJvcGVydGllcygpOwogICAgICAgIHByb3BzLnB1dCgiYm9vdHN0cmFwLnNlcnZlcnMiLCAibG9jYWxob3N0OjkwOTIiKTsKICAgICAgICBwcm9wcy5wdXQoImdyb3VwLmlkIiwgIm15LWdyb3VwIik7CiAgICAgICAgcHJvcHMucHV0KCJrZXkuZGVzZXJpYWxpemVyIiwgIm9yZy5hcGFjaGUua2Fma2EuY29tbW9uLnNlcmlhbGl6YXRpb24uU3RyaW5nRGVzZXJpYWxpemVyIik7CiAgICAgICAgcHJvcHMucHV0KCJ2YWx1ZS5kZXNlcmlhbGl6ZXIiLCAib3JnLmFwYWNoZS5rYWZrYS5jb21tb24uc2VyaWFsaXphdGlvbi5TdHJpbmdEZXNlcmlhbGl6ZXIiKTsKCiAgICAgICAgQ29uc3VtZXI8U3RyaW5nLCBTdHJpbmc+IGNvbnN1bWVyID0gbmV3IEthZmthQ29uc3VtZXI8Pihwcm9wcyk7CiAgICAgICAgUHJvZHVjZXI8U3RyaW5nLCBTdHJpbmc+IHByb2R1Y2VyID0gbmV3IEthZmthUHJvZHVjZXI8Pihwcm9wcyk7CiAgICAgICAgY29uc3VtZXIuc3Vic2NyaWJlKENvbGxlY3Rpb25zLnNpbmdsZXRvbkxpc3QoIm15LXRvcGljIikpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgICAgQ29uc3VtZXJSZWNvcmRzPFN0cmluZywgU3RyaW5nPiByZWNvcmRzID0gY29uc3VtZXIucG9sbChEdXJhdGlvbi5vZk1pbGxpcygxMDApKTsKICAgICAgICAgICAgICAgIGZvciAoQ29uc3VtZXJSZWNvcmQ8U3RyaW5nLCBTdHJpbmc+IHJlY29yZCA6IHJlY29yZHMpIHsKICAgICAgICAgICAgICAgICAgICBib29sZWFuIHN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBpbnQgYXR0ZW1wdCA9IDA7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCFzdWNjZXNzICYmIGF0dGVtcHQgPCBNQVhfUkVUUklFUykgewogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGYoIlJlZ2lzdHJlIGNvbnN1bWl0IGFtYiBjbGF1ICVzIGkgdmFsb3IgJXMlbiIsIHJlY29yZC5rZXkoKSwgcmVjb3JkLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRlbXB0Kys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50ZigiRXJyb3IgcHJvY2Vzc2FudCBlbCByZWdpc3RyZSBhbWIgY2xhdSAlcyBpIHZhbG9yICVzLCBpbnRlbnQgJWQlbiIsIHJlY29yZC5rZXkoKSwgcmVjb3JkLnZhbHVlKCksIGF0dGVtcHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmludFN0YWNrVHJhY2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhyZWFkLnNsZWVwKDEwMCk7IC8vIFJldGFyZCBhYmFucyBkZSByZWludGVudGFyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFzdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRmKCJObyBzJ2hhIHBvZ3V0IHByb2Nlc3NhciBlbCByZWdpc3RyZSBhbWIgY2xhdSAlcyBpIHZhbG9yICVzIGRlc3Byw6lzIGRlICVkIGludGVudHMuIEVudmlhbnQgYSBETFEuJW4iLCByZWNvcmQua2V5KCksIHJlY29yZC52YWx1ZSgpLCBNQVhfUkVUUklFUyk7CiAgICAgICAgICAgICAgICAgICAgICAgIFByb2R1Y2VyUmVjb3JkPFN0cmluZywgU3RyaW5nPiBkbHFSZWNvcmQgPSBuZXcgUHJvZHVjZXJSZWNvcmQ8PigiZGxxLXRvcGljIiwgcmVjb3JkLmtleSgpLCByZWNvcmQudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y2VyLnNlbmQoZGxxUmVjb3JkKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChXYWtldXBFeGNlcHRpb24gZSkgewogICAgICAgICAgICAvLyBJZ25vcmFyIGV4Y2VwY2nDsyBzaSBlcyB0YW5jYQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGNvbnN1bWVyLmNsb3NlKCk7CiAgICAgICAgICAgIHByb2R1Y2VyLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQp9"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>public class KafkaConsumerWithDLQ {
    private static final int MAX_RETRIES = 3;

    public static void main(String[] args) {
        Properties props = new Properties();
        props.put(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);
        props.put(&quot;group.id&quot;, &quot;my-group&quot;);
        props.put(&quot;key.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);
        props.put(&quot;value.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);

        Consumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props);
        Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props);
        consumer.subscribe(Collections.singletonList(&quot;my-topic&quot;));

        try {
            while (true) {
                ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(100));
                for (ConsumerRecord&lt;String, String&gt; record : records) {
                    boolean success = false;
                    int attempt = 0;
                    while (!success &amp;&amp; attempt &lt; MAX_RETRIES) {
                        try {
                            System.out.printf(&quot;Registre consumit amb clau %s i valor %s%n&quot;, record.key(), record.value());
                            success = true;
                        } catch (Exception e) {
                            attempt++;
                            System.err.printf(&quot;Error processant el registre amb clau %s i valor %s, intent %d%n&quot;, record.key(), record.value(), attempt);
                            e.printStackTrace();
                            try {
                                Thread.sleep(100); // Retard abans de reintentar
                            } catch (InterruptedException ie) {
                                Thread.currentThread().interrupt();
                            }
                        }
                    }
                    if (!success) {
                        System.err.printf(&quot;No s'ha pogut processar el registre amb clau %s i valor %s despr&eacute;s de %d intents. Enviant a DLQ.%n&quot;, record.key(), record.value(), MAX_RETRIES);
                        ProducerRecord&lt;String, String&gt; dlqRecord = new ProducerRecord&lt;&gt;(&quot;dlq-topic&quot;, record.key(), record.value());
                        producer.send(dlqRecord);
                    }
                }
            }
        } catch (WakeupException e) {
            // Ignorar excepci&oacute; si es tanca
        } finally {
            consumer.close();
            producer.close();
        }
    }
}</pre></div><div class='content'></div><h1>Conclusió</h1>
<div class='content'><p>La gestió d'errors i els reintents són components essencials per construir aplicacions Kafka robustes. Comprenent i implementant les estratègies discutides en aquesta secció, pots assegurar que les teves aplicacions puguin gestionar errors transitoris de manera elegant i mantenir la integritat de les dades. Tant si ets un principiant com un usuari avançat, dominar aquestes tècniques millorarà significativament la fiabilitat dels teus sistemes basats en Kafka.</p>
</div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
