<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triggers en PL/SQL</title>

    <link rel="alternate" href="https://campusempresa.com/es/plsql/triggers" hreflang="es" />
    <link rel="alternate" href="https://campusempresa.com/es/plsql/triggers" hreflang="x-default" />
	<link rel="alternate" href="https://campusempresa.com/ca/plsql/triggers" hreflang="ca" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/ca/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construint la societat d'avui i del demà</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
							<a href="/es/plsql/triggers" id="lnk_lang_es" data-lang="es" class="px-2">ES</a></b>
				|
				<b id="lit_lang_ca" class="px-2">CA</b>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/ca/objective">El Projecte</a>
				<a href="/ca/about">Sobre nosaltres</a>
				<a href="/ca/contribute">Contribuir</a>
				<a href="/ca/donate">Donacions</a>
				<a href="/ca/licence">Llicència</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'><div class='col-6'><a href='packages'>&#x25C4; Paquets</a></div><div class='col-6 text-end'><a href='dynamic-sql'>SQL Dinàmic &#x25BA;</a></div></div><div class='content'></div><h1>Introducció als Triggers</h1>
<div class='content'><p>Els triggers són un tipus especial de procediment emmagatzemat que s'executa automàticament quan es produeixen certs esdeveniments. S'utilitzen per fer complir les regles de negoci, mantenir registres d'auditoria i sincronitzar taules.</p>
</div><h2>Conceptes Clau</h2>
<div class='content'><ul>
<li><strong>Esdeveniment del Trigger</strong>: L'esdeveniment específic que fa que el trigger s'activi (per exemple, INSERT, UPDATE, DELETE).</li>
<li><strong>Moment del Trigger</strong>: Especifica quan s'ha d'activar el trigger (per exemple, BEFORE, AFTER).</li>
<li><strong>Tipus de Trigger</strong>: Defineix l'abast del trigger (per exemple, a nivell de fila, a nivell de sentència).</li>
<li><strong>Cos del Trigger</strong>: El codi PL/SQL que s'executa quan s'activa el trigger.</li>
</ul>
</div><h1>Crear Triggers</h1>
<div class='content'><p>Per crear un trigger, s'utilitza la sentència <code>CREATE TRIGGER</code>. La sintaxi bàsica és la següent:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIFtPUiBSRVBMQUNFXSBUUklHR0VSIG5vbV9kZWxfdHJpZ2dlcgp7QkVGT1JFIHwgQUZURVJ9IHtJTlNFUlQgfCBVUERBVEUgfCBERUxFVEV9Ck9OIG5vbV9kZV9sYV90YXVsYQpbRk9SIEVBQ0ggUk9XXQpERUNMQVJFCiAgLS0gZGVjbGFyYWNpw7MgZGUgdmFyaWFibGVzCkJFR0lOCiAgLS0gY29zIGRlbCB0cmlnZ2VyCkVORDs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE [OR REPLACE] TRIGGER nom_del_trigger
{BEFORE | AFTER} {INSERT | UPDATE | DELETE}
ON nom_de_la_taula
[FOR EACH ROW]
DECLARE
  -- declaraci&oacute; de variables
BEGIN
  -- cos del trigger
END;</pre></div><div class='content'></div><h2>Exemple: Trigger Bàsic</h2>
<div class='content'><p>Creem un trigger senzill que registra els canvis en una taula <code>employees</code>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIE9SIFJFUExBQ0UgVFJJR0dFUiBsb2dfZW1wbG95ZWVfY2hhbmdlcwpBRlRFUiBJTlNFUlQgT1IgVVBEQVRFIE9SIERFTEVURQpPTiBlbXBsb3llZXMKRk9SIEVBQ0ggUk9XCkJFR0lOCiAgSUYgSU5TRVJUSU5HIFRIRU4KICAgIElOU0VSVCBJTlRPIGVtcGxveWVlX2xvZyAobG9nX2RhdGUsIHVzZXJfaWQsIG9wZXJhdGlvbikKICAgIFZBTFVFUyAoU1lTREFURSwgVVNFUiwgJ0lOU0VSVCcpOwogIEVMU0lGIFVQREFUSU5HIFRIRU4KICAgIElOU0VSVCBJTlRPIGVtcGxveWVlX2xvZyAobG9nX2RhdGUsIHVzZXJfaWQsIG9wZXJhdGlvbikKICAgIFZBTFVFUyAoU1lTREFURSwgVVNFUiwgJ1VQREFURScpOwogIEVMU0lGIERFTEVUSU5HIFRIRU4KICAgIElOU0VSVCBJTlRPIGVtcGxveWVlX2xvZyAobG9nX2RhdGUsIHVzZXJfaWQsIG9wZXJhdGlvbikKICAgIFZBTFVFUyAoU1lTREFURSwgVVNFUiwgJ0RFTEVURScpOwogIEVORCBJRjsKRU5EOw=="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE OR REPLACE TRIGGER log_employee_changes
AFTER INSERT OR UPDATE OR DELETE
ON employees
FOR EACH ROW
BEGIN
  IF INSERTING THEN
    INSERT INTO employee_log (log_date, user_id, operation)
    VALUES (SYSDATE, USER, 'INSERT');
  ELSIF UPDATING THEN
    INSERT INTO employee_log (log_date, user_id, operation)
    VALUES (SYSDATE, USER, 'UPDATE');
  ELSIF DELETING THEN
    INSERT INTO employee_log (log_date, user_id, operation)
    VALUES (SYSDATE, USER, 'DELETE');
  END IF;
END;</pre></div><div class='content'></div><h2>Explicació</h2>
<div class='content'><ul>
<li><strong>Nom del Trigger</strong>: <code>log_employee_changes</code></li>
<li><strong>Moment del Trigger</strong>: <code>AFTER</code></li>
<li><strong>Esdeveniment del Trigger</strong>: <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code></li>
<li><strong>Abast del Trigger</strong>: <code>FOR EACH ROW</code> (trigger a nivell de fila)</li>
<li><strong>Cos del Trigger</strong>: Insereix una entrada de registre a la taula <code>employee_log</code> sempre que es produeixi una operació d'inserció, actualització o eliminació a la taula <code>employees</code>.</li>
</ul>
</div><h1>Conceptes Avançats de Triggers</h1>
<div class='content'></div><h2>Triggers Compostos</h2>
<div class='content'><p>Els triggers compostos permeten definir múltiples punts de temps dins d'un sol trigger. Això pot ajudar a evitar errors de taules mutables i millorar el rendiment.</p>
<h4>Exemple: Trigger Compost</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIE9SIFJFUExBQ0UgVFJJR0dFUiBjb21wb3VuZF9lbXBsb3llZV90cmlnZ2VyCkZPUiBJTlNFUlQgT1IgVVBEQVRFIE9SIERFTEVURSBPTiBlbXBsb3llZXMKQ09NUE9VTkQgVFJJR0dFUgogIFRZUEUgdF9lbXBsb3llZV9pZHMgSVMgVEFCTEUgT0YgZW1wbG95ZWVzLmVtcGxveWVlX2lkJVRZUEU7CiAgZW1wbG95ZWVfaWRzIHRfZW1wbG95ZWVfaWRzIDo9IHRfZW1wbG95ZWVfaWRzKCk7CgogIEJFRk9SRSBTVEFURU1FTlQgSVMKICBCRUdJTgogICAgLS0gQ29kaSBhIGV4ZWN1dGFyIGFiYW5zIGRlIGxhIHNlbnTDqG5jaWEgZGVzZW5jYWRlbmFudAogIEVORCBCRUZPUkUgU1RBVEVNRU5UOwoKICBCRUZPUkUgRUFDSCBST1cgSVMKICBCRUdJTgogICAgLS0gQ29kaSBhIGV4ZWN1dGFyIGFiYW5zIGRlIGNhZGEgZmlsYQogICAgSUYgSU5TRVJUSU5HIE9SIFVQREFUSU5HIFRIRU4KICAgICAgZW1wbG95ZWVfaWRzLkVYVEVORDsKICAgICAgZW1wbG95ZWVfaWRzKGVtcGxveWVlX2lkcy5DT1VOVCkgOj0gOk5FVy5lbXBsb3llZV9pZDsKICAgIEVORCBJRjsKICBFTkQgQkVGT1JFIEVBQ0ggUk9XOwoKICBBRlRFUiBFQUNIIFJPVyBJUwogIEJFR0lOCiAgICAtLSBDb2RpIGEgZXhlY3V0YXIgZGVzcHLDqXMgZGUgY2FkYSBmaWxhCiAgRU5EIEFGVEVSIEVBQ0ggUk9XOwoKICBBRlRFUiBTVEFURU1FTlQgSVMKICBCRUdJTgogICAgLS0gQ29kaSBhIGV4ZWN1dGFyIGRlc3Byw6lzIGRlIGxhIHNlbnTDqG5jaWEgZGVzZW5jYWRlbmFudAogICAgRk9SIGkgSU4gMSAuLiBlbXBsb3llZV9pZHMuQ09VTlQgTE9PUAogICAgICAtLSBQcm9jZXNzYXIgY2FkYSBlbXBsb3llZV9pZAogICAgRU5EIExPT1A7CiAgRU5EIEFGVEVSIFNUQVRFTUVOVDsKRU5EIGNvbXBvdW5kX2VtcGxveWVlX3RyaWdnZXI7"))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE OR REPLACE TRIGGER compound_employee_trigger
FOR INSERT OR UPDATE OR DELETE ON employees
COMPOUND TRIGGER
  TYPE t_employee_ids IS TABLE OF employees.employee_id%TYPE;
  employee_ids t_employee_ids := t_employee_ids();

  BEFORE STATEMENT IS
  BEGIN
    -- Codi a executar abans de la sent&egrave;ncia desencadenant
  END BEFORE STATEMENT;

  BEFORE EACH ROW IS
  BEGIN
    -- Codi a executar abans de cada fila
    IF INSERTING OR UPDATING THEN
      employee_ids.EXTEND;
      employee_ids(employee_ids.COUNT) := :NEW.employee_id;
    END IF;
  END BEFORE EACH ROW;

  AFTER EACH ROW IS
  BEGIN
    -- Codi a executar despr&eacute;s de cada fila
  END AFTER EACH ROW;

  AFTER STATEMENT IS
  BEGIN
    -- Codi a executar despr&eacute;s de la sent&egrave;ncia desencadenant
    FOR i IN 1 .. employee_ids.COUNT LOOP
      -- Processar cada employee_id
    END LOOP;
  END AFTER STATEMENT;
END compound_employee_trigger;</pre></div><div class='content'></div><h2>Explicació</h2>
<div class='content'><ul>
<li><strong>Trigger Compost</strong>: Combina múltiples punts de temps (<code>BEFORE STATEMENT</code>, <code>BEFORE EACH ROW</code>, <code>AFTER EACH ROW</code>, <code>AFTER STATEMENT</code>) dins d'un sol trigger.</li>
<li><strong>Emmagatzematge Temporal</strong>: Utilitza una col·lecció PL/SQL (<code>employee_ids</code>) per emmagatzemar dades a través de diferents punts de temps.</li>
</ul>
</div><h1>Gestió de Triggers</h1>
<div class='content'><ul>
<li><strong>Habilitar/Deshabilitar Triggers</strong>: Es poden habilitar o deshabilitar triggers utilitzant la sentència <code>ALTER TRIGGER</code>.</li>
<li><strong>Eliminar Triggers</strong>: Es pot eliminar un trigger utilitzant la sentència <code>DROP TRIGGER</code>.</li>
</ul>
</div><h2>Exemple: Gestió de Triggers</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gRGVzaGFiaWxpdGFyIHVuIHRyaWdnZXIKQUxURVIgVFJJR0dFUiBsb2dfZW1wbG95ZWVfY2hhbmdlcyBESVNBQkxFOwoKLS0gSGFiaWxpdGFyIHVuIHRyaWdnZXIKQUxURVIgVFJJR0dFUiBsb2dfZW1wbG95ZWVfY2hhbmdlcyBFTkFCTEU7CgotLSBFbGltaW5hciB1biB0cmlnZ2VyCkRST1AgVFJJR0dFUiBsb2dfZW1wbG95ZWVfY2hhbmdlczs="))));alert("Copiat!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Deshabilitar un trigger
ALTER TRIGGER log_employee_changes DISABLE;

-- Habilitar un trigger
ALTER TRIGGER log_employee_changes ENABLE;

-- Eliminar un trigger
DROP TRIGGER log_employee_changes;</pre></div><div class='content'></div><h1>Millors Pràctiques</h1>
<div class='content'><ul>
<li><strong>Mantenir els Triggers Simples</strong>: Evitar la lògica complexa dins dels triggers per mantenir el rendiment i la llegibilitat.</li>
<li><strong>Utilitzar Triggers Compostos</strong>: Per gestionar múltiples punts de temps i evitar errors de taules mutables.</li>
<li><strong>Documentar els Triggers</strong>: Documentar clarament el propòsit i la lògica de cada trigger.</li>
</ul>
</div><h1>Conclusió</h1>
<div class='content'><p>Els triggers en PL/SQL són eines poderoses per automatitzar tasques de bases de dades i fer complir les regles de negoci. Comprenent els conceptes bàsics i avançats, es poden utilitzar efectivament els triggers per millorar les aplicacions de bases de dades. Sempre seguir les millors pràctiques per assegurar que els triggers siguin eficients i mantenibles.</p>
</div><div class='row navigation'><div class='col-6'><a href='packages'>&#x25C4; Paquets</a></div><div class='col-6 text-end'><a href='dynamic-sql'>SQL Dinàmic &#x25BA;</a></div></div></div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicitat</h1>
			<p>Aquest espai està destinat a publicitat.</p>
			<p>Si vols ser patrocinador, contacta amb nosaltres per incloure enllaços en aquesta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Gràcies per col·laborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Tots els drets reservats</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/ca/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
