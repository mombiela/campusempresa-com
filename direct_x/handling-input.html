<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manejo de Entrada en DirectX</title>

    <link rel="alternate" href="https://campusempresa.com/direct_x/handling-input" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/direct_x/handling-input" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/direct_x/handling-input" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
										<a href="https://enterprisecampus.net/direct_x/handling-input" class="px-2">EN</a></b>
				|
				<b class="px-2">ES</b>
				|
				<a href="https://campusempresa.cat/direct_x/handling-input" class="px-2">CA</a>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Proyecto</a>
				<a href="/about">Sobre nosotros</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donaciones</a>
				<a href="/licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='creating-a-game-loop'>&#x25C4;Creando un Bucle de Juego</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Manejo de Entrada en DirectX</a>
	</div>
	<div class='col-4 text-end'>
					<a href='collision-detection-and-physics'>Detección de Colisiones y Física &#x25BA;</a>
			</div>
</div>
<div class='content'><p>El manejo de entrada es un aspecto crucial del desarrollo de aplicaciones interactivas y juegos utilizando DirectX. Este tema te guiará a través de los conceptos básicos de captura y procesamiento de la entrada del usuario, progresando hacia técnicas más avanzadas.</p>
</div><h1>Introducción al Manejo de Entrada</h1>
<div class='content'><p>En DirectX, el manejo de entrada generalmente implica capturar datos de varios dispositivos de entrada como el teclado, el ratón y los controladores de juegos. Comenzaremos con lo básico y gradualmente avanzaremos a escenarios más complejos.</p>
</div><h2>Conceptos Clave</h2>
<div class='content'><ul>
<li><strong>DirectInput</strong>: Una API heredada para manejar dispositivos de entrada.</li>
<li><strong>Raw Input</strong>: Una forma más moderna y flexible de manejar la entrada.</li>
<li><strong>XInput</strong>: Diseñado específicamente para controladores de Xbox, pero también funciona con otros gamepads.</li>
</ul>
</div><h1>Usando DirectInput</h1>
<div class='content'><p>DirectInput es parte de la API de DirectX y proporciona una forma de interactuar con dispositivos de entrada. Aunque se considera algo desactualizado, sigue siendo útil para ciertas aplicaciones.</p>
</div><h2>Inicializando DirectInput</h2>
<div class='content'><p>Para usar DirectInput, necesitas inicializarlo y crear objetos de dispositivo para los dispositivos de entrada que deseas manejar.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("I2luY2x1ZGUgPGRpbnB1dC5oPgoKLy8gVmFyaWFibGVzIGdsb2JhbGVzIGRlIERpcmVjdElucHV0CkxQRElSRUNUSU5QVVQ4IGdfcERJID0gTlVMTDsKTFBESVJFQ1RJTlBVVERFVklDRTggZ19wS2V5Ym9hcmQgPSBOVUxMOwoKLy8gSW5pY2lhbGl6YXIgRGlyZWN0SW5wdXQKSFJFU1VMVCBJbml0RGlyZWN0SW5wdXQoSElOU1RBTkNFIGhJbnN0YW5jZSwgSFdORCBoV25kKSB7CiAgICBIUkVTVUxUIGhyOwoKICAgIC8vIENyZWFyIGxhIGludGVyZmF6IGRlIERpcmVjdElucHV0CiAgICBociA9IERpcmVjdElucHV0OENyZWF0ZShoSW5zdGFuY2UsIERJUkVDVElOUFVUX1ZFUlNJT04sIElJRF9JRGlyZWN0SW5wdXQ4LCAodm9pZCoqKSZnX3BESSwgTlVMTCk7CiAgICBpZiAoRkFJTEVEKGhyKSkgcmV0dXJuIGhyOwoKICAgIC8vIENyZWFyIHVuIGRpc3Bvc2l0aXZvIHBhcmEgZWwgdGVjbGFkbwogICAgaHIgPSBnX3BESS0+Q3JlYXRlRGV2aWNlKEdVSURfU3lzS2V5Ym9hcmQsICZnX3BLZXlib2FyZCwgTlVMTCk7CiAgICBpZiAoRkFJTEVEKGhyKSkgcmV0dXJuIGhyOwoKICAgIC8vIEVzdGFibGVjZXIgZWwgZm9ybWF0byBkZSBkYXRvcyBwYXJhIGVsIHRlY2xhZG8KICAgIGhyID0gZ19wS2V5Ym9hcmQtPlNldERhdGFGb3JtYXQoJmNfZGZESUtleWJvYXJkKTsKICAgIGlmIChGQUlMRUQoaHIpKSByZXR1cm4gaHI7CgogICAgLy8gRXN0YWJsZWNlciBlbCBuaXZlbCBjb29wZXJhdGl2bwogICAgaHIgPSBnX3BLZXlib2FyZC0+U2V0Q29vcGVyYXRpdmVMZXZlbChoV25kLCBESVNDTF9GT1JFR1JPVU5EIHwgRElTQ0xfTk9ORVhDTFVTSVZFKTsKICAgIGlmIChGQUlMRUQoaHIpKSByZXR1cm4gaHI7CgogICAgcmV0dXJuIFNfT0s7Cn0="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#include &lt;dinput.h&gt;

// Variables globales de DirectInput
LPDIRECTINPUT8 g_pDI = NULL;
LPDIRECTINPUTDEVICE8 g_pKeyboard = NULL;

// Inicializar DirectInput
HRESULT InitDirectInput(HINSTANCE hInstance, HWND hWnd) {
    HRESULT hr;

    // Crear la interfaz de DirectInput
    hr = DirectInput8Create(hInstance, DIRECTINPUT_VERSION, IID_IDirectInput8, (void**)&amp;g_pDI, NULL);
    if (FAILED(hr)) return hr;

    // Crear un dispositivo para el teclado
    hr = g_pDI-&gt;CreateDevice(GUID_SysKeyboard, &amp;g_pKeyboard, NULL);
    if (FAILED(hr)) return hr;

    // Establecer el formato de datos para el teclado
    hr = g_pKeyboard-&gt;SetDataFormat(&amp;c_dfDIKeyboard);
    if (FAILED(hr)) return hr;

    // Establecer el nivel cooperativo
    hr = g_pKeyboard-&gt;SetCooperativeLevel(hWnd, DISCL_FOREGROUND | DISCL_NONEXCLUSIVE);
    if (FAILED(hr)) return hr;

    return S_OK;
}</pre></div><div class='content'></div><h2>Leyendo la Entrada del Teclado</h2>
<div class='content'><p>Una vez inicializado, puedes leer el estado del teclado.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("QllURSBnX0tleWJvYXJkU3RhdGVbMjU2XTsKCi8vIExlZXIgZWwgZXN0YWRvIGRlbCB0ZWNsYWRvCnZvaWQgUmVhZEtleWJvYXJkKCkgewogICAgSFJFU1VMVCBociA9IGdfcEtleWJvYXJkLT5HZXREZXZpY2VTdGF0ZShzaXplb2YoZ19LZXlib2FyZFN0YXRlKSwgKExQVk9JRCkmZ19LZXlib2FyZFN0YXRlKTsKICAgIGlmIChGQUlMRUQoaHIpKSB7CiAgICAgICAgLy8gUmVhZHF1aXJpciBlbCBkaXNwb3NpdGl2byBzaSBlcyBuZWNlc2FyaW8KICAgICAgICBpZiAoaHIgPT0gRElFUlJfSU5QVVRMT1NUIHx8IGhyID09IERJRVJSX05PVEFDUVVJUkVEKSB7CiAgICAgICAgICAgIGdfcEtleWJvYXJkLT5BY3F1aXJlKCk7CiAgICAgICAgfQogICAgfQp9CgovLyBWZXJpZmljYXIgc2kgdW5hIHRlY2xhIGVzdMOhIHByZXNpb25hZGEKYm9vbCBJc0tleVByZXNzZWQoQllURSBrZXkpIHsKICAgIHJldHVybiAoZ19LZXlib2FyZFN0YXRlW2tleV0gJiAweDgwKSAhPSAwOwp9"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>BYTE g_KeyboardState[256];

// Leer el estado del teclado
void ReadKeyboard() {
    HRESULT hr = g_pKeyboard-&gt;GetDeviceState(sizeof(g_KeyboardState), (LPVOID)&amp;g_KeyboardState);
    if (FAILED(hr)) {
        // Readquirir el dispositivo si es necesario
        if (hr == DIERR_INPUTLOST || hr == DIERR_NOTACQUIRED) {
            g_pKeyboard-&gt;Acquire();
        }
    }
}

// Verificar si una tecla est&aacute; presionada
bool IsKeyPressed(BYTE key) {
    return (g_KeyboardState[key] &amp; 0x80) != 0;
}</pre></div><div class='content'></div><h1>Usando Raw Input</h1>
<div class='content'><p>Raw Input proporciona más flexibilidad y es la forma recomendada de manejar la entrada en aplicaciones modernas.</p>
</div><h2>Registrando para Raw Input</h2>
<div class='content'><p>Primero, necesitas registrar tu aplicación para recibir datos de entrada sin procesar.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("UkFXSU5QVVRERVZJQ0UgUmlkWzFdOwoKLy8gUmVnaXN0cmFyc2UgcGFyYSBSYXcgSW5wdXQKdm9pZCBSZWdpc3RlclJhd0lucHV0KEhXTkQgaFduZCkgewogICAgUmlkWzBdLnVzVXNhZ2VQYWdlID0gSElEX1VTQUdFX1BBR0VfR0VORVJJQzsKICAgIFJpZFswXS51c1VzYWdlID0gSElEX1VTQUdFX0dFTkVSSUNfTU9VU0U7CiAgICBSaWRbMF0uZHdGbGFncyA9IFJJREVWX0lOUFVUU0lOSzsKICAgIFJpZFswXS5od25kVGFyZ2V0ID0gaFduZDsKCiAgICBpZiAoUmVnaXN0ZXJSYXdJbnB1dERldmljZXMoUmlkLCAxLCBzaXplb2YoUmlkWzBdKSkgPT0gRkFMU0UpIHsKICAgICAgICAvLyBMYSByZWdpc3RyYWNpw7NuIGZhbGzDswogICAgfQp9"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>RAWINPUTDEVICE Rid[1];

// Registrarse para Raw Input
void RegisterRawInput(HWND hWnd) {
    Rid[0].usUsagePage = HID_USAGE_PAGE_GENERIC;
    Rid[0].usUsage = HID_USAGE_GENERIC_MOUSE;
    Rid[0].dwFlags = RIDEV_INPUTSINK;
    Rid[0].hwndTarget = hWnd;

    if (RegisterRawInputDevices(Rid, 1, sizeof(Rid[0])) == FALSE) {
        // La registraci&oacute;n fall&oacute;
    }
}</pre></div><div class='content'></div><h2>Procesando Raw Input</h2>
<div class='content'><p>Puedes procesar los datos de entrada sin procesar en tu procedimiento de ventana.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("TFJFU1VMVCBDQUxMQkFDSyBXaW5kb3dQcm9jKEhXTkQgaFduZCwgVUlOVCBtZXNzYWdlLCBXUEFSQU0gd1BhcmFtLCBMUEFSQU0gbFBhcmFtKSB7CiAgICBzd2l0Y2ggKG1lc3NhZ2UpIHsKICAgICAgICBjYXNlIFdNX0lOUFVUOiB7CiAgICAgICAgICAgIFVJTlQgZHdTaXplOwogICAgICAgICAgICBHZXRSYXdJbnB1dERhdGEoKEhSQVdJTlBVVClsUGFyYW0sIFJJRF9JTlBVVCwgTlVMTCwgJmR3U2l6ZSwgc2l6ZW9mKFJBV0lOUFVUSEVBREVSKSk7CiAgICAgICAgICAgIExQQllURSBscGIgPSBuZXcgQllURVtkd1NpemVdOwogICAgICAgICAgICBpZiAobHBiID09IE5VTEwpIHJldHVybiAwOwoKICAgICAgICAgICAgaWYgKEdldFJhd0lucHV0RGF0YSgoSFJBV0lOUFVUKWxQYXJhbSwgUklEX0lOUFVULCBscGIsICZkd1NpemUsIHNpemVvZihSQVdJTlBVVEhFQURFUikpICE9IGR3U2l6ZSkgewogICAgICAgICAgICAgICAgT3V0cHV0RGVidWdTdHJpbmcoVEVYVCgiR2V0UmF3SW5wdXREYXRhIG5vIGRldnVlbHZlIGVsIHRhbWHDsW8gY29ycmVjdG8hXG4iKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFJBV0lOUFVUKiByYXcgPSAoUkFXSU5QVVQqKWxwYjsKCiAgICAgICAgICAgIGlmIChyYXctPmhlYWRlci5kd1R5cGUgPT0gUklNX1RZUEVNT1VTRSkgewogICAgICAgICAgICAgICAgLy8gUHJvY2VzYXIgZW50cmFkYSBkZWwgcmF0w7NuCiAgICAgICAgICAgICAgICBpbnQgeFBvc1JlbGF0aXZlID0gcmF3LT5kYXRhLm1vdXNlLmxMYXN0WDsKICAgICAgICAgICAgICAgIGludCB5UG9zUmVsYXRpdmUgPSByYXctPmRhdGEubW91c2UubExhc3RZOwogICAgICAgICAgICAgICAgLy8gTWFuZWphciBtb3ZpbWllbnRvIGRlbCByYXTDs24KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZGVsZXRlW10gbHBiOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgLy8gTWFuZWphciBvdHJvcyBtZW5zYWplcwogICAgfQogICAgcmV0dXJuIERlZldpbmRvd1Byb2MoaFduZCwgbWVzc2FnZSwgd1BhcmFtLCBsUGFyYW0pOwp9"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>LRESULT CALLBACK WindowProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam) {
    switch (message) {
        case WM_INPUT: {
            UINT dwSize;
            GetRawInputData((HRAWINPUT)lParam, RID_INPUT, NULL, &amp;dwSize, sizeof(RAWINPUTHEADER));
            LPBYTE lpb = new BYTE[dwSize];
            if (lpb == NULL) return 0;

            if (GetRawInputData((HRAWINPUT)lParam, RID_INPUT, lpb, &amp;dwSize, sizeof(RAWINPUTHEADER)) != dwSize) {
                OutputDebugString(TEXT(&quot;GetRawInputData no devuelve el tama&ntilde;o correcto!\n&quot;));
            }

            RAWINPUT* raw = (RAWINPUT*)lpb;

            if (raw-&gt;header.dwType == RIM_TYPEMOUSE) {
                // Procesar entrada del rat&oacute;n
                int xPosRelative = raw-&gt;data.mouse.lLastX;
                int yPosRelative = raw-&gt;data.mouse.lLastY;
                // Manejar movimiento del rat&oacute;n
            }

            delete[] lpb;
            return 0;
        }
        // Manejar otros mensajes
    }
    return DefWindowProc(hWnd, message, wParam, lParam);
}</pre></div><div class='content'></div><h1>Usando XInput</h1>
<div class='content'><p>XInput está diseñado para controladores de Xbox, pero también puede ser usado para otros gamepads. Proporciona una interfaz simple para manejar la entrada del controlador.</p>
</div><h2>Inicializando XInput</h2>
<div class='content'><p>XInput no requiere inicialización explícita. Puedes comenzar a usarlo directamente.</p>
</div><h2>Leyendo la Entrada del Controlador</h2>
<div class='content'><p>Puedes leer el estado del controlador usando <code>XInputGetState</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("I2luY2x1ZGUgPFhJbnB1dC5oPgoKLy8gTGVlciBlbCBlc3RhZG8gZGVsIGNvbnRyb2xhZG9yCnZvaWQgUmVhZENvbnRyb2xsZXIoKSB7CiAgICBYSU5QVVRfU1RBVEUgc3RhdGU7CiAgICBaZXJvTWVtb3J5KCZzdGF0ZSwgc2l6ZW9mKFhJTlBVVF9TVEFURSkpOwoKICAgIERXT1JEIGR3UmVzdWx0ID0gWElucHV0R2V0U3RhdGUoMCwgJnN0YXRlKTsKICAgIGlmIChkd1Jlc3VsdCA9PSBFUlJPUl9TVUNDRVNTKSB7CiAgICAgICAgLy8gRWwgY29udHJvbGFkb3IgZXN0w6EgY29uZWN0YWRvCiAgICAgICAgWElOUFVUX0dBTUVQQUQqIHBhZCA9ICZzdGF0ZS5HYW1lcGFkOwoKICAgICAgICAvLyBWZXJpZmljYXIgc2kgZWwgYm90w7NuIEEgZXN0w6EgcHJlc2lvbmFkbwogICAgICAgIGlmIChwYWQtPndCdXR0b25zICYgWElOUFVUX0dBTUVQQURfQSkgewogICAgICAgICAgICAvLyBNYW5lamFyIGxhIHByZXNpw7NuIGRlbCBib3TDs24gQQogICAgICAgIH0KCiAgICAgICAgLy8gVmVyaWZpY2FyIGxhcyBwb3NpY2lvbmVzIGRlbCBqb3lzdGljawogICAgICAgIGZsb2F0IExYID0gcGFkLT5zVGh1bWJMWCAvIDMyNzY3LjBmOwogICAgICAgIGZsb2F0IExZID0gcGFkLT5zVGh1bWJMWSAvIDMyNzY3LjBmOwogICAgICAgIC8vIE1hbmVqYXIgZWwgbW92aW1pZW50byBkZWwgam95c3RpY2sKICAgIH0gZWxzZSB7CiAgICAgICAgLy8gRWwgY29udHJvbGFkb3Igbm8gZXN0w6EgY29uZWN0YWRvCiAgICB9Cn0="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#include &lt;XInput.h&gt;

// Leer el estado del controlador
void ReadController() {
    XINPUT_STATE state;
    ZeroMemory(&amp;state, sizeof(XINPUT_STATE));

    DWORD dwResult = XInputGetState(0, &amp;state);
    if (dwResult == ERROR_SUCCESS) {
        // El controlador est&aacute; conectado
        XINPUT_GAMEPAD* pad = &amp;state.Gamepad;

        // Verificar si el bot&oacute;n A est&aacute; presionado
        if (pad-&gt;wButtons &amp; XINPUT_GAMEPAD_A) {
            // Manejar la presi&oacute;n del bot&oacute;n A
        }

        // Verificar las posiciones del joystick
        float LX = pad-&gt;sThumbLX / 32767.0f;
        float LY = pad-&gt;sThumbLY / 32767.0f;
        // Manejar el movimiento del joystick
    } else {
        // El controlador no est&aacute; conectado
    }
}</pre></div><div class='content'></div><h1>Resumen</h1>
<div class='content'><p>El manejo de entrada en DirectX implica entender y usar diferentes APIs dependiendo del tipo de dispositivo de entrada y los requisitos de tu aplicación.</p>
<ul>
<li><strong>DirectInput</strong> es útil para aplicaciones heredadas y proporciona una forma sencilla de manejar la entrada del teclado y el ratón.</li>
<li><strong>Raw Input</strong> ofrece más flexibilidad y es adecuado para aplicaciones modernas que necesitan datos de entrada detallados.</li>
<li><strong>XInput</strong> es ideal para manejar controladores de juegos, especialmente controladores de Xbox, con una interfaz simple y eficiente.</li>
</ul>
<p>Dominando estas técnicas, puedes crear aplicaciones DirectX receptivas e interactivas que proporcionen una gran experiencia de usuario.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='creating-a-game-loop'>&#x25C4;Creando un Bucle de Juego</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Manejo de Entrada en DirectX</a>
	</div>
	<div class='col-4 text-end'>
					<a href='collision-detection-and-physics'>Detección de Colisiones y Física &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Aceptar</a>
    <a href="/cookies">Mas información</a>
</div>	

	</div>    
</body>
</html>
