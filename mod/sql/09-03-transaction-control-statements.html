<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instrucciones de control de transacciones</title>

    <link rel="alternate" href="https://campusempresa.com/mod/sql/09-03-transaction-control-statements" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/sql/09-03-transaction-control-statements" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/sql/09-03-transaction-control-statements" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-2 p-md-0 text-end">
				<a href="https://enterprisecampus.net/mod/sql/09-03-transaction-control-statements" class="px-2">EN</a></b>
	|
	<b class="px-2">ES</b>
	|
	<a href="https://campusempresa.cat/mod/sql/09-03-transaction-control-statements" class="px-2">CA</a>
<br>
			<cite>Construyendo la sociedad de hoy y del mañana</cite>
		</div>
	</div>
</div>
<div id="subheader" class="container-xxl">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">El Proyecto</a> | 
<a href="/about">Sobre nosotros</a> | 
<a href="/contribute">Contribuir</a> | 
<a href="/donate">Donaciones</a> | 
<a href="/licence">Licencia</a>
		</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
									<a href="./">Contenido del curso</a>
					<span class="sep">|</span>
								<a href="/all/competencias">Competencias técnicas</a>
				<a href="/all/conocimientos">Conocimientos</a>
				<a href="/all/soft_skills">Competencias sociales</a>
			</div>
		</div>
	</div>
</div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='09-02-acid-properties' title="Propiedades ACID">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Instrucciones de control de transacciones</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='09-04-handling-concurrency' title="Manejo de concurrencia">
				<span class="d-none d-md-inline">Siguiente &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>En este tema, aprenderemos sobre las instrucciones de control de transacciones en SQL. Las transacciones son fundamentales para garantizar la integridad y consistencia de los datos en una base de datos. Las instrucciones de control de transacciones permiten gestionar el inicio, la confirmación y la reversión de transacciones.</p>
</div><h1><p>Conceptos Clave</p>
</h1>
<div class='content'><ol>
<li><strong>Transacción</strong>: Una transacción es una unidad de trabajo que se ejecuta de manera completa o no se ejecuta en absoluto. Asegura que las operaciones de la base de datos sean atómicas, consistentes, aisladas y duraderas (propiedades ACID).</li>
<li><strong>BEGIN TRANSACTION</strong>: Marca el inicio de una transacción.</li>
<li><strong>COMMIT</strong>: Confirma todas las operaciones realizadas durante la transacción.</li>
<li><strong>ROLLBACK</strong>: Revierte todas las operaciones realizadas durante la transacción.</li>
</ol>
</div><h1><p>Instrucciones de Control de Transacciones</p>
</h1>
<div class='content'></div><h2><p>BEGIN TRANSACTION</p>
</h2>
<div class='content'><p>La instrucción <code>BEGIN TRANSACTION</code> se utiliza para iniciar una nueva transacción. Todas las operaciones realizadas después de esta instrucción se consideran parte de la transacción hasta que se ejecute un <code>COMMIT</code> o <code>ROLLBACK</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("QkVHSU4gVFJBTlNBQ1RJT047"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>BEGIN TRANSACTION;</pre></div><div class='content'></div><h2><p>COMMIT</p>
</h2>
<div class='content'><p>La instrucción <code>COMMIT</code> se utiliza para confirmar todas las operaciones realizadas durante la transacción. Una vez que se ejecuta <code>COMMIT</code>, los cambios se guardan permanentemente en la base de datos.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q09NTUlUOw=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>COMMIT;</pre></div><div class='content'></div><h2><p>ROLLBACK</p>
</h2>
<div class='content'><p>La instrucción <code>ROLLBACK</code> se utiliza para deshacer todas las operaciones realizadas durante la transacción. Esto revierte la base de datos al estado en que se encontraba antes de que comenzara la transacción.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Uk9MTEJBQ0s7"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ROLLBACK;</pre></div><div class='content'></div><h1><p>Ejemplo Práctico</p>
</h1>
<div class='content'><p>Veamos un ejemplo práctico que ilustra cómo usar estas instrucciones de control de transacciones.</p>
</div><h2><p>Escenario</p>
</h2>
<div class='content'><p>Supongamos que tenemos una tabla <code>cuentas</code> con las siguientes columnas: <code>id</code>, <code>nombre</code>, y <code>saldo</code>. Queremos transferir dinero de una cuenta a otra de manera segura.</p>
</div><h2><p>Tabla <code>cuentas</code></p>
</h2>
<div class='content'><table>
<thead>
<tr>
<th>id</th>
<th>nombre</th>
<th>saldo</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Alice</td>
<td>1000</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
<td>500</td>
</tr>
</tbody>
</table>
</div><h2><p>Código SQL</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gSW5pY2lhciBsYSB0cmFuc2FjY2nDs24KQkVHSU4gVFJBTlNBQ1RJT047CgotLSBSZXN0YXIgMjAwIGRlbCBzYWxkbyBkZSBBbGljZQpVUERBVEUgY3VlbnRhcwpTRVQgc2FsZG8gPSBzYWxkbyAtIDIwMApXSEVSRSBub21icmUgPSAnQWxpY2UnOwoKLS0gU3VtYXIgMjAwIGFsIHNhbGRvIGRlIEJvYgpVUERBVEUgY3VlbnRhcwpTRVQgc2FsZG8gPSBzYWxkbyArIDIwMApXSEVSRSBub21icmUgPSAnQm9iJzsKCi0tIENvbmZpcm1hciBsYSB0cmFuc2FjY2nDs24KQ09NTUlUOw=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Iniciar la transacci&oacute;n
BEGIN TRANSACTION;

-- Restar 200 del saldo de Alice
UPDATE cuentas
SET saldo = saldo - 200
WHERE nombre = 'Alice';

-- Sumar 200 al saldo de Bob
UPDATE cuentas
SET saldo = saldo + 200
WHERE nombre = 'Bob';

-- Confirmar la transacci&oacute;n
COMMIT;</pre></div><div class='content'></div><h2><p>Explicación</p>
</h2>
<div class='content'><ol>
<li><strong>BEGIN TRANSACTION</strong>: Inicia la transacción.</li>
<li><strong>UPDATE cuentas SET saldo = saldo - 200 WHERE nombre = 'Alice'</strong>: Resta 200 del saldo de Alice.</li>
<li><strong>UPDATE cuentas SET saldo = saldo + 200 WHERE nombre = 'Bob'</strong>: Suma 200 al saldo de Bob.</li>
<li><strong>COMMIT</strong>: Confirma la transacción, haciendo permanentes los cambios.</li>
</ol>
</div><h2><p>Manejo de Errores</p>
</h2>
<div class='content'><p>Es importante manejar errores para asegurar que la base de datos no quede en un estado inconsistente. Si ocurre un error durante la transacción, debemos usar <code>ROLLBACK</code> para revertir los cambios.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("QkVHSU4gVFJBTlNBQ1RJT047CgpCRUdJTiBUUlkKICAgIC0tIFJlc3RhciAyMDAgZGVsIHNhbGRvIGRlIEFsaWNlCiAgICBVUERBVEUgY3VlbnRhcwogICAgU0VUIHNhbGRvID0gc2FsZG8gLSAyMDAKICAgIFdIRVJFIG5vbWJyZSA9ICdBbGljZSc7CgogICAgLS0gU3VtYXIgMjAwIGFsIHNhbGRvIGRlIEJvYgogICAgVVBEQVRFIGN1ZW50YXMKICAgIFNFVCBzYWxkbyA9IHNhbGRvICsgMjAwCiAgICBXSEVSRSBub21icmUgPSAnQm9iJzsKCiAgICAtLSBDb25maXJtYXIgbGEgdHJhbnNhY2Npw7NuCiAgICBDT01NSVQ7CkVORCBUUlkKQkVHSU4gQ0FUQ0gKICAgIC0tIFJldmVydGlyIGxhIHRyYW5zYWNjacOzbiBlbiBjYXNvIGRlIGVycm9yCiAgICBST0xMQkFDSzsKICAgIFBSSU5UICdFcnJvciBlbiBsYSB0cmFuc2FjY2nDs24uIFNlIGhhIHJldmVydGlkby4nOwpFTkQgQ0FUQ0g7"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>BEGIN TRANSACTION;

BEGIN TRY
    -- Restar 200 del saldo de Alice
    UPDATE cuentas
    SET saldo = saldo - 200
    WHERE nombre = 'Alice';

    -- Sumar 200 al saldo de Bob
    UPDATE cuentas
    SET saldo = saldo + 200
    WHERE nombre = 'Bob';

    -- Confirmar la transacci&oacute;n
    COMMIT;
END TRY
BEGIN CATCH
    -- Revertir la transacci&oacute;n en caso de error
    ROLLBACK;
    PRINT 'Error en la transacci&oacute;n. Se ha revertido.';
END CATCH;</pre></div><div class='content'></div><h2><p>Explicación</p>
</h2>
<div class='content'><ol>
<li><strong>BEGIN TRY</strong>: Inicia un bloque de código que intenta ejecutar las operaciones.</li>
<li><strong>BEGIN CATCH</strong>: Captura cualquier error que ocurra durante la ejecución del bloque <code>TRY</code>.</li>
<li><strong>ROLLBACK</strong>: Revertir la transacción si ocurre un error.</li>
<li><strong>PRINT 'Error en la transacción. Se ha revertido.'</strong>: Mensaje de error para el usuario.</li>
</ol>
</div><h1><p>Ejercicio Práctico</p>
</h1>
<div class='content'></div><h2><p>Ejercicio</p>
</h2>
<div class='content'><ol>
<li>Crea una tabla llamada <code>productos</code> con las siguientes columnas: <code>id</code>, <code>nombre</code>, <code>cantidad</code>.</li>
<li>Inserta dos registros en la tabla <code>productos</code>.</li>
<li>Escribe una transacción que:
<ul>
<li>Reste 10 de la cantidad del primer producto.</li>
<li>Sume 10 a la cantidad del segundo producto.</li>
<li>Confirme la transacción.</li>
</ul>
</li>
</ol>
</div><h2><p>Solución</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gQ3JlYXIgbGEgdGFibGEgcHJvZHVjdG9zCkNSRUFURSBUQUJMRSBwcm9kdWN0b3MgKAogICAgaWQgSU5UIFBSSU1BUlkgS0VZLAogICAgbm9tYnJlIFZBUkNIQVIoNTApLAogICAgY2FudGlkYWQgSU5UCik7CgotLSBJbnNlcnRhciByZWdpc3Ryb3MgZW4gbGEgdGFibGEgcHJvZHVjdG9zCklOU0VSVCBJTlRPIHByb2R1Y3RvcyAoaWQsIG5vbWJyZSwgY2FudGlkYWQpIFZBTFVFUyAoMSwgJ1Byb2R1Y3RvIEEnLCAxMDApOwpJTlNFUlQgSU5UTyBwcm9kdWN0b3MgKGlkLCBub21icmUsIGNhbnRpZGFkKSBWQUxVRVMgKDIsICdQcm9kdWN0byBCJywgNTApOwoKLS0gSW5pY2lhciBsYSB0cmFuc2FjY2nDs24KQkVHSU4gVFJBTlNBQ1RJT047CgotLSBSZXN0YXIgMTAgZGUgbGEgY2FudGlkYWQgZGVsIHByaW1lciBwcm9kdWN0bwpVUERBVEUgcHJvZHVjdG9zClNFVCBjYW50aWRhZCA9IGNhbnRpZGFkIC0gMTAKV0hFUkUgaWQgPSAxOwoKLS0gU3VtYXIgMTAgYSBsYSBjYW50aWRhZCBkZWwgc2VndW5kbyBwcm9kdWN0bwpVUERBVEUgcHJvZHVjdG9zClNFVCBjYW50aWRhZCA9IGNhbnRpZGFkICsgMTAKV0hFUkUgaWQgPSAyOwoKLS0gQ29uZmlybWFyIGxhIHRyYW5zYWNjacOzbgpDT01NSVQ7"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Crear la tabla productos
CREATE TABLE productos (
    id INT PRIMARY KEY,
    nombre VARCHAR(50),
    cantidad INT
);

-- Insertar registros en la tabla productos
INSERT INTO productos (id, nombre, cantidad) VALUES (1, 'Producto A', 100);
INSERT INTO productos (id, nombre, cantidad) VALUES (2, 'Producto B', 50);

-- Iniciar la transacci&oacute;n
BEGIN TRANSACTION;

-- Restar 10 de la cantidad del primer producto
UPDATE productos
SET cantidad = cantidad - 10
WHERE id = 1;

-- Sumar 10 a la cantidad del segundo producto
UPDATE productos
SET cantidad = cantidad + 10
WHERE id = 2;

-- Confirmar la transacci&oacute;n
COMMIT;</pre></div><div class='content'></div><h1><p>Conclusión</p>
</h1>
<div class='content'><p>En esta sección, hemos aprendido sobre las instrucciones de control de transacciones en SQL, incluyendo <code>BEGIN TRANSACTION</code>, <code>COMMIT</code> y <code>ROLLBACK</code>. Estas instrucciones son esenciales para garantizar la integridad y consistencia de los datos en una base de datos. También hemos visto cómo manejar errores durante una transacción para evitar estados inconsistentes en la base de datos. Con estos conocimientos, estás preparado para gestionar transacciones de manera efectiva en tus aplicaciones SQL.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='09-02-acid-properties' title="Propiedades ACID">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='09-04-handling-concurrency' title="Manejo de concurrencia">
				<span class="d-none d-md-inline">Siguiente &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Usamos cookies para mejorar tu experiencia de uso y ofrecer contenidos adaptados a tus intereses.
    <a href="#" id="btn_accept_cookies" class="button">Aceptar</a>
    <a href="/cookies">Mas información</a>
</div>	

	</div>    
</body>
</html>
