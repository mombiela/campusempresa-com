<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Angular Universal</title>

    <link rel="alternate" href="https://campusempresa.com/mod/angular/10-01-angular-universal" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/angular/10-01-angular-universal" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/angular/10-01-angular-universal" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 px-0 py-2 py-md-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 px-0 py-2 py-md-0 m-0 text-end">
										<a href="https://enterprisecampus.net/mod/angular/10-01-angular-universal" class="px-2">EN</a></b>
				|
				<b class="px-2">ES</b>
				|
				<a href="https://campusempresa.cat/mod/angular/10-01-angular-universal" class="px-2">CA</a>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Proyecto</a>
				<a href="/about">Sobre nosotros</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donaciones</a>
				<a href="/licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='09-05-mocking-dependencies' title="Simulación de Dependencias">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Angular Universal</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='10-02-performance-optimization' title="Optimización del Rendimiento">Siguiente &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introducción</h1>
<div class='content'><p>Angular Universal es una tecnología que permite la renderización del lado del servidor (SSR) para aplicaciones Angular. Esto significa que en lugar de que el navegador del cliente renderice la aplicación, el servidor lo hace y envía el HTML completamente renderizado al cliente. Esto puede mejorar significativamente el rendimiento de la aplicación y la optimización para motores de búsqueda (SEO).</p>
</div><h2>Beneficios de Angular Universal</h2>
<div class='content'><ol>
<li><strong>Mejora del Rendimiento Inicial</strong>: La aplicación se carga más rápido porque el HTML ya está renderizado en el servidor.</li>
<li><strong>Mejor SEO</strong>: Los motores de búsqueda pueden indexar mejor el contenido de la aplicación.</li>
<li><strong>Mejor Experiencia de Usuario</strong>: Los usuarios ven contenido más rápidamente, lo que mejora la percepción de la velocidad de la aplicación.</li>
</ol>
</div><h1>Configuración de Angular Universal</h1>
<div class='content'></div><h2>Paso 1: Crear una Aplicación Angular</h2>
<div class='content'><p>Si aún no tienes una aplicación Angular, puedes crear una nueva utilizando Angular CLI:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bmcgbmV3IG15LXVuaXZlcnNhbC1hcHAKY2QgbXktdW5pdmVyc2FsLWFwcA=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ng new my-universal-app
cd my-universal-app</pre></div><div class='content'></div><h2>Paso 2: Añadir Angular Universal</h2>
<div class='content'><p>Angular CLI facilita la adición de Angular Universal a tu proyecto. Ejecuta el siguiente comando:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bmcgYWRkIEBuZ3VuaXZlcnNhbC9leHByZXNzLWVuZ2luZQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ng add @nguniversal/express-engine</pre></div><div class='content'><p>Este comando realiza varias tareas:</p>
<ul>
<li>Instala las dependencias necesarias.</li>
<li>Configura el servidor Express.</li>
<li>Actualiza los archivos de configuración de Angular.</li>
</ul>
</div><h2>Paso 3: Configuración del Servidor</h2>
<div class='content'><p>El comando anterior crea un archivo <code>server.ts</code> en la raíz del proyecto. Este archivo configura un servidor Express para manejar las solicitudes y renderizar la aplicación Angular en el servidor.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0ICd6b25lLmpzL2Rpc3Qvem9uZS1ub2RlJzsKaW1wb3J0IHsgbmdFeHByZXNzRW5naW5lIH0gZnJvbSAnQG5ndW5pdmVyc2FsL2V4cHJlc3MtZW5naW5lJzsKaW1wb3J0ICogYXMgZXhwcmVzcyBmcm9tICdleHByZXNzJzsKaW1wb3J0IHsgam9pbiB9IGZyb20gJ3BhdGgnOwoKaW1wb3J0IHsgQXBwU2VydmVyTW9kdWxlIH0gZnJvbSAnLi9zcmMvbWFpbi5zZXJ2ZXInOwppbXBvcnQgeyBBUFBfQkFTRV9IUkVGIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJzsKaW1wb3J0IHsgZXhpc3RzU3luYyB9IGZyb20gJ2ZzJzsKCmNvbnN0IGFwcCA9IGV4cHJlc3MoKTsKCmNvbnN0IERJU1RfRk9MREVSID0gam9pbihwcm9jZXNzLmN3ZCgpLCAnZGlzdC9teS11bml2ZXJzYWwtYXBwL2Jyb3dzZXInKTsKCmFwcC5lbmdpbmUoJ2h0bWwnLCBuZ0V4cHJlc3NFbmdpbmUoewogIGJvb3RzdHJhcDogQXBwU2VydmVyTW9kdWxlLAp9KSk7CgphcHAuc2V0KCd2aWV3IGVuZ2luZScsICdodG1sJyk7CmFwcC5zZXQoJ3ZpZXdzJywgRElTVF9GT0xERVIpOwoKYXBwLmdldCgnKi4qJywgZXhwcmVzcy5zdGF0aWMoRElTVF9GT0xERVIsIHsKICBtYXhBZ2U6ICcxeScKfSkpOwoKYXBwLmdldCgnKicsIChyZXEsIHJlcykgPT4gewogIHJlcy5yZW5kZXIoJ2luZGV4JywgeyByZXEsIHByb3ZpZGVyczogW3sgcHJvdmlkZTogQVBQX0JBU0VfSFJFRiwgdXNlVmFsdWU6IHJlcS5iYXNlVXJsIH1dIH0pOwp9KTsKCmNvbnN0IFBPUlQgPSBwcm9jZXNzLmVudi5QT1JUIHx8IDQwMDA7CgphcHAubGlzdGVuKFBPUlQsICgpID0+IHsKICBjb25zb2xlLmxvZyhgTm9kZSBFeHByZXNzIHNlcnZlciBsaXN0ZW5pbmcgb24gaHR0cDovL2xvY2FsaG9zdDoke1BPUlR9YCk7Cn0pOw=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import 'zone.js/dist/zone-node';
import { ngExpressEngine } from '@nguniversal/express-engine';
import * as express from 'express';
import { join } from 'path';

import { AppServerModule } from './src/main.server';
import { APP_BASE_HREF } from '@angular/common';
import { existsSync } from 'fs';

const app = express();

const DIST_FOLDER = join(process.cwd(), 'dist/my-universal-app/browser');

app.engine('html', ngExpressEngine({
  bootstrap: AppServerModule,
}));

app.set('view engine', 'html');
app.set('views', DIST_FOLDER);

app.get('*.*', express.static(DIST_FOLDER, {
  maxAge: '1y'
}));

app.get('*', (req, res) =&gt; {
  res.render('index', { req, providers: [{ provide: APP_BASE_HREF, useValue: req.baseUrl }] });
});

const PORT = process.env.PORT || 4000;

app.listen(PORT, () =&gt; {
  console.log(`Node Express server listening on http://localhost:${PORT}`);
});</pre></div><div class='content'></div><h2>Paso 4: Construcción y Ejecución</h2>
<div class='content'><p>Para construir y ejecutar la aplicación con Angular Universal, utiliza los siguientes comandos:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bnBtIHJ1biBidWlsZDpzc3IKbnBtIHJ1biBzZXJ2ZTpzc3I="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>npm run build:ssr
npm run serve:ssr</pre></div><div class='content'><p>El primer comando construye la aplicación tanto para el navegador como para el servidor. El segundo comando inicia el servidor Express que renderiza la aplicación en el servidor.</p>
</div><h1>Ejemplo Práctico</h1>
<div class='content'></div><h2>Componentes y Módulos</h2>
<div class='content'><p>Asegúrate de que tus componentes y módulos estén preparados para la renderización del lado del servidor. Por ejemplo, evita el uso de APIs del navegador directamente en el constructor de los componentes.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHsgQ29tcG9uZW50LCBJbmplY3QsIFBMQVRGT1JNX0lEIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7CmltcG9ydCB7IGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJzsKCkBDb21wb25lbnQoewogIHNlbGVjdG9yOiAnYXBwLXJvb3QnLAogIHRlbXBsYXRlOiBgPGgxPldlbGNvbWUgdG8gQW5ndWxhciBVbml2ZXJzYWwhPC9oMT5gCn0pCmV4cG9ydCBjbGFzcyBBcHBDb21wb25lbnQgewogIGNvbnN0cnVjdG9yKEBJbmplY3QoUExBVEZPUk1fSUQpIHByaXZhdGUgcGxhdGZvcm1JZDogT2JqZWN0KSB7CiAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybUlkKSkgewogICAgICAvLyBDw7NkaWdvIGVzcGVjw61maWNvIGRlbCBuYXZlZ2Fkb3IKICAgIH0KICB9Cn0="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import { Component, Inject, PLATFORM_ID } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';

@Component({
  selector: 'app-root',
  template: `&lt;h1&gt;Welcome to Angular Universal!&lt;/h1&gt;`
})
export class AppComponent {
  constructor(@Inject(PLATFORM_ID) private platformId: Object) {
    if (isPlatformBrowser(this.platformId)) {
      // C&oacute;digo espec&iacute;fico del navegador
    }
  }
}</pre></div><div class='content'></div><h2>Manejo de Datos</h2>
<div class='content'><p>Para manejar datos en Angular Universal, es importante que los servicios que realizan solicitudes HTTP estén preparados para SSR. Utiliza <code>TransferState</code> para transferir el estado del servidor al cliente.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnOwppbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnOwppbXBvcnQgeyBUcmFuc2ZlclN0YXRlLCBtYWtlU3RhdGVLZXkgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJzsKCmNvbnN0IERBVEFfS0VZID0gbWFrZVN0YXRlS2V5KCdkYXRhJyk7CgpASW5qZWN0YWJsZSh7CiAgcHJvdmlkZWRJbjogJ3Jvb3QnCn0pCmV4cG9ydCBjbGFzcyBEYXRhU2VydmljZSB7CiAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LCBwcml2YXRlIHRyYW5zZmVyU3RhdGU6IFRyYW5zZmVyU3RhdGUpIHt9CgogIGdldERhdGEoKSB7CiAgICBpZiAodGhpcy50cmFuc2ZlclN0YXRlLmhhc0tleShEQVRBX0tFWSkpIHsKICAgICAgcmV0dXJuIHRoaXMudHJhbnNmZXJTdGF0ZS5nZXQoREFUQV9LRVksIG51bGwpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoJy9hcGkvZGF0YScpLnBpcGUoCiAgICAgICAgdGFwKGRhdGEgPT4gewogICAgICAgICAgdGhpcy50cmFuc2ZlclN0YXRlLnNldChEQVRBX0tFWSwgZGF0YSk7CiAgICAgICAgfSkKICAgICAgKTsKICAgIH0KICB9Cn0="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { TransferState, makeStateKey } from '@angular/platform-browser';

const DATA_KEY = makeStateKey('data');

@Injectable({
  providedIn: 'root'
})
export class DataService {
  constructor(private http: HttpClient, private transferState: TransferState) {}

  getData() {
    if (this.transferState.hasKey(DATA_KEY)) {
      return this.transferState.get(DATA_KEY, null);
    } else {
      return this.http.get('/api/data').pipe(
        tap(data =&gt; {
          this.transferState.set(DATA_KEY, data);
        })
      );
    }
  }
}</pre></div><div class='content'></div><h1>Ejercicio Práctico</h1>
<div class='content'></div><h2>Ejercicio 1: Configuración de Angular Universal</h2>
<div class='content'><ol>
<li><strong>Objetivo</strong>: Configurar una aplicación Angular existente para usar Angular Universal.</li>
<li><strong>Pasos</strong>:
<ul>
<li>Crea una nueva aplicación Angular.</li>
<li>Añade Angular Universal utilizando Angular CLI.</li>
<li>Configura el servidor Express.</li>
<li>Construye y ejecuta la aplicación.</li>
</ul>
</li>
</ol>
</div><h2>Solución</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bmcgbmV3IG15LXVuaXZlcnNhbC1hcHAKY2QgbXktdW5pdmVyc2FsLWFwcApuZyBhZGQgQG5ndW5pdmVyc2FsL2V4cHJlc3MtZW5naW5lCm5wbSBydW4gYnVpbGQ6c3NyCm5wbSBydW4gc2VydmU6c3Ny"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ng new my-universal-app
cd my-universal-app
ng add @nguniversal/express-engine
npm run build:ssr
npm run serve:ssr</pre></div><div class='content'></div><h1>Conclusión</h1>
<div class='content'><p>Angular Universal es una poderosa herramienta para mejorar el rendimiento y la SEO de las aplicaciones Angular. Al renderizar la aplicación en el servidor, los usuarios experimentan tiempos de carga más rápidos y los motores de búsqueda pueden indexar mejor el contenido. Con la configuración adecuada y el uso de <code>TransferState</code>, puedes crear aplicaciones Angular que sean rápidas y eficientes tanto en el servidor como en el cliente.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='09-05-mocking-dependencies' title="Simulación de Dependencias">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='10-02-performance-optimization' title="Optimización del Rendimiento">Siguiente &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Aceptar</a>
    <a href="/cookies">Mas información</a>
</div>	

	</div>    
</body>
</html>
