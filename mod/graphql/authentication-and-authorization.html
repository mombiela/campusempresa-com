<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autenticación y Autorización en GraphQL</title>

    <link rel="alternate" href="https://campusempresa.com/mod/graphql/authentication-and-authorization" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/graphql/authentication-and-authorization" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/graphql/authentication-and-authorization" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
										<a href="https://enterprisecampus.net/mod/graphql/authentication-and-authorization" class="px-2">EN</a></b>
				|
				<b class="px-2">ES</b>
				|
				<a href="https://campusempresa.cat/mod/graphql/authentication-and-authorization" class="px-2">CA</a>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Proyecto</a>
				<a href="/about">Sobre nosotros</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donaciones</a>
				<a href="/licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='rate-limiting'>&#x25C4;Limitación de Tasa</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Autenticación y Autorización en GraphQL</a>
	</div>
	<div class='col-4 text-end'>
					<a href='error-handling'>Manejo de Errores &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introducción</h1>
<div class='content'><p>En esta sección, exploraremos los conceptos de autenticación y autorización en el contexto de GraphQL. Comprender estos conceptos es crucial para construir aplicaciones seguras y robustas.</p>
<ul>
<li><strong>Autenticación</strong>: El proceso de verificar la identidad de un usuario o sistema.</li>
<li><strong>Autorización</strong>: El proceso de determinar qué está permitido hacer a un usuario o sistema autenticado.</li>
</ul>
</div><h1>Autenticación</h1>
<div class='content'></div><h2>Autenticación Básica</h2>
<div class='content'><p>La autenticación básica implica verificar la identidad de un usuario a través de credenciales como un nombre de usuario y una contraseña.</p>
<h4>Ejemplo</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bXV0YXRpb24gewogIGxvZ2luKHVzZXJuYW1lOiAidXNlciIsIHBhc3N3b3JkOiAicGFzc3dvcmQiKSB7CiAgICB0b2tlbgogIH0KfQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>mutation {
  login(username: &quot;user&quot;, password: &quot;password&quot;) {
    token
  }
}</pre></div><div class='content'><ul>
<li><strong>Explicación</strong>: Esta mutación toma un nombre de usuario y una contraseña y devuelve un token si las credenciales son válidas. El token se usa luego para solicitudes posteriores para autenticar al usuario.</li>
</ul>
</div><h2>Autenticación Basada en Tokens</h2>
<div class='content'><p>La autenticación basada en tokens implica emitir un token tras un inicio de sesión exitoso, que luego se usa para autenticar solicitudes posteriores.</p>
<h4>Ejemplo</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bXV0YXRpb24gewogIGxvZ2luKHVzZXJuYW1lOiAidXNlciIsIHBhc3N3b3JkOiAicGFzc3dvcmQiKSB7CiAgICB0b2tlbgogIH0KfQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>mutation {
  login(username: &quot;user&quot;, password: &quot;password&quot;) {
    token
  }
}</pre></div><div class='content'><ul>
<li><strong>Explicación</strong>: Similar al ejemplo de autenticación básica, pero el token se almacena del lado del cliente (por ejemplo, en el almacenamiento local) y se envía con cada solicitud.</li>
</ul>
<h4>Uso de Tokens en Solicitudes</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cXVlcnkgewogIHVzZXIgewogICAgaWQKICAgIG5hbWUKICB9Cn0="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>query {
  user {
    id
    name
  }
}</pre></div><div class='content'><ul>
<li><strong>Explicación</strong>: El token generalmente se envía en los encabezados HTTP. Por ejemplo, en una solicitud HTTP, podrías incluir el token así:
<pre><code>Authorization: Bearer &lt;token&gt;
</code></pre>
</li>
</ul>
</div><h2>OAuth</h2>
<div class='content'><p>OAuth es un estándar abierto para la delegación de acceso, comúnmente utilizado para la autenticación basada en tokens.</p>
<h4>Ejemplo</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bXV0YXRpb24gewogIGxvZ2luV2l0aE9BdXRoKHByb3ZpZGVyOiAiZ29vZ2xlIiwgdG9rZW46ICJvYXV0aC10b2tlbiIpIHsKICAgIHRva2VuCiAgfQp9"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>mutation {
  loginWithOAuth(provider: &quot;google&quot;, token: &quot;oauth-token&quot;) {
    token
  }
}</pre></div><div class='content'><ul>
<li><strong>Explicación</strong>: Esta mutación usa un token OAuth obtenido de un proveedor como Google para autenticar al usuario y devolver un token para solicitudes posteriores.</li>
</ul>
</div><h1>Autorización</h1>
<div class='content'></div><h2>Control de Acceso Basado en Roles (RBAC)</h2>
<div class='content'><p>RBAC restringe el acceso basado en los roles asignados a los usuarios.</p>
<h4>Ejemplo</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dHlwZSBRdWVyeSB7CiAgYWRtaW5EYXRhOiBBZG1pbkRhdGEgQGF1dGgocmVxdWlyZXM6IEFETUlOKQogIHVzZXJEYXRhOiBVc2VyRGF0YSBAYXV0aChyZXF1aXJlczogVVNFUikKfQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>type Query {
  adminData: AdminData @auth(requires: ADMIN)
  userData: UserData @auth(requires: USER)
}</pre></div><div class='content'><ul>
<li><strong>Explicación</strong>: La directiva <code>@auth</code> verifica si el usuario tiene el rol requerido antes de resolver el campo.</li>
</ul>
</div><h2>Autorización a Nivel de Campo</h2>
<div class='content'><p>La autorización a nivel de campo controla el acceso a campos específicos dentro de un tipo.</p>
<h4>Ejemplo</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dHlwZSBVc2VyIHsKICBpZDogSUQhCiAgbmFtZTogU3RyaW5nIQogIGVtYWlsOiBTdHJpbmchIEBhdXRoKHJlcXVpcmVzOiBBRE1JTikKfQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>type User {
  id: ID!
  name: String!
  email: String! @auth(requires: ADMIN)
}</pre></div><div class='content'><ul>
<li><strong>Explicación</strong>: La directiva <code>@auth</code> restringe el acceso al campo <code>email</code> a usuarios con el rol <code>ADMIN</code>.</li>
</ul>
</div><h2>Lógica de Autorización Personalizada</h2>
<div class='content'><p>La lógica de autorización personalizada permite reglas más complejas más allá de las verificaciones basadas en roles.</p>
<h4>Ejemplo</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dHlwZSBRdWVyeSB7CiAgc2Vuc2l0aXZlRGF0YTogU2Vuc2l0aXZlRGF0YSBAYXV0aChyZXF1aXJlczogImlzT3duZXIiKQp9"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>type Query {
  sensitiveData: SensitiveData @auth(requires: &quot;isOwner&quot;)
}</pre></div><div class='content'><ul>
<li><strong>Explicación</strong>: La directiva <code>@auth</code> puede configurarse para llamar a una función personalizada como <code>isOwner</code> para determinar el acceso.</li>
</ul>
</div><h1>Implementación de Autenticación y Autorización en GraphQL</h1>
<div class='content'></div><h2>Middleware</h2>
<div class='content'><p>El middleware puede usarse para manejar la lógica de autenticación y autorización.</p>
<h4>Ejemplo</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBBcG9sbG9TZXJ2ZXIgfSA9IHJlcXVpcmUoJ2Fwb2xsby1zZXJ2ZXInKTsKY29uc3QgeyB2ZXJpZnlUb2tlbiB9ID0gcmVxdWlyZSgnLi9hdXRoJyk7Cgpjb25zdCBzZXJ2ZXIgPSBuZXcgQXBvbGxvU2VydmVyKHsKICB0eXBlRGVmcywKICByZXNvbHZlcnMsCiAgY29udGV4dDogKHsgcmVxIH0pID0+IHsKICAgIGNvbnN0IHRva2VuID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbiB8fCAnJzsKICAgIGNvbnN0IHVzZXIgPSB2ZXJpZnlUb2tlbih0b2tlbik7CiAgICByZXR1cm4geyB1c2VyIH07CiAgfSwKfSk7"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { ApolloServer } = require('apollo-server');
const { verifyToken } = require('./auth');

const server = new ApolloServer({
  typeDefs,
  resolvers,
  context: ({ req }) =&gt; {
    const token = req.headers.authorization || '';
    const user = verifyToken(token);
    return { user };
  },
});</pre></div><div class='content'><ul>
<li><strong>Explicación</strong>: La función <code>verifyToken</code> verifica el token y devuelve el usuario. El usuario se agrega luego al contexto, haciéndolo disponible en los resolvers.</li>
</ul>
</div><h2>Directivas</h2>
<div class='content'><p>Las directivas personalizadas pueden usarse para implementar la lógica de autorización directamente en el esquema.</p>
<h4>Ejemplo</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBTY2hlbWFEaXJlY3RpdmVWaXNpdG9yIH0gPSByZXF1aXJlKCdhcG9sbG8tc2VydmVyJyk7CmNvbnN0IHsgZGVmYXVsdEZpZWxkUmVzb2x2ZXIgfSA9IHJlcXVpcmUoJ2dyYXBocWwnKTsKCmNsYXNzIEF1dGhEaXJlY3RpdmUgZXh0ZW5kcyBTY2hlbWFEaXJlY3RpdmVWaXNpdG9yIHsKICB2aXNpdEZpZWxkRGVmaW5pdGlvbihmaWVsZCkgewogICAgY29uc3QgeyByZXNvbHZlID0gZGVmYXVsdEZpZWxkUmVzb2x2ZXIgfSA9IGZpZWxkOwogICAgY29uc3QgeyByZXF1aXJlcyB9ID0gdGhpcy5hcmdzOwoKICAgIGZpZWxkLnJlc29sdmUgPSBhc3luYyBmdW5jdGlvbiAoLi4uYXJncykgewogICAgICBjb25zdCBjb250ZXh0ID0gYXJnc1syXTsKICAgICAgaWYgKCFjb250ZXh0LnVzZXIgfHwgIWNvbnRleHQudXNlci5yb2xlcy5pbmNsdWRlcyhyZXF1aXJlcykpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vdCBhdXRob3JpemVkJyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc29sdmUuYXBwbHkodGhpcywgYXJncyk7CiAgICB9OwogIH0KfQoKY29uc3QgdHlwZURlZnMgPSBgCiAgZGlyZWN0aXZlIEBhdXRoKHJlcXVpcmVzOiBSb2xlISkgb24gRklFTERfREVGSU5JVElPTgoKICBlbnVtIFJvbGUgewogICAgQURNSU4KICAgIFVTRVIKICB9CgogIHR5cGUgUXVlcnkgewogICAgYWRtaW5EYXRhOiBBZG1pbkRhdGEgQGF1dGgocmVxdWlyZXM6IEFETUlOKQogICAgdXNlckRhdGE6IFVzZXJEYXRhIEBhdXRoKHJlcXVpcmVzOiBVU0VSKQogIH0KYDsKCmNvbnN0IHNjaGVtYSA9IG1ha2VFeGVjdXRhYmxlU2NoZW1hKHsKICB0eXBlRGVmcywKICByZXNvbHZlcnMsCiAgc2NoZW1hRGlyZWN0aXZlczogewogICAgYXV0aDogQXV0aERpcmVjdGl2ZSwKICB9LAp9KTs="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { SchemaDirectiveVisitor } = require('apollo-server');
const { defaultFieldResolver } = require('graphql');

class AuthDirective extends SchemaDirectiveVisitor {
  visitFieldDefinition(field) {
    const { resolve = defaultFieldResolver } = field;
    const { requires } = this.args;

    field.resolve = async function (...args) {
      const context = args[2];
      if (!context.user || !context.user.roles.includes(requires)) {
        throw new Error('Not authorized');
      }
      return resolve.apply(this, args);
    };
  }
}

const typeDefs = `
  directive @auth(requires: Role!) on FIELD_DEFINITION

  enum Role {
    ADMIN
    USER
  }

  type Query {
    adminData: AdminData @auth(requires: ADMIN)
    userData: UserData @auth(requires: USER)
  }
`;

const schema = makeExecutableSchema({
  typeDefs,
  resolvers,
  schemaDirectives: {
    auth: AuthDirective,
  },
});</pre></div><div class='content'><ul>
<li><strong>Explicación</strong>: La <code>AuthDirective</code> verifica los roles del usuario antes de resolver el campo. Si el usuario no está autorizado, se lanza un error.</li>
</ul>
</div><h1>Conclusión</h1>
<div class='content'><p>La autenticación y la autorización son componentes críticos de cualquier aplicación segura. En GraphQL, estos pueden implementarse usando varias estrategias como la autenticación basada en tokens, el control de acceso basado en roles y las directivas personalizadas. Al comprender y aplicar estos conceptos, puedes asegurar que tu API de GraphQL sea tanto segura como robusta.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='rate-limiting'>&#x25C4;Limitación de Tasa</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Autenticación y Autorización en GraphQL</a>
	</div>
	<div class='col-4 text-end'>
					<a href='error-handling'>Manejo de Errores &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Aceptar</a>
    <a href="/cookies">Mas información</a>
</div>	

	</div>    
</body>
</html>
