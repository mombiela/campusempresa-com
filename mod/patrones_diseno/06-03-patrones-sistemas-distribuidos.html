<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patrones de Diseño en Sistemas Distribuidos</title>

    <link rel="alternate" href="https://campusempresa.com/mod/patrones_diseno/06-03-patrones-sistemas-distribuidos" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/patrones_diseno/06-03-patrons-sistemes-distribuits" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/patrones_diseno/06-03-patterns-distributed-systems" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
										<a href="https://enterprisecampus.net/mod/patrones_diseno/06-03-patterns-distributed-systems" class="px-2">EN</a></b>
				|
				<b class="px-2">ES</b>
				|
				<a href="https://campusempresa.cat/mod/patrones_diseno/06-03-patrons-sistemes-distribuits" class="px-2">CA</a>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Proyecto</a>
				<a href="/about">Sobre nosotros</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donaciones</a>
				<a href="/licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='06-02-patrones-microservicios' title="Patrones de Diseño en Microservicios">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Patrones de Diseño en Sistemas Distribuidos</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='06-04-patrones-desarrollo-agil' title="Patrones de Diseño en Desarrollo Ágil">Siguiente &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1><p>Introducción</p>
</h1>
<div class='content'><p>Los sistemas distribuidos son aquellos en los que los componentes ubicados en diferentes máquinas se comunican y coordinan sus acciones mediante el intercambio de mensajes. Estos sistemas presentan desafíos únicos, como la latencia de red, la tolerancia a fallos y la consistencia de datos. Los patrones de diseño en sistemas distribuidos proporcionan soluciones probadas para abordar estos desafíos.</p>
</div><h2><p>Objetivos del Tema</p>
</h2>
<div class='content'><ul>
<li>Comprender los desafíos específicos de los sistemas distribuidos.</li>
<li>Aprender los patrones de diseño más comunes utilizados en sistemas distribuidos.</li>
<li>Aplicar estos patrones para mejorar la robustez, escalabilidad y mantenibilidad de los sistemas distribuidos.</li>
</ul>
</div><h1><p>Desafíos en Sistemas Distribuidos</p>
</h1>
<div class='content'><ol>
<li><strong>Latencia de Red</strong>: El tiempo que tarda un mensaje en viajar de un nodo a otro puede afectar el rendimiento del sistema.</li>
<li><strong>Tolerancia a Fallos</strong>: Los sistemas distribuidos deben ser capaces de manejar fallos de hardware y software.</li>
<li><strong>Consistencia de Datos</strong>: Mantener la consistencia de datos en diferentes nodos es crucial y puede ser complicado.</li>
<li><strong>Escalabilidad</strong>: Los sistemas deben ser capaces de manejar un aumento en la carga de trabajo sin degradar el rendimiento.</li>
<li><strong>Seguridad</strong>: La comunicación entre nodos debe ser segura para evitar ataques y accesos no autorizados.</li>
</ol>
</div><h1><p>Patrones de Diseño Comunes en Sistemas Distribuidos</p>
</h1>
<div class='content'></div><h2><ol>
<li><strong>Patrón de Orquestación</strong></li>
</ol>
</h2>
<div class='content'><h4>Descripción</h4>
<p>La orquestación implica la coordinación centralizada de los componentes del sistema. Un orquestador central gestiona las interacciones entre los servicios.</p>
<h4>Ejemplo</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgT3JjaGVzdHJhdG9yOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYuc2VydmljZV9hID0gU2VydmljZUEoKQogICAgICAgIHNlbGYuc2VydmljZV9iID0gU2VydmljZUIoKQogICAgCiAgICBkZWYgZXhlY3V0ZShzZWxmKToKICAgICAgICByZXN1bHRfYSA9IHNlbGYuc2VydmljZV9hLnBlcmZvcm1fdGFzaygpCiAgICAgICAgcmVzdWx0X2IgPSBzZWxmLnNlcnZpY2VfYi5wZXJmb3JtX3Rhc2socmVzdWx0X2EpCiAgICAgICAgcmV0dXJuIHJlc3VsdF9iCgpjbGFzcyBTZXJ2aWNlQToKICAgIGRlZiBwZXJmb3JtX3Rhc2soc2VsZik6CiAgICAgICAgIyBMw7NnaWNhIGRlbCBzZXJ2aWNpbyBBCiAgICAgICAgcmV0dXJuICJSZXN1bHQgZnJvbSBTZXJ2aWNlIEEiCgpjbGFzcyBTZXJ2aWNlQjoKICAgIGRlZiBwZXJmb3JtX3Rhc2soc2VsZiwgaW5wdXQpOgogICAgICAgICMgTMOzZ2ljYSBkZWwgc2VydmljaW8gQgogICAgICAgIHJldHVybiBmIlJlc3VsdCBmcm9tIFNlcnZpY2UgQiB3aXRoIHtpbnB1dH0iCgojIFVzbyBkZWwgb3JxdWVzdGFkb3IKb3JjaGVzdHJhdG9yID0gT3JjaGVzdHJhdG9yKCkKcmVzdWx0ID0gb3JjaGVzdHJhdG9yLmV4ZWN1dGUoKQpwcmludChyZXN1bHQp"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class Orchestrator:
    def __init__(self):
        self.service_a = ServiceA()
        self.service_b = ServiceB()
    
    def execute(self):
        result_a = self.service_a.perform_task()
        result_b = self.service_b.perform_task(result_a)
        return result_b

class ServiceA:
    def perform_task(self):
        # L&oacute;gica del servicio A
        return &quot;Result from Service A&quot;

class ServiceB:
    def perform_task(self, input):
        # L&oacute;gica del servicio B
        return f&quot;Result from Service B with {input}&quot;

# Uso del orquestador
orchestrator = Orchestrator()
result = orchestrator.execute()
print(result)</pre></div><div class='content'><h4>Ventajas</h4>
<ul>
<li>Control centralizado de las interacciones.</li>
<li>Facilita la implementación de lógica compleja.</li>
</ul>
<h4>Desventajas</h4>
<ul>
<li>Punto único de fallo.</li>
<li>Puede convertirse en un cuello de botella.</li>
</ul>
</div><h2><ol start="2">
<li><strong>Patrón de Coreografía</strong></li>
</ol>
</h2>
<div class='content'><h4>Descripción</h4>
<p>La coreografía implica la coordinación descentralizada de los componentes del sistema. Cada servicio conoce su rol y se comunica directamente con otros servicios según sea necesario.</p>
<h4>Ejemplo</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgU2VydmljZUE6CiAgICBkZWYgcGVyZm9ybV90YXNrKHNlbGYpOgogICAgICAgICMgTMOzZ2ljYSBkZWwgc2VydmljaW8gQQogICAgICAgIHJldHVybiAiUmVzdWx0IGZyb20gU2VydmljZSBBIgoKY2xhc3MgU2VydmljZUI6CiAgICBkZWYgcGVyZm9ybV90YXNrKHNlbGYsIGlucHV0KToKICAgICAgICAjIEzDs2dpY2EgZGVsIHNlcnZpY2lvIEIKICAgICAgICByZXR1cm4gZiJSZXN1bHQgZnJvbSBTZXJ2aWNlIEIgd2l0aCB7aW5wdXR9IgoKIyBVc28gZGUgY29yZW9ncmFmw61hCnNlcnZpY2VfYSA9IFNlcnZpY2VBKCkKcmVzdWx0X2EgPSBzZXJ2aWNlX2EucGVyZm9ybV90YXNrKCkKCnNlcnZpY2VfYiA9IFNlcnZpY2VCKCkKcmVzdWx0X2IgPSBzZXJ2aWNlX2IucGVyZm9ybV90YXNrKHJlc3VsdF9hKQpwcmludChyZXN1bHRfYik="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class ServiceA:
    def perform_task(self):
        # L&oacute;gica del servicio A
        return &quot;Result from Service A&quot;

class ServiceB:
    def perform_task(self, input):
        # L&oacute;gica del servicio B
        return f&quot;Result from Service B with {input}&quot;

# Uso de coreograf&iacute;a
service_a = ServiceA()
result_a = service_a.perform_task()

service_b = ServiceB()
result_b = service_b.perform_task(result_a)
print(result_b)</pre></div><div class='content'><h4>Ventajas</h4>
<ul>
<li>No hay un punto único de fallo.</li>
<li>Mejor escalabilidad.</li>
</ul>
<h4>Desventajas</h4>
<ul>
<li>Mayor complejidad en la coordinación.</li>
<li>Difícil de depurar y mantener.</li>
</ul>
</div><h2><ol start="3">
<li><strong>Patrón de Circuit Breaker</strong></li>
</ol>
</h2>
<div class='content'><h4>Descripción</h4>
<p>El patrón de Circuit Breaker se utiliza para evitar que una aplicación intente realizar una operación que probablemente fallará. Actúa como un interruptor que corta el flujo cuando detecta fallos repetidos.</p>
<h4>Ejemplo</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgQ2lyY3VpdEJyZWFrZXI6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZmFpbHVyZV90aHJlc2hvbGQsIHJlY292ZXJ5X3RpbWVvdXQpOgogICAgICAgIHNlbGYuZmFpbHVyZV90aHJlc2hvbGQgPSBmYWlsdXJlX3RocmVzaG9sZAogICAgICAgIHNlbGYucmVjb3ZlcnlfdGltZW91dCA9IHJlY292ZXJ5X3RpbWVvdXQKICAgICAgICBzZWxmLmZhaWx1cmVfY291bnQgPSAwCiAgICAgICAgc2VsZi5sYXN0X2ZhaWx1cmVfdGltZSA9IE5vbmUKICAgICAgICBzZWxmLnN0YXRlID0gIkNMT1NFRCIKCiAgICBkZWYgY2FsbChzZWxmLCBmdW5jLCAqYXJncywgKiprd2FyZ3MpOgogICAgICAgIGlmIHNlbGYuc3RhdGUgPT0gIk9QRU4iOgogICAgICAgICAgICBpZiAodGltZS50aW1lKCkgLSBzZWxmLmxhc3RfZmFpbHVyZV90aW1lKSA+IHNlbGYucmVjb3ZlcnlfdGltZW91dDoKICAgICAgICAgICAgICAgIHNlbGYuc3RhdGUgPSAiSEFMRi1PUEVOIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJDaXJjdWl0IGlzIG9wZW4iKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3VsdCA9IGZ1bmMoKmFyZ3MsICoqa3dhcmdzKQogICAgICAgICAgICBzZWxmLnJlc2V0KCkKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5yZWNvcmRfZmFpbHVyZSgpCiAgICAgICAgICAgIHJhaXNlIGUKCiAgICBkZWYgcmVzZXQoc2VsZik6CiAgICAgICAgc2VsZi5mYWlsdXJlX2NvdW50ID0gMAogICAgICAgIHNlbGYuc3RhdGUgPSAiQ0xPU0VEIgoKICAgIGRlZiByZWNvcmRfZmFpbHVyZShzZWxmKToKICAgICAgICBzZWxmLmZhaWx1cmVfY291bnQgKz0gMQogICAgICAgIHNlbGYubGFzdF9mYWlsdXJlX3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIGlmIHNlbGYuZmFpbHVyZV9jb3VudCA+PSBzZWxmLmZhaWx1cmVfdGhyZXNob2xkOgogICAgICAgICAgICBzZWxmLnN0YXRlID0gIk9QRU4iCgojIFVzbyBkZWwgQ2lyY3VpdCBCcmVha2VyCmltcG9ydCB0aW1lCgpkZWYgdW5yZWxpYWJsZV9zZXJ2aWNlKCk6CiAgICBpZiB0aW1lLnRpbWUoKSAlIDIgPT0gMDoKICAgICAgICByYWlzZSBFeGNlcHRpb24oIlNlcnZpY2UgZmFpbGVkIikKICAgIHJldHVybiAiU2VydmljZSBzdWNjZWVkZWQiCgpjaXJjdWl0X2JyZWFrZXIgPSBDaXJjdWl0QnJlYWtlcihmYWlsdXJlX3RocmVzaG9sZD0zLCByZWNvdmVyeV90aW1lb3V0PTUpCgpmb3IgXyBpbiByYW5nZSgxMCk6CiAgICB0cnk6CiAgICAgICAgcmVzdWx0ID0gY2lyY3VpdF9icmVha2VyLmNhbGwodW5yZWxpYWJsZV9zZXJ2aWNlKQogICAgICAgIHByaW50KHJlc3VsdCkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChlKQogICAgdGltZS5zbGVlcCgxKQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class CircuitBreaker:
    def __init__(self, failure_threshold, recovery_timeout):
        self.failure_threshold = failure_threshold
        self.recovery_timeout = recovery_timeout
        self.failure_count = 0
        self.last_failure_time = None
        self.state = &quot;CLOSED&quot;

    def call(self, func, *args, **kwargs):
        if self.state == &quot;OPEN&quot;:
            if (time.time() - self.last_failure_time) &gt; self.recovery_timeout:
                self.state = &quot;HALF-OPEN&quot;
            else:
                raise Exception(&quot;Circuit is open&quot;)

        try:
            result = func(*args, **kwargs)
            self.reset()
            return result
        except Exception as e:
            self.record_failure()
            raise e

    def reset(self):
        self.failure_count = 0
        self.state = &quot;CLOSED&quot;

    def record_failure(self):
        self.failure_count += 1
        self.last_failure_time = time.time()
        if self.failure_count &gt;= self.failure_threshold:
            self.state = &quot;OPEN&quot;

# Uso del Circuit Breaker
import time

def unreliable_service():
    if time.time() % 2 == 0:
        raise Exception(&quot;Service failed&quot;)
    return &quot;Service succeeded&quot;

circuit_breaker = CircuitBreaker(failure_threshold=3, recovery_timeout=5)

for _ in range(10):
    try:
        result = circuit_breaker.call(unreliable_service)
        print(result)
    except Exception as e:
        print(e)
    time.sleep(1)</pre></div><div class='content'><h4>Ventajas</h4>
<ul>
<li>Previene fallos en cascada.</li>
<li>Mejora la resiliencia del sistema.</li>
</ul>
<h4>Desventajas</h4>
<ul>
<li>Puede introducir latencia adicional.</li>
<li>Requiere configuración y ajuste fino.</li>
</ul>
</div><h2><ol start="4">
<li><strong>Patrón de Event Sourcing</strong></li>
</ol>
</h2>
<div class='content'><h4>Descripción</h4>
<p>El patrón de Event Sourcing almacena el estado de un sistema como una secuencia de eventos. Cada cambio en el estado se representa como un evento, y el estado actual se reconstruye reproduciendo estos eventos.</p>
<h4>Ejemplo</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgRXZlbnRTdG9yZToKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICBzZWxmLmV2ZW50cyA9IFtdCgogICAgZGVmIHNhdmVfZXZlbnQoc2VsZiwgZXZlbnQpOgogICAgICAgIHNlbGYuZXZlbnRzLmFwcGVuZChldmVudCkKCiAgICBkZWYgZ2V0X2V2ZW50cyhzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5ldmVudHMKCmNsYXNzIEFjY291bnQ6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZXZlbnRfc3RvcmUpOgogICAgICAgIHNlbGYuZXZlbnRfc3RvcmUgPSBldmVudF9zdG9yZQogICAgICAgIHNlbGYuYmFsYW5jZSA9IDAKCiAgICBkZWYgYXBwbHlfZXZlbnQoc2VsZiwgZXZlbnQpOgogICAgICAgIGlmIGV2ZW50WyJ0eXBlIl0gPT0gImRlcG9zaXQiOgogICAgICAgICAgICBzZWxmLmJhbGFuY2UgKz0gZXZlbnRbImFtb3VudCJdCiAgICAgICAgZWxpZiBldmVudFsidHlwZSJdID09ICJ3aXRoZHJhdyI6CiAgICAgICAgICAgIHNlbGYuYmFsYW5jZSAtPSBldmVudFsiYW1vdW50Il0KCiAgICBkZWYgZGVwb3NpdChzZWxmLCBhbW91bnQpOgogICAgICAgIGV2ZW50ID0geyJ0eXBlIjogImRlcG9zaXQiLCAiYW1vdW50IjogYW1vdW50fQogICAgICAgIHNlbGYuZXZlbnRfc3RvcmUuc2F2ZV9ldmVudChldmVudCkKICAgICAgICBzZWxmLmFwcGx5X2V2ZW50KGV2ZW50KQoKICAgIGRlZiB3aXRoZHJhdyhzZWxmLCBhbW91bnQpOgogICAgICAgIGV2ZW50ID0geyJ0eXBlIjogIndpdGhkcmF3IiwgImFtb3VudCI6IGFtb3VudH0KICAgICAgICBzZWxmLmV2ZW50X3N0b3JlLnNhdmVfZXZlbnQoZXZlbnQpCiAgICAgICAgc2VsZi5hcHBseV9ldmVudChldmVudCkKCiAgICBkZWYgZ2V0X2JhbGFuY2Uoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuYmFsYW5jZQoKIyBVc28gZGVsIEV2ZW50IFNvdXJjaW5nCmV2ZW50X3N0b3JlID0gRXZlbnRTdG9yZSgpCmFjY291bnQgPSBBY2NvdW50KGV2ZW50X3N0b3JlKQoKYWNjb3VudC5kZXBvc2l0KDEwMCkKYWNjb3VudC53aXRoZHJhdyg1MCkKCnByaW50KGYiQmFsYW5jZSBhY3R1YWw6IHthY2NvdW50LmdldF9iYWxhbmNlKCl9IikKcHJpbnQoZiJFdmVudG9zOiB7ZXZlbnRfc3RvcmUuZ2V0X2V2ZW50cygpfSIp"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class EventStore:
    def __init__(self):
        self.events = []

    def save_event(self, event):
        self.events.append(event)

    def get_events(self):
        return self.events

class Account:
    def __init__(self, event_store):
        self.event_store = event_store
        self.balance = 0

    def apply_event(self, event):
        if event[&quot;type&quot;] == &quot;deposit&quot;:
            self.balance += event[&quot;amount&quot;]
        elif event[&quot;type&quot;] == &quot;withdraw&quot;:
            self.balance -= event[&quot;amount&quot;]

    def deposit(self, amount):
        event = {&quot;type&quot;: &quot;deposit&quot;, &quot;amount&quot;: amount}
        self.event_store.save_event(event)
        self.apply_event(event)

    def withdraw(self, amount):
        event = {&quot;type&quot;: &quot;withdraw&quot;, &quot;amount&quot;: amount}
        self.event_store.save_event(event)
        self.apply_event(event)

    def get_balance(self):
        return self.balance

# Uso del Event Sourcing
event_store = EventStore()
account = Account(event_store)

account.deposit(100)
account.withdraw(50)

print(f&quot;Balance actual: {account.get_balance()}&quot;)
print(f&quot;Eventos: {event_store.get_events()}&quot;)</pre></div><div class='content'><h4>Ventajas</h4>
<ul>
<li>Historial completo de cambios.</li>
<li>Facilita la auditoría y el debugging.</li>
</ul>
<h4>Desventajas</h4>
<ul>
<li>Complejidad en la gestión de eventos.</li>
<li>Puede requerir mucho almacenamiento.</li>
</ul>
</div><h1><p>Ejercicio Práctico</p>
</h1>
<div class='content'></div><h2><p>Ejercicio 1: Implementar un Circuit Breaker</p>
</h2>
<div class='content'><p><strong>Objetivo</strong>: Implementar un Circuit Breaker para un servicio que puede fallar y probar su funcionamiento.</p>
<p><strong>Instrucciones</strong>:</p>
<ol>
<li>Implementa una clase <code>CircuitBreaker</code> con los métodos <code>call</code>, <code>reset</code> y <code>record_failure</code>.</li>
<li>Simula un servicio que falla aleatoriamente.</li>
<li>Usa el Circuit Breaker para llamar al servicio y maneja los fallos adecuadamente.</li>
</ol>
<p><strong>Código Base</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRpbWUKaW1wb3J0IHJhbmRvbQoKY2xhc3MgQ2lyY3VpdEJyZWFrZXI6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZmFpbHVyZV90aHJlc2hvbGQsIHJlY292ZXJ5X3RpbWVvdXQpOgogICAgICAgIHNlbGYuZmFpbHVyZV90aHJlc2hvbGQgPSBmYWlsdXJlX3RocmVzaG9sZAogICAgICAgIHNlbGYucmVjb3ZlcnlfdGltZW91dCA9IHJlY292ZXJ5X3RpbWVvdXQKICAgICAgICBzZWxmLmZhaWx1cmVfY291bnQgPSAwCiAgICAgICAgc2VsZi5sYXN0X2ZhaWx1cmVfdGltZSA9IE5vbmUKICAgICAgICBzZWxmLnN0YXRlID0gIkNMT1NFRCIKCiAgICBkZWYgY2FsbChzZWxmLCBmdW5jLCAqYXJncywgKiprd2FyZ3MpOgogICAgICAgIGlmIHNlbGYuc3RhdGUgPT0gIk9QRU4iOgogICAgICAgICAgICBpZiAodGltZS50aW1lKCkgLSBzZWxmLmxhc3RfZmFpbHVyZV90aW1lKSA+IHNlbGYucmVjb3ZlcnlfdGltZW91dDoKICAgICAgICAgICAgICAgIHNlbGYuc3RhdGUgPSAiSEFMRi1PUEVOIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJDaXJjdWl0IGlzIG9wZW4iKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3VsdCA9IGZ1bmMoKmFyZ3MsICoqa3dhcmdzKQogICAgICAgICAgICBzZWxmLnJlc2V0KCkKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5yZWNvcmRfZmFpbHVyZSgpCiAgICAgICAgICAgIHJhaXNlIGUKCiAgICBkZWYgcmVzZXQoc2VsZik6CiAgICAgICAgc2VsZi5mYWlsdXJlX2NvdW50ID0gMAogICAgICAgIHNlbGYuc3RhdGUgPSAiQ0xPU0VEIgoKICAgIGRlZiByZWNvcmRfZmFpbHVyZShzZWxmKToKICAgICAgICBzZWxmLmZhaWx1cmVfY291bnQgKz0gMQogICAgICAgIHNlbGYubGFzdF9mYWlsdXJlX3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIGlmIHNlbGYuZmFpbHVyZV9jb3VudCA+PSBzZWxmLmZhaWx1cmVfdGhyZXNob2xkOgogICAgICAgICAgICBzZWxmLnN0YXRlID0gIk9QRU4iCgpkZWYgdW5yZWxpYWJsZV9zZXJ2aWNlKCk6CiAgICBpZiByYW5kb20ucmFuZG9tKCkgPCAwLjU6CiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJTZXJ2aWNlIGZhaWxlZCIpCiAgICByZXR1cm4gIlNlcnZpY2Ugc3VjY2VlZGVkIgoKIyBVc28gZGVsIENpcmN1aXQgQnJlYWtlcgpjaXJjdWl0X2JyZWFrZXIgPSBDaXJjdWl0QnJlYWtlcihmYWlsdXJlX3RocmVzaG9sZD0zLCByZWNvdmVyeV90aW1lb3V0PTUpCgpmb3IgXyBpbiByYW5nZSgxMCk6CiAgICB0cnk6CiAgICAgICAgcmVzdWx0ID0gY2lyY3VpdF9icmVha2VyLmNhbGwodW5yZWxpYWJsZV9zZXJ2aWNlKQogICAgICAgIHByaW50KHJlc3VsdCkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChlKQogICAgdGltZS5zbGVlcCgxKQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import time
import random

class CircuitBreaker:
    def __init__(self, failure_threshold, recovery_timeout):
        self.failure_threshold = failure_threshold
        self.recovery_timeout = recovery_timeout
        self.failure_count = 0
        self.last_failure_time = None
        self.state = &quot;CLOSED&quot;

    def call(self, func, *args, **kwargs):
        if self.state == &quot;OPEN&quot;:
            if (time.time() - self.last_failure_time) &gt; self.recovery_timeout:
                self.state = &quot;HALF-OPEN&quot;
            else:
                raise Exception(&quot;Circuit is open&quot;)

        try:
            result = func(*args, **kwargs)
            self.reset()
            return result
        except Exception as e:
            self.record_failure()
            raise e

    def reset(self):
        self.failure_count = 0
        self.state = &quot;CLOSED&quot;

    def record_failure(self):
        self.failure_count += 1
        self.last_failure_time = time.time()
        if self.failure_count &gt;= self.failure_threshold:
            self.state = &quot;OPEN&quot;

def unreliable_service():
    if random.random() &lt; 0.5:
        raise Exception(&quot;Service failed&quot;)
    return &quot;Service succeeded&quot;

# Uso del Circuit Breaker
circuit_breaker = CircuitBreaker(failure_threshold=3, recovery_timeout=5)

for _ in range(10):
    try:
        result = circuit_breaker.call(unreliable_service)
        print(result)
    except Exception as e:
        print(e)
    time.sleep(1)</pre></div><div class='content'></div><h2><p>Solución</p>
</h2>
<div class='content'><p>El código base ya proporciona una implementación funcional del Circuit Breaker. Puedes ajustarlo y probarlo para diferentes configuraciones de <code>failure_threshold</code> y <code>recovery_timeout</code>.</p>
</div><h1><p>Conclusión</p>
</h1>
<div class='content'><p>En esta sección, hemos explorado varios patrones de diseño utilizados en sistemas distribuidos, incluyendo Orquestación, Coreografía, Circuit Breaker y Event Sourcing. Estos patrones ayudan a abordar los desafíos únicos de los sistemas distribuidos, mejorando su robustez, escalabilidad y mantenibilidad. Al aplicar estos patrones, los desarrolladores pueden construir sistemas más resilientes y eficientes.</p>
<hr />
<p>En el siguiente módulo, exploraremos cómo aplicar estos patrones en arquitecturas modernas, como microservicios y sistemas distribuidos, para maximizar su efectividad y eficiencia.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='06-02-patrones-microservicios' title="Patrones de Diseño en Microservicios">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='06-04-patrones-desarrollo-agil' title="Patrones de Diseño en Desarrollo Ágil">Siguiente &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Aceptar</a>
    <a href="/cookies">Mas información</a>
</div>	

	</div>    
</body>
</html>
