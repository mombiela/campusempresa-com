<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive">
    <title>Configuración de Spring Security</title>

    <link rel="alternate" href="https://campusempresa.com/mod/springboot/05-02-configuring-spring-security" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/springboot/05-02-configuring-spring-security" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/springboot/05-02-configuring-spring-security" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css?v=4" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>  	
	</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-2 p-md-0 text-end">
			<span>	<a href="https://enterprisecampus.net/mod/springboot/05-02-configuring-spring-security" class="px-2">EN</a></b>
	|
	<b class="px-2">ES</b>
	|
	<a href="https://campusempresa.cat/mod/springboot/05-02-configuring-spring-security" class="px-2">CA</a>
</span>
			<span class="d-none d-md-inline"><br><cite>Todo el conocimiento a tu alcance</cite></span>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">El Proyecto</a> | 
<a href="/about">Sobre nosotros</a> | 
<a href="/contribute">Contribuir</a> | 
<a href="/donate">Donaciones</a> | 
<a href="/licence">Licencia</a>
		</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
					 				<a href="/"><i class="bi bi-house-fill"></i> HOME</a>
											</div>
		</div>
	</div>
</div>
		
<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
				<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='05-01-introduction-spring-security' title="Introducción a Spring Security">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Configuración de Spring Security</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='05-03-user-authentication-authorization' title="Autenticación y Autorización de Usuarios">
				<span class="d-none d-md-inline">Siguiente &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>En este tema, aprenderemos cómo configurar Spring Security en una aplicación Spring Boot. Spring Security es un marco poderoso y altamente personalizable para la autenticación y autorización en aplicaciones Java. A lo largo de esta sección, cubriremos los conceptos básicos de la configuración de Spring Security, incluyendo la configuración de seguridad básica, la personalización de la autenticación y la autorización, y la integración con bases de datos para la gestión de usuarios.</p>
</div><h1>Contenido</h1>
<div class='content'><ol>
<li><a href="#configuración-básica-de-spring-security">Configuración Básica de Spring Security</a></li>
<li><a href="#personalización-de-la-autenticación">Personalización de la Autenticación</a></li>
<li><a href="#personalización-de-la-autorización">Personalización de la Autorización</a></li>
<li><a href="#integración-con-bases-de-datos">Integración con Bases de Datos</a></li>
<li><a href="#ejercicios-prácticos">Ejercicios Prácticos</a></li>
</ol>
</div><h1>Configuración Básica de Spring Security</h1>
<div class='content'></div><h2>Paso 1: Añadir Dependencias</h2>
<div class='content'><p>Para empezar, necesitamos añadir las dependencias de Spring Security en nuestro archivo <code>pom.xml</code>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("PGRlcGVuZGVuY3k+CiAgICA8Z3JvdXBJZD5vcmcuc3ByaW5nZnJhbWV3b3JrLmJvb3Q8L2dyb3VwSWQ+CiAgICA8YXJ0aWZhY3RJZD5zcHJpbmctYm9vdC1zdGFydGVyLXNlY3VyaXR5PC9hcnRpZmFjdElkPgo8L2RlcGVuZGVuY3k+"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;</pre></div><div class='content'></div><h2>Paso 2: Configuración por Defecto</h2>
<div class='content'><p>Spring Boot proporciona una configuración de seguridad por defecto que protege todas las rutas de nuestra aplicación. Al añadir la dependencia de Spring Security, nuestra aplicación requerirá autenticación para todas las rutas.</p>
</div><h2>Paso 3: Configuración Personalizada</h2>
<div class='content'><p>Podemos personalizar la configuración de seguridad creando una clase que extienda <code>WebSecurityConfigurerAdapter</code>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuY29udGV4dC5hbm5vdGF0aW9uLkNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnNlY3VyaXR5LmNvbmZpZy5hbm5vdGF0aW9uLndlYi5idWlsZGVycy5IdHRwU2VjdXJpdHk7CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnNlY3VyaXR5LmNvbmZpZy5hbm5vdGF0aW9uLndlYi5jb25maWd1cmF0aW9uLkVuYWJsZVdlYlNlY3VyaXR5OwppbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5zZWN1cml0eS5jb25maWcuYW5ub3RhdGlvbi53ZWIuY29uZmlndXJhdGlvbi5XZWJTZWN1cml0eUNvbmZpZ3VyZXJBZGFwdGVyOwoKQENvbmZpZ3VyYXRpb24KQEVuYWJsZVdlYlNlY3VyaXR5CnB1YmxpYyBjbGFzcyBTZWN1cml0eUNvbmZpZyBleHRlbmRzIFdlYlNlY3VyaXR5Q29uZmlndXJlckFkYXB0ZXIgewoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgY29uZmlndXJlKEh0dHBTZWN1cml0eSBodHRwKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBodHRwCiAgICAgICAgICAgIC5hdXRob3JpemVSZXF1ZXN0cygpCiAgICAgICAgICAgICAgICAuYW50TWF0Y2hlcnMoIi9wdWJsaWMvKioiKS5wZXJtaXRBbGwoKSAvLyBQZXJtaXRpciBhY2Nlc28gc2luIGF1dGVudGljYWNpw7NuIGEgcnV0YXMgcMO6YmxpY2FzCiAgICAgICAgICAgICAgICAuYW55UmVxdWVzdCgpLmF1dGhlbnRpY2F0ZWQoKSAvLyBSZXF1ZXJpciBhdXRlbnRpY2FjacOzbiBwYXJhIGN1YWxxdWllciBvdHJhIHJ1dGEKICAgICAgICAgICAgICAgIC5hbmQoKQogICAgICAgICAgICAuZm9ybUxvZ2luKCkKICAgICAgICAgICAgICAgIC5sb2dpblBhZ2UoIi9sb2dpbiIpIC8vIFDDoWdpbmEgZGUgaW5pY2lvIGRlIHNlc2nDs24gcGVyc29uYWxpemFkYQogICAgICAgICAgICAgICAgLnBlcm1pdEFsbCgpCiAgICAgICAgICAgICAgICAuYW5kKCkKICAgICAgICAgICAgLmxvZ291dCgpCiAgICAgICAgICAgICAgICAucGVybWl0QWxsKCk7CiAgICB9Cn0="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;

@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .authorizeRequests()
                .antMatchers(&quot;/public/**&quot;).permitAll() // Permitir acceso sin autenticaci&oacute;n a rutas p&uacute;blicas
                .anyRequest().authenticated() // Requerir autenticaci&oacute;n para cualquier otra ruta
                .and()
            .formLogin()
                .loginPage(&quot;/login&quot;) // P&aacute;gina de inicio de sesi&oacute;n personalizada
                .permitAll()
                .and()
            .logout()
                .permitAll();
    }
}</pre></div><div class='content'></div><h2>Explicación del Código</h2>
<div class='content'><ul>
<li><code>@Configuration</code> y <code>@EnableWebSecurity</code>: Anotaciones que indican que esta clase es una configuración de seguridad.</li>
<li><code>authorizeRequests()</code>: Método para definir las reglas de autorización.</li>
<li><code>antMatchers(&quot;/public/**&quot;).permitAll()</code>: Permite el acceso sin autenticación a cualquier ruta que comience con <code>/public/</code>.</li>
<li><code>anyRequest().authenticated()</code>: Requiere autenticación para cualquier otra ruta.</li>
<li><code>formLogin()</code>: Habilita el formulario de inicio de sesión.</li>
<li><code>loginPage(&quot;/login&quot;)</code>: Especifica una página de inicio de sesión personalizada.</li>
<li><code>logout()</code>: Habilita la funcionalidad de cierre de sesión.</li>
</ul>
</div><h1>Personalización de la Autenticación</h1>
<div class='content'></div><h2>Paso 1: Configuración de Usuarios en Memoria</h2>
<div class='content'><p>Podemos configurar usuarios en memoria para propósitos de prueba:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuY29udGV4dC5hbm5vdGF0aW9uLkJlYW47CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnNlY3VyaXR5LmNvbmZpZy5hbm5vdGF0aW9uLmF1dGhlbnRpY2F0aW9uLmJ1aWxkZXJzLkF1dGhlbnRpY2F0aW9uTWFuYWdlckJ1aWxkZXI7CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnNlY3VyaXR5LmNvcmUudXNlcmRldGFpbHMuVXNlcjsKaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuc2VjdXJpdHkuY29yZS51c2VyZGV0YWlscy5Vc2VyRGV0YWlsczsKaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuc2VjdXJpdHkuY29yZS51c2VyZGV0YWlscy5Vc2VyRGV0YWlsc1NlcnZpY2U7CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnNlY3VyaXR5LnByb3Zpc2lvbmluZy5Jbk1lbW9yeVVzZXJEZXRhaWxzTWFuYWdlcjsKCkBDb25maWd1cmF0aW9uCnB1YmxpYyBjbGFzcyBTZWN1cml0eUNvbmZpZyBleHRlbmRzIFdlYlNlY3VyaXR5Q29uZmlndXJlckFkYXB0ZXIgewoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgY29uZmlndXJlKEF1dGhlbnRpY2F0aW9uTWFuYWdlckJ1aWxkZXIgYXV0aCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgYXV0aC5pbk1lbW9yeUF1dGhlbnRpY2F0aW9uKCkKICAgICAgICAgICAgLndpdGhVc2VyKCJ1c2VyIikucGFzc3dvcmQoIntub29wfXBhc3N3b3JkIikucm9sZXMoIlVTRVIiKQogICAgICAgICAgICAuYW5kKCkKICAgICAgICAgICAgLndpdGhVc2VyKCJhZG1pbiIpLnBhc3N3b3JkKCJ7bm9vcH1hZG1pbiIpLnJvbGVzKCJBRE1JTiIpOwogICAgfQp9"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.springframework.context.annotation.Bean;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.provisioning.InMemoryUserDetailsManager;

@Configuration
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.inMemoryAuthentication()
            .withUser(&quot;user&quot;).password(&quot;{noop}password&quot;).roles(&quot;USER&quot;)
            .and()
            .withUser(&quot;admin&quot;).password(&quot;{noop}admin&quot;).roles(&quot;ADMIN&quot;);
    }
}</pre></div><div class='content'></div><h2>Explicación del Código</h2>
<div class='content'><ul>
<li><code>auth.inMemoryAuthentication()</code>: Configura la autenticación en memoria.</li>
<li><code>withUser(&quot;user&quot;).password(&quot;{noop}password&quot;).roles(&quot;USER&quot;)</code>: Añade un usuario con el rol <code>USER</code>.</li>
<li><code>{noop}</code>: Indica que la contraseña no está codificada.</li>
</ul>
</div><h1>Personalización de la Autorización</h1>
<div class='content'></div><h2>Paso 1: Configuración de Roles y Permisos</h2>
<div class='content'><p>Podemos definir roles y permisos específicos para diferentes rutas:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("QE92ZXJyaWRlCnByb3RlY3RlZCB2b2lkIGNvbmZpZ3VyZShIdHRwU2VjdXJpdHkgaHR0cCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICBodHRwCiAgICAgICAgLmF1dGhvcml6ZVJlcXVlc3RzKCkKICAgICAgICAgICAgLmFudE1hdGNoZXJzKCIvYWRtaW4vKioiKS5oYXNSb2xlKCJBRE1JTiIpIC8vIFNvbG8gdXN1YXJpb3MgY29uIHJvbCBBRE1JTiBwdWVkZW4gYWNjZWRlcgogICAgICAgICAgICAuYW50TWF0Y2hlcnMoIi91c2VyLyoqIikuaGFzUm9sZSgiVVNFUiIpIC8vIFNvbG8gdXN1YXJpb3MgY29uIHJvbCBVU0VSIHB1ZWRlbiBhY2NlZGVyCiAgICAgICAgICAgIC5hbnRNYXRjaGVycygiL3B1YmxpYy8qKiIpLnBlcm1pdEFsbCgpIC8vIFBlcm1pdGlyIGFjY2VzbyBzaW4gYXV0ZW50aWNhY2nDs24gYSBydXRhcyBww7pibGljYXMKICAgICAgICAgICAgLmFueVJlcXVlc3QoKS5hdXRoZW50aWNhdGVkKCkKICAgICAgICAgICAgLmFuZCgpCiAgICAgICAgLmZvcm1Mb2dpbigpCiAgICAgICAgICAgIC5sb2dpblBhZ2UoIi9sb2dpbiIpCiAgICAgICAgICAgIC5wZXJtaXRBbGwoKQogICAgICAgICAgICAuYW5kKCkKICAgICAgICAubG9nb3V0KCkKICAgICAgICAgICAgLnBlcm1pdEFsbCgpOwp9"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>@Override
protected void configure(HttpSecurity http) throws Exception {
    http
        .authorizeRequests()
            .antMatchers(&quot;/admin/**&quot;).hasRole(&quot;ADMIN&quot;) // Solo usuarios con rol ADMIN pueden acceder
            .antMatchers(&quot;/user/**&quot;).hasRole(&quot;USER&quot;) // Solo usuarios con rol USER pueden acceder
            .antMatchers(&quot;/public/**&quot;).permitAll() // Permitir acceso sin autenticaci&oacute;n a rutas p&uacute;blicas
            .anyRequest().authenticated()
            .and()
        .formLogin()
            .loginPage(&quot;/login&quot;)
            .permitAll()
            .and()
        .logout()
            .permitAll();
}</pre></div><div class='content'></div><h2>Explicación del Código</h2>
<div class='content'><ul>
<li><code>antMatchers(&quot;/admin/**&quot;).hasRole(&quot;ADMIN&quot;)</code>: Solo usuarios con el rol <code>ADMIN</code> pueden acceder a rutas que comiencen con <code>/admin/</code>.</li>
<li><code>antMatchers(&quot;/user/**&quot;).hasRole(&quot;USER&quot;)</code>: Solo usuarios con el rol <code>USER</code> pueden acceder a rutas que comiencen con <code>/user/</code>.</li>
</ul>
</div><h1>Integración con Bases de Datos</h1>
<div class='content'></div><h2>Paso 1: Configuración de la Fuente de Datos</h2>
<div class='content'><p>Primero, configuramos la fuente de datos en <code>application.properties</code>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c3ByaW5nLmRhdGFzb3VyY2UudXJsPWpkYmM6bXlzcWw6Ly9sb2NhbGhvc3Q6MzMwNi9teWRiCnNwcmluZy5kYXRhc291cmNlLnVzZXJuYW1lPXJvb3QKc3ByaW5nLmRhdGFzb3VyY2UucGFzc3dvcmQ9cm9vdApzcHJpbmcuZGF0YXNvdXJjZS5kcml2ZXItY2xhc3MtbmFtZT1jb20ubXlzcWwuY2ouamRiYy5Ecml2ZXI="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>spring.datasource.url=jdbc:mysql://localhost:3306/mydb
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</pre></div><div class='content'></div><h2>Paso 2: Configuración de Usuarios en la Base de Datos</h2>
<div class='content'><p>Creamos una tabla de usuarios y roles en la base de datos:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIFRBQkxFIHVzZXJzICgKICAgIHVzZXJuYW1lIFZBUkNIQVIoNTApIE5PVCBOVUxMIFBSSU1BUlkgS0VZLAogICAgcGFzc3dvcmQgVkFSQ0hBUigxMDApIE5PVCBOVUxMLAogICAgZW5hYmxlZCBCT09MRUFOIE5PVCBOVUxMCik7CgpDUkVBVEUgVEFCTEUgYXV0aG9yaXRpZXMgKAogICAgdXNlcm5hbWUgVkFSQ0hBUig1MCkgTk9UIE5VTEwsCiAgICBhdXRob3JpdHkgVkFSQ0hBUig1MCkgTk9UIE5VTEwsCiAgICBGT1JFSUdOIEtFWSAodXNlcm5hbWUpIFJFRkVSRU5DRVMgdXNlcnModXNlcm5hbWUpCik7"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE TABLE users (
    username VARCHAR(50) NOT NULL PRIMARY KEY,
    password VARCHAR(100) NOT NULL,
    enabled BOOLEAN NOT NULL
);

CREATE TABLE authorities (
    username VARCHAR(50) NOT NULL,
    authority VARCHAR(50) NOT NULL,
    FOREIGN KEY (username) REFERENCES users(username)
);</pre></div><div class='content'></div><h2>Paso 3: Configuración de la Autenticación con JDBC</h2>
<div class='content'><p>Configuramos la autenticación para usar JDBC:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IGphdmF4LnNxbC5EYXRhU291cmNlOwppbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5iZWFucy5mYWN0b3J5LmFubm90YXRpb24uQXV0b3dpcmVkOwppbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5jb250ZXh0LmFubm90YXRpb24uQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuc2VjdXJpdHkuY29uZmlnLmFubm90YXRpb24uYXV0aGVudGljYXRpb24uYnVpbGRlcnMuQXV0aGVudGljYXRpb25NYW5hZ2VyQnVpbGRlcjsKaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuc2VjdXJpdHkuY29uZmlnLmFubm90YXRpb24ud2ViLmJ1aWxkZXJzLkh0dHBTZWN1cml0eTsKaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuc2VjdXJpdHkuY29uZmlnLmFubm90YXRpb24ud2ViLmNvbmZpZ3VyYXRpb24uRW5hYmxlV2ViU2VjdXJpdHk7CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnNlY3VyaXR5LmNvbmZpZy5hbm5vdGF0aW9uLndlYi5jb25maWd1cmF0aW9uLldlYlNlY3VyaXR5Q29uZmlndXJlckFkYXB0ZXI7CgpAQ29uZmlndXJhdGlvbgpARW5hYmxlV2ViU2VjdXJpdHkKcHVibGljIGNsYXNzIFNlY3VyaXR5Q29uZmlnIGV4dGVuZHMgV2ViU2VjdXJpdHlDb25maWd1cmVyQWRhcHRlciB7CgogICAgQEF1dG93aXJlZAogICAgcHJpdmF0ZSBEYXRhU291cmNlIGRhdGFTb3VyY2U7CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBjb25maWd1cmUoQXV0aGVudGljYXRpb25NYW5hZ2VyQnVpbGRlciBhdXRoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBhdXRoLmpkYmNBdXRoZW50aWNhdGlvbigpCiAgICAgICAgICAgIC5kYXRhU291cmNlKGRhdGFTb3VyY2UpCiAgICAgICAgICAgIC51c2Vyc0J5VXNlcm5hbWVRdWVyeSgiU0VMRUNUIHVzZXJuYW1lLCBwYXNzd29yZCwgZW5hYmxlZCBGUk9NIHVzZXJzIFdIRVJFIHVzZXJuYW1lID0gPyIpCiAgICAgICAgICAgIC5hdXRob3JpdGllc0J5VXNlcm5hbWVRdWVyeSgiU0VMRUNUIHVzZXJuYW1lLCBhdXRob3JpdHkgRlJPTSBhdXRob3JpdGllcyBXSEVSRSB1c2VybmFtZSA9ID8iKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIGNvbmZpZ3VyZShIdHRwU2VjdXJpdHkgaHR0cCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaHR0cAogICAgICAgICAgICAuYXV0aG9yaXplUmVxdWVzdHMoKQogICAgICAgICAgICAgICAgLmFudE1hdGNoZXJzKCIvcHVibGljLyoqIikucGVybWl0QWxsKCkKICAgICAgICAgICAgICAgIC5hbnlSZXF1ZXN0KCkuYXV0aGVudGljYXRlZCgpCiAgICAgICAgICAgICAgICAuYW5kKCkKICAgICAgICAgICAgLmZvcm1Mb2dpbigpCiAgICAgICAgICAgICAgICAubG9naW5QYWdlKCIvbG9naW4iKQogICAgICAgICAgICAgICAgLnBlcm1pdEFsbCgpCiAgICAgICAgICAgICAgICAuYW5kKCkKICAgICAgICAgICAgLmxvZ291dCgpCiAgICAgICAgICAgICAgICAucGVybWl0QWxsKCk7CiAgICB9Cn0="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import javax.sql.DataSource;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;

@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Autowired
    private DataSource dataSource;

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.jdbcAuthentication()
            .dataSource(dataSource)
            .usersByUsernameQuery(&quot;SELECT username, password, enabled FROM users WHERE username = ?&quot;)
            .authoritiesByUsernameQuery(&quot;SELECT username, authority FROM authorities WHERE username = ?&quot;);
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .authorizeRequests()
                .antMatchers(&quot;/public/**&quot;).permitAll()
                .anyRequest().authenticated()
                .and()
            .formLogin()
                .loginPage(&quot;/login&quot;)
                .permitAll()
                .and()
            .logout()
                .permitAll();
    }
}</pre></div><div class='content'></div><h2>Explicación del Código</h2>
<div class='content'><ul>
<li><code>auth.jdbcAuthentication()</code>: Configura la autenticación para usar JDBC.</li>
<li><code>dataSource(dataSource)</code>: Especifica la fuente de datos.</li>
<li><code>usersByUsernameQuery</code>: Consulta SQL para obtener los detalles del usuario.</li>
<li><code>authoritiesByUsernameQuery</code>: Consulta SQL para obtener los roles del usuario.</li>
</ul>
</div><h1>Ejercicios Prácticos</h1>
<div class='content'></div><h2>Ejercicio 1: Configuración Básica de Seguridad</h2>
<div class='content'><ol>
<li>Añade la dependencia de Spring Security a tu proyecto.</li>
<li>Crea una clase de configuración de seguridad que permita el acceso sin autenticación a la ruta <code>/public/**</code> y requiera autenticación para cualquier otra ruta.</li>
</ol>
</div><h2>Ejercicio 2: Configuración de Usuarios en Memoria</h2>
<div class='content'><ol>
<li>Configura dos usuarios en memoria: uno con el rol <code>USER</code> y otro con el rol <code>ADMIN</code>.</li>
<li>Configura las rutas <code>/user/**</code> y <code>/admin/**</code> para que solo sean accesibles por usuarios con los roles correspondientes.</li>
</ol>
</div><h2>Ejercicio 3: Integración con Base de Datos</h2>
<div class='content'><ol>
<li>Configura una base de datos MySQL para almacenar usuarios y roles.</li>
<li>Configura la autenticación en tu aplicación Spring Boot para usar la base de datos.</li>
</ol>
</div><h2>Soluciones</h2>
<div class='content'><h4>Ejercicio 1</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuY29udGV4dC5hbm5vdGF0aW9uLkNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnNlY3VyaXR5LmNvbmZpZy5hbm5vdGF0aW9uLndlYi5idWlsZGVycy5IdHRwU2VjdXJpdHk7CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnNlY3VyaXR5LmNvbmZpZy5hbm5vdGF0aW9uLndlYi5jb25maWd1cmF0aW9uLkVuYWJsZVdlYlNlY3VyaXR5OwppbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5zZWN1cml0eS5jb25maWcuYW5ub3RhdGlvbi53ZWIuY29uZmlndXJhdGlvbi5XZWJTZWN1cml0eUNvbmZpZ3VyZXJBZGFwdGVyOwoKQENvbmZpZ3VyYXRpb24KQEVuYWJsZVdlYlNlY3VyaXR5CnB1YmxpYyBjbGFzcyBTZWN1cml0eUNvbmZpZyBleHRlbmRzIFdlYlNlY3VyaXR5Q29uZmlndXJlckFkYXB0ZXIgewoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgY29uZmlndXJlKEh0dHBTZWN1cml0eSBodHRwKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBodHRwCiAgICAgICAgICAgIC5hdXRob3JpemVSZXF1ZXN0cygpCiAgICAgICAgICAgICAgICAuYW50TWF0Y2hlcnMoIi9wdWJsaWMvKioiKS5wZXJtaXRBbGwoKQogICAgICAgICAgICAgICAgLmFueVJlcXVlc3QoKS5hdXRoZW50aWNhdGVkKCkKICAgICAgICAgICAgICAgIC5hbmQoKQogICAgICAgICAgICAuZm9ybUxvZ2luKCkKICAgICAgICAgICAgICAgIC5wZXJtaXRBbGwoKQogICAgICAgICAgICAgICAgLmFuZCgpCiAgICAgICAgICAgIC5sb2dvdXQoKQogICAgICAgICAgICAgICAgLnBlcm1pdEFsbCgpOwogICAgfQp9"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;

@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .authorizeRequests()
                .antMatchers(&quot;/public/**&quot;).permitAll()
                .anyRequest().authenticated()
                .and()
            .formLogin()
                .permitAll()
                .and()
            .logout()
                .permitAll();
    }
}</pre></div><div class='content'><h4>Ejercicio 2</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuY29udGV4dC5hbm5vdGF0aW9uLkNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnNlY3VyaXR5LmNvbmZpZy5hbm5vdGF0aW9uLmF1dGhlbnRpY2F0aW9uLmJ1aWxkZXJzLkF1dGhlbnRpY2F0aW9uTWFuYWdlckJ1aWxkZXI7CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnNlY3VyaXR5LmNvbmZpZy5hbm5vdGF0aW9uLndlYi5idWlsZGVycy5IdHRwU2VjdXJpdHk7CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnNlY3VyaXR5LmNvbmZpZy5hbm5vdGF0aW9uLndlYi5jb25maWd1cmF0aW9uLkVuYWJsZVdlYlNlY3VyaXR5OwppbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5zZWN1cml0eS5jb25maWcuYW5ub3RhdGlvbi53ZWIuY29uZmlndXJhdGlvbi5XZWJTZWN1cml0eUNvbmZpZ3VyZXJBZGFwdGVyOwoKQENvbmZpZ3VyYXRpb24KQEVuYWJsZVdlYlNlY3VyaXR5CnB1YmxpYyBjbGFzcyBTZWN1cml0eUNvbmZpZyBleHRlbmRzIFdlYlNlY3VyaXR5Q29uZmlndXJlckFkYXB0ZXIgewoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgY29uZmlndXJlKEF1dGhlbnRpY2F0aW9uTWFuYWdlckJ1aWxkZXIgYXV0aCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgYXV0aC5pbk1lbW9yeUF1dGhlbnRpY2F0aW9uKCkKICAgICAgICAgICAgLndpdGhVc2VyKCJ1c2VyIikucGFzc3dvcmQoIntub29wfXBhc3N3b3JkIikucm9sZXMoIlVTRVIiKQogICAgICAgICAgICAuYW5kKCkKICAgICAgICAgICAgLndpdGhVc2VyKCJhZG1pbiIpLnBhc3N3b3JkKCJ7bm9vcH1hZG1pbiIpLnJvbGVzKCJBRE1JTiIpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgY29uZmlndXJlKEh0dHBTZWN1cml0eSBodHRwKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBodHRwCiAgICAgICAgICAgIC5hdXRob3JpemVSZXF1ZXN0cygpCiAgICAgICAgICAgICAgICAuYW50TWF0Y2hlcnMoIi9hZG1pbi8qKiIpLmhhc1JvbGUoIkFETUlOIikKICAgICAgICAgICAgICAgIC5hbnRNYXRjaGVycygiL3VzZXIvKioiKS5oYXNSb2xlKCJVU0VSIikKICAgICAgICAgICAgICAgIC5hbnRNYXRjaGVycygiL3B1YmxpYy8qKiIpLnBlcm1pdEFsbCgpCiAgICAgICAgICAgICAgICAuYW55UmVxdWVzdCgpLmF1dGhlbnRpY2F0ZWQoKQogICAgICAgICAgICAgICAgLmFuZCgpCiAgICAgICAgICAgIC5mb3JtTG9naW4oKQogICAgICAgICAgICAgICAgLnBlcm1pdEFsbCgpCiAgICAgICAgICAgICAgICAuYW5kKCkKICAgICAgICAgICAgLmxvZ291dCgpCiAgICAgICAgICAgICAgICAucGVybWl0QWxsKCk7CiAgICB9Cn0="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;

@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.inMemoryAuthentication()
            .withUser(&quot;user&quot;).password(&quot;{noop}password&quot;).roles(&quot;USER&quot;)
            .and()
            .withUser(&quot;admin&quot;).password(&quot;{noop}admin&quot;).roles(&quot;ADMIN&quot;);
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .authorizeRequests()
                .antMatchers(&quot;/admin/**&quot;).hasRole(&quot;ADMIN&quot;)
                .antMatchers(&quot;/user/**&quot;).hasRole(&quot;USER&quot;)
                .antMatchers(&quot;/public/**&quot;).permitAll()
                .anyRequest().authenticated()
                .and()
            .formLogin()
                .permitAll()
                .and()
            .logout()
                .permitAll();
    }
}</pre></div><div class='content'><h4>Ejercicio 3</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IGphdmF4LnNxbC5EYXRhU291cmNlOwppbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5iZWFucy5mYWN0b3J5LmFubm90YXRpb24uQXV0b3dpcmVkOwppbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5jb250ZXh0LmFubm90YXRpb24uQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuc2VjdXJpdHkuY29uZmlnLmFubm90YXRpb24uYXV0aGVudGljYXRpb24uYnVpbGRlcnMuQXV0aGVudGljYXRpb25NYW5hZ2VyQnVpbGRlcjsKaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuc2VjdXJpdHkuY29uZmlnLmFubm90YXRpb24ud2ViLmJ1aWxkZXJzLkh0dHBTZWN1cml0eTsKaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuc2VjdXJpdHkuY29uZmlnLmFubm90YXRpb24ud2ViLmNvbmZpZ3VyYXRpb24uRW5hYmxlV2ViU2VjdXJpdHk7CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnNlY3VyaXR5LmNvbmZpZy5hbm5vdGF0aW9uLndlYi5jb25maWd1cmF0aW9uLldlYlNlY3VyaXR5Q29uZmlndXJlckFkYXB0ZXI7CgpAQ29uZmlndXJhdGlvbgpARW5hYmxlV2ViU2VjdXJpdHkKcHVibGljIGNsYXNzIFNlY3VyaXR5Q29uZmlnIGV4dGVuZHMgV2ViU2VjdXJpdHlDb25maWd1cmVyQWRhcHRlciB7CgogICAgQEF1dG93aXJlZAogICAgcHJpdmF0ZSBEYXRhU291cmNlIGRhdGFTb3VyY2U7CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBjb25maWd1cmUoQXV0aGVudGljYXRpb25NYW5hZ2VyQnVpbGRlciBhdXRoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBhdXRoLmpkYmNBdXRoZW50aWNhdGlvbigpCiAgICAgICAgICAgIC5kYXRhU291cmNlKGRhdGFTb3VyY2UpCiAgICAgICAgICAgIC51c2Vyc0J5VXNlcm5hbWVRdWVyeSgiU0VMRUNUIHVzZXJuYW1lLCBwYXNzd29yZCwgZW5hYmxlZCBGUk9NIHVzZXJzIFdIRVJFIHVzZXJuYW1lID0gPyIpCiAgICAgICAgICAgIC5hdXRob3JpdGllc0J5VXNlcm5hbWVRdWVyeSgiU0VMRUNUIHVzZXJuYW1lLCBhdXRob3JpdHkgRlJPTSBhdXRob3JpdGllcyBXSEVSRSB1c2VybmFtZSA9ID8iKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIGNvbmZpZ3VyZShIdHRwU2VjdXJpdHkgaHR0cCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaHR0cAogICAgICAgICAgICAuYXV0aG9yaXplUmVxdWVzdHMoKQogICAgICAgICAgICAgICAgLmFudE1hdGNoZXJzKCIvcHVibGljLyoqIikucGVybWl0QWxsKCkKICAgICAgICAgICAgICAgIC5hbnlSZXF1ZXN0KCkuYXV0aGVudGljYXRlZCgpCiAgICAgICAgICAgICAgICAuYW5kKCkKICAgICAgICAgICAgLmZvcm1Mb2dpbigpCiAgICAgICAgICAgICAgICAucGVybWl0QWxsKCkKICAgICAgICAgICAgICAgIC5hbmQoKQogICAgICAgICAgICAubG9nb3V0KCkKICAgICAgICAgICAgICAgIC5wZXJtaXRBbGwoKTsKICAgIH0KfQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import javax.sql.DataSource;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;

@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Autowired
    private DataSource dataSource;

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.jdbcAuthentication()
            .dataSource(dataSource)
            .usersByUsernameQuery(&quot;SELECT username, password, enabled FROM users WHERE username = ?&quot;)
            .authoritiesByUsernameQuery(&quot;SELECT username, authority FROM authorities WHERE username = ?&quot;);
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .authorizeRequests()
                .antMatchers(&quot;/public/**&quot;).permitAll()
                .anyRequest().authenticated()
                .and()
            .formLogin()
                .permitAll()
                .and()
            .logout()
                .permitAll();
    }
}</pre></div><div class='content'></div><h1>Conclusión</h1>
<div class='content'><p>En esta sección, hemos aprendido cómo configurar Spring Security en una aplicación Spring Boot. Hemos cubierto la configuración básica, la personalización de la autenticación y la autorización, y la integración con bases de datos. Con estos conocimientos, puedes asegurar tu aplicación Spring Boot y proteger tus rutas y recursos de manera efectiva. En el próximo tema, exploraremos cómo implementar la autenticación JWT en Spring Boot.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='05-01-introduction-spring-security' title="Introducción a Spring Security">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='05-03-user-authentication-authorization' title="Autenticación y Autorización de Usuarios">
				<span class="d-none d-md-inline">Siguiente &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<!-- 
<h1>Publicidad</h1>
<p>Este espacio está destinado a publicidad.</p>
<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
<p>¡Gracias por colaborar!</p>
-->

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725"
     crossorigin="anonymous"></script>
<!-- enterprise_campus -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-0611338592562725"
     data-ad-slot="6914733106"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			









		</div>
	</div>
</div>

<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">El Proyecto</a> | 
<a href="/about">Sobre nosotros</a> | 
<a href="/contribute">Contribuir</a> | 
<a href="/donate">Donaciones</a> | 
<a href="/licence">Licencia</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Usamos cookies para mejorar tu experiencia de uso y ofrecer contenidos adaptados a tus intereses.
    <a href="#" id="btn_accept_cookies" class="button">Aceptar</a>
    <a href="/cookies">Mas información</a>
</div>	

	</div>    
</body>
</html>
