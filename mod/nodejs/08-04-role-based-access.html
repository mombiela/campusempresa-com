<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Acceso Basado en Roles</title>

    <link rel="alternate" href="https://campusempresa.com/mod/nodejs/08-04-role-based-access" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/nodejs/08-04-role-based-access" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/nodejs/08-04-role-based-access" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
										<a href="https://enterprisecampus.net/mod/nodejs/08-04-role-based-access" class="px-2">EN</a></b>
				|
				<b class="px-2">ES</b>
				|
				<a href="https://campusempresa.cat/mod/nodejs/08-04-role-based-access" class="px-2">CA</a>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Proyecto</a>
				<a href="/about">Sobre nosotros</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donaciones</a>
				<a href="/licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='08-03-jwt-authentication' title="Autenticación JWT">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Control de Acceso Basado en Roles</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='09-01-introduction-testing' title="Introducción a las Pruebas">Siguiente &#x25BA;</a>
			</div>
</div>
<div class='content'><p>El control de acceso basado en roles (RBAC, por sus siglas en inglés) es una metodología de seguridad que restringe el acceso a los recursos del sistema en función de los roles asignados a los usuarios. En una aplicación Node.js, RBAC se puede implementar para asegurar que solo los usuarios con los permisos adecuados puedan acceder a ciertas rutas o realizar acciones específicas.</p>
</div><h1>Conceptos Clave</h1>
<div class='content'><ol>
<li><strong>Roles</strong>: Un conjunto de permisos que se asignan a los usuarios. Ejemplos comunes incluyen &quot;admin&quot;, &quot;editor&quot; y &quot;viewer&quot;.</li>
<li><strong>Permisos</strong>: Acciones específicas que un rol puede realizar, como &quot;crear&quot;, &quot;leer&quot;, &quot;actualizar&quot; y &quot;eliminar&quot;.</li>
<li><strong>Usuarios</strong>: Entidades que se autentican en el sistema y se les asignan roles.</li>
</ol>
</div><h1>Implementación de RBAC en Node.js</h1>
<div class='content'></div><h2>Paso 1: Definir Roles y Permisos</h2>
<div class='content'><p>Primero, definimos los roles y los permisos asociados. Esto se puede hacer en un archivo de configuración o directamente en el código.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3Qgcm9sZXMgPSB7CiAgYWRtaW46IFsnY3JlYXRlJywgJ3JlYWQnLCAndXBkYXRlJywgJ2RlbGV0ZSddLAogIGVkaXRvcjogWydjcmVhdGUnLCAncmVhZCcsICd1cGRhdGUnXSwKICB2aWV3ZXI6IFsncmVhZCddCn07"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const roles = {
  admin: ['create', 'read', 'update', 'delete'],
  editor: ['create', 'read', 'update'],
  viewer: ['read']
};</pre></div><div class='content'></div><h2>Paso 2: Middleware de Autorización</h2>
<div class='content'><p>Creamos un middleware que verifique si el usuario tiene el rol necesario para acceder a una ruta específica.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgYXV0aG9yaXplID0gKHJlcXVpcmVkUm9sZSkgPT4gewogIHJldHVybiAocmVxLCByZXMsIG5leHQpID0+IHsKICAgIGNvbnN0IHVzZXJSb2xlID0gcmVxLnVzZXIucm9sZTsgLy8gQXN1bWltb3MgcXVlIGVsIHJvbCBkZWwgdXN1YXJpbyBlc3TDoSBlbiByZXEudXNlci5yb2xlCgogICAgaWYgKHJvbGVzW3VzZXJSb2xlXSAmJiByb2xlc1t1c2VyUm9sZV0uaW5jbHVkZXMocmVxdWlyZWRSb2xlKSkgewogICAgICBuZXh0KCk7IC8vIEVsIHVzdWFyaW8gdGllbmUgZWwgcGVybWlzbyBuZWNlc2FyaW8KICAgIH0gZWxzZSB7CiAgICAgIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgbWVzc2FnZTogJ0FjY2VzbyBkZW5lZ2FkbycgfSk7CiAgICB9CiAgfTsKfTs="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const authorize = (requiredRole) =&gt; {
  return (req, res, next) =&gt; {
    const userRole = req.user.role; // Asumimos que el rol del usuario est&aacute; en req.user.role

    if (roles[userRole] &amp;&amp; roles[userRole].includes(requiredRole)) {
      next(); // El usuario tiene el permiso necesario
    } else {
      res.status(403).json({ message: 'Acceso denegado' });
    }
  };
};</pre></div><div class='content'></div><h2>Paso 3: Aplicar el Middleware a las Rutas</h2>
<div class='content'><p>Utilizamos el middleware de autorización en las rutas que queremos proteger.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTsKY29uc3QgYXBwID0gZXhwcmVzcygpOwoKLy8gTWlkZGxld2FyZSBkZSBhdXRlbnRpY2FjacOzbiAoZWplbXBsbykKYXBwLnVzZSgocmVxLCByZXMsIG5leHQpID0+IHsKICAvLyBTaW11bGFtb3MgdW4gdXN1YXJpbyBhdXRlbnRpY2FkbwogIHJlcS51c2VyID0geyByb2xlOiAnZWRpdG9yJyB9OyAvLyBFc3RvIG5vcm1hbG1lbnRlIHNlIGhhcsOtYSBtZWRpYW50ZSB1biBtaWRkbGV3YXJlIGRlIGF1dGVudGljYWNpw7NuIHJlYWwKICBuZXh0KCk7Cn0pOwoKYXBwLnBvc3QoJy9jcmVhdGUnLCBhdXRob3JpemUoJ2NyZWF0ZScpLCAocmVxLCByZXMpID0+IHsKICByZXMuc2VuZCgnUmVjdXJzbyBjcmVhZG8nKTsKfSk7CgphcHAuZ2V0KCcvcmVhZCcsIGF1dGhvcml6ZSgncmVhZCcpLCAocmVxLCByZXMpID0+IHsKICByZXMuc2VuZCgnUmVjdXJzbyBsZcOtZG8nKTsKfSk7CgphcHAucHV0KCcvdXBkYXRlJywgYXV0aG9yaXplKCd1cGRhdGUnKSwgKHJlcSwgcmVzKSA9PiB7CiAgcmVzLnNlbmQoJ1JlY3Vyc28gYWN0dWFsaXphZG8nKTsKfSk7CgphcHAuZGVsZXRlKCcvZGVsZXRlJywgYXV0aG9yaXplKCdkZWxldGUnKSwgKHJlcSwgcmVzKSA9PiB7CiAgcmVzLnNlbmQoJ1JlY3Vyc28gZWxpbWluYWRvJyk7Cn0pOwoKYXBwLmxpc3RlbigzMDAwLCAoKSA9PiB7CiAgY29uc29sZS5sb2coJ1NlcnZpZG9yIGVzY3VjaGFuZG8gZW4gZWwgcHVlcnRvIDMwMDAnKTsKfSk7"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const express = require('express');
const app = express();

// Middleware de autenticaci&oacute;n (ejemplo)
app.use((req, res, next) =&gt; {
  // Simulamos un usuario autenticado
  req.user = { role: 'editor' }; // Esto normalmente se har&iacute;a mediante un middleware de autenticaci&oacute;n real
  next();
});

app.post('/create', authorize('create'), (req, res) =&gt; {
  res.send('Recurso creado');
});

app.get('/read', authorize('read'), (req, res) =&gt; {
  res.send('Recurso le&iacute;do');
});

app.put('/update', authorize('update'), (req, res) =&gt; {
  res.send('Recurso actualizado');
});

app.delete('/delete', authorize('delete'), (req, res) =&gt; {
  res.send('Recurso eliminado');
});

app.listen(3000, () =&gt; {
  console.log('Servidor escuchando en el puerto 3000');
});</pre></div><div class='content'></div><h2>Ejercicio Práctico</h2>
<div class='content'><p><strong>Objetivo</strong>: Implementar un sistema de control de acceso basado en roles en una aplicación Node.js.</p>
<ol>
<li><strong>Definir Roles y Permisos</strong>: Crea un archivo <code>roles.js</code> y define los roles y permisos.</li>
<li><strong>Middleware de Autorización</strong>: Crea un middleware <code>authorize.js</code> que verifique los permisos del usuario.</li>
<li><strong>Aplicar Middleware</strong>: Protege las rutas de tu aplicación utilizando el middleware de autorización.</li>
</ol>
<p><strong>Solución</strong>:</p>
<ol>
<li>
<p><strong>roles.js</strong>:</p>
<pre><code class="language-javascript">const roles = {
  admin: ['create', 'read', 'update', 'delete'],
  editor: ['create', 'read', 'update'],
  viewer: ['read']
};

module.exports = roles;
</code></pre>
</li>
<li>
<p><strong>authorize.js</strong>:</p>
<pre><code class="language-javascript">const roles = require('./roles');

const authorize = (requiredRole) =&gt; {
  return (req, res, next) =&gt; {
    const userRole = req.user.role;

    if (roles[userRole] &amp;&amp; roles[userRole].includes(requiredRole)) {
      next();
    } else {
      res.status(403).json({ message: 'Acceso denegado' });
    }
  };
};

module.exports = authorize;
</code></pre>
</li>
<li>
<p><strong>app.js</strong>:</p>
<pre><code class="language-javascript">const express = require('express');
const authorize = require('./authorize');
const app = express();

app.use((req, res, next) =&gt; {
  req.user = { role: 'editor' };
  next();
});

app.post('/create', authorize('create'), (req, res) =&gt; {
  res.send('Recurso creado');
});

app.get('/read', authorize('read'), (req, res) =&gt; {
  res.send('Recurso leído');
});

app.put('/update', authorize('update'), (req, res) =&gt; {
  res.send('Recurso actualizado');
});

app.delete('/delete', authorize('delete'), (req, res) =&gt; {
  res.send('Recurso eliminado');
});

app.listen(3000, () =&gt; {
  console.log('Servidor escuchando en el puerto 3000');
});
</code></pre>
</li>
</ol>
</div><h2>Errores Comunes y Consejos</h2>
<div class='content'><ol>
<li><strong>Olvidar Asignar Roles a los Usuarios</strong>: Asegúrate de que cada usuario tenga un rol asignado. Esto generalmente se hace durante el proceso de autenticación.</li>
<li><strong>Roles Mal Definidos</strong>: Verifica que los roles y permisos estén correctamente definidos y que no haya errores tipográficos.</li>
<li><strong>No Proteger Rutas Críticas</strong>: Asegúrate de aplicar el middleware de autorización a todas las rutas que requieren protección.</li>
</ol>
</div><h1>Conclusión</h1>
<div class='content'><p>El control de acceso basado en roles es una técnica esencial para asegurar que solo los usuarios autorizados puedan realizar ciertas acciones en tu aplicación. Al implementar RBAC en Node.js, puedes mejorar significativamente la seguridad y la gestión de permisos en tu aplicación. En el siguiente módulo, exploraremos cómo realizar pruebas y depuración en aplicaciones Node.js para asegurar su correcto funcionamiento.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='08-03-jwt-authentication' title="Autenticación JWT">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='09-01-introduction-testing' title="Introducción a las Pruebas">Siguiente &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Aceptar</a>
    <a href="/cookies">Mas información</a>
</div>	

	</div>    
</body>
</html>
