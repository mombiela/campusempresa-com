<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streaming Estructurado</title>

    <link rel="alternate" href="https://campusempresa.com/mod/apachespark/04-02-structured-streaming" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/apachespark/04-02-structured-streaming" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/apachespark/04-02-structured-streaming" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-2 p-md-0 text-end">
				<a href="https://enterprisecampus.net/mod/apachespark/04-02-structured-streaming" class="px-2">EN</a></b>
	|
	<b class="px-2">ES</b>
	|
	<a href="https://campusempresa.cat/mod/apachespark/04-02-structured-streaming" class="px-2">CA</a>
<br>
			<cite>Construyendo la sociedad de hoy y del mañana</cite>
		</div>
	</div>
</div>
<div id="subheader" class="container-xxl">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">El Proyecto</a> | 
<a href="/about">Sobre nosotros</a> | 
<a href="/contribute">Contribuir</a> | 
<a href="/donate">Donaciones</a> | 
<a href="/licence">Licencia</a>
		</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
									<a href="./">Contenido del curso</a>
					<span class="sep">|</span>
								<a href="/all/competencias">Competencias técnicas</a>
				<a href="/all/conocimientos">Conocimientos</a>
				<a href="/all/soft_skills">Competencias sociales</a>
			</div>
		</div>
	</div>
</div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='04-01-spark-streaming' title="Spark Streaming">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Streaming Estructurado</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='04-03-spark-mllib' title="Spark MLlib">
				<span class="d-none d-md-inline">Siguiente &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'></div><h1><p>Introducción</p>
</h1>
<div class='content'><p>El Streaming Estructurado es una API de alto nivel para el procesamiento de flujos de datos en tiempo real en Apache Spark. Esta API permite trabajar con flujos de datos de manera similar a cómo se trabaja con DataFrames y Datasets, proporcionando una abstracción más sencilla y poderosa para el procesamiento de datos en tiempo real.</p>
</div><h1><p>Objetivos</p>
</h1>
<div class='content'><ul>
<li>Comprender los conceptos básicos del Streaming Estructurado.</li>
<li>Aprender a configurar y ejecutar aplicaciones de Streaming Estructurado.</li>
<li>Realizar operaciones comunes en flujos de datos en tiempo real.</li>
<li>Manejar el estado y la tolerancia a fallos en aplicaciones de Streaming Estructurado.</li>
</ul>
</div><h1><p>Conceptos Clave</p>
</h1>
<div class='content'></div><h2><ol>
<li>Modelo de Programación</li>
</ol>
</h2>
<div class='content'><p>El Streaming Estructurado sigue un modelo de programación basado en DataFrames y Datasets, lo que permite aplicar las mismas operaciones que se utilizan en el procesamiento de datos estáticos a los flujos de datos en tiempo real.</p>
</div><h2><ol start="2">
<li>Fuentes de Datos</li>
</ol>
</h2>
<div class='content'><p>El Streaming Estructurado puede leer datos de diversas fuentes, como Kafka, sockets TCP, archivos, entre otros.</p>
</div><h2><ol start="3">
<li>Sinks</li>
</ol>
</h2>
<div class='content'><p>Los resultados del procesamiento de flujos de datos pueden ser escritos a diferentes destinos, como bases de datos, sistemas de archivos, consolas, etc.</p>
</div><h2><ol start="4">
<li>Modos de Salida</li>
</ol>
</h2>
<div class='content'><p>El Streaming Estructurado soporta tres modos de salida:</p>
<ul>
<li><strong>Append</strong>: Solo las nuevas filas de datos se escriben en el sink.</li>
<li><strong>Complete</strong>: Todo el resultado del procesamiento se escribe en el sink.</li>
<li><strong>Update</strong>: Solo las filas que han cambiado desde la última ejecución se escriben en el sink.</li>
</ul>
</div><h1><p>Ejemplo Práctico</p>
</h1>
<div class='content'></div><h2><p>Configuración del Entorno</p>
</h2>
<div class='content'><p>Antes de comenzar, asegúrate de tener Apache Spark instalado y configurado. Puedes seguir las instrucciones del módulo &quot;Configuración del Entorno Spark&quot; para configurar tu entorno.</p>
</div><h2><p>Lectura de Datos desde un Socket</p>
</h2>
<div class='content'><p>A continuación, se muestra un ejemplo de cómo leer datos de un socket TCP y realizar operaciones básicas de procesamiento en tiempo real.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBweXNwYXJrLnNxbCBpbXBvcnQgU3BhcmtTZXNzaW9uCmZyb20gcHlzcGFyay5zcWwuZnVuY3Rpb25zIGltcG9ydCBleHBsb2RlLCBzcGxpdAoKIyBDcmVhciB1bmEgc2VzacOzbiBkZSBTcGFyawpzcGFyayA9IFNwYXJrU2Vzc2lvbi5idWlsZGVyIFwKICAgIC5hcHBOYW1lKCJTdHJ1Y3R1cmVkU3RyZWFtaW5nRXhhbXBsZSIpIFwKICAgIC5nZXRPckNyZWF0ZSgpCgojIExlZXIgZGF0b3MgZGVzZGUgdW4gc29ja2V0IFRDUApsaW5lcyA9IHNwYXJrLnJlYWRTdHJlYW0gXAogICAgLmZvcm1hdCgic29ja2V0IikgXAogICAgLm9wdGlvbigiaG9zdCIsICJsb2NhbGhvc3QiKSBcCiAgICAub3B0aW9uKCJwb3J0IiwgOTk5OSkgXAogICAgLmxvYWQoKQoKIyBEaXZpZGlyIGxhcyBsw61uZWFzIGVuIHBhbGFicmFzCndvcmRzID0gbGluZXMuc2VsZWN0KAogICAgZXhwbG9kZSgKICAgICAgICBzcGxpdChsaW5lcy52YWx1ZSwgIiAiKQogICAgKS5hbGlhcygid29yZCIpCikKCiMgQ29udGFyIGxhcyBwYWxhYnJhcwp3b3JkQ291bnRzID0gd29yZHMuZ3JvdXBCeSgid29yZCIpLmNvdW50KCkKCiMgRXNjcmliaXIgbG9zIHJlc3VsdGFkb3MgZW4gbGEgY29uc29sYQpxdWVyeSA9IHdvcmRDb3VudHMud3JpdGVTdHJlYW0gXAogICAgLm91dHB1dE1vZGUoImNvbXBsZXRlIikgXAogICAgLmZvcm1hdCgiY29uc29sZSIpIFwKICAgIC5zdGFydCgpCgpxdWVyeS5hd2FpdFRlcm1pbmF0aW9uKCk="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from pyspark.sql import SparkSession
from pyspark.sql.functions import explode, split

# Crear una sesi&oacute;n de Spark
spark = SparkSession.builder \
    .appName(&quot;StructuredStreamingExample&quot;) \
    .getOrCreate()

# Leer datos desde un socket TCP
lines = spark.readStream \
    .format(&quot;socket&quot;) \
    .option(&quot;host&quot;, &quot;localhost&quot;) \
    .option(&quot;port&quot;, 9999) \
    .load()

# Dividir las l&iacute;neas en palabras
words = lines.select(
    explode(
        split(lines.value, &quot; &quot;)
    ).alias(&quot;word&quot;)
)

# Contar las palabras
wordCounts = words.groupBy(&quot;word&quot;).count()

# Escribir los resultados en la consola
query = wordCounts.writeStream \
    .outputMode(&quot;complete&quot;) \
    .format(&quot;console&quot;) \
    .start()

query.awaitTermination()</pre></div><div class='content'></div><h2><p>Explicación del Código</p>
</h2>
<div class='content'><ol>
<li><strong>Crear una sesión de Spark</strong>: Se crea una sesión de Spark utilizando <code>SparkSession.builder</code>.</li>
<li><strong>Leer datos desde un socket TCP</strong>: Se configura la fuente de datos para leer desde un socket TCP en el host <code>localhost</code> y el puerto <code>9999</code>.</li>
<li><strong>Dividir las líneas en palabras</strong>: Se utiliza la función <code>split</code> para dividir las líneas en palabras y <code>explode</code> para convertir cada palabra en una fila separada.</li>
<li><strong>Contar las palabras</strong>: Se agrupan las palabras y se cuentan las ocurrencias de cada una.</li>
<li><strong>Escribir los resultados en la consola</strong>: Se configura el sink para escribir los resultados en la consola en modo <code>complete</code>.</li>
</ol>
</div><h1><p>Ejercicio Práctico</p>
</h1>
<div class='content'></div><h2><p>Ejercicio 1: Contar Palabras desde un Archivo</p>
</h2>
<div class='content'><p>Modifica el ejemplo anterior para leer datos desde un archivo en lugar de un socket TCP. Utiliza el siguiente archivo de texto como fuente de datos:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGF0YS50eHQKLS0tLS0tLS0tCmhlbGxvIHdvcmxkCmhlbGxvIHNwYXJrCmhlbGxvIHN0cnVjdHVyZWQgc3RyZWFtaW5n"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>data.txt
---------
hello world
hello spark
hello structured streaming</pre></div><div class='content'></div><h2><p>Solución</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBweXNwYXJrLnNxbCBpbXBvcnQgU3BhcmtTZXNzaW9uCmZyb20gcHlzcGFyay5zcWwuZnVuY3Rpb25zIGltcG9ydCBleHBsb2RlLCBzcGxpdAoKIyBDcmVhciB1bmEgc2VzacOzbiBkZSBTcGFyawpzcGFyayA9IFNwYXJrU2Vzc2lvbi5idWlsZGVyIFwKICAgIC5hcHBOYW1lKCJTdHJ1Y3R1cmVkU3RyZWFtaW5nRmlsZUV4YW1wbGUiKSBcCiAgICAuZ2V0T3JDcmVhdGUoKQoKIyBMZWVyIGRhdG9zIGRlc2RlIHVuIGFyY2hpdm8KbGluZXMgPSBzcGFyay5yZWFkU3RyZWFtIFwKICAgIC5mb3JtYXQoInRleHQiKSBcCiAgICAub3B0aW9uKCJwYXRoIiwgInBhdGgvdG8vZGF0YS50eHQiKSBcCiAgICAubG9hZCgpCgojIERpdmlkaXIgbGFzIGzDrW5lYXMgZW4gcGFsYWJyYXMKd29yZHMgPSBsaW5lcy5zZWxlY3QoCiAgICBleHBsb2RlKAogICAgICAgIHNwbGl0KGxpbmVzLnZhbHVlLCAiICIpCiAgICApLmFsaWFzKCJ3b3JkIikKKQoKIyBDb250YXIgbGFzIHBhbGFicmFzCndvcmRDb3VudHMgPSB3b3Jkcy5ncm91cEJ5KCJ3b3JkIikuY291bnQoKQoKIyBFc2NyaWJpciBsb3MgcmVzdWx0YWRvcyBlbiBsYSBjb25zb2xhCnF1ZXJ5ID0gd29yZENvdW50cy53cml0ZVN0cmVhbSBcCiAgICAub3V0cHV0TW9kZSgiY29tcGxldGUiKSBcCiAgICAuZm9ybWF0KCJjb25zb2xlIikgXAogICAgLnN0YXJ0KCkKCnF1ZXJ5LmF3YWl0VGVybWluYXRpb24oKQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from pyspark.sql import SparkSession
from pyspark.sql.functions import explode, split

# Crear una sesi&oacute;n de Spark
spark = SparkSession.builder \
    .appName(&quot;StructuredStreamingFileExample&quot;) \
    .getOrCreate()

# Leer datos desde un archivo
lines = spark.readStream \
    .format(&quot;text&quot;) \
    .option(&quot;path&quot;, &quot;path/to/data.txt&quot;) \
    .load()

# Dividir las l&iacute;neas en palabras
words = lines.select(
    explode(
        split(lines.value, &quot; &quot;)
    ).alias(&quot;word&quot;)
)

# Contar las palabras
wordCounts = words.groupBy(&quot;word&quot;).count()

# Escribir los resultados en la consola
query = wordCounts.writeStream \
    .outputMode(&quot;complete&quot;) \
    .format(&quot;console&quot;) \
    .start()

query.awaitTermination()</pre></div><div class='content'></div><h2><p>Explicación de la Solución</p>
</h2>
<div class='content'><ol>
<li><strong>Leer datos desde un archivo</strong>: Se configura la fuente de datos para leer desde un archivo de texto en lugar de un socket TCP.</li>
<li><strong>Ruta del archivo</strong>: Asegúrate de reemplazar <code>&quot;path/to/data.txt&quot;</code> con la ruta real del archivo de texto.</li>
</ol>
</div><h1><p>Resumen</p>
</h1>
<div class='content'><p>En esta sección, hemos aprendido los conceptos básicos del Streaming Estructurado en Apache Spark, cómo configurar y ejecutar aplicaciones de Streaming Estructurado, y cómo realizar operaciones comunes en flujos de datos en tiempo real. También hemos visto un ejemplo práctico y un ejercicio para reforzar los conceptos aprendidos.</p>
<p>En el siguiente módulo, exploraremos Spark MLlib, la biblioteca de aprendizaje automático de Apache Spark.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='04-01-spark-streaming' title="Spark Streaming">
				<span class="d-none d-md-inline">&#x25C4; Anterior</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='04-03-spark-mllib' title="Spark MLlib">
				<span class="d-none d-md-inline">Siguiente &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Usamos cookies para mejorar tu experiencia de uso y ofrecer contenidos adaptados a tus intereses.
    <a href="#" id="btn_accept_cookies" class="button">Aceptar</a>
    <a href="/cookies">Mas información</a>
</div>	

	</div>    
</body>
</html>
