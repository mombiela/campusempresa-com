<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguridad en Formularios</title>

    <link rel="alternate" href="https://campusempresa.com/mod/php/05-04-form-security" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/php/05-04-form-security" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/php/05-04-form-security" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 px-0 py-2 py-md-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 px-0 py-2 py-md-0 m-0 text-end">
										<a href="https://enterprisecampus.net/mod/php/05-04-form-security" class="px-2">EN</a></b>
				|
				<b class="px-2">ES</b>
				|
				<a href="https://campusempresa.cat/mod/php/05-04-form-security" class="px-2">CA</a>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Proyecto</a>
				<a href="/about">Sobre nosotros</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donaciones</a>
				<a href="/licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='05-03-file-uploads' title="Subida de Archivos">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Seguridad en Formularios</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='06-01-reading-writing-files' title="Lectura y Escritura de Archivos">Siguiente &#x25BA;</a>
			</div>
</div>
<div class='content'><p>La seguridad en formularios es un aspecto crucial en el desarrollo de aplicaciones web. Los formularios son una de las principales vías de entrada de datos en una aplicación, y si no se manejan adecuadamente, pueden ser una puerta de entrada para ataques maliciosos. En esta sección, aprenderás cómo proteger tus formularios contra las amenazas más comunes.</p>
</div><h1>Conceptos Clave</h1>
<div class='content'><ol>
<li><strong>Validación del Lado del Servidor</strong>: Asegurarse de que los datos recibidos sean válidos y seguros.</li>
<li><strong>Protección contra Cross-Site Scripting (XSS)</strong>: Evitar la inyección de scripts maliciosos.</li>
<li><strong>Protección contra Cross-Site Request Forgery (CSRF)</strong>: Prevenir que un atacante realice acciones en nombre de un usuario autenticado.</li>
<li><strong>Escapado de Salida</strong>: Asegurarse de que los datos se muestren de manera segura en el navegador.</li>
<li><strong>Uso de HTTPS</strong>: Asegurar la transmisión de datos entre el cliente y el servidor.</li>
</ol>
</div><h1>Validación del Lado del Servidor</h1>
<div class='content'><p>Aunque la validación del lado del cliente es útil para mejorar la experiencia del usuario, nunca debe ser la única línea de defensa. La validación del lado del servidor es esencial para garantizar que los datos recibidos sean seguros.</p>
</div><h2>Ejemplo de Validación del Lado del Servidor</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("PD9waHAKaWYgKCRfU0VSVkVSWyJSRVFVRVNUX01FVEhPRCJdID09ICJQT1NUIikgewogICAgJG5hbWUgPSB0cmltKCRfUE9TVFsibmFtZSJdKTsKICAgICRlbWFpbCA9IHRyaW0oJF9QT1NUWyJlbWFpbCJdKTsKCiAgICBpZiAoZW1wdHkoJG5hbWUpIHx8IGVtcHR5KCRlbWFpbCkpIHsKICAgICAgICBlY2hvICJUb2RvcyBsb3MgY2FtcG9zIHNvbiBvYmxpZ2F0b3Jpb3MuIjsKICAgIH0gZWxzZWlmICghZmlsdGVyX3ZhcigkZW1haWwsIEZJTFRFUl9WQUxJREFURV9FTUFJTCkpIHsKICAgICAgICBlY2hvICJFbCBjb3JyZW8gZWxlY3Ryw7NuaWNvIG5vIGVzIHbDoWxpZG8uIjsKICAgIH0gZWxzZSB7CiAgICAgICAgLy8gUHJvY2VzYXIgbG9zIGRhdG9zIGRlIGZvcm1hIHNlZ3VyYQogICAgICAgIGVjaG8gIkRhdG9zIHJlY2liaWRvcyBjb3JyZWN0YW1lbnRlLiI7CiAgICB9Cn0KPz4="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>&lt;?php
if ($_SERVER[&quot;REQUEST_METHOD&quot;] == &quot;POST&quot;) {
    $name = trim($_POST[&quot;name&quot;]);
    $email = trim($_POST[&quot;email&quot;]);

    if (empty($name) || empty($email)) {
        echo &quot;Todos los campos son obligatorios.&quot;;
    } elseif (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
        echo &quot;El correo electr&oacute;nico no es v&aacute;lido.&quot;;
    } else {
        // Procesar los datos de forma segura
        echo &quot;Datos recibidos correctamente.&quot;;
    }
}
?&gt;</pre></div><div class='content'></div><h2>Explicación</h2>
<div class='content'><ul>
<li><code>$_SERVER[&quot;REQUEST_METHOD&quot;] == &quot;POST&quot;</code>: Verifica que el formulario se haya enviado mediante el método POST.</li>
<li><code>trim()</code>: Elimina espacios en blanco al inicio y al final de la cadena.</li>
<li><code>empty()</code>: Verifica si una variable está vacía.</li>
<li><code>filter_var()</code>: Valida el formato del correo electrónico.</li>
</ul>
</div><h1>Protección contra Cross-Site Scripting (XSS)</h1>
<div class='content'><p>XSS es un tipo de vulnerabilidad que permite a los atacantes inyectar scripts maliciosos en páginas web vistas por otros usuarios. Para prevenir XSS, es crucial escapar cualquier dato que se muestre en la página.</p>
</div><h2>Ejemplo de Protección contra XSS</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("PD9waHAKJG5hbWUgPSBodG1sc3BlY2lhbGNoYXJzKCRfUE9TVFsibmFtZSJdLCBFTlRfUVVPVEVTLCAnVVRGLTgnKTsKZWNobyAiSG9sYSwgIiAuICRuYW1lOwo/Pg=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>&lt;?php
$name = htmlspecialchars($_POST[&quot;name&quot;], ENT_QUOTES, 'UTF-8');
echo &quot;Hola, &quot; . $name;
?&gt;</pre></div><div class='content'></div><h2>Explicación</h2>
<div class='content'><ul>
<li><code>htmlspecialchars()</code>: Convierte caracteres especiales en entidades HTML, previniendo la ejecución de scripts.</li>
</ul>
</div><h1>Protección contra Cross-Site Request Forgery (CSRF)</h1>
<div class='content'><p>CSRF es un ataque que fuerza a un usuario autenticado a realizar acciones no deseadas en una aplicación web. Para prevenir CSRF, se utilizan tokens únicos que se verifican en cada solicitud.</p>
</div><h2>Ejemplo de Protección contra CSRF</h2>
<div class='content'><h4>Generación del Token</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("PD9waHAKc2Vzc2lvbl9zdGFydCgpOwppZiAoZW1wdHkoJF9TRVNTSU9OWydjc3JmX3Rva2VuJ10pKSB7CiAgICAkX1NFU1NJT05bJ2NzcmZfdG9rZW4nXSA9IGJpbjJoZXgocmFuZG9tX2J5dGVzKDMyKSk7Cn0KPz4KPGZvcm0gbWV0aG9kPSJQT1NUIiBhY3Rpb249InByb2Nlc3NfZm9ybS5waHAiPgogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iY3NyZl90b2tlbiIgdmFsdWU9Ijw/cGhwIGVjaG8gJF9TRVNTSU9OWydjc3JmX3Rva2VuJ107ID8+Ij4KICAgIDwhLS0gT3Ryb3MgY2FtcG9zIGRlbCBmb3JtdWxhcmlvIC0tPgogICAgPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IkVudmlhciI+CjwvZm9ybT4="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>&lt;?php
session_start();
if (empty($_SESSION['csrf_token'])) {
    $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
}
?&gt;
&lt;form method=&quot;POST&quot; action=&quot;process_form.php&quot;&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;csrf_token&quot; value=&quot;&lt;?php echo $_SESSION['csrf_token']; ?&gt;&quot;&gt;
    &lt;!-- Otros campos del formulario --&gt;
    &lt;input type=&quot;submit&quot; value=&quot;Enviar&quot;&gt;
&lt;/form&gt;</pre></div><div class='content'><h4>Verificación del Token</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("PD9waHAKc2Vzc2lvbl9zdGFydCgpOwppZiAoJF9TRVJWRVJbIlJFUVVFU1RfTUVUSE9EIl0gPT0gIlBPU1QiKSB7CiAgICBpZiAoIWhhc2hfZXF1YWxzKCRfU0VTU0lPTlsnY3NyZl90b2tlbiddLCAkX1BPU1RbJ2NzcmZfdG9rZW4nXSkpIHsKICAgICAgICBkaWUoIkNTUkYgdG9rZW4gaW52w6FsaWRvLiIpOwogICAgfQogICAgLy8gUHJvY2VzYXIgbG9zIGRhdG9zIGRlIGZvcm1hIHNlZ3VyYQp9Cj8+"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>&lt;?php
session_start();
if ($_SERVER[&quot;REQUEST_METHOD&quot;] == &quot;POST&quot;) {
    if (!hash_equals($_SESSION['csrf_token'], $_POST['csrf_token'])) {
        die(&quot;CSRF token inv&aacute;lido.&quot;);
    }
    // Procesar los datos de forma segura
}
?&gt;</pre></div><div class='content'></div><h2>Explicación</h2>
<div class='content'><ul>
<li><code>bin2hex(random_bytes(32))</code>: Genera un token seguro.</li>
<li><code>hash_equals()</code>: Compara de manera segura dos cadenas, previniendo ataques de tiempo.</li>
</ul>
</div><h1>Escapado de Salida</h1>
<div class='content'><p>El escapado de salida asegura que los datos se muestren de manera segura en el navegador, previniendo la ejecución de scripts maliciosos.</p>
</div><h2>Ejemplo de Escapado de Salida</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("PD9waHAKJG5hbWUgPSBodG1sc3BlY2lhbGNoYXJzKCRfUE9TVFsibmFtZSJdLCBFTlRfUVVPVEVTLCAnVVRGLTgnKTsKZWNobyAiSG9sYSwgIiAuICRuYW1lOwo/Pg=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>&lt;?php
$name = htmlspecialchars($_POST[&quot;name&quot;], ENT_QUOTES, 'UTF-8');
echo &quot;Hola, &quot; . $name;
?&gt;</pre></div><div class='content'></div><h2>Explicación</h2>
<div class='content'><ul>
<li><code>htmlspecialchars()</code>: Convierte caracteres especiales en entidades HTML.</li>
</ul>
</div><h1>Uso de HTTPS</h1>
<div class='content'><p>HTTPS asegura la transmisión de datos entre el cliente y el servidor, protegiendo contra ataques de intermediarios (man-in-the-middle).</p>
</div><h2>Configuración de HTTPS</h2>
<div class='content'><ol>
<li><strong>Obtener un Certificado SSL</strong>: Puedes obtener un certificado SSL de una autoridad certificadora (CA) o usar Let's Encrypt para obtener uno gratuito.</li>
<li><strong>Configurar el Servidor Web</strong>: Configura tu servidor web (Apache, Nginx, etc.) para usar HTTPS.</li>
</ol>
</div><h2>Ejemplo de Configuración en Apache</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("PFZpcnR1YWxIb3N0ICo6NDQzPgogICAgU2VydmVyTmFtZSB3d3cuZWplbXBsby5jb20KICAgIERvY3VtZW50Um9vdCAvdmFyL3d3dy9odG1sCgogICAgU1NMRW5naW5lIG9uCiAgICBTU0xDZXJ0aWZpY2F0ZUZpbGUgL2V0Yy9zc2wvY2VydHMvZWplbXBsby5jb20uY3J0CiAgICBTU0xDZXJ0aWZpY2F0ZUtleUZpbGUgL2V0Yy9zc2wvcHJpdmF0ZS9lamVtcGxvLmNvbS5rZXkKPC9WaXJ0dWFsSG9zdD4="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>&lt;VirtualHost *:443&gt;
    ServerName www.ejemplo.com
    DocumentRoot /var/www/html

    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/ejemplo.com.crt
    SSLCertificateKeyFile /etc/ssl/private/ejemplo.com.key
&lt;/VirtualHost&gt;</pre></div><div class='content'></div><h1>Ejercicio Práctico</h1>
<div class='content'></div><h2>Ejercicio</h2>
<div class='content'><ol>
<li>Crea un formulario que solicite el nombre y el correo electrónico del usuario.</li>
<li>Implementa validación del lado del servidor para asegurarte de que ambos campos no estén vacíos y que el correo electrónico sea válido.</li>
<li>Protege el formulario contra XSS escapando los datos de salida.</li>
<li>Implementa protección contra CSRF generando y verificando un token.</li>
<li>Asegúrate de que el formulario se envíe a través de HTTPS.</li>
</ol>
</div><h2>Solución</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("PD9waHAKc2Vzc2lvbl9zdGFydCgpOwppZiAoZW1wdHkoJF9TRVNTSU9OWydjc3JmX3Rva2VuJ10pKSB7CiAgICAkX1NFU1NJT05bJ2NzcmZfdG9rZW4nXSA9IGJpbjJoZXgocmFuZG9tX2J5dGVzKDMyKSk7Cn0KCmlmICgkX1NFUlZFUlsiUkVRVUVTVF9NRVRIT0QiXSA9PSAiUE9TVCIpIHsKICAgIGlmICghaGFzaF9lcXVhbHMoJF9TRVNTSU9OWydjc3JmX3Rva2VuJ10sICRfUE9TVFsnY3NyZl90b2tlbiddKSkgewogICAgICAgIGRpZSgiQ1NSRiB0b2tlbiBpbnbDoWxpZG8uIik7CiAgICB9CgogICAgJG5hbWUgPSB0cmltKCRfUE9TVFsibmFtZSJdKTsKICAgICRlbWFpbCA9IHRyaW0oJF9QT1NUWyJlbWFpbCJdKTsKCiAgICBpZiAoZW1wdHkoJG5hbWUpIHx8IGVtcHR5KCRlbWFpbCkpIHsKICAgICAgICBlY2hvICJUb2RvcyBsb3MgY2FtcG9zIHNvbiBvYmxpZ2F0b3Jpb3MuIjsKICAgIH0gZWxzZWlmICghZmlsdGVyX3ZhcigkZW1haWwsIEZJTFRFUl9WQUxJREFURV9FTUFJTCkpIHsKICAgICAgICBlY2hvICJFbCBjb3JyZW8gZWxlY3Ryw7NuaWNvIG5vIGVzIHbDoWxpZG8uIjsKICAgIH0gZWxzZSB7CiAgICAgICAgJG5hbWUgPSBodG1sc3BlY2lhbGNoYXJzKCRuYW1lLCBFTlRfUVVPVEVTLCAnVVRGLTgnKTsKICAgICAgICBlY2hvICJIb2xhLCAiIC4gJG5hbWUgLiAiLiBUdSBjb3JyZW8gZWxlY3Ryw7NuaWNvIGVzICIgLiBodG1sc3BlY2lhbGNoYXJzKCRlbWFpbCwgRU5UX1FVT1RFUywgJ1VURi04JykgLiAiLiI7CiAgICB9Cn0KPz4KCjxmb3JtIG1ldGhvZD0iUE9TVCIgYWN0aW9uPSIiPgogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iY3NyZl90b2tlbiIgdmFsdWU9Ijw/cGhwIGVjaG8gJF9TRVNTSU9OWydjc3JmX3Rva2VuJ107ID8+Ij4KICAgIE5vbWJyZTogPGlucHV0IHR5cGU9InRleHQiIG5hbWU9Im5hbWUiPjxicj4KICAgIENvcnJlbyBFbGVjdHLDs25pY286IDxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSJlbWFpbCI+PGJyPgogICAgPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IkVudmlhciI+CjwvZm9ybT4="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>&lt;?php
session_start();
if (empty($_SESSION['csrf_token'])) {
    $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
}

if ($_SERVER[&quot;REQUEST_METHOD&quot;] == &quot;POST&quot;) {
    if (!hash_equals($_SESSION['csrf_token'], $_POST['csrf_token'])) {
        die(&quot;CSRF token inv&aacute;lido.&quot;);
    }

    $name = trim($_POST[&quot;name&quot;]);
    $email = trim($_POST[&quot;email&quot;]);

    if (empty($name) || empty($email)) {
        echo &quot;Todos los campos son obligatorios.&quot;;
    } elseif (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
        echo &quot;El correo electr&oacute;nico no es v&aacute;lido.&quot;;
    } else {
        $name = htmlspecialchars($name, ENT_QUOTES, 'UTF-8');
        echo &quot;Hola, &quot; . $name . &quot;. Tu correo electr&oacute;nico es &quot; . htmlspecialchars($email, ENT_QUOTES, 'UTF-8') . &quot;.&quot;;
    }
}
?&gt;

&lt;form method=&quot;POST&quot; action=&quot;&quot;&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;csrf_token&quot; value=&quot;&lt;?php echo $_SESSION['csrf_token']; ?&gt;&quot;&gt;
    Nombre: &lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;&lt;br&gt;
    Correo Electr&oacute;nico: &lt;input type=&quot;text&quot; name=&quot;email&quot;&gt;&lt;br&gt;
    &lt;input type=&quot;submit&quot; value=&quot;Enviar&quot;&gt;
&lt;/form&gt;</pre></div><div class='content'></div><h1>Conclusión</h1>
<div class='content'><p>En esta sección, has aprendido cómo proteger tus formularios contra las amenazas más comunes, incluyendo la validación del lado del servidor, la protección contra XSS y CSRF, el escapado de salida y el uso de HTTPS. Estos conceptos son fundamentales para asegurar que tu aplicación web sea segura y confiable. En el próximo módulo, exploraremos cómo trabajar con archivos en PHP, incluyendo la lectura, escritura y manejo de permisos.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='05-03-file-uploads' title="Subida de Archivos">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='06-01-reading-writing-files' title="Lectura y Escritura de Archivos">Siguiente &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Aceptar</a>
    <a href="/cookies">Mas información</a>
</div>	

	</div>    
</body>
</html>
