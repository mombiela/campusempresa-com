<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vacuuming y Mantenimiento</title>

    <link rel="alternate" href="https://campusempresa.com/mod/postgresql/06-04-vacuuming-and-maintenance" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/postgresql/06-04-vacuuming-and-maintenance" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/postgresql/06-04-vacuuming-and-maintenance" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
										<a href="https://enterprisecampus.net/mod/postgresql/06-04-vacuuming-and-maintenance" class="px-2">EN</a></b>
				|
				<b class="px-2">ES</b>
				|
				<a href="https://campusempresa.cat/mod/postgresql/06-04-vacuuming-and-maintenance" class="px-2">CA</a>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Proyecto</a>
				<a href="/about">Sobre nosotros</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donaciones</a>
				<a href="/licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='06-03-analyzing-query-performance' title="Análisis del Rendimiento de Consultas">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Vacuuming y Mantenimiento</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='07-01-user-roles-and-permissions' title="Roles de Usuario y Permisos">Siguiente &#x25BA;</a>
			</div>
</div>
<div class='content'><p>En este tema, aprenderemos sobre las operaciones de mantenimiento en PostgreSQL, específicamente el proceso de &quot;vacuuming&quot; y otras tareas de mantenimiento que son cruciales para asegurar el rendimiento y la integridad de la base de datos.</p>
</div><h1><p>¿Qué es Vacuuming?</p>
</h1>
<div class='content'><p>Vacuuming es un proceso en PostgreSQL que limpia las tablas y los índices eliminando las filas que ya no son necesarias. Esto es esencial para:</p>
<ul>
<li>Recuperar espacio en disco.</li>
<li>Mantener la eficiencia de las consultas.</li>
<li>Prevenir el crecimiento descontrolado de la base de datos.</li>
</ul>
</div><h2><p>Tipos de Vacuuming</p>
</h2>
<div class='content'><ol>
<li><strong>VACUUM Básico</strong>: Limpia las filas muertas y recupera espacio en disco.</li>
<li><strong>VACUUM FULL</strong>: Realiza una limpieza más exhaustiva, compactando las tablas y liberando espacio en disco de manera más efectiva, pero es más lento y bloquea las tablas durante su ejecución.</li>
<li><strong>Autovacuum</strong>: Un proceso automático que PostgreSQL ejecuta en segundo plano para realizar tareas de vacuuming sin intervención manual.</li>
</ol>
</div><h1><p>Comandos de Vacuuming</p>
</h1>
<div class='content'></div><h2><p>VACUUM Básico</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("VkFDVVVNOw=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>VACUUM;</pre></div><div class='content'><p>Este comando limpia las filas muertas de todas las tablas en la base de datos actual.</p>
</div><h2><p>VACUUM FULL</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("VkFDVVVNIEZVTEw7"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>VACUUM FULL;</pre></div><div class='content'><p>Este comando realiza una limpieza completa y compacta las tablas, pero puede ser más disruptivo debido a que bloquea las tablas.</p>
</div><h2><p>VACUUM en una Tabla Específica</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("VkFDVVVNIG15X3RhYmxlOw=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>VACUUM my_table;</pre></div><div class='content'><p>Este comando limpia las filas muertas de una tabla específica.</p>
</div><h2><p>VACUUM con ANALYZE</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("VkFDVVVNIEFOQUxZWkU7"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>VACUUM ANALYZE;</pre></div><div class='content'><p>Este comando no solo limpia las filas muertas, sino que también actualiza las estadísticas de la base de datos, lo cual es útil para el optimizador de consultas.</p>
</div><h1><p>Autovacuum</p>
</h1>
<div class='content'><p>El autovacuum es un proceso que PostgreSQL ejecuta automáticamente para realizar tareas de mantenimiento. Está habilitado por defecto y se puede configurar en el archivo <code>postgresql.conf</code>.</p>
</div><h2><p>Configuración de Autovacuum</p>
</h2>
<div class='content'><p>Algunas configuraciones importantes del autovacuum incluyen:</p>
<ul>
<li><code>autovacuum</code>: Habilita o deshabilita el autovacuum.</li>
<li><code>autovacuum_naptime</code>: Intervalo de tiempo entre ejecuciones del autovacuum.</li>
<li><code>autovacuum_vacuum_threshold</code>: Número mínimo de filas muertas que deben existir antes de que se ejecute el autovacuum.</li>
<li><code>autovacuum_analyze_threshold</code>: Número mínimo de filas insertadas, actualizadas o eliminadas antes de que se ejecute el autovacuum con ANALYZE.</li>
</ul>
<p>Ejemplo de configuración en <code>postgresql.conf</code>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YXV0b3ZhY3V1bSA9IG9uCmF1dG92YWN1dW1fbmFwdGltZSA9ICcxbWluJwphdXRvdmFjdXVtX3ZhY3V1bV90aHJlc2hvbGQgPSA1MAphdXRvdmFjdXVtX2FuYWx5emVfdGhyZXNob2xkID0gNTA="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>autovacuum = on
autovacuum_naptime = '1min'
autovacuum_vacuum_threshold = 50
autovacuum_analyze_threshold = 50</pre></div><div class='content'></div><h1><p>Mantenimiento Adicional</p>
</h1>
<div class='content'></div><h2><p>Reindexación</p>
</h2>
<div class='content'><p>La reindexación es el proceso de reconstruir los índices de una tabla para mejorar el rendimiento de las consultas.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("UkVJTkRFWCBUQUJMRSBteV90YWJsZTs="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>REINDEX TABLE my_table;</pre></div><div class='content'></div><h2><p>Análisis de Estadísticas</p>
</h2>
<div class='content'><p>El comando <code>ANALYZE</code> actualiza las estadísticas de la base de datos, lo cual es crucial para que el optimizador de consultas funcione de manera eficiente.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("QU5BTFlaRTs="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ANALYZE;</pre></div><div class='content'></div><h2><p>Monitoreo de la Base de Datos</p>
</h2>
<div class='content'><p>Es importante monitorear la base de datos para identificar problemas de rendimiento y espacio. PostgreSQL ofrece varias vistas y herramientas para este propósito, como <code>pg_stat_activity</code> y <code>pg_stat_user_tables</code>.</p>
</div><h1><p>Ejercicio Práctico</p>
</h1>
<div class='content'></div><h2><p>Ejercicio 1: Ejecutar VACUUM en una Tabla Específica</p>
</h2>
<div class='content'><ol>
<li>Crea una tabla y llena con datos de prueba:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIFRBQkxFIHRlc3RfdGFibGUgKAogICAgaWQgU0VSSUFMIFBSSU1BUlkgS0VZLAogICAgZGF0YSBURVhUCik7CgpJTlNFUlQgSU5UTyB0ZXN0X3RhYmxlIChkYXRhKQpTRUxFQ1QgbWQ1KHJhbmRvbSgpOjp0ZXh0KQpGUk9NIGdlbmVyYXRlX3NlcmllcygxLCAxMDAwMDApOw=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE TABLE test_table (
    id SERIAL PRIMARY KEY,
    data TEXT
);

INSERT INTO test_table (data)
SELECT md5(random()::text)
FROM generate_series(1, 100000);</pre></div><div class='content'><ol start="2">
<li>Elimina algunas filas para generar filas muertas:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("REVMRVRFIEZST00gdGVzdF90YWJsZQpXSEVSRSBpZCAlIDIgPSAwOw=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>DELETE FROM test_table
WHERE id % 2 = 0;</pre></div><div class='content'><ol start="3">
<li>Ejecuta el comando VACUUM en la tabla:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("VkFDVVVNIHRlc3RfdGFibGU7"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>VACUUM test_table;</pre></div><div class='content'></div><h2><p>Ejercicio 2: Configurar y Verificar Autovacuum</p>
</h2>
<div class='content'><ol>
<li>Asegúrate de que el autovacuum esté habilitado en <code>postgresql.conf</code>:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YXV0b3ZhY3V1bSA9IG9u"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>autovacuum = on</pre></div><div class='content'><ol start="2">
<li>Verifica el estado del autovacuum:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUICogRlJPTSBwZ19zdGF0X3VzZXJfdGFibGVzIFdIRVJFIHJlbG5hbWUgPSAndGVzdF90YWJsZSc7"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT * FROM pg_stat_user_tables WHERE relname = 'test_table';</pre></div><div class='content'><ol start="3">
<li>Observa las columnas <code>last_vacuum</code> y <code>last_autovacuum</code> para verificar cuándo se ejecutó el último vacuum automático.</li>
</ol>
</div><h1><p>Conclusión</p>
</h1>
<div class='content'><p>El mantenimiento regular de la base de datos mediante vacuuming y otras tareas es crucial para mantener el rendimiento y la integridad de PostgreSQL. El autovacuum facilita este proceso al ejecutarse automáticamente, pero es importante entender cómo y cuándo realizar estas tareas manualmente para situaciones específicas. Con estos conocimientos, estarás mejor preparado para gestionar y optimizar tus bases de datos PostgreSQL.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='06-03-analyzing-query-performance' title="Análisis del Rendimiento de Consultas">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='07-01-user-roles-and-permissions' title="Roles de Usuario y Permisos">Siguiente &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Usamos cookies para mejorar tu experiencia de uso y ofrecer contenidos adaptados a tus intereses.
    <a href="#" id="btn_accept_cookies" class="button">Aceptar</a>
    <a href="/cookies">Mas información</a>
</div>	

	</div>    
</body>
</html>
