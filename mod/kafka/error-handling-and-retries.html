<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manejo de Errores y Reintentos</title>

    <link rel="alternate" href="https://campusempresa.com/mod/kafka/error-handling-and-retries" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/kafka/error-handling-and-retries" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/kafka/error-handling-and-retries" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
										<a href="https://enterprisecampus.net/mod/kafka/error-handling-and-retries" class="px-2">EN</a></b>
				|
				<b class="px-2">ES</b>
				|
				<a href="https://campusempresa.cat/mod/kafka/error-handling-and-retries" class="px-2">CA</a>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Proyecto</a>
				<a href="/about">Sobre nosotros</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donaciones</a>
				<a href="/licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='producer-configuration'>&#x25C4;Configuración del Productor</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Manejo de Errores y Reintentos</a>
	</div>
	<div class='col-4 text-end'>
					<a href='consumer-api-overview'>Visión General de la API del Consumidor &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introducción</h1>
<div class='content'><p>El manejo de errores y los reintentos son aspectos cruciales al trabajar con Apache Kafka, asegurando que tus aplicaciones puedan manejar fallos de manera elegante y mantener la integridad de los datos. Esta sección cubrirá los conceptos básicos del manejo de errores, estrategias comunes para reintentos y técnicas avanzadas para gestionar errores en Kafka.</p>
</div><h1>Conceptos Clave</h1>
<div class='content'><ul>
<li><strong>Manejo de Errores</strong>: El proceso de gestionar errores que ocurren durante la ejecución de un programa.</li>
<li><strong>Reintentos</strong>: El acto de intentar una operación nuevamente después de que ha fallado.</li>
<li><strong>Idempotencia</strong>: Asegurarse de que una operación pueda realizarse múltiples veces sin cambiar el resultado más allá de la aplicación inicial.</li>
<li><strong>Estrategia de Retroceso</strong>: Un método para retrasar los reintentos para evitar sobrecargar el sistema.</li>
</ul>
</div><h1>Manejo de Errores en Kafka</h1>
<div class='content'><p>Kafka proporciona varios mecanismos para manejar errores que ocurren durante la producción y el consumo de mensajes.</p>
</div><h2>Manejo de Errores del Productor</h2>
<div class='content'><p>Al producir mensajes a Kafka, pueden ocurrir errores debido a problemas de red, fallos de los brokers o problemas de configuración. La API del productor de Kafka proporciona callbacks y excepciones para manejar estos errores.</p>
<h4>Ejemplo: Manejo de Errores del Productor</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5hcGFjaGUua2Fma2EuY2xpZW50cy5wcm9kdWNlci4qOwoKaW1wb3J0IGphdmEudXRpbC5Qcm9wZXJ0aWVzOwoKcHVibGljIGNsYXNzIEthZmthUHJvZHVjZXJFeGFtcGxlIHsKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHsKICAgICAgICBQcm9wZXJ0aWVzIHByb3BzID0gbmV3IFByb3BlcnRpZXMoKTsKICAgICAgICBwcm9wcy5wdXQoImJvb3RzdHJhcC5zZXJ2ZXJzIiwgImxvY2FsaG9zdDo5MDkyIik7CiAgICAgICAgcHJvcHMucHV0KCJrZXkuc2VyaWFsaXplciIsICJvcmcuYXBhY2hlLmthZmthLmNvbW1vbi5zZXJpYWxpemF0aW9uLlN0cmluZ1NlcmlhbGl6ZXIiKTsKICAgICAgICBwcm9wcy5wdXQoInZhbHVlLnNlcmlhbGl6ZXIiLCAib3JnLmFwYWNoZS5rYWZrYS5jb21tb24uc2VyaWFsaXphdGlvbi5TdHJpbmdTZXJpYWxpemVyIik7CgogICAgICAgIFByb2R1Y2VyPFN0cmluZywgU3RyaW5nPiBwcm9kdWNlciA9IG5ldyBLYWZrYVByb2R1Y2VyPD4ocHJvcHMpOwoKICAgICAgICBQcm9kdWNlclJlY29yZDxTdHJpbmcsIFN0cmluZz4gcmVjb3JkID0gbmV3IFByb2R1Y2VyUmVjb3JkPD4oIm15LXRvcGljIiwgImtleSIsICJ2YWx1ZSIpOwoKICAgICAgICBwcm9kdWNlci5zZW5kKHJlY29yZCwgbmV3IENhbGxiYWNrKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgb25Db21wbGV0aW9uKFJlY29yZE1ldGFkYXRhIG1ldGFkYXRhLCBFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICBpZiAoZXhjZXB0aW9uICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oIkVycm9yIHByb2R1Y2llbmRvIGFsIHTDs3BpY28gIiArIG1ldGFkYXRhLnRvcGljKCkpOwogICAgICAgICAgICAgICAgICAgIGV4Y2VwdGlvbi5wcmludFN0YWNrVHJhY2UoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJSZWdpc3RybyBwcm9kdWNpZG8gYWwgdMOzcGljbyAiICsgbWV0YWRhdGEudG9waWMoKSArICIgcGFydGljacOzbiAiICsgbWV0YWRhdGEucGFydGl0aW9uKCkgKyAiIEAgb2Zmc2V0ICIgKyBtZXRhZGF0YS5vZmZzZXQoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgcHJvZHVjZXIuY2xvc2UoKTsKICAgIH0KfQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.apache.kafka.clients.producer.*;

import java.util.Properties;

public class KafkaProducerExample {
    public static void main(String[] args) {
        Properties props = new Properties();
        props.put(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);
        props.put(&quot;key.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);
        props.put(&quot;value.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);

        Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props);

        ProducerRecord&lt;String, String&gt; record = new ProducerRecord&lt;&gt;(&quot;my-topic&quot;, &quot;key&quot;, &quot;value&quot;);

        producer.send(record, new Callback() {
            @Override
            public void onCompletion(RecordMetadata metadata, Exception exception) {
                if (exception != null) {
                    System.err.println(&quot;Error produciendo al t&oacute;pico &quot; + metadata.topic());
                    exception.printStackTrace();
                } else {
                    System.out.println(&quot;Registro producido al t&oacute;pico &quot; + metadata.topic() + &quot; partici&oacute;n &quot; + metadata.partition() + &quot; @ offset &quot; + metadata.offset());
                }
            }
        });

        producer.close();
    }
}</pre></div><div class='content'></div><h2>Manejo de Errores del Consumidor</h2>
<div class='content'><p>Los consumidores pueden encontrar errores al obtener mensajes de Kafka, como errores de deserialización o problemas de red. La API del consumidor de Kafka proporciona mecanismos para manejar estos errores de manera elegante.</p>
<h4>Ejemplo: Manejo de Errores del Consumidor</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5hcGFjaGUua2Fma2EuY2xpZW50cy5jb25zdW1lci4qOwppbXBvcnQgb3JnLmFwYWNoZS5rYWZrYS5jb21tb24uZXJyb3JzLldha2V1cEV4Y2VwdGlvbjsKCmltcG9ydCBqYXZhLnRpbWUuRHVyYXRpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuUHJvcGVydGllczsKCnB1YmxpYyBjbGFzcyBLYWZrYUNvbnN1bWVyRXhhbXBsZSB7CiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdzKSB7CiAgICAgICAgUHJvcGVydGllcyBwcm9wcyA9IG5ldyBQcm9wZXJ0aWVzKCk7CiAgICAgICAgcHJvcHMucHV0KCJib290c3RyYXAuc2VydmVycyIsICJsb2NhbGhvc3Q6OTA5MiIpOwogICAgICAgIHByb3BzLnB1dCgiZ3JvdXAuaWQiLCAibXktZ3JvdXAiKTsKICAgICAgICBwcm9wcy5wdXQoImtleS5kZXNlcmlhbGl6ZXIiLCAib3JnLmFwYWNoZS5rYWZrYS5jb21tb24uc2VyaWFsaXphdGlvbi5TdHJpbmdEZXNlcmlhbGl6ZXIiKTsKICAgICAgICBwcm9wcy5wdXQoInZhbHVlLmRlc2VyaWFsaXplciIsICJvcmcuYXBhY2hlLmthZmthLmNvbW1vbi5zZXJpYWxpemF0aW9uLlN0cmluZ0Rlc2VyaWFsaXplciIpOwoKICAgICAgICBDb25zdW1lcjxTdHJpbmcsIFN0cmluZz4gY29uc3VtZXIgPSBuZXcgS2Fma2FDb25zdW1lcjw+KHByb3BzKTsKICAgICAgICBjb25zdW1lci5zdWJzY3JpYmUoQ29sbGVjdGlvbnMuc2luZ2xldG9uTGlzdCgibXktdG9waWMiKSk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICBDb25zdW1lclJlY29yZHM8U3RyaW5nLCBTdHJpbmc+IHJlY29yZHMgPSBjb25zdW1lci5wb2xsKER1cmF0aW9uLm9mTWlsbGlzKDEwMCkpOwogICAgICAgICAgICAgICAgZm9yIChDb25zdW1lclJlY29yZDxTdHJpbmcsIFN0cmluZz4gcmVjb3JkIDogcmVjb3JkcykgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRmKCJSZWdpc3RybyBjb25zdW1pZG8gY29uIGNsYXZlICVzIHkgdmFsb3IgJXMlbiIsIHJlY29yZC5rZXkoKSwgcmVjb3JkLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRmKCJFcnJvciBwcm9jZXNhbmRvIHJlZ2lzdHJvIGNvbiBjbGF2ZSAlcyB5IHZhbG9yICVzJW4iLCByZWNvcmQua2V5KCksIHJlY29yZC52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmludFN0YWNrVHJhY2UoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChXYWtldXBFeGNlcHRpb24gZSkgewogICAgICAgICAgICAvLyBJZ25vcmFyIGV4Y2VwY2nDs24gc2kgc2UgZXN0w6EgY2VycmFuZG8KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBjb25zdW1lci5jbG9zZSgpOwogICAgICAgIH0KICAgIH0KfQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.apache.kafka.clients.consumer.*;
import org.apache.kafka.common.errors.WakeupException;

import java.time.Duration;
import java.util.Collections;
import java.util.Properties;

public class KafkaConsumerExample {
    public static void main(String[] args) {
        Properties props = new Properties();
        props.put(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);
        props.put(&quot;group.id&quot;, &quot;my-group&quot;);
        props.put(&quot;key.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);
        props.put(&quot;value.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);

        Consumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props);
        consumer.subscribe(Collections.singletonList(&quot;my-topic&quot;));

        try {
            while (true) {
                ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(100));
                for (ConsumerRecord&lt;String, String&gt; record : records) {
                    try {
                        System.out.printf(&quot;Registro consumido con clave %s y valor %s%n&quot;, record.key(), record.value());
                    } catch (Exception e) {
                        System.err.printf(&quot;Error procesando registro con clave %s y valor %s%n&quot;, record.key(), record.value());
                        e.printStackTrace();
                    }
                }
            }
        } catch (WakeupException e) {
            // Ignorar excepci&oacute;n si se est&aacute; cerrando
        } finally {
            consumer.close();
        }
    }
}</pre></div><div class='content'></div><h1>Estrategias de Reintentos</h1>
<div class='content'><p>Los reintentos son esenciales para asegurar que los errores transitorios no causen fallos permanentes. Kafka proporciona varias configuraciones para gestionar los reintentos.</p>
</div><h2>Reintentos del Productor</h2>
<div class='content'><p>Los productores de Kafka pueden configurarse para reintentar el envío de mensajes en caso de errores transitorios.</p>
<h4>Ejemplo: Configuración de Reintentos del Productor</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("UHJvcGVydGllcyBwcm9wcyA9IG5ldyBQcm9wZXJ0aWVzKCk7CnByb3BzLnB1dCgiYm9vdHN0cmFwLnNlcnZlcnMiLCAibG9jYWxob3N0OjkwOTIiKTsKcHJvcHMucHV0KCJrZXkuc2VyaWFsaXplciIsICJvcmcuYXBhY2hlLmthZmthLmNvbW1vbi5zZXJpYWxpemF0aW9uLlN0cmluZ1NlcmlhbGl6ZXIiKTsKcHJvcHMucHV0KCJ2YWx1ZS5zZXJpYWxpemVyIiwgIm9yZy5hcGFjaGUua2Fma2EuY29tbW9uLnNlcmlhbGl6YXRpb24uU3RyaW5nU2VyaWFsaXplciIpOwpwcm9wcy5wdXQoInJldHJpZXMiLCAzKTsgLy8gTsO6bWVybyBkZSByZWludGVudG9zCnByb3BzLnB1dCgicmV0cnkuYmFja29mZi5tcyIsIDEwMCk7IC8vIFRpZW1wbyBkZSByZXRyb2Nlc28gZW50cmUgcmVpbnRlbnRvcwoKUHJvZHVjZXI8U3RyaW5nLCBTdHJpbmc+IHByb2R1Y2VyID0gbmV3IEthZmthUHJvZHVjZXI8Pihwcm9wcyk7"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>Properties props = new Properties();
props.put(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);
props.put(&quot;key.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);
props.put(&quot;value.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);
props.put(&quot;retries&quot;, 3); // N&uacute;mero de reintentos
props.put(&quot;retry.backoff.ms&quot;, 100); // Tiempo de retroceso entre reintentos

Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props);</pre></div><div class='content'></div><h2>Reintentos del Consumidor</h2>
<div class='content'><p>Los consumidores pueden implementar lógica de reintento personalizada para manejar errores transitorios durante el procesamiento de mensajes.</p>
<h4>Ejemplo: Implementación de Reintentos del Consumidor</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHVibGljIGNsYXNzIEthZmthQ29uc3VtZXJXaXRoUmV0cmllcyB7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTUFYX1JFVFJJRVMgPSAzOwoKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHsKICAgICAgICBQcm9wZXJ0aWVzIHByb3BzID0gbmV3IFByb3BlcnRpZXMoKTsKICAgICAgICBwcm9wcy5wdXQoImJvb3RzdHJhcC5zZXJ2ZXJzIiwgImxvY2FsaG9zdDo5MDkyIik7CiAgICAgICAgcHJvcHMucHV0KCJncm91cC5pZCIsICJteS1ncm91cCIpOwogICAgICAgIHByb3BzLnB1dCgia2V5LmRlc2VyaWFsaXplciIsICJvcmcuYXBhY2hlLmthZmthLmNvbW1vbi5zZXJpYWxpemF0aW9uLlN0cmluZ0Rlc2VyaWFsaXplciIpOwogICAgICAgIHByb3BzLnB1dCgidmFsdWUuZGVzZXJpYWxpemVyIiwgIm9yZy5hcGFjaGUua2Fma2EuY29tbW9uLnNlcmlhbGl6YXRpb24uU3RyaW5nRGVzZXJpYWxpemVyIik7CgogICAgICAgIENvbnN1bWVyPFN0cmluZywgU3RyaW5nPiBjb25zdW1lciA9IG5ldyBLYWZrYUNvbnN1bWVyPD4ocHJvcHMpOwogICAgICAgIGNvbnN1bWVyLnN1YnNjcmliZShDb2xsZWN0aW9ucy5zaW5nbGV0b25MaXN0KCJteS10b3BpYyIpKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgIENvbnN1bWVyUmVjb3JkczxTdHJpbmcsIFN0cmluZz4gcmVjb3JkcyA9IGNvbnN1bWVyLnBvbGwoRHVyYXRpb24ub2ZNaWxsaXMoMTAwKSk7CiAgICAgICAgICAgICAgICBmb3IgKENvbnN1bWVyUmVjb3JkPFN0cmluZywgU3RyaW5nPiByZWNvcmQgOiByZWNvcmRzKSB7CiAgICAgICAgICAgICAgICAgICAgYm9vbGVhbiBzdWNjZXNzID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaW50IGF0dGVtcHQgPSAwOwogICAgICAgICAgICAgICAgICAgIHdoaWxlICghc3VjY2VzcyAmJiBhdHRlbXB0IDwgTUFYX1JFVFJJRVMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRmKCJSZWdpc3RybyBjb25zdW1pZG8gY29uIGNsYXZlICVzIHkgdmFsb3IgJXMlbiIsIHJlY29yZC5rZXkoKSwgcmVjb3JkLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRlbXB0Kys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50ZigiRXJyb3IgcHJvY2VzYW5kbyByZWdpc3RybyBjb24gY2xhdmUgJXMgeSB2YWxvciAlcywgaW50ZW50byAlZCVuIiwgcmVjb3JkLmtleSgpLCByZWNvcmQudmFsdWUoKSwgYXR0ZW1wdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByaW50U3RhY2tUcmFjZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaHJlYWQuc2xlZXAoMTAwKTsgLy8gUmV0cm9jZXNvIGFudGVzIGRlIHJlaW50ZW50YXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIXN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmVyci5wcmludGYoIkZhbGzDsyBlbCBwcm9jZXNhbWllbnRvIGRlbCByZWdpc3RybyBjb24gY2xhdmUgJXMgeSB2YWxvciAlcyBkZXNwdcOpcyBkZSAlZCBpbnRlbnRvcyVuIiwgcmVjb3JkLmtleSgpLCByZWNvcmQudmFsdWUoKSwgTUFYX1JFVFJJRVMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKFdha2V1cEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIElnbm9yYXIgZXhjZXBjacOzbiBzaSBzZSBlc3TDoSBjZXJyYW5kbwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGNvbnN1bWVyLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQp9"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>public class KafkaConsumerWithRetries {
    private static final int MAX_RETRIES = 3;

    public static void main(String[] args) {
        Properties props = new Properties();
        props.put(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);
        props.put(&quot;group.id&quot;, &quot;my-group&quot;);
        props.put(&quot;key.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);
        props.put(&quot;value.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);

        Consumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props);
        consumer.subscribe(Collections.singletonList(&quot;my-topic&quot;));

        try {
            while (true) {
                ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(100));
                for (ConsumerRecord&lt;String, String&gt; record : records) {
                    boolean success = false;
                    int attempt = 0;
                    while (!success &amp;&amp; attempt &lt; MAX_RETRIES) {
                        try {
                            System.out.printf(&quot;Registro consumido con clave %s y valor %s%n&quot;, record.key(), record.value());
                            success = true;
                        } catch (Exception e) {
                            attempt++;
                            System.err.printf(&quot;Error procesando registro con clave %s y valor %s, intento %d%n&quot;, record.key(), record.value(), attempt);
                            e.printStackTrace();
                            try {
                                Thread.sleep(100); // Retroceso antes de reintentar
                            } catch (InterruptedException ie) {
                                Thread.currentThread().interrupt();
                            }
                        }
                    }
                    if (!success) {
                        System.err.printf(&quot;Fall&oacute; el procesamiento del registro con clave %s y valor %s despu&eacute;s de %d intentos%n&quot;, record.key(), record.value(), MAX_RETRIES);
                    }
                }
            }
        } catch (WakeupException e) {
            // Ignorar excepci&oacute;n si se est&aacute; cerrando
        } finally {
            consumer.close();
        }
    }
}</pre></div><div class='content'></div><h1>Técnicas Avanzadas</h1>
<div class='content'><p>Las técnicas avanzadas de manejo de errores y reintentos pueden mejorar aún más la robustez de tus aplicaciones Kafka.</p>
</div><h2>Productor Idempotente</h2>
<div class='content'><p>Un productor idempotente asegura que los mensajes no se dupliquen, incluso si ocurren reintentos.</p>
<h4>Ejemplo: Configuración de Productor Idempotente</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("UHJvcGVydGllcyBwcm9wcyA9IG5ldyBQcm9wZXJ0aWVzKCk7CnByb3BzLnB1dCgiYm9vdHN0cmFwLnNlcnZlcnMiLCAibG9jYWxob3N0OjkwOTIiKTsKcHJvcHMucHV0KCJrZXkuc2VyaWFsaXplciIsICJvcmcuYXBhY2hlLmthZmthLmNvbW1vbi5zZXJpYWxpemF0aW9uLlN0cmluZ1NlcmlhbGl6ZXIiKTsKcHJvcHMucHV0KCJ2YWx1ZS5zZXJpYWxpemVyIiwgIm9yZy5hcGFjaGUua2Fma2EuY29tbW9uLnNlcmlhbGl6YXRpb24uU3RyaW5nU2VyaWFsaXplciIpOwpwcm9wcy5wdXQoImVuYWJsZS5pZGVtcG90ZW5jZSIsICJ0cnVlIik7IC8vIEhhYmlsaXRhciBpZGVtcG90ZW5jaWEKClByb2R1Y2VyPFN0cmluZywgU3RyaW5nPiBwcm9kdWNlciA9IG5ldyBLYWZrYVByb2R1Y2VyPD4ocHJvcHMpOw=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>Properties props = new Properties();
props.put(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);
props.put(&quot;key.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);
props.put(&quot;value.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);
props.put(&quot;enable.idempotence&quot;, &quot;true&quot;); // Habilitar idempotencia

Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props);</pre></div><div class='content'></div><h2>Cola de Mensajes Fallidos (DLQ)</h2>
<div class='content'><p>Una Cola de Mensajes Fallidos es un tópico especial de Kafka donde se envían los mensajes que no pueden procesarse después de un cierto número de reintentos para un análisis posterior.</p>
<h4>Ejemplo: Envío a DLQ</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHVibGljIGNsYXNzIEthZmthQ29uc3VtZXJXaXRoRExRIHsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBNQVhfUkVUUklFUyA9IDM7CgogICAgcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgewogICAgICAgIFByb3BlcnRpZXMgcHJvcHMgPSBuZXcgUHJvcGVydGllcygpOwogICAgICAgIHByb3BzLnB1dCgiYm9vdHN0cmFwLnNlcnZlcnMiLCAibG9jYWxob3N0OjkwOTIiKTsKICAgICAgICBwcm9wcy5wdXQoImdyb3VwLmlkIiwgIm15LWdyb3VwIik7CiAgICAgICAgcHJvcHMucHV0KCJrZXkuZGVzZXJpYWxpemVyIiwgIm9yZy5hcGFjaGUua2Fma2EuY29tbW9uLnNlcmlhbGl6YXRpb24uU3RyaW5nRGVzZXJpYWxpemVyIik7CiAgICAgICAgcHJvcHMucHV0KCJ2YWx1ZS5kZXNlcmlhbGl6ZXIiLCAib3JnLmFwYWNoZS5rYWZrYS5jb21tb24uc2VyaWFsaXphdGlvbi5TdHJpbmdEZXNlcmlhbGl6ZXIiKTsKCiAgICAgICAgQ29uc3VtZXI8U3RyaW5nLCBTdHJpbmc+IGNvbnN1bWVyID0gbmV3IEthZmthQ29uc3VtZXI8Pihwcm9wcyk7CiAgICAgICAgUHJvZHVjZXI8U3RyaW5nLCBTdHJpbmc+IHByb2R1Y2VyID0gbmV3IEthZmthUHJvZHVjZXI8Pihwcm9wcyk7CiAgICAgICAgY29uc3VtZXIuc3Vic2NyaWJlKENvbGxlY3Rpb25zLnNpbmdsZXRvbkxpc3QoIm15LXRvcGljIikpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgICAgQ29uc3VtZXJSZWNvcmRzPFN0cmluZywgU3RyaW5nPiByZWNvcmRzID0gY29uc3VtZXIucG9sbChEdXJhdGlvbi5vZk1pbGxpcygxMDApKTsKICAgICAgICAgICAgICAgIGZvciAoQ29uc3VtZXJSZWNvcmQ8U3RyaW5nLCBTdHJpbmc+IHJlY29yZCA6IHJlY29yZHMpIHsKICAgICAgICAgICAgICAgICAgICBib29sZWFuIHN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBpbnQgYXR0ZW1wdCA9IDA7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCFzdWNjZXNzICYmIGF0dGVtcHQgPCBNQVhfUkVUUklFUykgewogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGYoIlJlZ2lzdHJvIGNvbnN1bWlkbyBjb24gY2xhdmUgJXMgeSB2YWxvciAlcyVuIiwgcmVjb3JkLmtleSgpLCByZWNvcmQudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGVtcHQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRmKCJFcnJvciBwcm9jZXNhbmRvIHJlZ2lzdHJvIGNvbiBjbGF2ZSAlcyB5IHZhbG9yICVzLCBpbnRlbnRvICVkJW4iLCByZWNvcmQua2V5KCksIHJlY29yZC52YWx1ZSgpLCBhdHRlbXB0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRocmVhZC5zbGVlcCgxMDApOyAvLyBSZXRyb2Nlc28gYW50ZXMgZGUgcmVpbnRlbnRhcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLmludGVycnVwdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50ZigiRmFsbMOzIGVsIHByb2Nlc2FtaWVudG8gZGVsIHJlZ2lzdHJvIGNvbiBjbGF2ZSAlcyB5IHZhbG9yICVzIGRlc3B1w6lzIGRlICVkIGludGVudG9zLiBFbnZpYW5kbyBhIERMUS4lbiIsIHJlY29yZC5rZXkoKSwgcmVjb3JkLnZhbHVlKCksIE1BWF9SRVRSSUVTKTsKICAgICAgICAgICAgICAgICAgICAgICAgUHJvZHVjZXJSZWNvcmQ8U3RyaW5nLCBTdHJpbmc+IGRscVJlY29yZCA9IG5ldyBQcm9kdWNlclJlY29yZDw+KCJkbHEtdG9waWMiLCByZWNvcmQua2V5KCksIHJlY29yZC52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjZXIuc2VuZChkbHFSZWNvcmQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKFdha2V1cEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIElnbm9yYXIgZXhjZXBjacOzbiBzaSBzZSBlc3TDoSBjZXJyYW5kbwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGNvbnN1bWVyLmNsb3NlKCk7CiAgICAgICAgICAgIHByb2R1Y2VyLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQp9"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>public class KafkaConsumerWithDLQ {
    private static final int MAX_RETRIES = 3;

    public static void main(String[] args) {
        Properties props = new Properties();
        props.put(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);
        props.put(&quot;group.id&quot;, &quot;my-group&quot;);
        props.put(&quot;key.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);
        props.put(&quot;value.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);

        Consumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props);
        Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props);
        consumer.subscribe(Collections.singletonList(&quot;my-topic&quot;));

        try {
            while (true) {
                ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(100));
                for (ConsumerRecord&lt;String, String&gt; record : records) {
                    boolean success = false;
                    int attempt = 0;
                    while (!success &amp;&amp; attempt &lt; MAX_RETRIES) {
                        try {
                            System.out.printf(&quot;Registro consumido con clave %s y valor %s%n&quot;, record.key(), record.value());
                            success = true;
                        } catch (Exception e) {
                            attempt++;
                            System.err.printf(&quot;Error procesando registro con clave %s y valor %s, intento %d%n&quot;, record.key(), record.value(), attempt);
                            e.printStackTrace();
                            try {
                                Thread.sleep(100); // Retroceso antes de reintentar
                            } catch (InterruptedException ie) {
                                Thread.currentThread().interrupt();
                            }
                        }
                    }
                    if (!success) {
                        System.err.printf(&quot;Fall&oacute; el procesamiento del registro con clave %s y valor %s despu&eacute;s de %d intentos. Enviando a DLQ.%n&quot;, record.key(), record.value(), MAX_RETRIES);
                        ProducerRecord&lt;String, String&gt; dlqRecord = new ProducerRecord&lt;&gt;(&quot;dlq-topic&quot;, record.key(), record.value());
                        producer.send(dlqRecord);
                    }
                }
            }
        } catch (WakeupException e) {
            // Ignorar excepci&oacute;n si se est&aacute; cerrando
        } finally {
            consumer.close();
            producer.close();
        }
    }
}</pre></div><div class='content'></div><h1>Conclusión</h1>
<div class='content'><p>El manejo de errores y los reintentos son componentes esenciales para construir aplicaciones Kafka robustas. Al comprender e implementar las estrategias discutidas en esta sección, puedes asegurarte de que tus aplicaciones puedan manejar errores transitorios de manera elegante y mantener la integridad de los datos. Ya seas un principiante o un usuario avanzado, dominar estas técnicas mejorará significativamente la fiabilidad de tus sistemas basados en Kafka.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='producer-configuration'>&#x25C4;Configuración del Productor</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Manejo de Errores y Reintentos</a>
	</div>
	<div class='col-4 text-end'>
					<a href='consumer-api-overview'>Visión General de la API del Consumidor &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Aceptar</a>
    <a href="/cookies">Mas información</a>
</div>	

	</div>    
</body>
</html>
