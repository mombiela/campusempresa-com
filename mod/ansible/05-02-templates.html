<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plantillas</title>

    <link rel="alternate" href="https://campusempresa.com/mod/ansible/05-02-templates" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/ansible/05-02-templates" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/ansible/05-02-templates" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
										<a href="https://enterprisecampus.net/mod/ansible/05-02-templates" class="px-2">EN</a></b>
				|
				<b class="px-2">ES</b>
				|
				<a href="https://campusempresa.cat/mod/ansible/05-02-templates" class="px-2">CA</a>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Proyecto</a>
				<a href="/about">Sobre nosotros</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donaciones</a>
				<a href="/licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='05-01-handlers' title="Manejadores">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Plantillas</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='05-03-ansible-vault' title="Ansible Vault">Siguiente &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Las plantillas en Ansible son una herramienta poderosa que permite a los usuarios generar archivos de configuración dinámicos basados en variables y lógica definida en los playbooks. Las plantillas se escriben en el lenguaje de plantillas Jinja2, que es un motor de plantillas para Python.</p>
</div><h1>¿Qué es una Plantilla?</h1>
<div class='content'><p>Una plantilla es un archivo de texto que contiene marcadores de posición para datos dinámicos. Estos marcadores de posición se reemplazan con valores reales cuando la plantilla se procesa. En Ansible, las plantillas se utilizan comúnmente para generar archivos de configuración que se despliegan en los nodos gestionados.</p>
</div><h2>Ejemplo de Plantilla</h2>
<div class='content'><p>Supongamos que queremos crear un archivo de configuración para un servidor web. La plantilla podría verse así:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c2VydmVyIHsKICAgIGxpc3RlbiA4MDsKICAgIHNlcnZlcl9uYW1lIHt7IHNlcnZlcl9uYW1lIH19OwogICAgCiAgICBsb2NhdGlvbiAvIHsKICAgICAgICBwcm94eV9wYXNzIGh0dHA6Ly97eyBiYWNrZW5kX3NlcnZlciB9fTsKICAgICAgICBwcm94eV9zZXRfaGVhZGVyIEhvc3QgJGhvc3Q7CiAgICAgICAgcHJveHlfc2V0X2hlYWRlciBYLVJlYWwtSVAgJHJlbW90ZV9hZGRyOwogICAgICAgIHByb3h5X3NldF9oZWFkZXIgWC1Gb3J3YXJkZWQtRm9yICRwcm94eV9hZGRfeF9mb3J3YXJkZWRfZm9yOwogICAgICAgIHByb3h5X3NldF9oZWFkZXIgWC1Gb3J3YXJkZWQtUHJvdG8gJHNjaGVtZTsKICAgIH0KfQ=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>server {
    listen 80;
    server_name {{ server_name }};
    
    location / {
        proxy_pass http://{{ backend_server }};
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}</pre></div><div class='content'><p>En este ejemplo, <code>{{ server_name }}</code> y <code>{{ backend_server }}</code> son marcadores de posición que se reemplazarán con valores reales cuando la plantilla se procese.</p>
</div><h1>Uso de Plantillas en Ansible</h1>
<div class='content'><p>Para usar una plantilla en Ansible, se utiliza el módulo <code>template</code>. Este módulo copia una plantilla desde el controlador de Ansible al nodo gestionado, reemplazando los marcadores de posición con los valores de las variables definidas en el playbook.</p>
</div><h2>Ejemplo de Playbook con Plantilla</h2>
<div class='content'><p>A continuación, se muestra un ejemplo de un playbook que utiliza una plantilla:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogRGVzcGxlZ2FyIGNvbmZpZ3VyYWNpw7NuIGRlbCBzZXJ2aWRvciB3ZWIKICBob3N0czogd2Vic2VydmVycwogIHZhcnM6CiAgICBzZXJ2ZXJfbmFtZTogd3d3LmVqZW1wbG8uY29tCiAgICBiYWNrZW5kX3NlcnZlcjogMTkyLjE2OC4xLjEwCiAgdGFza3M6CiAgICAtIG5hbWU6IENvcGlhciBhcmNoaXZvIGRlIGNvbmZpZ3VyYWNpw7NuIGRlbCBzZXJ2aWRvciB3ZWIKICAgICAgdGVtcGxhdGU6CiAgICAgICAgc3JjOiB0ZW1wbGF0ZXMvbmdpbnguY29uZi5qMgogICAgICAgIGRlc3Q6IC9ldGMvbmdpbngvY29uZi5kL2RlZmF1bHQuY29uZgogICAgICBub3RpZnk6CiAgICAgICAgLSBSZWluaWNpYXIgTmdpbngKCiAgaGFuZGxlcnM6CiAgICAtIG5hbWU6IFJlaW5pY2lhciBOZ2lueAogICAgICBzZXJ2aWNlOgogICAgICAgIG5hbWU6IG5naW54CiAgICAgICAgc3RhdGU6IHJlc3RhcnRlZA=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Desplegar configuraci&oacute;n del servidor web
  hosts: webservers
  vars:
    server_name: www.ejemplo.com
    backend_server: 192.168.1.10
  tasks:
    - name: Copiar archivo de configuraci&oacute;n del servidor web
      template:
        src: templates/nginx.conf.j2
        dest: /etc/nginx/conf.d/default.conf
      notify:
        - Reiniciar Nginx

  handlers:
    - name: Reiniciar Nginx
      service:
        name: nginx
        state: restarted</pre></div><div class='content'></div><h2>Explicación del Playbook</h2>
<div class='content'><ol>
<li><strong>Definición del Playbook</strong>: El playbook se llama &quot;Desplegar configuración del servidor web&quot; y se ejecuta en los hosts del grupo <code>webservers</code>.</li>
<li><strong>Variables</strong>: Se definen dos variables: <code>server_name</code> y <code>backend_server</code>.</li>
<li><strong>Tarea de Plantilla</strong>: La tarea <code>template</code> copia la plantilla <code>nginx.conf.j2</code> desde el directorio <code>templates</code> en el controlador de Ansible al archivo <code>/etc/nginx/conf.d/default.conf</code> en el nodo gestionado.</li>
<li><strong>Notificación</strong>: La tarea <code>template</code> notifica al manejador <code>Reiniciar Nginx</code> para reiniciar el servicio Nginx si la plantilla se ha copiado con éxito.</li>
<li><strong>Manejador</strong>: El manejador <code>Reiniciar Nginx</code> reinicia el servicio Nginx.</li>
</ol>
</div><h1>Ejercicio Práctico</h1>
<div class='content'></div><h2>Ejercicio</h2>
<div class='content'><p>Crea un playbook que utilice una plantilla para generar un archivo de configuración de Apache. La plantilla debe incluir marcadores de posición para el nombre del servidor y el directorio raíz del documento.</p>
<h4>Pasos:</h4>
<ol>
<li>Crea una plantilla llamada <code>apache.conf.j2</code> con el siguiente contenido:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("PFZpcnR1YWxIb3N0ICo6ODA+CiAgICBTZXJ2ZXJOYW1lIHt7IHNlcnZlcl9uYW1lIH19CiAgICBEb2N1bWVudFJvb3Qge3sgZG9jdW1lbnRfcm9vdCB9fQogICAgPERpcmVjdG9yeSAie3sgZG9jdW1lbnRfcm9vdCB9fSI+CiAgICAgICAgQWxsb3dPdmVycmlkZSBBbGwKICAgICAgICBSZXF1aXJlIGFsbCBncmFudGVkCiAgICA8L0RpcmVjdG9yeT4KICAgIEVycm9yTG9nICR7QVBBQ0hFX0xPR19ESVJ9L2Vycm9yLmxvZwogICAgQ3VzdG9tTG9nICR7QVBBQ0hFX0xPR19ESVJ9L2FjY2Vzcy5sb2cgY29tYmluZWQKPC9WaXJ0dWFsSG9zdD4="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>&lt;VirtualHost *:80&gt;
    ServerName {{ server_name }}
    DocumentRoot {{ document_root }}
    &lt;Directory &quot;{{ document_root }}&quot;&gt;
        AllowOverride All
        Require all granted
    &lt;/Directory&gt;
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
&lt;/VirtualHost&gt;</pre></div><div class='content'><ol start="2">
<li>Crea un playbook llamado <code>deploy_apache.yml</code> con el siguiente contenido:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogRGVzcGxlZ2FyIGNvbmZpZ3VyYWNpw7NuIGRlIEFwYWNoZQogIGhvc3RzOiB3ZWJzZXJ2ZXJzCiAgdmFyczoKICAgIHNlcnZlcl9uYW1lOiB3d3cuZWplbXBsby5jb20KICAgIGRvY3VtZW50X3Jvb3Q6IC92YXIvd3d3L2h0bWwKICB0YXNrczoKICAgIC0gbmFtZTogQ29waWFyIGFyY2hpdm8gZGUgY29uZmlndXJhY2nDs24gZGUgQXBhY2hlCiAgICAgIHRlbXBsYXRlOgogICAgICAgIHNyYzogdGVtcGxhdGVzL2FwYWNoZS5jb25mLmoyCiAgICAgICAgZGVzdDogL2V0Yy9hcGFjaGUyL3NpdGVzLWF2YWlsYWJsZS8wMDAtZGVmYXVsdC5jb25mCiAgICAgIG5vdGlmeToKICAgICAgICAtIFJlaW5pY2lhciBBcGFjaGUKCiAgaGFuZGxlcnM6CiAgICAtIG5hbWU6IFJlaW5pY2lhciBBcGFjaGUKICAgICAgc2VydmljZToKICAgICAgICBuYW1lOiBhcGFjaGUyCiAgICAgICAgc3RhdGU6IHJlc3RhcnRlZA=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Desplegar configuraci&oacute;n de Apache
  hosts: webservers
  vars:
    server_name: www.ejemplo.com
    document_root: /var/www/html
  tasks:
    - name: Copiar archivo de configuraci&oacute;n de Apache
      template:
        src: templates/apache.conf.j2
        dest: /etc/apache2/sites-available/000-default.conf
      notify:
        - Reiniciar Apache

  handlers:
    - name: Reiniciar Apache
      service:
        name: apache2
        state: restarted</pre></div><div class='content'></div><h2>Solución</h2>
<div class='content'><ol>
<li><strong>Plantilla <code>apache.conf.j2</code></strong>:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("PFZpcnR1YWxIb3N0ICo6ODA+CiAgICBTZXJ2ZXJOYW1lIHt7IHNlcnZlcl9uYW1lIH19CiAgICBEb2N1bWVudFJvb3Qge3sgZG9jdW1lbnRfcm9vdCB9fQogICAgPERpcmVjdG9yeSAie3sgZG9jdW1lbnRfcm9vdCB9fSI+CiAgICAgICAgQWxsb3dPdmVycmlkZSBBbGwKICAgICAgICBSZXF1aXJlIGFsbCBncmFudGVkCiAgICA8L0RpcmVjdG9yeT4KICAgIEVycm9yTG9nICR7QVBBQ0hFX0xPR19ESVJ9L2Vycm9yLmxvZwogICAgQ3VzdG9tTG9nICR7QVBBQ0hFX0xPR19ESVJ9L2FjY2Vzcy5sb2cgY29tYmluZWQKPC9WaXJ0dWFsSG9zdD4="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>&lt;VirtualHost *:80&gt;
    ServerName {{ server_name }}
    DocumentRoot {{ document_root }}
    &lt;Directory &quot;{{ document_root }}&quot;&gt;
        AllowOverride All
        Require all granted
    &lt;/Directory&gt;
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
&lt;/VirtualHost&gt;</pre></div><div class='content'><ol start="2">
<li><strong>Playbook <code>deploy_apache.yml</code></strong>:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogRGVzcGxlZ2FyIGNvbmZpZ3VyYWNpw7NuIGRlIEFwYWNoZQogIGhvc3RzOiB3ZWJzZXJ2ZXJzCiAgdmFyczoKICAgIHNlcnZlcl9uYW1lOiB3d3cuZWplbXBsby5jb20KICAgIGRvY3VtZW50X3Jvb3Q6IC92YXIvd3d3L2h0bWwKICB0YXNrczoKICAgIC0gbmFtZTogQ29waWFyIGFyY2hpdm8gZGUgY29uZmlndXJhY2nDs24gZGUgQXBhY2hlCiAgICAgIHRlbXBsYXRlOgogICAgICAgIHNyYzogdGVtcGxhdGVzL2FwYWNoZS5jb25mLmoyCiAgICAgICAgZGVzdDogL2V0Yy9hcGFjaGUyL3NpdGVzLWF2YWlsYWJsZS8wMDAtZGVmYXVsdC5jb25mCiAgICAgIG5vdGlmeToKICAgICAgICAtIFJlaW5pY2lhciBBcGFjaGUKCiAgaGFuZGxlcnM6CiAgICAtIG5hbWU6IFJlaW5pY2lhciBBcGFjaGUKICAgICAgc2VydmljZToKICAgICAgICBuYW1lOiBhcGFjaGUyCiAgICAgICAgc3RhdGU6IHJlc3RhcnRlZA=="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Desplegar configuraci&oacute;n de Apache
  hosts: webservers
  vars:
    server_name: www.ejemplo.com
    document_root: /var/www/html
  tasks:
    - name: Copiar archivo de configuraci&oacute;n de Apache
      template:
        src: templates/apache.conf.j2
        dest: /etc/apache2/sites-available/000-default.conf
      notify:
        - Reiniciar Apache

  handlers:
    - name: Reiniciar Apache
      service:
        name: apache2
        state: restarted</pre></div><div class='content'></div><h1>Resumen</h1>
<div class='content'><p>En esta sección, hemos aprendido sobre las plantillas en Ansible y cómo utilizarlas para generar archivos de configuración dinámicos. Hemos visto un ejemplo práctico de cómo usar el módulo <code>template</code> en un playbook y hemos realizado un ejercicio para reforzar los conceptos aprendidos. Las plantillas son una herramienta esencial en Ansible para gestionar configuraciones de manera eficiente y flexible.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='05-01-handlers' title="Manejadores">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='05-03-ansible-vault' title="Ansible Vault">Siguiente &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Aceptar</a>
    <a href="/cookies">Mas información</a>
</div>	

	</div>    
</body>
</html>
