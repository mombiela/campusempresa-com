<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Módulos Personalizados</title>

    <link rel="alternate" href="https://campusempresa.com/mod/ansible/10-01-custom-modules" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/ansible/10-01-custom-modules" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/ansible/10-01-custom-modules" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Construyendo la sociedad de hoy y del mañana</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
										<a href="https://enterprisecampus.net/mod/ansible/10-01-custom-modules" class="px-2">EN</a></b>
				|
				<b class="px-2">ES</b>
				|
				<a href="https://campusempresa.cat/mod/ansible/10-01-custom-modules" class="px-2">CA</a>
								</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">El Proyecto</a>
				<a href="/about">Sobre nosotros</a>
				<a href="/contribute">Contribuir</a>
				<a href="/donate">Donaciones</a>
				<a href="/licence">Licencia</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='09-04-testing-ansible-code' title="Pruebas de Código Ansible">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Módulos Personalizados</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='10-02-dynamic-inventory' title="Inventario Dinámico">Siguiente &#x25BA;</a>
			</div>
</div>
<div class='content'><p>En este módulo, aprenderás cómo crear tus propios módulos personalizados en Ansible. Los módulos personalizados te permiten extender la funcionalidad de Ansible para satisfacer necesidades específicas que no están cubiertas por los módulos integrados.</p>
</div><h1><p>Objetivos del Módulo</p>
</h1>
<div class='content'><ul>
<li>Comprender la estructura básica de un módulo personalizado.</li>
<li>Aprender a escribir y ejecutar un módulo personalizado.</li>
<li>Conocer las mejores prácticas para desarrollar módulos personalizados.</li>
</ul>
</div><h1><ol>
<li>Introducción a los Módulos Personalizados</li>
</ol>
</h1>
<div class='content'></div><h2><p>¿Qué es un Módulo Personalizado?</p>
</h2>
<div class='content'><p>Un módulo personalizado en Ansible es un script que puedes escribir para realizar tareas específicas que no están cubiertas por los módulos integrados. Estos módulos pueden ser escritos en cualquier lenguaje de programación, aunque Python es el más común debido a su integración nativa con Ansible.</p>
</div><h2><p>¿Por qué Crear Módulos Personalizados?</p>
</h2>
<div class='content'><ul>
<li><strong>Flexibilidad:</strong> Permiten realizar tareas específicas que no están cubiertas por los módulos existentes.</li>
<li><strong>Reusabilidad:</strong> Pueden ser reutilizados en múltiples playbooks y proyectos.</li>
<li><strong>Mantenibilidad:</strong> Facilitan la organización y mantenimiento del código.</li>
</ul>
</div><h1><ol start="2">
<li>Estructura de un Módulo Personalizado</li>
</ol>
</h1>
<div class='content'></div><h2><p>Componentes Básicos</p>
</h2>
<div class='content'><p>Un módulo personalizado generalmente consta de los siguientes componentes:</p>
<ul>
<li><strong>Documentación:</strong> Describe el propósito del módulo, sus parámetros y ejemplos de uso.</li>
<li><strong>Argument Spec:</strong> Define los argumentos que el módulo acepta.</li>
<li><strong>Main Function:</strong> Contiene la lógica principal del módulo.</li>
<li><strong>Exit JSON:</strong> Devuelve el resultado de la ejecución del módulo.</li>
</ul>
</div><h2><p>Ejemplo de Estructura</p>
</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyEvdXNyL2Jpbi9weXRob24KCmZyb20gYW5zaWJsZS5tb2R1bGVfdXRpbHMuYmFzaWMgaW1wb3J0IEFuc2libGVNb2R1bGUKCmRlZiBydW5fbW9kdWxlKCk6CiAgICAjIERlZmluaXIgbG9zIGFyZ3VtZW50b3MgcXVlIGVsIG3Ds2R1bG8gYWNlcHRhCiAgICBtb2R1bGVfYXJncyA9IGRpY3QoCiAgICAgICAgbmFtZT1kaWN0KHR5cGU9J3N0cicsIHJlcXVpcmVkPVRydWUpLAogICAgICAgIHN0YXRlPWRpY3QodHlwZT0nc3RyJywgcmVxdWlyZWQ9VHJ1ZSwgY2hvaWNlcz1bJ3ByZXNlbnQnLCAnYWJzZW50J10pCiAgICApCgogICAgIyBDcmVhciBlbCBvYmpldG8gQW5zaWJsZU1vZHVsZQogICAgbW9kdWxlID0gQW5zaWJsZU1vZHVsZSgKICAgICAgICBhcmd1bWVudF9zcGVjPW1vZHVsZV9hcmdzLAogICAgICAgIHN1cHBvcnRzX2NoZWNrX21vZGU9VHJ1ZQogICAgKQoKICAgICMgT2J0ZW5lciBsb3MgcGFyw6FtZXRyb3MKICAgIG5hbWUgPSBtb2R1bGUucGFyYW1zWyduYW1lJ10KICAgIHN0YXRlID0gbW9kdWxlLnBhcmFtc1snc3RhdGUnXQoKICAgICMgTMOzZ2ljYSBkZWwgbcOzZHVsbwogICAgcmVzdWx0ID0gZGljdCgKICAgICAgICBjaGFuZ2VkPUZhbHNlLAogICAgICAgIG9yaWdpbmFsX21lc3NhZ2U9JycsCiAgICAgICAgbWVzc2FnZT0nJwogICAgKQoKICAgIGlmIHN0YXRlID09ICdwcmVzZW50JzoKICAgICAgICByZXN1bHRbJ2NoYW5nZWQnXSA9IFRydWUKICAgICAgICByZXN1bHRbJ21lc3NhZ2UnXSA9IGYne25hbWV9IGlzIG5vdyBwcmVzZW50JwogICAgZWxpZiBzdGF0ZSA9PSAnYWJzZW50JzoKICAgICAgICByZXN1bHRbJ2NoYW5nZWQnXSA9IFRydWUKICAgICAgICByZXN1bHRbJ21lc3NhZ2UnXSA9IGYne25hbWV9IGlzIG5vdyBhYnNlbnQnCgogICAgIyBTYWxpZGEgZGVsIG3Ds2R1bG8KICAgIG1vZHVsZS5leGl0X2pzb24oKipyZXN1bHQpCgpkZWYgbWFpbigpOgogICAgcnVuX21vZHVsZSgpCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAgbWFpbigp"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#!/usr/bin/python

from ansible.module_utils.basic import AnsibleModule

def run_module():
    # Definir los argumentos que el m&oacute;dulo acepta
    module_args = dict(
        name=dict(type='str', required=True),
        state=dict(type='str', required=True, choices=['present', 'absent'])
    )

    # Crear el objeto AnsibleModule
    module = AnsibleModule(
        argument_spec=module_args,
        supports_check_mode=True
    )

    # Obtener los par&aacute;metros
    name = module.params['name']
    state = module.params['state']

    # L&oacute;gica del m&oacute;dulo
    result = dict(
        changed=False,
        original_message='',
        message=''
    )

    if state == 'present':
        result['changed'] = True
        result['message'] = f'{name} is now present'
    elif state == 'absent':
        result['changed'] = True
        result['message'] = f'{name} is now absent'

    # Salida del m&oacute;dulo
    module.exit_json(**result)

def main():
    run_module()

if __name__ == '__main__':
    main()</pre></div><div class='content'></div><h1><ol start="3">
<li>Escribiendo tu Primer Módulo Personalizado</li>
</ol>
</h1>
<div class='content'></div><h2><p>Paso a Paso</p>
</h2>
<div class='content'><ol>
<li>
<p><strong>Crear el Archivo del Módulo:</strong>
Crea un archivo Python, por ejemplo, <code>my_custom_module.py</code>.</p>
</li>
<li>
<p><strong>Importar AnsibleModule:</strong></p>
<pre><code class="language-python">from ansible.module_utils.basic import AnsibleModule
</code></pre>
</li>
<li>
<p><strong>Definir Argumentos:</strong></p>
<pre><code class="language-python">module_args = dict(
    name=dict(type='str', required=True),
    state=dict(type='str', required=True, choices=['present', 'absent'])
)
</code></pre>
</li>
<li>
<p><strong>Crear el Objeto AnsibleModule:</strong></p>
<pre><code class="language-python">module = AnsibleModule(
    argument_spec=module_args,
    supports_check_mode=True
)
</code></pre>
</li>
<li>
<p><strong>Obtener Parámetros:</strong></p>
<pre><code class="language-python">name = module.params['name']
state = module.params['state']
</code></pre>
</li>
<li>
<p><strong>Implementar la Lógica del Módulo:</strong></p>
<pre><code class="language-python">result = dict(
    changed=False,
    original_message='',
    message=''
)

if state == 'present':
    result['changed'] = True
    result['message'] = f'{name} is now present'
elif state == 'absent':
    result['changed'] = True
    result['message'] = f'{name} is now absent'
</code></pre>
</li>
<li>
<p><strong>Devolver el Resultado:</strong></p>
<pre><code class="language-python">module.exit_json(**result)
</code></pre>
</li>
<li>
<p><strong>Definir la Función Principal:</strong></p>
<pre><code class="language-python">def main():
    run_module()

if __name__ == '__main__':
    main()
</code></pre>
</li>
</ol>
</div><h2><p>Ejemplo Completo</p>
</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyEvdXNyL2Jpbi9weXRob24KCmZyb20gYW5zaWJsZS5tb2R1bGVfdXRpbHMuYmFzaWMgaW1wb3J0IEFuc2libGVNb2R1bGUKCmRlZiBydW5fbW9kdWxlKCk6CiAgICBtb2R1bGVfYXJncyA9IGRpY3QoCiAgICAgICAgbmFtZT1kaWN0KHR5cGU9J3N0cicsIHJlcXVpcmVkPVRydWUpLAogICAgICAgIHN0YXRlPWRpY3QodHlwZT0nc3RyJywgcmVxdWlyZWQ9VHJ1ZSwgY2hvaWNlcz1bJ3ByZXNlbnQnLCAnYWJzZW50J10pCiAgICApCgogICAgbW9kdWxlID0gQW5zaWJsZU1vZHVsZSgKICAgICAgICBhcmd1bWVudF9zcGVjPW1vZHVsZV9hcmdzLAogICAgICAgIHN1cHBvcnRzX2NoZWNrX21vZGU9VHJ1ZQogICAgKQoKICAgIG5hbWUgPSBtb2R1bGUucGFyYW1zWyduYW1lJ10KICAgIHN0YXRlID0gbW9kdWxlLnBhcmFtc1snc3RhdGUnXQoKICAgIHJlc3VsdCA9IGRpY3QoCiAgICAgICAgY2hhbmdlZD1GYWxzZSwKICAgICAgICBvcmlnaW5hbF9tZXNzYWdlPScnLAogICAgICAgIG1lc3NhZ2U9JycKICAgICkKCiAgICBpZiBzdGF0ZSA9PSAncHJlc2VudCc6CiAgICAgICAgcmVzdWx0WydjaGFuZ2VkJ10gPSBUcnVlCiAgICAgICAgcmVzdWx0WydtZXNzYWdlJ10gPSBmJ3tuYW1lfSBpcyBub3cgcHJlc2VudCcKICAgIGVsaWYgc3RhdGUgPT0gJ2Fic2VudCc6CiAgICAgICAgcmVzdWx0WydjaGFuZ2VkJ10gPSBUcnVlCiAgICAgICAgcmVzdWx0WydtZXNzYWdlJ10gPSBmJ3tuYW1lfSBpcyBub3cgYWJzZW50JwoKICAgIG1vZHVsZS5leGl0X2pzb24oKipyZXN1bHQpCgpkZWYgbWFpbigpOgogICAgcnVuX21vZHVsZSgpCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAgbWFpbigp"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#!/usr/bin/python

from ansible.module_utils.basic import AnsibleModule

def run_module():
    module_args = dict(
        name=dict(type='str', required=True),
        state=dict(type='str', required=True, choices=['present', 'absent'])
    )

    module = AnsibleModule(
        argument_spec=module_args,
        supports_check_mode=True
    )

    name = module.params['name']
    state = module.params['state']

    result = dict(
        changed=False,
        original_message='',
        message=''
    )

    if state == 'present':
        result['changed'] = True
        result['message'] = f'{name} is now present'
    elif state == 'absent':
        result['changed'] = True
        result['message'] = f'{name} is now absent'

    module.exit_json(**result)

def main():
    run_module()

if __name__ == '__main__':
    main()</pre></div><div class='content'></div><h1><ol start="4">
<li>Ejecutando el Módulo Personalizado</li>
</ol>
</h1>
<div class='content'></div><h2><p>Incluir el Módulo en un Playbook</p>
</h2>
<div class='content'><p>Para ejecutar tu módulo personalizado, inclúyelo en un playbook de la siguiente manera:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogVGVzdCBjdXN0b20gbW9kdWxlCiAgaG9zdHM6IGxvY2FsaG9zdAogIHRhc2tzOgogICAgLSBuYW1lOiBFbnN1cmUgbXlfY3VzdG9tX21vZHVsZSB3b3JrcwogICAgICBteV9jdXN0b21fbW9kdWxlOgogICAgICAgIG5hbWU6ICJleGFtcGxlIgogICAgICAgIHN0YXRlOiAicHJlc2VudCI="))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Test custom module
  hosts: localhost
  tasks:
    - name: Ensure my_custom_module works
      my_custom_module:
        name: &quot;example&quot;
        state: &quot;present&quot;</pre></div><div class='content'></div><h2><p>Ejecutar el Playbook</p>
</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YW5zaWJsZS1wbGF5Ym9vayB0ZXN0X2N1c3RvbV9tb2R1bGUueW1s"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ansible-playbook test_custom_module.yml</pre></div><div class='content'></div><h1><ol start="5">
<li>Mejores Prácticas</li>
</ol>
</h1>
<div class='content'><ul>
<li><strong>Documentación:</strong> Asegúrate de documentar bien tu módulo para que otros usuarios puedan entender su propósito y cómo usarlo.</li>
<li><strong>Pruebas:</strong> Realiza pruebas exhaustivas para asegurarte de que tu módulo funciona correctamente en diferentes escenarios.</li>
<li><strong>Manejo de Errores:</strong> Implementa un manejo de errores adecuado para que el módulo pueda manejar situaciones inesperadas de manera elegante.</li>
</ul>
</div><h1><ol start="6">
<li>Ejercicio Práctico</li>
</ol>
</h1>
<div class='content'></div><h2><p>Ejercicio</p>
</h2>
<div class='content'><p>Crea un módulo personalizado que gestione archivos en el sistema. El módulo debe aceptar los siguientes parámetros:</p>
<ul>
<li><code>path</code>: Ruta del archivo.</li>
<li><code>state</code>: Estado del archivo (<code>present</code> para crear, <code>absent</code> para eliminar).</li>
</ul>
</div><h2><p>Solución</p>
</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyEvdXNyL2Jpbi9weXRob24KCmZyb20gYW5zaWJsZS5tb2R1bGVfdXRpbHMuYmFzaWMgaW1wb3J0IEFuc2libGVNb2R1bGUKaW1wb3J0IG9zCgpkZWYgcnVuX21vZHVsZSgpOgogICAgbW9kdWxlX2FyZ3MgPSBkaWN0KAogICAgICAgIHBhdGg9ZGljdCh0eXBlPSdzdHInLCByZXF1aXJlZD1UcnVlKSwKICAgICAgICBzdGF0ZT1kaWN0KHR5cGU9J3N0cicsIHJlcXVpcmVkPVRydWUsIGNob2ljZXM9WydwcmVzZW50JywgJ2Fic2VudCddKQogICAgKQoKICAgIG1vZHVsZSA9IEFuc2libGVNb2R1bGUoCiAgICAgICAgYXJndW1lbnRfc3BlYz1tb2R1bGVfYXJncywKICAgICAgICBzdXBwb3J0c19jaGVja19tb2RlPVRydWUKICAgICkKCiAgICBwYXRoID0gbW9kdWxlLnBhcmFtc1sncGF0aCddCiAgICBzdGF0ZSA9IG1vZHVsZS5wYXJhbXNbJ3N0YXRlJ10KCiAgICByZXN1bHQgPSBkaWN0KAogICAgICAgIGNoYW5nZWQ9RmFsc2UsCiAgICAgICAgb3JpZ2luYWxfbWVzc2FnZT0nJywKICAgICAgICBtZXNzYWdlPScnCiAgICApCgogICAgaWYgc3RhdGUgPT0gJ3ByZXNlbnQnOgogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoKToKICAgICAgICAgICAgb3BlbihwYXRoLCAndycpLmNsb3NlKCkKICAgICAgICAgICAgcmVzdWx0WydjaGFuZ2VkJ10gPSBUcnVlCiAgICAgICAgICAgIHJlc3VsdFsnbWVzc2FnZSddID0gZidGaWxlIHtwYXRofSBjcmVhdGVkJwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJlc3VsdFsnbWVzc2FnZSddID0gZidGaWxlIHtwYXRofSBhbHJlYWR5IGV4aXN0cycKICAgIGVsaWYgc3RhdGUgPT0gJ2Fic2VudCc6CiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMocGF0aCk6CiAgICAgICAgICAgIG9zLnJlbW92ZShwYXRoKQogICAgICAgICAgICByZXN1bHRbJ2NoYW5nZWQnXSA9IFRydWUKICAgICAgICAgICAgcmVzdWx0WydtZXNzYWdlJ10gPSBmJ0ZpbGUge3BhdGh9IGRlbGV0ZWQnCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmVzdWx0WydtZXNzYWdlJ10gPSBmJ0ZpbGUge3BhdGh9IGRvZXMgbm90IGV4aXN0JwoKICAgIG1vZHVsZS5leGl0X2pzb24oKipyZXN1bHQpCgpkZWYgbWFpbigpOgogICAgcnVuX21vZHVsZSgpCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAgbWFpbigp"))));alert("¡Copiado!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#!/usr/bin/python

from ansible.module_utils.basic import AnsibleModule
import os

def run_module():
    module_args = dict(
        path=dict(type='str', required=True),
        state=dict(type='str', required=True, choices=['present', 'absent'])
    )

    module = AnsibleModule(
        argument_spec=module_args,
        supports_check_mode=True
    )

    path = module.params['path']
    state = module.params['state']

    result = dict(
        changed=False,
        original_message='',
        message=''
    )

    if state == 'present':
        if not os.path.exists(path):
            open(path, 'w').close()
            result['changed'] = True
            result['message'] = f'File {path} created'
        else:
            result['message'] = f'File {path} already exists'
    elif state == 'absent':
        if os.path.exists(path):
            os.remove(path)
            result['changed'] = True
            result['message'] = f'File {path} deleted'
        else:
            result['message'] = f'File {path} does not exist'

    module.exit_json(**result)

def main():
    run_module()

if __name__ == '__main__':
    main()</pre></div><div class='content'></div><h1><p>Conclusión</p>
</h1>
<div class='content'><p>En este módulo, has aprendido cómo crear y ejecutar módulos personalizados en Ansible. Los módulos personalizados te permiten extender la funcionalidad de Ansible para satisfacer necesidades específicas, proporcionando flexibilidad y reusabilidad en tus playbooks. Asegúrate de seguir las mejores prácticas para documentar, probar y manejar errores en tus módulos personalizados. En el próximo módulo, exploraremos el uso de inventarios dinámicos en Ansible.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='09-04-testing-ansible-code' title="Pruebas de Código Ansible">&#x25C4;Anterior</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='10-02-dynamic-inventory' title="Inventario Dinámico">Siguiente &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Publicidad</h1>
			<p>Este espacio está destinado a publicidad.</p>
			<p>Si quieres ser patrocinador, contáctanos para incluir enlaces en esta zona: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>¡Gracias por colaborar!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. Todos los derechos reservados</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Usamos cookies para mejorar tu experiencia de uso y ofrecer contenidos adaptados a tus intereses.
    <a href="#" id="btn_accept_cookies" class="button">Aceptar</a>
    <a href="/cookies">Mas información</a>
</div>	

	</div>    
</body>
</html>
